<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>File System on Coding_Panda&#39;s Blog</title>
        <link>https://blog.ipandai.club/tags/file-system/</link>
        <description>Recent content in File System on Coding_Panda&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 02 Mar 2023 15:11:40 +0800</lastBuildDate><atom:link href="https://blog.ipandai.club/tags/file-system/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>[FAST&#39;23] More Than Capacity: Performance-oriented Evolution of Pangu in Alibaba</title>
        <link>https://blog.ipandai.club/p/fast23-more-than-capacity-performance-oriented-evolution-of-pangu-in-alibaba/</link>
        <pubDate>Thu, 02 Mar 2023 15:11:40 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/fast23-more-than-capacity-performance-oriented-evolution-of-pangu-in-alibaba/</guid>
        <description>&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast23/presentation/li-qiang-deployed&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[FAST&#39;23] More Than Capacity: Performance-oriented Evolution of Pangu in Alibaba&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;FAST&#39;23 ä¼šè®®è®ºæ–‡ç¿»è¯‘ï¼Œã€Šä¸ä»…ä»…æ˜¯å®¹é‡:ç›˜å¤é¢å‘æ€§èƒ½çš„æ¼”å˜ã€‹&lt;/p&gt;
&lt;p&gt;æœ¬è®ºæ–‡è®²è¿°äº†Panguå­˜å‚¨ç³»ç»Ÿæ˜¯å¦‚ä½•éšç€ç¡¬ä»¶åŠå•†ä¸šéœ€æ±‚ï¼Œå»æ¼”å˜æä¾›æ›´é«˜çš„æ€§èƒ½çš„ï¼Œå­˜å‚¨æœåŠ¡çš„I/Oå»¶è¿Ÿè¾¾åˆ°äº†100-usã€‚ç›˜å¤çš„æ¼”å˜ä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Phase 1: ç›˜å¤é€šè¿‡ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿå¹¶è®¾è®¡äº†ç”¨æˆ·ç«¯çš„å­˜å‚¨æ“ä½œç³»ç»Ÿï¼Œç§¯æå¼•å…¥é«˜é€ŸSSDå’ŒRemote Direct Memory Access(RDMA)ç½‘ç»œæŠ€æœ¯ã€‚å› æ­¤ï¼Œç›˜å¤åœ¨æœ‰æ•ˆé™ä½äº†I/Oå»¶è¿Ÿçš„åŒæ—¶ï¼Œè¿˜æé«˜äº†ååé‡å’ŒIOPSã€‚&lt;/li&gt;
&lt;li&gt;Phase 2: ç›˜å¤ä»é¢å‘å·çš„å­˜å‚¨ä¾›åº”å•†è½¬å˜ä¸ºé¢å‘æ€§èƒ½ã€‚ä¸ºäº†é€‚åº”è¿™ä¸€å•†ä¸šæ¨¡å¼çš„æ”¹å˜ï¼Œç›˜å¤ä½¿ç”¨è¶³å¤Ÿå¤šçš„SSDå’Œ25Gbps-100Gbpsçš„RDMAå¸¦å®½æ›´æ–°äº†åŸºç¡€è®¾æ–½ã€‚è¿™å¼•å…¥äº†ä¸€äº›åˆ—çš„å…³é”®è®¾è®¡ï¼ŒåŒ…æ‹¬å‡å°‘æµé‡æ”¾å¤§ï¼Œè¿œç¨‹ç›´æ¥ç¼“å­˜è®¿é—®ï¼Œå’ŒCPUè®¡ç®—å¸è½½ï¼Œæ¥ä¿è¯ç›˜å¤å®Œå…¨è·å¾—åŸºäºç¡¬ä»¶å‡çº§æ‰€å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é™¤äº†æŠ€æœ¯ä¸Šçš„åˆ›æ–°ï¼Œä½œè€…è¿˜åˆ†äº«äº†ç›˜å¤å‘å±•è¿‡ç¨‹ä¸­çš„è¿è¥ç»éªŒï¼Œå¹¶è®¨è®ºäº†å…¶ä¸­çš„é‡è¦æ•™è®­ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;ç›˜å¤çš„å¼€å‘å§‹äº2009å¹´ï¼Œç›®å‰å·²ç»æ˜¯é˜¿é‡Œå·´å·´é›†å›¢å’Œé˜¿é‡Œäº‘ç»Ÿä¸€å­˜å‚¨å¹³å°ã€‚ç›˜å¤ä¸ºé˜¿é‡Œçš„æ ¸å¿ƒä¸šåŠ¡æä¾›äº†å¯ä¼¸ç¼©æ€§ã€é«˜æ€§èƒ½å’Œå¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Elastic Block Storage(EBS), Object Storage Service(OSS), Network-Attached Storage(NAS), PolarDB, MaxComputeè¿™äº›äº‘æœåŠ¡åŸºäºç›˜å¤å»ºç«‹ã€‚ç»è¿‡åå‡ å¹´çš„å‘å±•ï¼Œç›˜å¤å·²ç»æˆä¸ºäº†ä¸€ä¸ªæ‹¥æœ‰ExaByteså¹¶ç®¡ç†ä¸‡äº¿æ–‡ä»¶çš„å…¨å±€å­˜å‚¨ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›˜å¤-10-æä¾›å­˜å‚¨å®¹é‡&#34;&gt;ç›˜å¤ 1.0: æä¾›å­˜å‚¨å®¹é‡&lt;/h2&gt;
&lt;p&gt;Pangu 1.0è®¾è®¡äº2009-2015å¹´ï¼Œé€šè¿‡é«˜æ€§èƒ½çš„CPUå’ŒHDDç»„æˆï¼Œå¯ä»¥æä¾›msæ¯«ç§’çº§åˆ«çš„I/Oå»¶è¿Ÿå’ŒGbpsçº§åˆ«çš„&lt;strong&gt;æ•°æ®ä¸­å¿ƒå¸¦å®½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Pangu 1.0åŸºäºLinux Ext4è®¾è®¡äº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„å†…æ ¸æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸TCPï¼Œå¹¶ç»™äºˆä¸åŒç§ç±»çš„å­˜å‚¨æœåŠ¡æä¾›å¤šç§æ–‡ä»¶ç±»å‹æ”¯æŒï¼ˆTempfileï¼ŒLogFileï¼ŒRandom Access fileï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶æ­£å¤„äºäº‘è®¡ç®—çš„åˆå§‹é˜¶æ®µï¼Œæ€§èƒ½å—é™äºHDDæ€§èƒ½å’Œç½‘ç»œå¸¦å®½ï¼Œç›¸è¾ƒäºæ›´å¿«çš„è®¿é—®é€Ÿåº¦ï¼Œç”¨æˆ·æ›´å…³æ³¨å­˜å‚¨å®¹é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–°çš„ç¡¬ä»¶æ–°çš„è®¾è®¡&#34;&gt;æ–°çš„ç¡¬ä»¶ï¼Œæ–°çš„è®¾è®¡&lt;/h2&gt;
&lt;p&gt;è‡ª2015å¹´èµ·ï¼Œä¸ºäº†å¼•å…¥æ–°å…´çš„SSDå’ŒRDMAæŠ€æœ¯ï¼Œç›˜å¤2.0å¼€å§‹è®¾è®¡å’Œå¼€å‘ã€‚ç›˜å¤2.0çš„ç›®æ ‡æ˜¯æä¾›100usçº§åˆ«I/Oå»¶è¿Ÿçš„é«˜æ€§èƒ½çš„å­˜å‚¨æœåŠ¡ã€‚å°½ç®¡SSDå’ŒRDMAåœ¨å­˜å‚¨å’Œç½‘ç»œä¸­å®ç°ä½å»¶è¿Ÿã€é«˜æ€§èƒ½çš„I/Oï¼Œå›¢é˜Ÿå‘ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›˜å¤1.0ä¸­ä½¿ç”¨çš„å¤šç§æ–‡ä»¶ç±»å‹ï¼Œç‰¹åˆ«æ˜¯å…è®¸éšæœºè®¿é—®çš„æ–‡ä»¶ç±»å‹ï¼Œåœ¨å›ºæ€ç¡¬ç›˜ä¸Šçš„è¡¨ç°å¾ˆå·®ï¼Œè€Œå›ºæ€ç¡¬ç›˜åœ¨é¡ºåºæ“ä½œä¸Šå¯ä»¥å®ç°é«˜ååé‡å’ŒIOPSã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºæ•°æ®å¤åˆ¶å’Œé¢‘ç¹çš„ä¸­æ–­ï¼Œå†…æ ¸ç©ºé—´çš„è½¯ä»¶æ ˆæ— æ³•è·Ÿä¸ŠSSDå’ŒRDMAçš„é«˜IOPSå’Œä½I/Oå»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;ä»ä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„æ•°æ®ä¸­å¿ƒæ¶æ„å‘èµ„æºåˆ†æ•£çš„æ•°æ®ä¸­å¿ƒæ¶æ„çš„èŒƒå¼è½¬å˜ï¼Œå¯¹å®ç°ä½I/Oå»¶è¿Ÿæå‡ºäº†é¢å¤–çš„æŒ‘æˆ˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç›˜å¤20-phase-1-é€šè¿‡é‡æ„æ–‡ä»¶ç³»ç»Ÿä¸ç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿæ¥æ‹¥æŠ±ssdå’Œrdma&#34;&gt;ç›˜å¤2.0 Phase 1: é€šè¿‡é‡æ„æ–‡ä»¶ç³»ç»Ÿä¸ç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿæ¥æ‹¥æŠ±SSDå’ŒRDMA&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†å®ç°é«˜æ€§èƒ½å’Œä½I/Oå»¶è¿Ÿï¼Œç›˜å¤2.0é¦–å…ˆåœ¨å…¶æ–‡ä»¶ç³»ç»Ÿä¸­çš„å…³é”®ç»„ä»¶æå‡ºäº†æ–°çš„è®¾è®¡ã€‚ä¸ºäº†ç®€åŒ–æ•´ä¸ªç³»ç»Ÿçš„å¼€å‘å’Œç®¡ç†ï¼Œç›˜å¤è®¾è®¡äº†ä¸€ä¸ªç»Ÿä¸€ã€è¿½åŠ å†™å…¥çš„æŒä¹…åŒ–å±‚ã€‚å®ƒè¿˜å¼•å…¥äº†ä¸€ä¸ªç‹¬ç«‹çš„åˆ†å—å¸ƒå±€ï¼Œä»¥å‡å°‘æ–‡ä»¶å†™å…¥æ“ä½œçš„I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›˜å¤2.0è®¾è®¡äº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿï¼ˆUSSOSï¼‰ï¼ŒUSSOSSä½¿ç”¨ä¸€ä¸ªRTC(Run to completion)çº¿ç¨‹æ¨¡å‹æ¥å®ç°ç”¨æˆ·ç©ºé—´å­˜å‚¨æ ˆå’Œç”¨æˆ·ç©ºé—´ç½‘ç»œæ ˆçš„é«˜æ•ˆåä½œã€‚å®ƒè¿˜ä¸ºé«˜æ•ˆçš„CPUå’Œå†…å­˜èµ„æºåˆ†é…æå‡ºäº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›˜å¤2.0éƒ¨ç½²äº†åœ¨åŠ¨æ€ç¯å¢ƒä¸‹æä¾›SLAä¿è¯çš„æœºåˆ¶ã€‚é€šè¿‡è¿™äº›åˆ›æ–°ï¼Œç›˜å¤2.0å®ç°äº†æ¯«ç§’çº§åˆ«çš„P999 I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç›˜å¤20-phase-2-é€šè¿‡åŸºç¡€è®¾æ–½æ›´æ–°å’Œçªç ´ç½‘ç»œå†…å­˜cpuç“¶é¢ˆé€‚åº”ä»¥æ€§èƒ½ä¸ºå¯¼å‘çš„ä¸šåŠ¡æ¨¡å¼&#34;&gt;ç›˜å¤2.0 Phase 2: é€šè¿‡åŸºç¡€è®¾æ–½æ›´æ–°å’Œçªç ´ç½‘ç»œ/å†…å­˜/CPUç“¶é¢ˆï¼Œé€‚åº”ä»¥æ€§èƒ½ä¸ºå¯¼å‘çš„ä¸šåŠ¡æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;2018å¹´èµ·ï¼Œç›˜å¤é€æ¸ä»å®¹é‡å¯¼å‘çš„å•†ä¸šæ¨¡å¼è½¬å˜ä¸ºæ€§èƒ½å¯¼å‘ã€‚è¿™æ˜¯å› ä¸ºè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šç”¨æˆ·å°†ä»–ä»¬çš„ä¸šåŠ¡è½¬ç§»åˆ°äº†é˜¿é‡Œäº‘å¹¶ä¸”ä»–ä»¬å¯¹å­˜å‚¨æ€§èƒ½çš„å»¶è¿Ÿå’Œæ€§èƒ½æœ‰å¾ˆä¸¥æ ¼çš„è¦æ±‚ã€‚è¿™åœ¨COVID-19ç–«æƒ…çˆ†å‘ä¹‹åå˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œä¸ºäº†é€‚åº”è¿™ä¸€å•†ä¸šæ¨¡å¼è½¬å˜å’Œæ—¥ç›Šå¢é•¿çš„ç”¨æˆ·ï¼Œç›˜å¤2.0éœ€è¦ç»§ç»­å‡çº§åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨åŸæœ‰çš„æœåŠ¡å™¨å’Œäº¤æ¢æœºæ²¿ç€åŸºäºCLOSæ¶æ„çš„æ‹“æ‰‘ç»“æ„æ¥å¯¹åŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å®¹æ˜¯ä¸ç»æµçš„ï¼ŒåŒ…æ‹¬é«˜æ˜‚çš„æ€»æˆæœ¬ï¼ˆæœºæ¶ç©ºé—´ã€ç”µåŠ›ã€æ•£çƒ­ã€äººåŠ›æˆæœ¬ï¼‰å’Œæ›´é«˜çš„ç¢³æ’æ”¾/ç¯å¢ƒé—®é¢˜ã€‚å› æ­¤ï¼Œç›˜å¤å¼€å‘æ¥å®¤å†…é«˜å®¹é‡å­˜å‚¨æœåŠ¡å™¨ï¼ˆæ¯ä¸ªæœåŠ¡å™¨96TB SSDï¼‰å¹¶ä¸”å‡çº§åˆ°äº†25Gbps-100Gbpsçš„ç½‘ç»œå¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œå…¨è·å¾—è¿™äº›å‡çº§å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œç›˜å¤2.0æå‡ºäº†ä¸€ç³»åˆ—çš„æŠ€æœ¯æ¥å¤„ç†åœ¨{ç½‘ç»œ/å†…å­˜/CPU}çš„æ€§èƒ½ç“¶é¢ˆå¹¶å……åˆ†åˆ©ç”¨å…¶å¼ºå¤§çš„ç¡¬ä»¶èµ„æºã€‚å…·ä½“æ¥è¯´ï¼Œç›˜å¤2.0é€šè¿‡å‡å°‘ç½‘ç»œæµé‡æ”¾å¤§ç‡å’ŒåŠ¨æ€è°ƒæ•´ä¸åŒæµé‡çš„ä¼˜å…ˆçº§æ¥ä¼˜åŒ–ç½‘ç»œå¸¦å®½ï¼›é€šè¿‡æå‡ºRemote Direct Cache Access(RDCA)æ¥å¤„ç†å†…å­˜ç“¶é¢ˆï¼›é€šè¿‡æ¶ˆé™¤æ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¼€é”€å¹¶å¼•å…¥CPUç­‰å¾…æŒ‡ä»¤æ¥åŒæ­¥è¶…çº¿ç¨‹ï¼Œä»¥æ­¤æ¥è§£å†³CPUç“¶é¢ˆé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿäº§ä¸­çš„é«˜æ€§èƒ½&#34;&gt;ç”Ÿäº§ä¸­çš„é«˜æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;ç›˜å¤2.0æˆåŠŸæ”¯æŒäº†elastic SSD blockå­˜å‚¨æœåŠ¡ï¼Œå¹¶å¯è¾¾åˆ°100usçº§åˆ«çš„I/Oå»¶è¿Ÿå’Œ1Mçš„IOPSã€‚åœ¨2018å¹´åŒåä¸€æ´»åŠ¨ï¼Œç›˜å¤2.0åŠ æŒä¸‹çš„é˜¿é‡Œæ•°æ®åº“å®ç°äº†280usçš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºOTSå­˜å‚¨æœåŠ¡ï¼ŒåŒæ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ã€‚ç›˜å¤2.0çš„I/Oå»¶è¿Ÿæ¯”ç›˜å¤1.0é™ä½äº†ä¸€ä¸ªæ•°é‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå†™æ•æ„Ÿçš„æœåŠ¡ï¼ˆEBSäº‘ç›˜ï¼‰ï¼ŒP999 I/Oå»¶è¿Ÿä½äº1msã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¯»æ•æ„Ÿçš„æœåŠ¡ï¼ˆåœ¨çº¿æœç´¢ï¼‰ï¼ŒP999 I/Oå»¶è¿Ÿä½äº11msã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬äºŒé˜¶æ®µï¼Œé€šè¿‡å°†2x25Gbpså¸¦å®½å‡çº§åˆ°2x100Gbpsï¼Œå¹¶è§£å†³äº†ç½‘ç»œã€å†…å­˜ã€CPUç“¶é¢ˆï¼Œæ¯å°æ³°å±±å­˜å‚¨æœåŠ¡å™¨çš„æœ‰æ•ˆååé‡å¢åŠ äº†6.1å€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Elastic SSD Block/EBSäº‘ç›˜ï¼šæ˜¯ä¸ºé˜¿é‡Œäº‘ä¸ºäº‘æœåŠ¡å™¨ECSæä¾›çš„ä½æ—¶å»¶ã€æŒä¹…æ€§ã€é«˜å¯é çš„å—çº§éšæœºå­˜å‚¨ã€‚å—å­˜å‚¨æ”¯æŒåœ¨å¯ç”¨åŒºå†…è‡ªåŠ¨å¤åˆ¶ç”¨æˆ·çš„æ•°æ®ï¼Œé˜²æ­¢æ„å¤–ç¡¬ä»¶æ•…éšœå¯¼è‡´çš„æ•°æ®ä¸å¯ç”¨ï¼Œä¿æŠ¤ä¸šåŠ¡å…äºç¡¬ä»¶æ•…éšœçš„å¨èƒã€‚&lt;/p&gt;
&lt;p&gt;OTSï¼šOpen Table Serviceï¼Œå·²æ›´åTable Storeï¼Œæ˜¯æ„å»ºåœ¨é˜¿é‡Œäº‘é£å¤©åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹ä¸Šçš„NoSQLæ•°æ®åº“æœåŠ¡ï¼Œæä¾›æµ·é‡ç»“æ„åŒ–æ•°æ®çš„å­˜å‚¨å’Œå®æ—¶è®¿é—®ã€‚Table Storeä»¥å®ä¾‹å’Œè¡¨çš„å½¢å¼ç»„ç»‡æ•°æ®ï¼Œé€šè¿‡æ•°æ®åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå®ç°è§„æ¨¡ä¸Šçš„æ— ç¼æ‰©å±•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x01-bg&#34;&gt;0x01 Bg&lt;/h1&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;ç›˜å¤æ˜¯å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œç”±ï¼šç›˜å¤æ ¸å¿ƒï¼Œç›˜å¤æœåŠ¡å±‚ï¼Œç›˜å¤ç›‘æ§ç³»ç»Ÿç»„æˆï¼ˆFigure 1ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230303140052844.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230303140052844&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤core&#34;&gt;ç›˜å¤Core&lt;/h3&gt;
&lt;p&gt;ç›˜å¤æ ¸å¿ƒç”±ï¼šclientsï¼Œmastersï¼Œchunk seversç»„æˆï¼Œæä¾›è¿½åŠ å†™å…¥çš„å­˜å‚¨è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Client&lt;/strong&gt;æä¾›è®¿é—®ç›˜å¤äº‘å­˜å‚¨æœåŠ¡ï¼ˆEBSï¼ŒOSSï¼‰çš„SDKï¼Œå¹¶è´Ÿè´£æ¥æ”¶ä»æœåŠ¡ç«¯å‘é€çš„æ–‡ä»¶è¯·æ±‚ï¼Œä¸masterså’Œchunk serversé€šä¿¡æ¥å®ç°è¿™äº›è¯·æ±‚ã€‚ç±»ä¼¼äºå…¶ä»–åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆTectonicï¼ŒColossusï¼‰ï¼Œç›˜å¤ä¸­çš„Clientsè´Ÿè´£è¾ƒé‡çš„å·¥ä½œå¹¶åœ¨ç›˜å¤çš„å¤åˆ¶ç®¡ç†ã€SLAä¿éšœã€æ•°æ®ä¸€è‡´æ€§ç®¡ç†ä¸­æ‰®æ¼”å…³é”®è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Master&lt;/strong&gt;ç®¡ç†ç›˜å¤ä¸­çš„æ‰€æœ‰å…ƒæ•°æ®å¹¶ä½¿ç”¨åŸºäºRaftçš„åè®®æ¥ç»´æŠ¤å…ƒæ•°æ®çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€‚ä¸ºäº†æ›´å¥½çš„æ°´å¹³æ‰©å±•æ€§å’Œå»¶ä¼¸æ€§ï¼ˆå¤§é‡çš„æ–‡ä»¶æ•°ï¼‰ï¼Œç›˜å¤masteråˆ†è§£å…ƒæ•°æ®æœåŠ¡ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šnamespaceæœåŠ¡å’Œstream metaæœåŠ¡ï¼Œstreamæ˜¯ä¸€ç»„chunkçš„æŠ½è±¡ã€‚è¿™ä¸¤ä¸ªæœåŠ¡é¦–å…ˆæ ¹æ®ç›®å½•æ ‘åˆ†éš”å…ƒæ•°æ®æ¥å®ç°å±€éƒ¨åŸæ•°æ®ï¼Œç„¶åé€šè¿‡å“ˆå¸Œå°†è¿™äº›streamè¿›ä¸€æ­¥åˆ†éš”ä»¥è¾¾åˆ°è´Ÿè½½å‡è¡¡ã€‚namespaceæœåŠ¡æä¾›æ–‡ä»¶çš„ä¿¡æ¯ï¼ˆç›®å½•æ ‘å’Œå‘½åç©ºé—´ï¼‰ï¼Œstreamå…ƒæ•°æ®æœåŠ¡æä¾›ä»æ–‡ä»¶åˆ°chunkçš„æ˜ å°„ï¼ˆchunkçš„ä½ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ChunkServers&lt;/strong&gt;ä»¥chunkå­˜å‚¨æ•°æ®å¹¶é…å¤‡æœ‰è‡ªå®šä¹‰çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿï¼ˆUSSFSï¼‰ï¼ŒUSSFSä¸ºä¸åŒç¡¬ä»¶ï¼ˆSMRSTORE for HM-SMR drivesï¼‰æä¾›é«˜æ€§èƒ½ï¼Œè¿½åŠ å†™å…¥çš„å­˜å‚¨å¼•æ“ã€‚åœ¨ç›˜å¤2.0çš„ç¬¬ä¸€é˜¶æ®µï¼Œæ¯ä¸ªå­˜å‚¨åœ¨chunkserversçš„æ–‡ä»¶éƒ½æœ‰ä¸‰ä¸ªå†—ä½™ï¼Œç”±GCWorkerè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¹¶ä½¿ç”¨ECï¼ˆErasure Codingï¼‰ç¼–ç æ¥å­˜å‚¨æ–‡ä»¶ã€‚åœ¨ç›˜å¤2.0çš„ç¬¬äºŒé˜¶æ®µï¼Œåœ¨å•†ä¸šæ¨¡å¼ä¸­ï¼Œä½¿ç”¨ECæ›¿æ¢3ä¸ªå†—ä½™çš„å­˜å‚¨æ–¹å¼æ¥å‡å°‘æµé‡æ”¾å¤§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤service&#34;&gt;ç›˜å¤Service&lt;/h3&gt;
&lt;p&gt;ç›˜å¤æœåŠ¡å±‚æä¾›ä¼ ç»Ÿçš„äº‘å­˜å‚¨æœåŠ¡ï¼ˆEBSã€OSSã€NASï¼‰ï¼Œé€šè¿‡é¢ç›¸äº‘åŸç”Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆFiscï¼‰æä¾›äº‘åŸç”Ÿå­˜å‚¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤monitoring-system&#34;&gt;ç›˜å¤Monitoring System&lt;/h3&gt;
&lt;p&gt;Perseusä¸ºç›˜å¤æ ¸å¿ƒå’Œç›˜å¤æœåŠ¡æä¾›å®æ—¶ç›‘æ§å’Œäººå·¥æ™ºèƒ½è¾…åŠ©çš„æ ¹æœ¬åŸå› åˆ†ææœåŠ¡ã€‚ç›˜å¤Coreã€ç›˜å¤Serviceã€ç›˜å¤Monitoring Systemé€šè¿‡é«˜é€Ÿç½‘ç»œç›¸è¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›˜å¤20çš„è®¾è®¡ç›®æ ‡&#34;&gt;ç›˜å¤2.0çš„è®¾è®¡ç›®æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½å»¶è¿Ÿï¼šç›˜å¤2.0è¦åˆ©ç”¨SSDå’ŒRDMAä½å»¶è¿Ÿçš„ç‰¹æ€§ï¼Œåœ¨è®¡ç®—-å­˜å‚¨åˆ†ç¦»æ¶æ„ä¸­å®ç°å¹³å‡100usçº§åˆ«I/Oå»¶è¿Ÿçš„æ€§èƒ½ç›®æ ‡ï¼Œå³ä½¿åœ¨ç½‘ç»œæµé‡æŠ–åŠ¨å’ŒæœåŠ¡å™¨æ•…éšœç­‰åŠ¨æ€ç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½æä¾›æ¯«ç§’çº§åˆ« P999 SLAã€‚&lt;/li&gt;
&lt;li&gt;é«˜ååé‡ï¼šä½¿å­˜å‚¨æœåŠ¡å™¨çš„æœ‰æ•ˆååé‡æ¥è¿‘å…¶å®¹é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ‰€æœ‰æœåŠ¡æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½æ”¯æŒï¼šä¸ºè¿è¡Œåœ¨å…¶ä¸Šçš„æ‰€æœ‰ä¸šåŠ¡æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½æ”¯æŒï¼Œä¾‹å¦‚åœ¨çº¿æœç´¢ã€æ•°æ®æµåˆ†æã€EBSã€OSSå’Œæ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;related-work&#34;&gt;Related Work&lt;/h2&gt;
&lt;p&gt;ç›®å‰æœ‰å¾ˆå¤šåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿè¢«æå‡ºå’Œä½¿ç”¨&lt;/p&gt;
&lt;p&gt;å¼€æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://hadoop.apache.org/docs/r1.2.1/hdfs_design.htmll&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HDFSï¼ˆHadoop FSï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://ceph.com/en/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cephï¼ˆRedhatï¼‰[OSDI&#39;06] Ceph: A Scalable, High-Performance Distributed File System&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://pdos.csail.mit.edu/6.824/papers/gfs.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GFSï¼ˆGoogleï¼‰[SOSP&#39;03] The Google File System&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast21/presentation/pan&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Tectonic (FaceBook)[FAST&#39;21] Facebookâ€™s Tectonic Filesystem: Efficiency from Exascale&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://aws.amazon.com/products/storage/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;AWS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é˜¿é‡Œå·´å·´çš„ç›˜å¤å›¢é˜Ÿåˆ†äº«è¿‡å¾ˆå¤šç›˜å¤çš„è®¾è®¡ç†å¿µï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RDMAå¤§å‹éƒ¨ç½²,&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/system/files/nsdi21-gao.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[NSDI&#39;21] When Cloud Storage Meets RDMA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¨ªå‘æ‰©å±•äº‘å­˜å‚¨æœåŠ¡çš„Key-Valueé”®å€¼å­˜å‚¨å¼•æ“&lt;a class=&#34;link&#34; href=&#34;https://dl.acm.org/doi/abs/10.1145/3448016.3457553&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[SIGMOD&#39;21] A Key-Value Engine for Scalable Cloud Storage Services&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;EBSå­˜å‚¨æœåŠ¡çš„ç½‘ç»œå’Œå­˜å‚¨è½¯ä»¶æ ˆååŒè®¾è®¡&lt;a class=&#34;link&#34; href=&#34;https://dl.acm.org/doi/abs/10.1145/3544216.3544238&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[SIGCOMM&#39;22] From Luna to Solar: the Evolu- tions of the Compute-to-Storage Networks in Alibaba Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;namespaceå…ƒæ•°æ®æœåŠ¡çš„å…³é”®è®¾è®¡&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast22/presentation/lv&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[FAST&#39;22] InfiniFS: An Efficient Metadata Service for Large-Scale Distributed Filesystems&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x02-phase-one-embracing-ssd-and-rdma&#34;&gt;0x02 Phase One: Embracing SSD and RDMA&lt;/h1&gt;
&lt;p&gt;ç›¸è¾ƒäºHDDå’ŒTCPï¼ŒSSDå’ŒRDMAæŠ€æœ¯æ˜¾è‘—é™ä½äº†I/Oå»¶è¿Ÿå’Œç½‘ç»œé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤é€šè¿‡å¼€å‘ç”¨æˆ·ç©ºé—´å­˜å‚¨æ“ä½œç³»ç»Ÿå¹¶æå‡ºä¸€äº›æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡æ¥å®ç°é«˜ååé‡ã€100usçº§åˆ«I/Oå»¶è¿Ÿçš„é«˜IOPSæ€§èƒ½ã€‚åŒæ—¶æä¾›äº†æ–°çš„æœºåˆ¶æ¥ä¿éšœSLAã€‚&lt;/p&gt;
&lt;h2 id=&#34;append-only-file-system&#34;&gt;Append-Only File System&lt;/h2&gt;
&lt;p&gt;ç›˜å¤æå‡ºäº†ç»Ÿä¸€ã€è¿½åŠ å†™å…¥çš„æŒä¹…å±‚ï¼Œé€šè¿‡åä¸ºFlatLogFileçš„è¿½åŠ å†™å…¥æ¥å£æ¥ç®€åŒ–æ¶æ„ã€‚FlatLogFileå…·æœ‰é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚åŸºäºFlatLogFileï¼Œç›˜å¤é‡‡ç”¨è¿½åŠ å†™å…¥çš„chunkï¼Œå¹¶ä½¿ç”¨ç‹¬ç«‹chunkå¸ƒå±€æ¥ç®¡ç†chunkserverä¸­çš„chunk&lt;/p&gt;
&lt;h3 id=&#34;unified-append-only-persistence-layer&#34;&gt;Unified, Append-Only Persistence Layer&lt;/h3&gt;
&lt;p&gt;ç›˜å¤çš„æŒä¹…åŒ–å±‚ä¸ºå­˜å‚¨æœåŠ¡æä¾›æ¥å£ã€‚åœ¨æ—©æœŸå¼€å‘é˜¶æ®µï¼Œä¸åŒçš„å­˜å‚¨æœåŠ¡ä¼šä½¿ç”¨ä¸åŒçš„æ¥å£ï¼Œä¾‹å¦‚LogFileæ¥å£æœåŠ¡äºä½å»¶è¿Ÿçš„NASæœåŠ¡ï¼ŒTempFileæ¥å£æœåŠ¡äºé«˜ååé‡çš„å¤§å‹è®¡ç®—æ•°æ®åˆ†ææœåŠ¡ã€‚ç„¶è€Œï¼Œè¿™ç§è®¾è®¡ä½¿å¼€å‘å’Œç®¡ç†éå¸¸å¤æ‚ã€‚æ¯ä¸ªæ¥å£éƒ½éœ€è¦æœ‰äººå¼€å‘å’Œç»´æŠ¤ï¼ŒäººåŠ›æˆæœ¬é«˜åˆ‡å®¹æ˜“å‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œéœ€è¦ç®€åŒ–å¼€å‘ç®¡ç†è¿‡ç¨‹ï¼Œè¿˜è¦å¼•å…¥ä½å»¶è¿Ÿçš„SSDï¼Œå—åˆ°è®¡ç®—æœºç½‘ç»œåˆ†å±‚æ¶æ„çš„å¯å‘ï¼Œç›˜å¤æå‡ºäº†ç»Ÿä¸€çš„æ–‡ä»¶ç±»å‹ï¼šFlatLogFileï¼ˆFigure 2ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230303201714075.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230303201714075&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;FlatLogFileä»…æ”¯æŒè¿½åŠ å†™å…¥ï¼Œä¸Šå±‚æœåŠ¡ï¼ˆOSSï¼‰å¯ä»¥å¯ä»¥ä½¿ç”¨ç±»ä¼¼é”®å€¼çš„æ˜ å°„æ¥æ›´æ–°æ•°æ®ï¼Œå¹¶ä½¿ç”¨åƒåœ¾æ”¶é›†æœºåˆ¶æ¥å‹ç¼©å†å²æ•°æ®ã€‚FlatLogFileä¸ºå­˜å‚¨æœåŠ¡æä¾›ç®€å•ã€ç»Ÿä¸€çš„æ¥å£æ“ä½œæ•°æ®ã€‚ç›˜å¤çš„å¼€å‘è€…å¿…é¡»ä¿è¯æ•°æ®æ“ä½œéƒ½æ˜¯é€šè¿‡FlatLogFileï¼Œå°¤å…¶æ˜¯å†™å…¥æ“ä½œï¼Œå¯ä»¥é«˜æ•ˆå¹¶å¯é çš„åœ¨å­˜å‚¨ä»‹è´¨ä¸Šæ‰§è¡Œã€‚å› æ­¤ï¼Œå­˜å‚¨æœåŠ¡çš„ä»»ä½•å‡çº§å’Œæ”¹å˜å¯¹äºå¼€å‘è€…è€Œè¨€éƒ½æ˜¯é€æ˜çš„ï¼Œç®€åŒ–äº†å¼€å‘å’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åº•å±‚ï¼Œå›¢é˜Ÿè§‚å¯Ÿåˆ°SSDç”±äºå…¶è‡ªèº«çš„å­˜å‚¨å•å…ƒå’Œé—ªå­˜äº‹åŠ¡å±‚çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨é¡ºåºæ“ä½œä¸Šè·å¾—è¾ƒé«˜çš„ååé‡å’ŒIOPSã€‚ä¸ºäº†ä¿è¯é€šè¿‡FlatLogFileè¿›è¡Œçš„æ•°æ®æ“ä½œèƒ½å¤Ÿåœ¨SSDä¸Šé«˜æ•ˆåœ°æ‰§è¡Œï¼Œæˆ‘ä»¬å°†FlatLogFileä¸Šçš„é¡ºåºæ“ä½œå¯¹é½ä»¥å®ç°é«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heavy-weight-client&#34;&gt;Heavy weight Client&lt;/h3&gt;
&lt;p&gt;è„æ´»ç´¯æ´»éƒ½æ˜¯Clientæ¥å¹²ã€‚Clientè´Ÿè´£ä¸chunkserversä¸€èµ·è¿›è¡Œæ•°æ®æ“ä½œï¼Œä¸masterä¸€èµ·è¿›è¡Œå…ƒæ•°æ®ä¿¡æ¯çš„æ£€ç´¢å’Œæ›´æ–°ã€‚åœ¨ä»mastersè·å–chunkä¿¡æ¯åï¼Œä¸€ä¸ªç›˜å¤Clientå°†è´Ÿè´£ç›¸åº”çš„å¤åˆ¶åè®®å’ŒECåè®®ã€‚Clientæœ‰é‡è¯•æœºåˆ¶ï¼ˆå¤‡ä»½è¯»å–Â¥3.3ï¼‰æ¥å¤„ç†æ„å¤–çš„æ€§èƒ½æŠ–åŠ¨ï¼ˆä¸¢åŒ…ï¼‰æ¥ä¿éšœI/O SLAã€‚&lt;/p&gt;
&lt;p&gt;Clientè¿˜æœ‰æ¢æµ‹æœºåˆ¶ï¼Œå®šæœŸä»mastersè·å–æœ€æ–°çš„ chunkserver çŠ¶æ€ï¼Œå¹¶è¯„ä¼° chunkserver çš„æœåŠ¡è´¨é‡ã€‚ç±»ä¼¼äºFacebook Tectonic FSçš„clientï¼Œç›˜å¤çš„Clientå¯ä»¥é€‰æ‹©åˆé€‚çš„è¯»å†™å‚æ•°æ¥å¤„ç†å…·ä½“çš„å­˜å‚¨æœåŠ¡æŒ‡ä»¤ï¼ˆEBS/OSSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;append-only-chunk-management&#34;&gt;Append-Only Chunk Management&lt;/h3&gt;
&lt;p&gt;ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿåœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼ŒåŒæ—¶åˆ†ç¦»å†™å…¥æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œäº§ç”Ÿä¸¤æ¬¡SSDçš„å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é™ä½å»¶è¿Ÿå’Œå»¶é•¿SSDå¯¿å‘½ï¼Œç›˜å¤åŸºäºFlatLogFileçš„append-onlyè¯­ä¹‰ï¼Œé€‰æ‹©ä»¥chunkä¸ºå•ä½å­˜å‚¨æ–‡ä»¶ï¼Œè€Œéblockï¼Œchunkå­˜å‚¨åœ¨chunkseverä¸­ï¼Œå¹¶æœ‰ç‹¬ç«‹çš„å¸ƒå±€ï¼Œæ¯ä¸ªchunkéƒ½ä¿å­˜äº†è‡ªå·±çš„æ•°æ®å’Œå…ƒæ•°æ®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;chunkåªéœ€è¦ä¸€æ¬¡æ“ä½œå°±å¯ä»¥è¢«å†™å…¥åˆ°å­˜å‚¨ä»‹è´¨ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å†™å…¥å»¶è¿Ÿå’Œå­˜å‚¨ä»‹è´¨çš„å¯¿å‘½ã€‚&lt;/p&gt;
&lt;p&gt;Figure 3æ˜¯chunkçš„å¸ƒå±€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230304141646186.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230304141646186&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªchunkåŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼šdataã€paddingã€footerã€‚&lt;/p&gt;
&lt;p&gt;footerä¿å­˜äº†chunkçš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚chunk IDã€chunk é•¿åº¦ã€CRCæ ¡éªŒå’Œã€‚&lt;/p&gt;
&lt;p&gt;ç‹¬ç«‹çš„chunkå¸ƒå±€ä¹Ÿä½¿å¾—chunkserverå¯ä»¥æ‰§è¡Œè¿›è¡Œçº é”™æ¢å¤ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªclientè¿ç»­å†™å…¥chunkåˆ°å­˜å‚¨è®¾å¤‡æ—¶ï¼Œchunkserveråœ¨å†…å­˜ä¸­å­˜å‚¨è¿™äº›chunkçš„å…ƒæ•°æ®ï¼Œå¹¶ä¸”å‘¨æœŸæ€§åœ°å°†è¿™äº›ä¿¡æ¯çš„æ£€æŸ¥ç‚¹ä¼ é€’ç»™å­˜å‚¨è®¾å¤‡ã€‚å½“å‘ç”Ÿé”™è¯¯å¯¼è‡´ä¸€äº›ä¸èƒ½å®Œæˆçš„å†™å…¥æ“ä½œæ—¶ï¼Œchunkserverä¼šåŠ è½½æ£€æŸ¥ç‚¹ä¸­çš„å…ƒæ•°æ®å¹¶ä¸”å’Œchunkä¸­çš„å…ƒæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœäºŒè€…ä¸åŒï¼Œchunkserverä¼šæ£€æŸ¥Chunkçš„CRCæ¥è¿›è¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;metadata-operation-optimization-å…ƒæ•°æ®æ“ä½œä¼˜åŒ–&#34;&gt;Metadata Operation Optimization å…ƒæ•°æ®æ“ä½œä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ç›˜å¤çš„Masteræä¾›ä¸¤ç§å…ƒæ•°æ®æœåŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;namespaceï¼šè´Ÿè´£ç›®å½•æ ‘å’Œæ–‡ä»¶ç®¡ç†&lt;/li&gt;
&lt;li&gt;Streamï¼šè´Ÿè´£chunkä¿¡æ¯çš„ç»´æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Streamå†…åŒ…å«ä¸€ç»„chunkï¼ŒåŒä¸€ä¸ªStreamä¸­çš„chunkä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæœåŠ¡éƒ½æ˜¯ç”¨äº†åˆ†å¸ƒå¼æ¶æ„æ¥ä¿è¯æ›´å¥½çš„ä¼¸ç¼©æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä»–ä»¬æ ¹æ®å…ƒæ•°æ®å±€éƒ¨æ€§å’Œè´Ÿè½½å‡è¡¡å¯¹å…ƒæ•°æ®è¿›è¡Œåˆ’åˆ†ï¼ˆå…ˆæ ¹æ®ç›®å½•æ ‘åˆ’åˆ†ï¼Œå†è¿›è¡Œå“ˆå¸Œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶è¿˜ç”¨å¤šç§æœºåˆ¶æ¥ä¼˜åŒ–å…ƒæ•°æ®æ“ä½œçš„é«˜æ•ˆæ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¹¶è¡Œçš„å…ƒæ•°æ®å¤„ç†&#34;&gt;å¹¶è¡Œçš„å…ƒæ•°æ®å¤„ç†&lt;/h4&gt;
&lt;p&gt;namespaceå’Œstreaméƒ½ä½¿ç”¨å¹¶è¡Œå¤„ç†ï¼ˆInfiniFSï¼‰æ¥å®ç°å…ƒæ•°æ®çš„ä½å»¶è¿Ÿè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤ä½¿ç”¨å“ˆå¸Œç®—æ³•æ¥æ˜ å°„å…³è”æ€§å¼ºçš„å…ƒæ•°æ®åˆ°ä¸åŒçš„å…ƒæ•°æ®æœåŠ¡å™¨ä¸­ã€‚ä½¿ç”¨ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¯é¢„æµ‹çš„ç›®å½•IDï¼Œå¹¶å…è®¸Clienté«˜æ•ˆåœ°å¹³è¡Œæ‰§è¡Œè·¯å¾„è§£æã€‚åŒæ—¶è¿˜å¼•å…¥äº†å‡ ç§åŠ é€ŸClientä»StreamæœåŠ¡ä¸­æ£€ç´¢chunkä¿¡æ¯çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯å˜é•¿åº¦çš„chunk&#34;&gt;å¯å˜é•¿åº¦çš„chunk&lt;/h4&gt;
&lt;p&gt;ç›˜å¤2.0é‡‡ç”¨å¤§chunkï¼Œæœ‰ä¸‰ä¸ªå¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘äº†å…ƒæ•°æ®çš„æ•°é‡&lt;/li&gt;
&lt;li&gt;é¿å…äº†Clienté¢‘ç¹è¯·æ±‚chunkäº§ç”Ÿçš„I/Oå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;æé«˜äº†SSDçš„å¯¿å‘½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä»…ä»…æé«˜chunk sizeä¼šæœ‰ç¢ç‰‡çš„é£é™©ï¼Œå› æ­¤é‡‡ç”¨äº†å¯å˜é•¿åº¦çš„chunkï¼ˆä»1MBåˆ°2GBï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚EBSæœåŠ¡çš„chunk sizeçš„95%åˆ†ä½æ•°ä¸º64MBï¼Œ99%åˆ†ä½æ•°ä¸º286.4MBã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœ¨clientä¸­ç¼“å­˜chunkä¿¡æ¯&#34;&gt;åœ¨Clientä¸­ç¼“å­˜chunkä¿¡æ¯&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªclientç»´æŠ¤äº†ä¸€ä¸ªæœ¬åœ°çš„å…ƒæ•°æ®ç¼“å­˜æ± ï¼Œæ¥å‡å°‘å…ƒæ•°æ®çš„è¯·æ±‚æ¬¡æ•°ã€‚ç¼“å­˜æ± é€šè¿‡LRUè¿›è¡Œç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç¨‹åºæƒ³è®¿é—®æ•°æ®æ—¶ï¼Œclienté¦–å…ˆè®¿é—®å…ƒæ•°æ®ç¼“å­˜ï¼Œå½“ç¼“å­˜æ²¡æœ‰å‘½ä¸­æ—¶å°†å‘èµ·å¯¹masterçš„è¯·æ±‚ï¼Œå½“ç¼“å­˜å‘½ä¸­æ—¶ï¼Œå“åº”è¯·æ±‚æ—¶ï¼Œå¯¹åº”çš„chunkserverä¼šé€šçŸ¥clientå…¶å…ƒæ•°æ®å·²ç»è¿‡æœŸï¼ˆç”±äºå‰¯æœ¬è¿ç§»ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ‰¹å¤„ç†chunkä¿¡æ¯è¯·æ±‚&#34;&gt;æ‰¹å¤„ç†chunkä¿¡æ¯è¯·æ±‚&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªclientåœ¨çŸ­æ—¶é—´å†…æ±‡æ€»å¤šä¸ªchunkè¯·æ±‚ï¼Œå¹¶å°†å…¶æ‰¹é‡å‘é€ç»™masterï¼Œæ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä¸»ç«™å¹¶è¡Œå¤„ç†æˆæ‰¹çš„è¯·æ±‚ï¼Œæ±‡æ€»ç»“æœå¹¶å°†å…¶å‘å›ç»™clientã€‚clientå¯¹ç»“æœè¿›è¡Œåˆ†è§£ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ç›¸åº”çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¨æµ‹chunkä¿¡æ¯è¿›è¡Œé¢„å–&#34;&gt;æ¨æµ‹chunkä¿¡æ¯è¿›è¡Œé¢„å–&lt;/h4&gt;
&lt;p&gt;è®¾è®¡äº†ä¸€ä¸ªåŸºäºè´ªå¿ƒå’Œç»Ÿè®¡å­¦çš„é¢„å–æœºåˆ¶æ¥å‡å°‘chunkä¿¡æ¯çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å½“masterèŠ‚ç‚¹æ”¶åˆ°äº†æ¥è‡ªclientçš„è¯»è¯·æ±‚æ—¶ï¼Œmasterå°†è¿”å›æœ‰å…³çš„chunkå…ƒæ•°æ®å’Œå…¶ä»–chunkçš„å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“masteræ”¶åˆ°å†™å…¥è¯·æ±‚æ—¶ï¼Œmasterå°†è¿”å›å¤šä¸ªchunkï¼Œè¶…å‡ºclientçš„è¯·æ±‚æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;clientå› æ­¤å¯ä»¥åœ¨ä¸è¯·æ±‚å—çš„æƒ…å†µä¸‹åˆ‡æ¢å—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ•°æ®æå¸¦å‡å°‘å¾€è¿”æ—¶å»¶&#34;&gt;æ•°æ®æå¸¦å‡å°‘å¾€è¿”æ—¶å»¶&lt;/h4&gt;
&lt;p&gt;å—åˆ°äº†QUICå’ŒHTTP3çš„å¯å‘ï¼Œä½¿ç”¨æ•°æ®æå¸¦æ¥æ”¹å–„å†™å…¥å»¶è¿Ÿï¼Œåœ¨clientä»masteræ£€ç´¢åˆ°chunkåœ°å€åï¼Œä»–å°†chunkåˆ›å»ºè¯·æ±‚å’Œæ•°æ®å†™å…¥è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åå‘é€ç»™chunkserverã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤å¯ä»¥å‡å°‘ä¸€ä¸ªRTTã€‚ï¼ˆä½†æ˜¯å½“ä¸ªRTTé•¿äº†ï¼Œæ•°æ®åŒ…å¤§å°é—®é¢˜ï¼Ÿï¼‰&lt;/p&gt;
&lt;h2 id=&#34;chunkserver-ussos&#34;&gt;ChunkServer USSOS&lt;/h2&gt;
&lt;p&gt;chunkserverè´Ÿè´£æ‰§è¡Œæ‰€æœ‰çš„æ•°æ®æ“ä½œã€‚å› æ­¤ï¼Œç²¾å¿ƒè®¾è®¡è¿è¡Œæ—¶æ“ä½œç³»ç»Ÿä»¥ç¡®ä¿æ•°æ®æ“ä½œèƒ½ä»¥&lt;strong&gt;ä½å»¶è¿Ÿ&lt;/strong&gt;å’Œ&lt;strong&gt;é«˜ååé‡&lt;/strong&gt;å®Œæˆæ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨æ–°å…´çš„é«˜é€Ÿç½‘ç»œæŠ€æœ¯å’Œå­˜å‚¨é¢†åŸŸï¼ŒåšæŒé€šè¿‡å†…æ ¸ç©ºé—´è¿›è¡Œæ•°æ®æ“ä½œçš„ä¼ ç»Ÿè®¾è®¡æ˜¯ä½æ•ˆçš„ã€‚è¿™ä¸ä»…ä¼šå¯¼è‡´é¢‘ç¹çš„ç³»ç»Ÿä¸­æ–­ï¼Œä»è€Œæ¶ˆè€—CPUèµ„æºï¼Œè€Œä¸”è¿˜ä¼šå¯¼è‡´ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¸å¿…è¦çš„æ•°æ®é‡å¤ã€‚
ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç›˜å¤é‡‡ç”¨äº†kernel-bypassç»•è¿‡å†…æ ¸çš„è®¾è®¡ï¼Œä¸ºchunkserverå¼€å‘äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ“ä½œç³»ç»Ÿï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨è½¯ä»¶å¹³å°ã€‚é™¤äº†åœ¨USSOSä¸­å®ç°è®¾å¤‡ç®¡ç†å’ŒRTCè¿è¡Œåˆ°å®Œæˆçš„çº¿ç¨‹æ¨¡å‹ï¼Œç›˜å¤è¿˜å®ç°äº†ç”¨æˆ·çº§çš„å†…å­˜ç®¡ç†ï¼Œè½»é‡çº§çš„ç”¨æˆ·ç©ºé—´è°ƒåº¦ç­–ç•¥ï¼Œè¿˜ä¸ºSSDå®šåˆ¶äº†é«˜æ€§èƒ½append-onlyçš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿï¼ˆUSSFSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨æˆ·çº§åˆ«å†…å­˜ç®¡ç†&#34;&gt;ç”¨æˆ·çº§åˆ«å†…å­˜ç®¡ç†&lt;/h3&gt;
&lt;p&gt;chunkserverçš„USSOSåŸºäºç°æœ‰çš„ç”¨æˆ·ç©ºé—´æŠ€æœ¯ï¼Œå¦‚ç½‘ç»œæ ˆä¸­çš„RDMAï¼Œå­˜å‚¨æ ˆä¸­çš„DPDKå’ŒSPDKã€‚ç›˜å¤å¯¹ç½‘ç»œæ ˆå’Œå­˜å‚¨æ ˆè¿›è¡Œäº†æ•´åˆï¼Œä»¥å‡å°‘å»¶è¿Ÿå¹¶å®ç°é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨RTCçº¿ç¨‹æ¨¡å‹ï¼Œåœ¨ä¼ ç»Ÿçš„æµæ°´çº¿pipelineçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚è¢«åˆ†è§£æˆå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µè¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚ç›¸åï¼ŒUSSOSä¸­ä¸€ä¸ªè¯·æ±‚è‡ªå§‹è‡³ç»ˆéƒ½å¤„äºä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹é—´é€šä¿¡çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹è¯·æ±‚ä¸€ä¸ªå¤§é¡µå†…å­˜ç©ºé—´ç”¨ä½œç½‘ç»œæ ˆå’Œå­˜å‚¨æ ˆçš„å…±äº«å†…å­˜ã€‚ä»ç½‘ç»œä¸­æ¥å—çš„æ•°æ®å¯ä»¥é€šè¿‡RDMAå­˜å‚¨åœ¨å¤§é¡µå†…å­˜ç©ºé—´ä¸­ã€‚å‘é€å¤§é¡µå†…å­˜çš„å…ƒæ•°æ®ä¹‹åï¼ˆåœ°å€å’Œå¤§å°ï¼‰ï¼Œæ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡SPDKä»å¤§é¡µå†…å­˜å†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶&#34;&gt;ç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶&lt;/h3&gt;
&lt;h4 id=&#34;é€šè¿‡é˜»å¡åç»­è¯·æ±‚é˜»æ­¢ä»»åŠ¡&#34;&gt;é€šè¿‡é˜»å¡åç»­è¯·æ±‚é˜»æ­¢ä»»åŠ¡&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªchunkserveréƒ½æœ‰å›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ–°çš„è¯·æ±‚é€šè¿‡å“ˆå¸Œæ˜ å°„è¢«ä¸‹å‘ç»™ä¸€ä¸ªworkingçº¿ç¨‹ã€‚è¢«å‘é€åˆ°åŒä¸€ä¸ªçº¿ç¨‹çš„è¯·æ±‚åŸºäºå…ˆåˆ°å…ˆæ‰§è¡ŒFIFSçš„æœºåˆ¶æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè¯·æ±‚å ç”¨äº†å¤ªå¤šçš„æ—¶é—´ç‰‡ï¼ˆè¡¨æŸ¥è¯¢æœç´¢ï¼Œå†…å­˜ç”³è¯·ï¼‰ï¼Œå°†ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºè´Ÿè½½è¾ƒé«˜çš„ä»»åŠ¡ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶æ¥ç›‘æ§ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œå¹¶è®¾ç½®å‘Šè­¦ã€‚å¦‚æœä»»åŠ¡è¶…å‡ºäº†è§„å®šæ—¶é—´ç‰‡ï¼Œä¼šå°†å…¶ä¸‹å‘åˆ°åå°çº¿ç¨‹è¿›è¡Œæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç³»ç»Ÿäº§ç”Ÿçš„è´Ÿè½½ï¼Œç›˜å¤ä½¿ç”¨TCMallocï¼ˆThread Cached Mallocï¼‰ç¼“å­˜æ¥å…è®¸åœ¨ç¼“å­˜ä¸­æ‰§è¡Œé«˜é¢‘ç‡çš„æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ä¼˜å…ˆçº§è°ƒåº¦ä¿éšœé«˜qos&#34;&gt;ä¼˜å…ˆçº§è°ƒåº¦ä¿éšœé«˜QoS&lt;/h4&gt;
&lt;p&gt;ç›˜å¤å¯¹ä¸åŒè¯·æ±‚æ ‡æ³¨ä¸åŒçš„QoSæ ‡ç­¾ï¼ˆç”¨æˆ·è¯·æ±‚é«˜ä¼˜å…ˆçº§ï¼ŒGCè¯·æ±‚ä½ä¼˜å…ˆçº§ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;USSOSåˆ›å»ºäº†ä¸€ä¸ª&lt;strong&gt;ä¼˜å…ˆé˜Ÿåˆ—&lt;/strong&gt;ï¼Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ ¹æ®QoSç›®æ ‡æ¥è¿›è¡Œè°ƒåº¦ã€‚ä»¥æ­¤æ¥é˜²æ­¢ä½QoSä»»åŠ¡è¿‡å¤šå¯¼è‡´é«˜QoSä¸èƒ½è¢«æŒ‰æ—¶å®Œæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;è½®è¯¢å’Œäº‹ä»¶é©±åŠ¨çš„åˆ‡æ¢napi&#34;&gt;è½®è¯¢å’Œäº‹ä»¶é©±åŠ¨çš„åˆ‡æ¢ï¼ˆNAPIï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢é¢‘ç¹å‘èµ·ä¸­æ–­å¯¼è‡´é«˜CPUåˆ©ç”¨ç‡ï¼ŒUSSOSä½¿ç”¨åˆ‡æ¢æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;NICï¼ˆNetwork Interface Controllerï¼Œç½‘å¡ï¼‰æä¾›äº†&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦fd&lt;/strong&gt;çš„ç›‘æ§ï¼ŒåŸºäºç›‘å¬æ•°æ®è¾¾åˆ°åçš„fdäº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç¨‹åºé»˜è®¤ä½¿ç”¨&lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;ï¼Œå½“ç¨‹åºæ”¶åˆ°äº†NICçš„é€šçŸ¥ï¼Œå°†åˆ‡æ¢ä¸ºè½®è¯¢æ¨¡å¼ã€‚å¦‚æœç¨‹åºä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•I/Oè¯·æ±‚ï¼Œå°†ä¼šåˆ‡æ¢ä¼šäº‹ä»¶é©±åŠ¨æ¨¡å¼å¹¶å‘ŠçŸ¥NICã€‚&lt;/p&gt;
&lt;h3 id=&#34;append-only-ussos&#34;&gt;Append Only USSOS&lt;/h3&gt;
&lt;p&gt;USSFSä½¿ç”¨ä¸€ç³»åˆ—åŸºäºchunkçš„æŒ‡ä»¤ï¼ˆopenï¼Œcloseï¼Œsealï¼Œformatç­‰ï¼‰ï¼Œæ”¯æŒappend-only writeã€‚&lt;/p&gt;
&lt;p&gt;æ”¯æŒappend-onlyçš„é¡ºåºå†™å…¥ï¼Œå……åˆ†åˆ©ç”¨äº†SSDçš„é¡ºåºå†™å’Œéšæœºè¯»ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¤šç§æœºåˆ¶æœ€å¤§åŒ–SSDæ€§èƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å……åˆ†åˆ©ç”¨ç‹¬ç«‹chunkå¸ƒå±€ï¼Œæå¤§çš„å‡å°‘äº†æ•°æ®æ“ä½œçš„æ¬¡æ•°ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨page cacheå’Œæ—¥å¿—ç­‰æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦å»ºç«‹åˆ†çº§çš„ç´¢å¼•æœºåˆ¶ï¼ˆä¾‹å¦‚ext4çš„inodeå’Œæ–‡ä»¶ç›®å½•dentriesï¼‰ã€‚æ‰€æœ‰çš„æ“ä½œä¼šé€šè¿‡æ—¥å¿—è¿›è¡Œè®°å½•ï¼Œè¯¥æ—¥å¿—å¯ä»¥ç”¨æ¥åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶é‡å»ºå…ƒæ•°æ®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è½®è¯¢æœºåˆ¶å‡å°‘ä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å•ä¸ªSSDçš„å®¹é‡ä¸€èˆ¬å¾ˆå¤§ï¼Œå¹¶ä¸”ä¸€ä¸ªchunkçš„å¤§å°é€šå¸¸æ˜¯64MBï¼Œè®¾å®šUSSFSçš„æœ€å°ç©ºé—´åˆ†é…ç²’åº¦ä¸º1MBï¼Œä¸»è¦è€ƒè™‘ä½¿ç”¨çš„å†…å­˜å¤§å°å’ŒSSDçš„ç©ºé—´åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é«˜æ€§èƒ½slaä¿éšœ&#34;&gt;é«˜æ€§èƒ½SLAä¿éšœ&lt;/h2&gt;
&lt;h3 id=&#34;chasing&#34;&gt;Chasing&lt;/h3&gt;
&lt;p&gt;å‡å°‘ç³»ç»ŸæŠ–åŠ¨åœ¨å†™å»¶è¿Ÿä¸Šçš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å½“$MaxCopy$ä¸ªå‰¯æœ¬ä¸­çš„$MinCopy$ä¸ªåœ¨chunkserverä¸­æˆåŠŸå†™å…¥æ—¶ï¼Œå…è®¸clientå‘åº”ç”¨è¿”å›successã€‚&lt;/p&gt;
&lt;p&gt;è§„å®š $2\times MinCopy\textgreater\ MaxCopy$ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾Figure 4å±•ç¤ºäº†Chasingåœ¨ $MaxCopy=3\and MinCopy=2$æƒ…å†µä¸‹çš„å·¥ä½œæƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230308133528640.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230308133528640&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºè¯·æ±‚Clientå†™å…¥æ•°æ®$[1,2,3]$åˆ°3ä¸ªå‰¯æœ¬chunkserverä¸­ï¼Œåœ¨æ—¶é—´$T$æ—¶ï¼Œchunkserver1å’Œ2å·²ç»å‘clientè¿”å›äº†å†™æ“ä½œsuccessï¼Œä½†æ˜¯chunkserver3è¿˜æ²¡æœ‰å›å¤ã€‚æ­¤æ—¶Clientå°†å‘åº”ç”¨ç¨‹åºå›å¤successã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Clientä¸­è¿˜éœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™å†™å…¥çš„æ•°æ®ï¼Œå¹¶ç­‰å¾…ä¸€ä¸ªæ—¶é—´æ®µ$t$ï¼ˆmsçº§åˆ«ï¼‰ï¼Œå¦‚æœchunkserver 3åœ¨$T+t$æ—¶é—´ä»¥å‰å›å¤äº†successï¼ŒClientå°±ä¼šåœ¨å†…å­˜ä¸­åˆ é™¤é‡Šæ”¾è¦å†™å…¥çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœchunkserver 3æ²¡æœ‰å®Œæˆå†™å…¥æ“ä½œï¼Œä¸”æ²¡æœ‰å®Œæˆçš„éƒ¨åˆ†å°äºé˜ˆå€¼$k$ï¼ŒClientå°†åœ¨chunkserver 3ä¸­å‘èµ·é‡è¯•æ“ä½œï¼›è‹¥æ²¡æœ‰å®Œæˆçš„éƒ¨åˆ†å¤§äº$k$ï¼ŒClientå°†ä¼šåœ¨chunkserver 3ä¸­å°å­˜è¿™ä¸ªchunkï¼Œä¿è¯ä¸ä¼šæ”¶åˆ°åç»­è¿½åŠ å†™å…¥çš„å½±å“ï¼ŒClienté€šçŸ¥masterï¼Œmasterå°†ä»chunkserver 1æˆ–è€…2å¤åˆ¶ä¸€ä¸ªä¸åŒçš„chunkæ¥ä¿è¯æ€»å…±å­˜åœ¨3ä¸ªå‰¯æœ¬ï¼Œ&lt;strong&gt;Clientçš„å†…å­˜ä¸­è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Ÿ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‚£ä¹ˆchunkserver 3ä¸­å°å­˜è¿‡çš„chunkæ€ä¹ˆå¤„ç†ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§Early- Write- Acknowledgmentæœºåˆ¶ï¼Œå‡å°‘äº†å†™å…¥æ“ä½œçš„å°¾å»¶è¿Ÿï¼Œåœ¨ç›˜å¤ä¸Šéƒ¨ç½²äº†åå¤šå¹´ï¼Œæ²¡å‘ç”Ÿè¿‡æ•°æ®ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;non-stop-write-ä¸åœå†™&#34;&gt;Non-stop write ä¸åœå†™&lt;/h3&gt;
&lt;p&gt;å‡å°‘å½“ä¸€ä¸ªchunkå†™å…¥å¤±è´¥å¯¼è‡´çš„å†™å…¥å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å½“å†™å…¥å¤±è´¥æ—¶ï¼ŒClientğŸå°å­˜chunkå¹¶ä¸”æ±‡æŠ¥masterå½“å‰å·²ç»æˆåŠŸå†™å…¥çš„æ•°æ®é•¿åº¦ï¼Œmasterä½¿ç”¨ä¸€ä¸ªæ–°çš„chunkæ¥ç»§ç»­å†™å…¥æ•°æ®ã€‚å¦‚æœå†™å…¥åˆ°å°å­˜çš„chunkä¸­çš„æ•°æ®æŸåï¼Œä¼šåœ¨åå°ä½¿ç”¨å…¶ä»–å·²ç»æˆåŠŸå†™å…¥çš„å‰¯æœ¬å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„chunkä¸­ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨å‰¯æœ¬ï¼ŒClientå°†å†æ¬¡å†™å…¥æ•°æ®åˆ°ä¸€ä¸ªæ–°çš„chunkã€‚&lt;/p&gt;
&lt;h3 id=&#34;backup-read&#34;&gt;Backup read&lt;/h3&gt;
&lt;p&gt;å‡å°‘åŠ¨æ€ç¯å¢ƒä¸‹è¯»å»¶è¿Ÿã€‚åœ¨æ”¶åˆ°è¯»è¯·æ±‚çš„responseå‰ï¼ŒClientå‘å…¶ä»–Chunkserverå‘é€é¢å¤–çš„è¯»è¯·æ±‚ä½œä¸ºå¤‡ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æœºåˆ¶æ¶‰åŠä¸¤ä¸ªå‚æ•°ï¼Œå‘é€è¯·æ±‚çš„æ•°é‡å’Œç­‰å¾…æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œç›˜å¤è®¡ç®—äº†ä¸åŒç¡¬ç›˜ç±»å‹å’ŒI/Oå¤§å°çš„å»¶è¿Ÿï¼Œå¹¶ä½¿ç”¨è¿™äº›ä¿¡æ¯åŠ¨æ€è°ƒæ•´å‘é€å¤‡ä»½è¯»å–è¯·æ±‚çš„æ—¶é—´ã€‚å®ƒè¿˜é™åˆ¶äº†å¤‡ä»½è¯»å–è¯·æ±‚çš„æ•°é‡ï¼Œä»¥æ§åˆ¶ç³»ç»Ÿçš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;blacklisting&#34;&gt;Blacklisting&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†é¿å…å‘æœåŠ¡è´¨é‡å·®çš„chunkserverå‘é€I/Oè¯·æ±‚ï¼Œç›˜å¤ä½¿ç”¨ä¸¤ä¸ªé»‘åå•ï¼Œ&lt;strong&gt;ç¡®å®šé»‘åå•&lt;/strong&gt;å’Œ&lt;strong&gt;éç¡®å®šé»‘åå•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç›˜å¤ç¡®å®šä¸€ä¸ªchunkserverå·²ç»æ— æ³•æä¾›æœåŠ¡ï¼ˆchunkserverçš„SSDæŸåï¼‰ï¼Œè¿™ä¸ªæœåŠ¡å™¨å°†è¢«åŠ å…¥ç¡®å®šé»‘åå•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªchunkserverå¯ä»¥æä¾›æœåŠ¡ï¼Œä½†æ˜¯å»¶è¿Ÿè¶…è¿‡ä¸Šé™ï¼Œå°†ä¼šè¢«åŠ å…¥éç¡®å®šé»‘åå•ï¼Œå¹¶è®¾ç½®å…¶æœåŠ¡å»¶è¿Ÿå¢åŠ çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœchunkserverçš„å»¶è¿Ÿè¶…è¿‡äº†æ‰€æœ‰serverå»¶è¿Ÿçš„ä¸­ä½æ•°ï¼Œä¼šå°†å®ƒç›´æ¥åŠ å…¥éç¡®å®šæ€§é»‘åå•ä¸­ï¼Œå¯èƒ½æ€§ä¸º1.&lt;/p&gt;
&lt;p&gt;Clienté˜¶æ®µæ€§çš„å‘chunkserverå‘é€I/Oæ¢æµ‹ï¼Œä»¥ä¾¿ç»´æŠ¤éç¡®å®šæ€§é»‘åå•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨ç¡®å®šæ€§é»‘åå•ä¸­çš„æœåŠ¡å™¨æˆåŠŸè¿”å›äº†responseï¼Œä¼šå°†å…¶åœ¨é»‘åå•ä¸­ç§»é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåœ¨éç¡®å®šæ€§é»‘åå•ä¸­çš„æœåŠ¡å™¨ï¼Œå°†ä¼šåŸºäºresponseçš„å“åº”æ—¶é—´æ¥åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤åŒæ—¶é™åˆ¶é»‘åå•ä¸­çš„æœåŠ¡æ•°é‡æ¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚å¯¹äºæ¯ä¸ªæœåŠ¡å™¨è€Œè¨€ï¼Œè¿™å¼•å…¥äº†å®½é™æœŸæ¥ç»´æŠ¤é»‘åå•ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤ä¸ºRDMAå’ŒTCPä¸¤ç§é“¾æ¥åˆ†åˆ«ç»´æŠ¤äº†é»‘åå•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯„ä¼°&#34;&gt;è¯„ä¼°&lt;/h2&gt;
&lt;p&gt;Figure 5ä¸º2018å¹´åŒåä¸€æœŸé—´çš„å³°å€¼å»¶è¿Ÿï¼Œåœ¨éœ€è¦è¿›è¡Œå¤§é‡äº‹ç‰©å¤„ç†çš„æƒ…å†µä¸‹ï¼Œç›˜å¤2.0å»¶è¿Ÿä½äº280usã€‚&lt;/p&gt;
&lt;p&gt;Figure 6ä¸ºOTSæœåŠ¡çš„å»¶è¿Ÿï¼Œåœ¨ç›¸åŒçš„è¯·æ±‚è´Ÿè½½ä¸‹ï¼Œç›˜å¤2.0çš„æŸ¥è¯¢å»¶è¿Ÿæ¥è¿‘é™ä½äº†ä¸€ä¸ªæ•°é‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230309135723278.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230309135723278&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Figure 7ã€8åˆ†åˆ«ä¸ºEBSã€åœ¨çº¿æœç´¢æœåŠ¡çš„å¹³å‡çš„å°¾å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;EBSæœåŠ¡å†™å…¥è¾ƒå¤šï¼ŒP999å°¾å»¶è¿Ÿä½äº1msã€‚&lt;/p&gt;
&lt;p&gt;åœ¨çº¿æœç´¢æœåŠ¡è¯»å–è¾ƒå¤šï¼ŒP999å°¾å»¶è¿Ÿä½äº5msã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230309135656800.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230309135656800&#34;
	
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x03-phase-two-adapting-to-performance-oriented-business-model-é€‚é…é¢ç›¸æ€§èƒ½çš„å•†ä¸šæ¨¡å‹&#34;&gt;0x03 Phase Two: Adapting to Performance-Oriented Business Model é€‚é…é¢ç›¸æ€§èƒ½çš„å•†ä¸šæ¨¡å‹&lt;/h1&gt;
&lt;h2 id=&#34;ç½‘ç»œç“¶é¢ˆ&#34;&gt;ç½‘ç»œç“¶é¢ˆ&lt;/h2&gt;
&lt;h3 id=&#34;æ‰©å¤§å¸¦å®½&#34;&gt;æ‰©å¤§å¸¦å®½&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†åŒ¹é…SSDçš„ååé‡ï¼Œå°†ç½‘ç»œå¸¦å®½ä»25Gbpså‡çº§åˆ°100Gbpsã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¡¬ä»¶ä¼˜åŒ–&lt;/strong&gt;ï¼šé‡‡ç”¨é«˜æ€§èƒ½çš„NIC/RNCIç½‘å¡ã€å…‰æ¨¡å—ï¼ˆQSFP28 DACï¼ŒQSFP28 AOCï¼ŒQSFP28ï¼‰ã€å•æ¨¡/å¤šæ¨¡å…‰çº¤ã€é«˜æ€§èƒ½äº¤æ¢æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œè½¯ä»¶å±‚&lt;/strong&gt;ï¼šé‡‡ç”¨æœ‰æŸRDMAï¼Œä¸ä½¿ç”¨æš‚åœå¸§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨æ— æŸRDMAï¼Œå½“RDMAç½‘ç»œä¸­æš‚åœå¸§è¿‡å¤šæ—¶ï¼Œè¦åœ¨ä¸€æ®µæ—¶é—´å†…å…³é—­NICç«¯å£æˆ–ä¸´æ—¶åˆ‡æ¢RDMAä¸ºTCPï¼Œè¿™ç§åŸºäºæµé‡çš„æ§åˆ¶ä¸èƒ½è§£å†³ç”±æš‚åœå¸§å¼•å‘çš„å…¶ä»–é—®é¢˜ï¼ˆæ­»é”ã€å¤´é˜»å¡ï¼‰ã€‚å› æ­¤ç›˜å¤ä½¿ç”¨æœ‰æŸRDMAã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµé‡ä¼˜åŒ–&#34;&gt;æµé‡ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;å‡å°‘æµé‡æ”¾å¤§ç‡ã€‚&lt;/p&gt;
&lt;p&gt;æµé‡æ”¾å¤§ç‡ä¸ºç³»ç»Ÿä¸­æ‰€æœ‰çš„æµé‡ä¼ è¾“é‡é™¤ä»¥çœŸå®çš„æ–‡ä»¶å¤§å°ï¼Œå¦‚Figure 9ï¼š&lt;/p&gt;
&lt;p&gt;ä»¥EBSæœåŠ¡ä¸ºä¾‹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;EBS Clientå‘é€æ–‡ä»¶ï¼ˆ1xï¼‰åˆ°ç›˜å¤Client&lt;/li&gt;
&lt;li&gt;ç›˜å¤Clientå°†æ–‡ä»¶ä¼ è¾“åˆ°3ä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œå¹¶å†™å…¥ä¸‰ä¸ªå‰¯æœ¬ï¼ˆ3xï¼‰&lt;/li&gt;
&lt;li&gt;GC Workerè¯»å–æ–‡ä»¶ï¼ˆ1xï¼‰å¹¶è¿›è¡ŒGC&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆæ–‡ä»¶ä»¥EC(8,3)(1.375x)çš„å½¢å¼å†™å›å­˜å‚¨èŠ‚ç‚¹ï¼Œä¿è¯è‡³å°‘ä¸3ä¸ªå‰¯æœ¬åŒç­‰çº§åˆ«çš„å®¹é”™ï¼Œå¹¶èŠ‚çœäº†ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230309151419443.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230309151419443&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;è¿‡ç¨‹ä¸­çš„æµé‡æ”¾å¤§ç‡ä¸º6.375x(1x+3x+1x+1.375x)ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤æå‡ºäº†ä¸‰ä¸ªä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;h4 id=&#34;ä½¿ç”¨ecæ›¿æ¢3ä¸ªå‰¯æœ¬&#34;&gt;ä½¿ç”¨ECæ›¿æ¢3ä¸ªå‰¯æœ¬&lt;/h4&gt;
&lt;p&gt;åœ¨ä¿è¯è‰¯å¥½å®¹é”™æ€§çš„æƒ…å†µä¸‹ï¼Œæœ‰æ•ˆé™ä½æµé‡ã€‚ä½¿ç”¨b1ä¸­çš„EC(4,2)ï¼Œå¯ä»¥å°†æµé‡é™ä½ä¸º4.875xã€‚è¯¥æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºå°æ–‡ä»¶çš„ECå­˜å‚¨å¼€é”€è¾ƒå¤§ï¼Œéœ€è¦å¡«å……å¤§é‡çš„0è¾¾åˆ°è§„å®šé•¿åº¦ã€‚ä½¿ç”¨å¤šç§æœºåˆ¶å‡å°‘ç©ºé—´æµªè´¹ã€‚å¯ä»¥å¯¹å°çš„å†™è¯·æ±‚è¿›è¡Œèšåˆï¼Œå¹¶åŠ¨æ€åˆ‡æ¢å­˜å‚¨ç­–ç•¥ï¼ˆECã€3ä¸ªå‰¯æœ¬ï¼‰&lt;/li&gt;
&lt;li&gt;è®¡ç®—ECå¼•å…¥äº†é¢å¤–å»¶è¿Ÿï¼Œç›˜å¤é‡‡ç”¨&lt;a class=&#34;link&#34; href=&#34;https://github.com/intel/isa-l&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Intel ISA-L&lt;/a&gt;ï¼Œå°†ECè®¡ç®—çš„å»¶è¿Ÿç›¸è¾ƒäºJerasureé™ä½äº†2.5-3å€&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;å‹ç¼©flatlogfile&#34;&gt;å‹ç¼©FlatLogFile&lt;/h4&gt;
&lt;p&gt;FlatLogFileå­˜åœ¨é«˜åº¦å†—ä½™ã€‚ç›˜å¤Clientå’ŒGC Workeråœ¨è¿›è¡Œä¸‹ä¸€æ­¥å†™å…¥æ—¶å‹ç¼©FlatLogFileï¼Œæ¥å‡å°‘æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤ä½¿ç”¨LZ4ç®—æ³•æ¥å®ç°é«˜æ•ˆçš„å‹ç¼©/è§£å‹ç¼©ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å‰åå°æµé‡çš„åŠ¨æ€å¸¦å®½è°ƒèŠ‚&#34;&gt;å‰åå°æµé‡çš„åŠ¨æ€å¸¦å®½è°ƒèŠ‚&lt;/h4&gt;
&lt;p&gt;åŠ¨æ€è°ƒæ•´åå°æµé‡ï¼ˆGCç­‰ï¼‰çš„ç½‘ç»œå¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;å½“å­˜å‚¨é›†ç¾¤ä¸­æµé‡ç©ºé—²æ—¶ï¼Œå‡å°‘åå°æµé‡çš„é™é¢ï¼Œä½¿å‰å°åº”ç”¨ä½¿ç”¨æ›´å¤šçš„å¸¦å®½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…å­˜ç“¶é¢ˆ&#34;&gt;å†…å­˜ç“¶é¢ˆ&lt;/h2&gt;
&lt;p&gt;å†…å­˜ç“¶é¢ˆæ¥è‡ªå†…å­˜å¸¦å®½å’Œç½‘å¡ï¼ˆNIC æ‰§è¡ŒDMAï¼‰çš„ç«äº‰ï¼Œä»¥åŠæ¥å—ç«¯çš„åº”ç”¨å¤„ç†ï¼ˆæ•°æ®æ‹·è´ï¼Œå¤åˆ¶ï¼Œgcï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;NICæ— æ³•è·å¾—è¶³å¤Ÿçš„å†…å­˜å¸¦å®½ï¼Œä½¿å¾—PCIeçš„å¸¦å®½è¶…å‡ºNICçš„å¤„ç†èƒ½åŠ›ï¼ŒNIC bufferä¸­éƒ½æ˜¯åœ¨é€”æ•°æ®åŒ…ï¼Œå¯¼è‡´ä¸¢åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;å› æ‹¥å¡æ§åˆ¶å¯¼è‡´çš„æ€§èƒ½æŸå¤±ä¼šé™ä½30%çš„ç½‘ç»œååé‡ï¼Œ10%çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ å†…å­˜&#34;&gt;åŠ å†…å­˜&lt;/h3&gt;
&lt;p&gt;å¢åŠ äº†å¾ˆå¤šå°å®¹é‡çš„DRAMï¼ˆ16GBï¼‰ï¼Œæœ€å¤§åŒ–Memory Channelçš„åˆ©ç”¨ç‡ï¼Œæé«˜æ¯ä¸ªæœåŠ¡å™¨å¯ç”¨çš„å†…å­˜å¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨NUMAæ¥é¿å…è·¨Socketså†…å­˜è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tcp-to-rdma&#34;&gt;TCP to RDMA&lt;/h3&gt;
&lt;p&gt;TCPä½¿ç”¨æ›´å¤šçš„å†…å­˜æ‹·è´ï¼Œä½¿ç”¨RDMAåï¼Œåå°æµé‡çš„å†…å­˜å¸¦å®½å‡å°‘äº†75%ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯å‰ç«¯æµé‡çš„QoSï¼Œç›˜å¤è®¾è®¡äº†ç±»ä¼¼Linux tcé¢‘ç‡æ§åˆ¶æœºåˆ¶ï¼Œæ¥æ§åˆ¶åå°æµé‡å‘é€åˆ°ç½‘ç»œä¸­çš„é€Ÿç‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rdca&#34;&gt;RDCA&lt;/h3&gt;
&lt;p&gt;ä½¿å¾—å‘é€ç«¯ç»•è¿‡æ¥æ”¶ç«¯çš„å†…å­˜å¹¶ç›´æ¥è®¿é—®æ¥æ”¶ç«¯çš„cacheã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ± ä½¿ç”¨å…±äº«æ¥æ”¶å™¨é˜Ÿåˆ—ï¼ˆSRQï¼‰æ¥æ¥æ”¶å°æ¶ˆæ¯ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜é©»ç•™ç¼“å†²æ± ï¼šä½¿ç”¨å…±äº«æ¥å—é˜Ÿåˆ—æ¥æ¥å—å°ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨åŸºäºçª—å£ï¼ˆç±»ä¼¼TCPæ»‘åŠ¨çª—å£ï¼Ÿï¼‰çš„é€Ÿç‡æ§åˆ¶æœºåˆ¶çš„READç¼“å†²åŒºæ¥æ¥æ”¶å¤§æ¶ˆæ¯ï¼Œå› æ­¤RDMAæ“ä½œæ‰€éœ€çš„å†…å­˜ç¼“å†²åŒºå¯ä»¥æ”¾å…¥ç¼“å­˜ä¸­&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿç¼“å­˜å›æ”¶ï¼šä¸ºäº†åœ¨å°‘é‡LLCäºŒçº§Cacheä¸‹è¾¾åˆ°100Gbps NICçº¿æ€§é€Ÿç‡æ“ä½œï¼Œè®¾è®¡ä¸¤ç§æœºåˆ¶å‡å°‘æ•°æ®é€šè¿‡NICçš„æ—¶é—´è·¨åº¦ï¼š
&lt;ol&gt;
&lt;li&gt;åœ¨ä¸€ä¸ªæµæ°´çº¿ä¸‹å¹³è¡Œå¤„ç†æ•°æ®&lt;/li&gt;
&lt;li&gt;é€šè¿‡ç¡¬ä»¶å¸è½½å’Œè½»é‡åŒ–çš„åºåˆ—åŒ–/ååºåˆ—åŒ– ä¼˜åŒ–æ•°æ®å¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ç¼“å­˜å‹åŠ›æ„ŸçŸ¥çš„é€ƒé€¸æœºåˆ¶ï¼šè§£å†³æ€§èƒ½æŠ–åŠ¨ï¼Œé€ƒé€¸æœºåˆ¶ç›‘æ§LLCçš„ä½¿ç”¨å¹¶æ‰§è¡Œå“åº”çš„ç­–ç•¥
&lt;ol&gt;
&lt;li&gt;é€šè¿‡å‘ç¼“å­˜é©»ç•™ç¼“å†²æ± æ·»åŠ ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºæ¥æ›¿æ¢æ‰é˜Ÿæ•°æ®çš„ç¼“å­˜ç¼“å†²åŒºï¼Œè¿™æ ·RDCAä¸­ç”¨äºé€‚åº”æ–°åˆ°è¾¾çš„è¯·æ±‚çš„å¯ç”¨ç¼“å­˜çš„å¤§å°ä¿æŒä¸å˜&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘ç”Ÿå¤ªå¤šæ›¿æ¢ï¼Œåˆ™ä¸»åŠ¨å°†è¿è¡Œç¼“æ…¢çš„åº”ç”¨ç¨‹åºçš„æ•°æ®å¤åˆ¶åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨RDCAç¼“å†²æ± ï¼Œå¹¶ä¸”è¯¥æ± ä¸ä¼šå ç”¨å¤ªå¤šç¼“å­˜&lt;/li&gt;
&lt;li&gt;è®©NICåœ¨&lt;strong&gt;æ‹¥å¡é€šçŸ¥åŒ…&lt;/strong&gt;ä¸­æ ‡è®°æ˜¾å¼&lt;strong&gt;æ‹¥å¡é€šçŸ¥&lt;/strong&gt;ï¼ˆECNï¼‰ï¼Œå¦‚æœå¤åˆ¶åˆ°å†…å­˜å¤±è´¥æˆ–ä¸è¶³ä»¥é‡Šæ”¾ç¼“å­˜å‹åŠ›ï¼Œåˆ™æŒ‡ç¤ºæ‹¥å¡&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cpuç“¶é¢ˆ&#34;&gt;CPUç“¶é¢ˆ&lt;/h2&gt;
&lt;p&gt;æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€æ•°æ®å‹ç¼©ã€æ•°æ®CRCæ ¡éªŒäº§ç”Ÿäº†å¤§é‡çš„CPUå¼€é”€&lt;/p&gt;
&lt;h3 id=&#34;æ··åˆrpc&#34;&gt;æ··åˆRPC&lt;/h3&gt;
&lt;p&gt;ç›˜å¤é€šè¿‡Protobufï¼ˆGoogle gRPCï¼‰å‘é€RPCè¯·æ±‚ï¼Œè¯¥æ¡†æ¶éœ€è¦å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œäº§ç”Ÿäº†30%çš„CPUå¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤å†…éƒ¨çš„æ•°æ®é€šè·¯åªæœ‰å°‘é‡ä¸ºRPCï¼Œå› æ­¤ï¼Œä¸ºäº†ä¸éœ€è¦åºåˆ—åŒ–å³å¯å‘é€æ•°æ®ï¼Œç›˜å¤ä½¿ç”¨ä¸€ç§ç±»ä¼¼FlatBufferçš„åŸç”Ÿç»“æ„å–ä»£æ•°æ®é€šè·¯æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¾—ç›ŠäºProtobufçµæ´»æ€§ï¼Œç›˜å¤ç»§ç»­ä½¿ç”¨Protobufæ¥è¿›è¡Œæ§åˆ¶æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªCPUæ ¸å¿ƒçš„ç½‘ç»œååé‡å¢åŠ äº†59%ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨cpu-waitæ”¯æŒè¶…çº¿ç¨‹&#34;&gt;ä½¿ç”¨CPU waitæ”¯æŒè¶…çº¿ç¨‹&lt;/h3&gt;
&lt;p&gt;hyper-threadingï¼ˆHTï¼‰è¶…çº¿ç¨‹æŠ€æœ¯æœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸¤ä¸ªHTåœ¨ä¸€ä¸ªæ— åŠ›æ ¸å¿ƒä¸Šæ‰§è¡Œéœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªHTå½±å“å…¶ä»–HTçš„æ‰§è¡Œï¼Œä¼šä½¿æ•´ä½“çš„å»¶è¿Ÿå‡é«˜&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç›˜å¤æå‡ºäº†CPU waitæŒ‡ä»¤ï¼ŒåŒ…æ‹¬&lt;strong&gt;monitor&lt;/strong&gt;å’Œ&lt;strong&gt;mwait&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šç½‘ç»œç©ºé—²è½®è¯¢çº¿ç¨‹å°†ç›‘æ§çš„å†…å­˜åœ°å€ï¼Œæ‰§è¡Œmwaitï¼Œç›´åˆ°å†…å­˜åœ°å€è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹æ—¶æ‰è¢«å”¤é†’ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨mwaitè¿‡ç¨‹ä¸­ï¼Œå®ƒè¿è¡Œçš„HTè¿›å…¥&lt;strong&gt;ç©ºé—²ç¡çœ çŠ¶æ€&lt;/strong&gt;ï¼ˆC-Statesä¸­çš„é™¤C0ä¹‹å¤–çš„ä¸€ä¸ªçŠ¶æ€ï¼‰ï¼Œå› æ­¤ä¸ä¼šå¹²æ‰°å…¶ä»–HTã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡ŒCPU waitçš„æ—¶é—´å¼€é”€å°äº5msï¼Œå”¤é†’ä¸€ä¸ªHTçš„å¼€é”€ä¹Ÿæ˜¯msçº§åˆ«ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ¯”æ²¡æœ‰CPU waitï¼Œç½‘ç»œååé‡æé«˜äº†31.6%ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è½¯ç¡¬ä»¶co-desgin&#34;&gt;è½¯ç¡¬ä»¶Co-Desgin&lt;/h3&gt;
&lt;p&gt;å°†ä¸€äº›ä»»åŠ¡å¸è½½åˆ°å¯ç¼–ç¨‹ç¡¬ä»¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å‹ç¼©&lt;/strong&gt;ï¼šå¸è½½åˆ°åŸºäºFPGAçš„å¯è®¡ç®—å­˜å‚¨ï¼Œè¾¾åˆ°3GB/sçš„ååé‡ï¼Œå¯ä»¥èŠ‚çœ10ä¸ªç‰©ç†æ ¸å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CRCè®¡ç®—&lt;/strong&gt;ï¼šå¸è½½åˆ°RDMA-æ€»çº¿ NICç½‘å¡ï¼Œä¸ºæ¯ä¸ªæ•°æ®å—è®¡ç®—CRCï¼ŒCPUä¼šæ±‡æ€»è¿™äº›CRCå¹¶æ‰§è¡Œè½»é‡åŒ–çš„æ£€æŸ¥ï¼Œä¿è¯äº†CPUçš„ä½è´Ÿè½½å’Œä¸Šå±‚åº”ç”¨çš„æ•°æ®é›†æˆã€‚èŠ‚çœäº†30%çš„CPUå¼€é”€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¯„ä¼°-1&#34;&gt;è¯„ä¼°&lt;/h2&gt;
&lt;p&gt;æ ‡å‡†åŒ–çš„æœ‰æ•ˆååé‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230311205320296.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230311205320296&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä»å·¦åˆ°å³ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›˜å¤ä½¿ç”¨2*25GBpsç½‘ç»œå¸¦å®½å’Œ4TB-SDD&lt;/li&gt;
&lt;li&gt;SSDå¢åŠ åˆ°æ›´é«˜æ€§èƒ½çš„8TBï¼Œä½¿ç”¨100Gbpsç½‘ç»œï¼ˆPCIe gen3ï¼‰&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–äº†å†…å­˜å¸¦å®½&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨PCIe gen4ï¼Œç½‘ç»œå¸¦å®½å¢åŠ åˆ°2*100Gbpsï¼Œå­˜åœ¨æµé‡æ”¾å¤§é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;Clienté‡‡å–EC(4,2)ï¼Œæ•°æ®å‹ç¼©ç­‰ä¼˜åŒ–ç¼“è§£äº†æµé‡æ”¾å¤§é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¸è½½æ•°æ®å‹ç¼©å’ŒCRCåˆ°å¤–ç½®ç¡¬ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x04-operation-experiences&#34;&gt;0x04 Operation Experiences&lt;/h1&gt;
&lt;p&gt;ä»‹ç»äº†åœ¨å¼€å‘è¿è¥è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›æ¡ˆä¾‹ç ”ç©¶&lt;/p&gt;
&lt;h1 id=&#34;0x05-lessons&#34;&gt;0x05 Lessons&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;user-space systemï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨user spaceå¼€å‘èŠ‚çœäººåŠ›å¹¶ä¸”å®¹æ˜“ç›‘æ§å’Œè°ƒæ•´å‚æ•°&lt;/li&gt;
&lt;li&gt;user spaceå¼€å‘éœ€è¦å­¦ä¹ kernel spaceå¼€å‘&lt;/li&gt;
&lt;li&gt;ç‹¬ç«‹chunkå¸ƒå±€è¿˜ä¼˜åŒ–äº†HDDçš„å†™å…¥æ•ˆç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;tradeoffï¼šæˆæœ¬å’Œæ€§èƒ½çš„å¹³è¡¡ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡&lt;/li&gt;
&lt;li&gt;PMemï¼šIntelæ”¾å¼ƒäº†PMemçš„ä¸šåŠ¡&lt;/li&gt;
&lt;li&gt;hardware offloadingï¼šä»˜å‡ºäº†å¤§é‡æˆæœ¬è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ”¶ç›Šæ˜æ˜¾&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x06-conclusion&#34;&gt;0x06 Conclusion&lt;/h1&gt;
&lt;p&gt;æ–‡ç« ä»‹ç»äº†ç›˜å¤ä»1.0ç‰ˆæœ¬åˆ°2.0ç‰ˆæœ¬çš„æ•´ä½“æ¼”è¿›è¿‡ç¨‹ï¼Œæœ‰éå¸¸å¤§çš„å®æˆ˜ç»éªŒï¼Œç»™å‡ºäº†å¯¹äºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€é¢å‘æ€§èƒ½çš„æœåŠ¡æ¨¡å¼ã€CPUç“¶é¢ˆã€å†…å­˜å¸¦å®½çš„å®ç°æ–¹æ¡ˆã€‚æ–‡ç« ä¸ªåˆ«åœ°æ–¹æ²¡æœ‰å¾ˆè¯¦ç»†çš„æè¿°ï¼Œé˜¿é‡Œäº‘å›¢é˜Ÿä¹Ÿå‘è¡¨è¿‡å¤šç¯‡å­¦æœ¯è®ºæ–‡ï¼Œæœ¬æ–‡è¿˜æ˜¯æ€»ç»“ä¸ºä¸»ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>[ATC&#39;20] PinK: High-speed In-storage Key-value Store with Bounded Tails</title>
        <link>https://blog.ipandai.club/p/atc20-pink-high-speed-in-storage-key-value-store-with-bounded-tails/</link>
        <pubDate>Sat, 26 Nov 2022 13:40:59 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/atc20-pink-high-speed-in-storage-key-value-store-with-bounded-tails/</guid>
        <description>&lt;h1 id=&#34;0x00-everyday-english&#34;&gt;0x00 Everyday English&lt;/h1&gt;
&lt;p&gt;preferable æ›´å¯å–çš„&lt;/p&gt;
&lt;p&gt;consequently å› æ­¤&lt;/p&gt;
&lt;p&gt;inevitably å¿…ç„¶çš„&lt;/p&gt;
&lt;p&gt;conventional å¸¸è§„çš„ã€ä¼ ç»Ÿçš„&lt;/p&gt;
&lt;p&gt;exacerbates åŠ å‰§&lt;/p&gt;
&lt;p&gt;deteriorates æ¶åŒ–&lt;/p&gt;
&lt;p&gt;deterministic ç¡®å®šæ€§&lt;/p&gt;
&lt;h1 id=&#34;0x01-intro&#34;&gt;0x01 Intro&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦æå‡ºäº†Pinkï¼ŒåŸºäºLSM treeçš„KV-SSDï¼Œä¸»è¦é€šè¿‡é¿å…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨å°‘é‡DRAMæ¥è¿›è¡Œä¼˜åŒ–&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿçš„KV-SSDä¸»è¦é€šè¿‡åœ¨æ§åˆ¶å™¨çš„DRAMä¸­ç»´æŠ¤ä¸€ä¸ªhash tableæ¥å¯»å€ï¼Œå—åˆ°DRAMçš„å®¹é‡é™åˆ¶ï¼Œè¶…å‡ºå®¹é‡çš„éƒ¨åˆ†ä¼šæš‚æ—¶å­˜æ”¾åœ¨é—ªå­˜ä¸­ï¼Œå› æ­¤åœ¨å¯»å€æ—¶å¸¦æ¥äº†è®¿é—®é—ªå­˜çš„é¢å¤–å¼€é”€ï¼ŒåŒæ—¶å½“å‘ç”Ÿå“ˆå¸Œç¢°æ’æ—¶ï¼Œå¯èƒ½ä¼šæ“ä½œå¤šä¸ªé—ªå­˜ï¼Œé€ æˆäº†å¤§é‡ä¸å¯é¢„æµ‹çš„å¼€é”€&lt;/p&gt;
&lt;p&gt;å•çº¯ä½¿ç”¨LSMåšä¸ºæ›¿æ¢çš„è¯ï¼Œå¯ä»¥å‡å°‘DRAMçš„å­˜å‚¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°¾å»¶è¿Ÿï¼šå¾ˆå¤šLSM-treeä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥å¿«é€Ÿæ£€ç´¢ï¼Œå¯é æ€§å·®ï¼Œå­˜åœ¨å°¾å»¶è¿Ÿé—®é¢˜&lt;/li&gt;
&lt;li&gt;å†™æ”¾å¤§ï¼šç”±äºLSMå¯¹KVç´¢å¼•çš„æ’åºå’Œåˆå¹¶æ“ä½œï¼Œå¸¦æ¥äº†å¾ˆå¤šå¯¹é—ªå­˜é¢å¤–çš„è®¿é—®ï¼Œè¿˜å¢å¤§äº†FTLè¿›è¡ŒGCçš„è´Ÿæ‹…&lt;/li&gt;
&lt;li&gt;å¸ƒéš†è¿‡æ»¤å™¨çš„é‡å»ºå’ŒKVæ’åºï¼šæ¶ˆè€—äº†å¤§é‡çš„CPUèµ„æºï¼Œå¸¦æ¥I/Oæ€§èƒ½çš„å¤§å¹…ä¸‹é™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºLSM-treeçš„KVå­˜å‚¨å¼•æ“-PinKï¼Œè§£å†³äº†ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ã€‚PinKä½¿ç”¨äº†å››ç§æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKçš„æ ¸å¿ƒæ˜¯level pinningï¼Œå°†å›ºå®šåœ¨LSM-treeæœ€é¡¶å±‚çš„KVç´¢å¼•å›ºå®šåˆ°DRAMä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºéƒ¨åˆ†levelå›ºå®šåœ¨DRAMä¸­ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è¿›è¡Œcompactionï¼Œæ— éœ€å ç”¨é—ªå­˜çš„I/Oï¼Œè¢«å›ºå®šçš„ç´¢å¼•é€šè¿‡ç”µå®¹è¿›è¡Œä¿æŠ¤ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦å®šæœŸè¿›è¡Œåˆ·æ–°ï¼Œè¿™é‡Œè¦æ³¨æ„ä½œè€…ä½¿ç”¨DRAMå®¹é‡å¾ˆå°ï¼Œä½¿ç”¨ç”µå®¹è¶³ä»¥ä¿è¯æŒä¹…åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GCçš„ä¸»è¦I/Oå¼€é”€æ¥è‡ªå¯¹LSM-treeç´¢å¼•çš„æ›´æ–°ï¼ŒPinké€šè¿‡å»¶è¿ŸLSM-treeä¸­ç´¢å¼•æ›´æ–°åˆ°compactioné˜¶æ®µæ¥å‡å°‘GCçš„I/Oå¼€é”€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨SSDæ§åˆ¶å™¨å’ŒNANDèŠ¯ç‰‡ä¹‹é—´æ·»åŠ æ¯”è¾ƒå™¨ï¼ŒPinKåœ¨è¯»å–KVå¯¹è±¡æ—¶æ‰§è¡ŒKVæ’åºï¼Œå®Œå…¨æ¶ˆé™¤äº†compactionçš„CPUæˆæœ¬&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x02-bg&#34;&gt;0x02 Bg&lt;/h1&gt;
&lt;p&gt;äº†è§£ä¸€äº›æœ‰å…³NANDé—ªå­˜SSDã€KV-SSDã€Hash-based KV-SSDã€LSM-Tree-based KV-SSDçš„ç°çŠ¶ï¼Œå¹¶å¯¹Hashå’ŒLSM-treeè¿›è¡Œæ¯”è¾ƒ&lt;/p&gt;
&lt;p&gt;ä½œè€…å¯¹LSM-treeçš„è®¾è®¡ï¼ŒL0ä½äºDRAMä¸­ï¼Œå¹¶ä½œä¸ºwrite bufferï¼Œå…¶ä½™å„å±‚å­˜å‚¨åœ¨é—ªå­˜ä¸­&lt;/p&gt;
&lt;h1 id=&#34;0x03-design&#34;&gt;0x03 Design&lt;/h1&gt;
&lt;p&gt;Pinkæœ‰å››ä¸ªä¸»è¦çš„æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;ä½äºDRAMä¸­çš„level listså’ŒSkiplist&lt;/p&gt;
&lt;p&gt;ä½äºé—ªå­˜ä¸­çš„meta segmentså’Œdata segments&lt;/p&gt;
&lt;p&gt;åœ¨LSM-tree KV æ–‡ä»¶ç³»ç»Ÿæ–¹é¢ï¼Œä½œè€…ä¸»è¦å‚è€ƒäº†&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast16/technical-sessions/presentation/lu&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;WiscKey FAST&#39;16&lt;/a&gt;ï¼Œå–ä»£FTLè¿›è¡ŒGCã€ç´¢å¼•å’Œç£¨æŸå‡è¡¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221128145842322.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221128145842322&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;skiplist&#34;&gt;Skiplist&lt;/h2&gt;
&lt;p&gt;Skiplistä½œä¸ºLSM-treeä¸­çš„L0ï¼Œèµ·åˆ°ç±»ä¼¼write bufferçš„ä½œç”¨ï¼Œæš‚æ—¶ä¿å­˜KVå¯¹è±¡ï¼ŒSkiplistä¸­çš„å¯¹è±¡ä¸ºï¼š&lt;code&gt;&amp;lt;key size, key, value size, value&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å½“Skiplistæ»¡æ—¶ï¼Œä¼šå°†ç¼“å­˜çš„å¯¹è±¡ä»¥meta segmentå’Œdata segmentçš„å½¢å¼åˆ·æ–°åˆ°L1ä¸­ï¼Œåœ¨L1å’Œæ›´ä½çš„levelä¸­ï¼ŒKeyå’ŒValueå°†è¢«åˆ†ç¦»å­˜å‚¨åˆ°meta/data segmentä¸­ï¼Œdata segmentä¸­å­˜å‚¨valueã€keyå’Œkey sizeç”¨äºGC&lt;/p&gt;
&lt;h2 id=&#34;level-list&#34;&gt;Level list&lt;/h2&gt;
&lt;p&gt;ç”¨äºè·Ÿè¸ªé—ªå­˜ä¸­æ¯ä¸ªlevelçš„meta segment&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªlevel listæ˜¯ä¸€ä¸ªä¿å­˜å›ºå®šå¤§å°çš„æŒ‡é’ˆå¯¹çš„æ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆ4Bï¼Œç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘meta segmentåœ¨é—ªå­˜ä¸­çš„ç‰©ç†åœ°å€ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘meta segmentçš„start key&lt;/p&gt;
&lt;p&gt;meta segmentçš„start keyå•ç‹¬å­˜å‚¨åœ¨DRAMä¸­ï¼Œå¯ä»¥æ”¯æŒåŠ¨æ€å¤§å°çš„keyï¼ŒåŒæ—¶å¯ä»¥å®ç°åœ¨level listæŸ¥æ‰¾meta segmentæ—¶è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;å¦‚æœLSM-treeæœ‰5ä¸ªLevelï¼Œå³h=5ï¼Œé™¤äº†L0ä¹‹å¤–ï¼Œæ¯ä¸ªleveléƒ½ä¼šæœ‰ä¸€ä¸ªlevel list&lt;/p&gt;
&lt;p&gt;L0å’ŒLevel listé€šè¿‡ç”µå®¹æ¥ä¿æŠ¤ï¼ŒPinkä¸éœ€è¦ä½¿ç”¨æ—¥å¿—æ¥ç»´æŠ¤åŸå­æ€§å’Œæ•°æ®çš„æŒä¹…æ€§&lt;/p&gt;
&lt;h2 id=&#34;level-pinning&#34;&gt;Level Pinning&lt;/h2&gt;
&lt;p&gt;æ¶ˆé™¤å°¾å»¶è¿Ÿï¼Œå°†$top-k\ \  level(k&amp;lt;=h-1)$ çš„meta segmentä¿å­˜åœ¨DRAMä¸­ï¼Œå‡å°‘äº†readè¿‡ç¨‹çš„å°¾éƒ¨å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;å½“å¤„ç†GETæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆåœ¨DRAMä¸­å¯¹Keyè¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“DRAMä¸­æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå°†å¯¹å‰©ä½™çš„å‡ ä¸ªlevelåœ¨é—ªå­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œåœ¨ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæœ€åçš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º$O(h-1)$ï¼Œè¯¥ç­–ç•¥ä¸‹å¯ä»¥ä¼˜åŒ–ä¸º$O(h-k-1)$&lt;/p&gt;
&lt;p&gt;å› æ­¤LSM-treeå„levelæŒ‰ç…§å‚æ•°Tè¿›è¡Œå¢é•¿ï¼Œå› æ­¤topkç­–ç•¥ä¸‹ç©ºé—´å ç”¨ä¸ä¼šè¿‡å¤§&lt;/p&gt;
&lt;p&gt;åŒæ—¶å¯ä»¥ç›´æ¥åœ¨DRAMä¸­è¿›è¡Œcompactionæ“ä½œï¼Œæ— éœ€å ç”¨é—ªå­˜I/Oï¼Œå› ä¸ºæœ‰ç”µå®¹çš„å­˜åœ¨ï¼Œæ— éœ€å®šæœŸåˆ·æ–°è„segmentåˆ°é—ªå­˜ä¸­&lt;/p&gt;
&lt;h2 id=&#34;optimizing-search-path&#34;&gt;Optimizing Search Path&lt;/h2&gt;
&lt;p&gt;åœ¨å¯¹Keyè¿›è¡ŒæŸ¥è¯¢æ—¶ï¼ŒLSM-treeå°†å¯¹å„ä¸ªLevelè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221129190239823.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221129190239823&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æœ´ç´ çš„LSM-treeæœ€åçš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º$O(h^2\cdot log(T))$ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„æƒ…å†µä¸‹å¯ä»¥æ›´ä½&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKé€šè¿‡prefixæ¥å‡å°‘å­—ç¬¦ä¸²æ¯”è¾ƒçš„å¼€é”€ï¼Œå¹¶ä¸”å…ˆæ¯”è¾ƒkeyçš„å‰4ä¸ªå­—èŠ‚ï¼Œå¦‚æœåŒ¹é…æˆåŠŸæ‰ä¼šæ¯”è¾ƒåé¢çš„éƒ¨åˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨level listä¸Šæ¯ä¸ªè®°å½•å¼•å…¥ä¸€ä¸ª4å­—èŠ‚çš„èŒƒå›´æŒ‡é’ˆï¼Œå®ç°å¤šçº§cascadingèŒƒå›´æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€çº§æœ‰æœ€å¤§çš„start keyåŒæ—¶key å°äºç­‰äºä¸Šä¸€çº§ä¸­çš„è®°å½•ï¼Œåœ¨ä¸€çº§ä¸€çº§çš„ä¼ é€’ä¸­ä¸æ–­å‡å°‘æœç´¢çš„èŒƒå›´ï¼Œå¦‚ä¸Šå›¾bæ‰€ç¤ºï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º$O(h\cdot log(T))$&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;speeding-up-compaction&#34;&gt;Speeding up Compaction&lt;/h2&gt;
&lt;p&gt;åœ¨compactioné˜¶æ®µï¼Œå¼•å…¥ä¸€ä¸ªç¡¬ä»¶åŠ é€Ÿå™¨ï¼Œä½äºé—ªå­˜å’Œæ•°æ®ä¸»æ€»çº¿ä¹‹é—´ï¼Œå¯ä»¥æ–¹ä¾¿çš„åˆå¹¶ä¸¤ä¸ªé—ªå­˜ä¸­çš„level&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221129225719057.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221129225719057&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å·¥ä½œæµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKå‘åŠ é€Ÿå™¨å‘èµ·compactionè¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ªlevelçš„meta segmentçš„é—ªå­˜åœ°å€$(L_i,L_{i+1})$&lt;/li&gt;
&lt;li&gt;å›å†™çš„é—ªå­˜åœ°å€$L_{i+1}$&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘å¤šä¸ªé—ªå­˜å‘èµ·è¯»å–è¯·æ±‚ï¼ŒåŒæ—¶è¿˜è¦å¯¹ä¸åŒchannelè¿”å›çš„æ•°æ®è¿›è¡Œé‡æ–°æ’åºï¼Œåºåˆ—åŒ–meta segment&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ç°è‰²çš„æ¯”è¾ƒå™¨ï¼Œä¼šä¸æ–­çš„è·å–ä¸¤ä¸ªlevelä¸­çš„æ•°æ®ï¼Œè¾“å‡ºkeyè¾ƒå°çš„é‚£ä¸€ä¸ª&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºæ— æ•ˆçš„keyï¼Œå°†é€šçŸ¥PinKè¿›è¡ŒGC&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å‡ºçš„æ’åºåç»“æœå°†ä¿å­˜åœ¨write bufferä¸­è¿›è¡Œå›å†™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ“ä½œç»“æŸåï¼ŒåŠ é€Ÿå™¨é€šçŸ¥PinKå½“å‰$L_{i+1}$ä½¿ç”¨çš„é—ªå­˜é¡µçš„æ•°é‡ï¼Œä¾¿äºå’Œæ­¤å‰æä¾›çš„è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºGC&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;PinKåœ¨DRAMçš„pinned levelä¸­ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„åŠ é€Ÿå™¨ï¼ŒåŸºäºDMA&lt;/p&gt;
&lt;h2 id=&#34;optimizing-gc&#34;&gt;Optimizing GC&lt;/h2&gt;
&lt;p&gt;éœ€è¦é’ˆå¯¹meta/data segmentåˆ†åˆ«åˆ¶å®šGCç­–ç•¥&lt;/p&gt;
&lt;h2 id=&#34;durability--scalability&#34;&gt;Durability &amp;amp;&amp;amp; Scalability&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ç”µå®¹æ¥ä¿æŠ¤æ•´ä¸ªDRAMï¼Œå¯¹äºæ¯”è¾ƒä½ç«¯çš„SSDï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç”µå®¹æ¥ç»´æŒï¼Œåªèƒ½ç»§ç»­ä½¿ç”¨å®šæœŸå†™å›åˆ°é—ªå­˜çš„æœºåˆ¶ï¼ˆè¦ä¿æŠ¤level listsï¼Œpinned levelï¼ŒL0ï¼‰ï¼ŒåŒæ—¶è¿˜è¦è®°å½•æ—¥å¿—ï¼Œç”±äºLSM-treeçš„ç‰¹æ€§ï¼Œè¯¥æ“ä½œæ¯”åŸºäºhashçš„KV-SSDå¼€é”€ç•¥å°&lt;/p&gt;
&lt;h1 id=&#34;conclusion--thinking&#34;&gt;Conclusion &amp;amp;&amp;amp; Thinking&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä¹‹å‰é˜…è¯»çš„KV-SSDç›¸æ¯”ï¼ŒPinKå°†éƒ¨åˆ†Levelå›ºå®šåˆ°DRAMä¸­ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;PinKå¼ƒç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½¿ç”¨ä¸€ç§å±‚çº§ç¼©å°æŸ¥æ‰¾èŒƒå›´çš„æ–¹å¼ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡&lt;/li&gt;
&lt;li&gt;å¼•å…¥äº†ä¸€ä¸ªåŠ é€Ÿå™¨æ¥å‡å°‘LSM-tree compactionæ“ä½œçš„å¼€é”€&lt;/li&gt;
&lt;li&gt;è®ºæ–‡éƒ½æé«˜äº†å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨æ—¶é‡å»ºçš„å¼€é”€ç•¥é«˜ï¼Œæ˜¯å¦å¯ä»¥è€ƒè™‘ä½¿ç”¨å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼Œè¿™éƒ¨åˆ†ä¸»è¦ç€çœ¼äºLSM-treeçš„ä¼˜åŒ–ï¼Œå¯èƒ½å¹¶ä¸æ˜¯çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>[OSDI&#39;21] Modernizing File System through In-Storage Indexing</title>
        <link>https://blog.ipandai.club/p/osdi21-modernizing-file-system-through-in-storage-indexing/</link>
        <pubDate>Sat, 29 Oct 2022 16:48:32 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/osdi21-modernizing-file-system-through-in-storage-indexing/</guid>
        <description>&lt;h1 id=&#34;questions&#34;&gt;Questions&lt;/h1&gt;
&lt;p&gt;æ ¸å¿ƒæ€æƒ³éƒ¨åˆ†éœ€è¦å†æ€è€ƒå’Œæ¢³ç†ä¸‹ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆé‡‡ç”¨ KV SSD æ›¿ä»£ä¼ ç»Ÿ block SSD èƒ½å¤Ÿè§£å†³ä¸Šè¿°é—®é¢˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å…¶ä¸­ï¼Œåˆ©ç”¨äº† KV SSD çš„ä»€ä¹ˆç‰¹æ€§ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¯¹æ–‡ä»¶ç³»ç»Ÿå“ªäº›åœ°æ–¹åšäº†ä»€ä¹ˆä»¥ä¼˜åŒ–ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®ºæ–‡è¯•å›¾è§£å†³çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;éšç€å­˜å‚¨è®¾å¤‡çš„ä¸æ–­å‘å±•ï¼Œå­˜å‚¨è®¾å¤‡çš„æ€§èƒ½è¶Šæ¥è¶Šé«˜ï¼Œä½†å½“å‰æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿåœ¨ä¸€äº›æ“ä½œä¸Šå¹¶ä¸èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¦‚ä»Šå­˜å‚¨è®¾å¤‡çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®å†™å…¥æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¤§é‡æ“ä½œç»´æŠ¤å…ƒæ•°æ®ã€è¿›è¡Œç¡¬ç›˜çš„ç©ºé—´ç®¡ç†ã€ç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œå·¥ä½œé‡å¤§ã€‚&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒæ€æƒ³ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Key-Valueå­˜å‚¨æ¥å£å–ä»£ä¼ ç»Ÿçš„å¿«è®¾å¤‡æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;p&gt;æå‡ºKevinï¼Œåˆ†ä¸ºKevin=KevinFS + KevinSSD&lt;/p&gt;
&lt;p&gt;KevinFS&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»´æŠ¤æ–‡ä»¶å’Œç›®å½•åˆ°KVå¯¹è±¡çš„æ˜ å°„å…³ç³»&lt;/li&gt;
&lt;li&gt;å°†POSIXç³»ç»Ÿè°ƒç”¨è½¬è¯‘æˆKVæ“ä½œæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;ä¿è¯KV-SSDçš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;KevinSSD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å­˜å‚¨è®¾å¤‡ä¸­ç´¢å¼•KVå¯¹è±¡&lt;/li&gt;
&lt;li&gt;å¯¹å¤šä¸ªKVå¯¹è±¡æä¾›äº‹åŠ¡æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;Keviné¿å…äº†å¤§é‡å…ƒæ•°æ®çš„ç»´æŠ¤å¸¦æ¥çš„I/Oæ”¾å¤§&lt;/p&gt;
&lt;p&gt;ä¸éœ€è¦æ—¥å¿—å³å¯å®Œæˆå´©æºƒä¸€è‡´æ€§çš„ç»´æŠ¤&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŠµå¾¡æ–‡ä»¶åˆ†æ®µåé€ æˆçš„æ€§èƒ½ä¸‹é™&lt;/p&gt;
&lt;p&gt;å­˜å‚¨çš„æ–‡ä»¶å—é€šè¿‡LSMè¿›è¡Œåˆ†éƒ¨æ’åºå’Œç´¢å¼•&lt;/p&gt;
&lt;h1 id=&#34;0x01-bg--related-work&#34;&gt;0x01 BG &amp;amp;&amp;amp; Related Work&lt;/h1&gt;
&lt;h2 id=&#34;ä¼ ç»Ÿå—è®¾å¤‡&#34;&gt;ä¼ ç»Ÿå—è®¾å¤‡&lt;/h2&gt;
&lt;p&gt;æä¾›å—ç²’åº¦ï¼ˆ512B or 4KBï¼‰çš„è®¿é—®&lt;/p&gt;
&lt;p&gt;HDDé€šè¿‡ç»´æŠ¤ä¸€ä¸ªé—´æ¥è¡¨æ¥å¤„ç†åå—&lt;/p&gt;
&lt;p&gt;åŸºäºé—ªå­˜çš„SSDé€šè¿‡FTLæ¥ç»´æŠ¤é€»è¾‘å—åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ç´¢å¼•è¡¨ï¼Œä»¥ä¾¿åœ¨å¼‚åœ°æ›´æ–°çš„NANDä¸Šæ¨¡æ‹Ÿå¯é‡å†™ä»‹è´¨å¹¶ä¸”æ’é™¤åå—ã€‚&lt;/p&gt;
&lt;p&gt;ç°æœ‰ç ”ç©¶ç¼“è§£äº†I/Oè°ƒåº¦ã€æ–‡ä»¶ç¢ç‰‡åŒ–ã€æ—¥å¿—ç›¸å…³é—®é¢˜ï¼Œæ²¡èƒ½æ¶ˆé™¤å…ƒæ•°æ®çš„ä¿®æ”¹å¸¦æ¥çš„I/Oæµé‡&lt;/p&gt;
&lt;p&gt;DevFSå®ç°äº†åœ¨å­˜å‚¨è®¾å¤‡å†…éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥å°†æ¥å£æš´éœ²ç»™åº”ç”¨ï¼Œè°ƒç”¨æ—¶ä¸ç”¨å‘ç”ŸTrapï¼Œå¯¹äºå…ƒæ•°æ®çš„ç»´æŠ¤éƒ½åœ¨å­˜å‚¨è®¾å¤‡ç«¯æ‰§è¡Œï¼Œç§»é™¤äº†I/O æ ˆå‡å°‘äº†é€šä¿¡æ¥å£çš„å¼€é”€ã€‚ç¼ºç‚¹æ˜¯éœ€è¦å¤§é‡çš„DRAMå’Œå¤šæ ¸å¿ƒçš„CPUã€èƒ½æä¾›çš„åŠŸèƒ½æœ‰é™ï¼Œè¿˜é™åˆ¶äº†å¿«ç…§ã€é‡å¤æ•°æ®åˆ é™¤ç­‰æ–‡ä»¶ç³»ç»Ÿé«˜çº§åŠŸèƒ½çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;KVå­˜å‚¨å¯ä»¥é«˜æ•ˆå¤„ç†å…ƒæ•°æ®å’Œå°æ–‡ä»¶çš„å†™å…¥&lt;/p&gt;
&lt;h2 id=&#34;lsm-tree&#34;&gt;LSM-Tree&lt;/h2&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102145019013.png&#34; alt=&#34;image-20221102145019013&#34; style=&#34;zoom:70%;&#34; /&gt;
&lt;p&gt;LSM Treeæœ‰å¤šçº§ï¼ŒåŒ…æ‹¬$L_1,L_2,&amp;hellip;,L_{h-1},L_{h}$ï¼Œhæ˜¯æ ‘çš„é«˜åº¦ï¼Œå¯¹äºå„çº§çš„å¤§å°æœ‰å¦‚ä¸‹å…³ç³»ï¼Œ$Size(L_{i+1})&amp;gt;=T*Size(L_i)$&lt;/p&gt;
&lt;p&gt;æ¯å±‚éƒ½æœ‰æŒ‰Keyæ’åºçš„å”¯ä¸€KVå¯¹è±¡ã€‚å„å±‚ä¹‹é—´çš„KeyèŒƒå›´å¯èƒ½ä¼šå‡ºç°é‡å ã€‚&lt;/p&gt;
&lt;p&gt;KVå¯¹è±¡é¦–å…ˆå†™å…¥DRAMä¸­çš„Memtableï¼Œå½“Memtableä¸ä¸ºç©ºæ—¶ï¼Œç¼“å­˜çš„KVå¯¹è±¡å°†åˆ·æ–°åˆ°L1ä¸­è¿›è¡ŒæŒä¹…åŒ–ï¼Œå½“L1ä¸ä¸ºç©ºæ—¶ï¼ŒKVå¯¹è±¡åˆ·æ–°åˆ°L2ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œå‹ç¼©æ“ä½œæ¥å¯¹ä¸¤å±‚ä¹‹é—´çš„KVå¯¹è±¡è¿›è¡Œåˆå¹¶å’Œæ’åºï¼Œåœ¨æ’åºåå†™å›ç£ç›˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ”¹å–„å‹ç¼©æ“ä½œçš„I/Oå¼€é”€ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„valueå­˜å‚¨åœ¨value logä¸­ï¼Œåœ¨LSM treeä¸­åªä¿å­˜valueæŒ‡é’ˆï¼Œå­˜å‚¨&lt;code&gt;&amp;lt;key, value pointer&amp;gt;&lt;/code&gt;å½¢å¼ã€‚å¯¹äºå¤±æ•ˆçš„valueè¦è€ƒè™‘åƒåœ¾å›æ”¶é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯¹KVå¯¹è±¡è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å¤šçº§è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“åœ¨Liä¸åŒ¹é…æ—¶ï¼ŒæŸ¥æ‰¾Li+1ã€‚ä¸ºäº†å‡å°‘å¤šçº§æŸ¥æ‰¾çš„è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œä¼˜åŒ–ï¼Œå½“æ£€ç´¢åˆ°ç›®æ ‡KVå¯¹è±¡æ—¶ï¼ŒLSM treeå°†ä¼šè¿”å›ç›¸åº”çš„valueï¼ŒKVåˆ†ç¦»å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œå°†ä¼šé¢å¤–å»è¯»ä¸€æ¬¡value logã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-architecture&#34;&gt;0x02 Architecture&lt;/h1&gt;
&lt;p&gt;KEVINåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†&lt;/p&gt;
&lt;p&gt;KEVINFSï¼šç»´æŠ¤æ–‡ä»¶ã€ç›®å½•åˆ°KVå¯¹è±¡æ˜ å°„çš„æ–‡ä»¶ç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;KEVINSSDï¼šç´¢å¼•KVå¯¹è±¡åˆ°é—ªå­˜çš„LSM-tree&lt;/p&gt;
&lt;h2 id=&#34;kv-command&#34;&gt;KV Command&lt;/h2&gt;
&lt;p&gt;æ”¯æŒå¤šç§KVæŒ‡ä»¤ï¼ŒåŒæ—¶æ”¯æŒäº‹åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102154423353.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102154423353&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…å°†Keyé™åˆ¶ä¸º256Bï¼Œvalueå¤§å°æ²¡æœ‰é™åˆ¶&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶å’Œç›®å½•çš„æ˜ å°„&#34;&gt;æ–‡ä»¶å’Œç›®å½•çš„æ˜ å°„&lt;/h2&gt;
&lt;p&gt;KevinFSåªä½¿ç”¨ä¸‰ä¸ªç±»å‹çš„KVå¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$superblock$ï¼šä¿å­˜æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¤§å°128B&lt;/li&gt;
&lt;li&gt;$meta$ï¼šä¿å­˜æ–‡ä»¶ã€ç›®å½•çš„å…ƒæ•°æ®ï¼Œå¤§å°256B&lt;/li&gt;
&lt;li&gt;$data$ï¼šä¿å­˜æ–‡ä»¶æ•°æ®ï¼Œunlimitedï¼Œä¸è¶…è¿‡æ–‡ä»¶å¤§å°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºç›®å½•çš„éå†é€šè¿‡ITERATE&lt;/p&gt;
&lt;p&gt;Keyçš„å‘½åéµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;metaå¯¹è±¡çš„keyç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;å‰ç¼€&lt;code&gt;m:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;çˆ¶ç›®å½•çš„inode number&lt;/li&gt;
&lt;li&gt;åˆ†éš”ç¬¦&lt;code&gt;:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶/ç›®å½•å&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;dataå¯¹è±¡çš„keyç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;å‰ç¼€&lt;code&gt;d:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶çš„inode number&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Keyå‘½åè§„èŒƒå‚è€ƒäº†å…¶ä»–è®ºæ–‡ï¼ˆKai Ren and Garth Gibson. TABLEFS: Enhancing Metadata Efficiency in the Local File System. In Proceedings of the USENIX Annual Technical Conference, pages 145â€“156, 2013.ï¼‰ï¼Œæœ¬ç¯‡æ–‡ç« å°†å…¶æ‰©å±•åˆ°äº†å­˜å‚¨è®¾å¤‡å±‚é¢&lt;/p&gt;
&lt;p&gt;KevinFSæ²¡æœ‰å®ç°dentryï¼Œå¦‚æœéœ€è¦è®¿é—®ä¸€ä¸ªç›®å½•å†…çš„æ‰€æœ‰é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;ITERATE(m:50:, 2)&lt;/code&gt;ï¼Œæ¥è·å–ä¸¤ä¸ªçˆ¶ç›®å½•inodeä¸º50ï¼ˆå‰ç¼€åŒ¹é…ç»™å®šçš„patternï¼‰çš„å­ç›®å½•/æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¼˜åŒ–ï¼šä¸ºäº†é˜²æ­¢ITERATEæ¶ˆè€—å¤ªé•¿æ—¶é—´ï¼Œå»ºè®®æŒ‡å®šcnt&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¼˜åŒ–ï¼šä¸ºäº†é«˜æ•ˆå¤„ç†å°æ–‡ä»¶ï¼ŒKevinFSå°†æ€»ä½“å°äº4KBçš„å°æ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ•°æ®å†…å®¹æ‰“åŒ…ï¼ŒI/Oç›´æ¥æ“ä½œmetaå¯¹è±¡GET/SETæ¥è¿›è¡Œè¯»å†™&lt;/p&gt;
&lt;p&gt;@TODO ä¸€ä¸ªä¼˜åŒ–ï¼šä½¿ç”¨å…¨è·¯å¾„ç´¢å¼•æ¥å–ä»£åŸºäºinodeçš„ç´¢å¼•ï¼Œè¿™æé«˜äº†åŸºäºæ’åºç®—æ³•çš„KVå­˜å‚¨çš„æ‰«ææ€§èƒ½ï¼Œä¸»è¦å¯¹seek timeå¼€é”€å¤§çš„HDDä¼˜åŒ–æ¯”è¾ƒæ˜æ˜¾&lt;/p&gt;
&lt;h2 id=&#34;kvå¯¹è±¡ç´¢å¼•&#34;&gt;KVå¯¹è±¡ç´¢å¼•&lt;/h2&gt;
&lt;p&gt;KevinSSDåŸºæœ¬å®ç°äº†ä¼ ç»ŸSSD ä¸­FTLçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå°†KVå¯¹è±¡æ˜ å°„åˆ°é—ªå­˜ã€åˆ†é…å’Œé‡Šæ”¾é—ªå­˜çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;FTLåªåšåå—ç®¡ç†å’Œç£¨æŸå‡è¡¡ç­‰ç®€å•å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªLevelç»´æŠ¤ä¸€ä¸ªå†…å­˜è¡¨ï¼Œæ¥è®°å½•Flashä¸­çš„KVå¯¹è±¡ã€‚è¡¨çš„æ¯ä¸ªè®°å½•éƒ½æœ‰&lt;code&gt;&amp;lt;start key, end key, pointer&amp;gt;&lt;/code&gt;ï¼Œå…¶ä¸­æŒ‡é’ˆæŒ‡å‘ä¿å­˜KVå¯¹è±¡çš„é—ªå­˜é¡µé¢çš„ä½ç½®ï¼Œstart keyå’Œend keyæ˜¯é¡µé¢ä¸­keyçš„èŒƒå›´ã€‚keyçš„èŒƒå›´å¯ä»¥åœ¨å¤šä¸ªLevelä¸Šé‡å ã€‚ä¸ºäº†å¿«é€ŸæŸ¥æ‰¾ï¼Œæ‰€æœ‰è®°å½•éƒ½æŒ‰å¼€å§‹é”®æ’åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102165350981.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102165350981&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;metaå’Œdataå¯¹è±¡çš„Keyå’ŒValueä¼šè¢«åˆ†ç¦»å­˜å‚¨ã€‚é€šè¿‡&lt;code&gt;&amp;lt;key, value pointer&amp;gt;&lt;/code&gt;çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œä¼šæœ‰ä¸“é—¨çš„flash pageæ¥åˆ†åˆ«å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ˆmetaå’Œdataå¯¹è±¡ä½¿ç”¨ä¸åŒçš„flash pageï¼‰ï¼Œkey-index pages&lt;/p&gt;
&lt;h3 id=&#34;meta-object&#34;&gt;Meta object&lt;/h3&gt;
&lt;p&gt;åœ¨å¯¹KVå¯¹è±¡è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å¤šçº§è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“åœ¨Liä¸åŒ¹é…æ—¶ï¼ŒæŸ¥æ‰¾Li+1ã€‚ä¸ºäº†å‡å°‘å¤šçº§æŸ¥æ‰¾çš„è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œä¼˜åŒ–ï¼Œå½“æ£€ç´¢åˆ°ç›®æ ‡KVå¯¹è±¡æ—¶ï¼ŒLSM treeå°†ä¼šè¿”å›ç›¸åº”çš„valueï¼ŒKVåˆ†ç¦»å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œå°†ä¼šé¢å¤–å»è¯»ä¸€æ¬¡value logã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ç›®å½•é¡¹çš„æ›´æ–°åªéœ€è¦ä¿®æ”¹å…¶å…ƒæ•°æ®å³å¯å®Œæˆï¼Œè€Œä¸éœ€è¦ä¿®æ”¹4KBçš„å—&lt;/p&gt;
&lt;h3 id=&#34;data-object&#34;&gt;Data object&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†é¿å…å¯¹å¤§æ•°æ®çš„å°èŒƒå›´æ›´æ–°å¸¦æ¥çš„I/Oé«˜è´Ÿè½½ï¼ŒKevinSSDå°†data objectåˆ†å‰²ä¸º4KBå¤§å°çš„å­å¯¹è±¡ï¼Œä½¿ç”¨å•ç‹¬çš„åç¼€æ¥å¯¹ä»–ä»¬è¿›è¡Œè¡¨ç¤ºï¼Œåç¼€ä»0å¼€å§‹ï¼Œæ‹¼æ¥åœ¨åŸå§‹çš„data object Keyåï¼Œå› æ­¤data objectçš„keyæœ€ç»ˆæ„æˆä¸º
$$
d:{inode\ \ \ number}:{subobject \ \ number,start\ with \ 0}
$$
ä¸éœ€è¦ä¸­é—´è¡¨è¿›è¡Œç´¢å¼•ï¼Œåªéœ€è¦é€šè¿‡åç§»é‡å³å¯å®šä½è¦ä¿®æ”¹çš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;Data objectåŒæ ·ä½¿ç”¨ä¿å­˜æŒ‡é’ˆçš„æ–¹å¼å°†æ˜ å°„å­˜å‚¨åœ¨key-index pagesä¸­ï¼Œkey-index pagesä¼šå¯¹é”®è¿›è¡Œæ’åºï¼Œå› æ­¤å±äºåŒä¸€ä¸ªæ–‡ä»¶çš„subobjectä¸€èˆ¬ä¼šåœ¨åŒä¸€ä¸ªflash pageä¸­ã€‚&lt;/p&gt;
&lt;p&gt;==ä¼˜åŒ–==ï¼šåœ¨æŸ¥æ‰¾æŒ‡é’ˆæ—¶ï¼Œä¼šå°†ä¸€æ•´ä¸ªé—ªå­˜é¡µå†…çš„æ•°æ®å…¨éƒ¨å–å‡ºï¼Œå­˜å‚¨åœ¨æ§åˆ¶å™¨çš„DRAMä¸­ï¼Œå‡è½»åç»­æŸ¥æ‰¾å¯èƒ½å¸¦æ¥çš„è´Ÿè½½&lt;/p&gt;
&lt;h2 id=&#34;ç¼“è§£ç´¢å¼•è´Ÿè½½&#34;&gt;ç¼“è§£ç´¢å¼•è´Ÿè½½&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨LSM-treeç”±äºå¤šçº§æŸ¥æ‰¾å¸¦æ¥é¢å¤–çš„I/Oï¼Œä¼ ç»ŸFTLçš„æ˜ å°„éƒ½ä¿å­˜åœ¨DRAMï¼Œå› æ­¤æ²¡æœ‰é¢å¤–å¼€é”€ã€‚ä½œè€…ä»‹ç»äº†ä¸‰ç§ä¸»è¦åŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‹ç¼©æ“ä½œçš„å¼€é”€&#34;&gt;å‹ç¼©æ“ä½œçš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;åŒä¸Šæ–‡ä»‹ç»çš„æ–¹æ¡ˆï¼Œé€šè¿‡åˆ†ç¦»Valueå¯ä»¥æ˜¾è‘—ç¼“è§£I/Oçš„æ•°æ®ä¼ è¾“è´Ÿè½½ï¼Œå¯¹dataè¿›è¡Œåˆ†ç‰‡æˆ‘ä¸ªäººæ„Ÿè§‰åè€Œä¼šåŠ å¤§å‹ç¼©æ“ä½œçš„åˆå¹¶è¿‡ç¨‹ï¼Œå³ä½¿åˆ†ç‰‡åé”®å€¼éƒ½æ˜¯æœ‰åºçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å±‚çº§æŸ¥æ‰¾çš„å¼€é”€&#34;&gt;å±‚çº§æŸ¥æ‰¾çš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;ç”±äºLSM-treeçš„ç‰¹æ€§ï¼Œéœ€è¦é€å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡çš„é¡ºåºæŸ¥æ‰¾ï¼Œä½œè€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶è¿˜ç¼“å­˜äº†çƒ­ç‚¹K2Vç´¢å¼•æ•°æ®ï¼ˆä¸ç›®æ ‡ç´¢å¼•å¤„åœ¨åŒä¸€ä¸ªflash pageä¸­çš„ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åˆ©ç”¨å¤§å®¹é‡SSDä¸­æä¾›çš„è¶…å¤§DRAMï¼Œä½œè€…é‡‡ç”¨å‹ç¼©å­˜å‚¨K2Vç´¢å¼•ï¼Œå¹¶åœ¨å…¶ä¸­æ’å…¥æ²¡æœ‰å‹ç¼©çš„K2Vç´¢å¼•æ¥ä½œä¸ºäºŒåˆ†æŸ¥æ‰¾çš„å‚ç…§ç‰©ã€‚ï¼ˆå¿«é€Ÿåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Ÿä¸å¦‚ç»§ç»­ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;åˆ†æ•£çš„å¯¹è±¡å¸¦æ¥çš„å¼€é”€&#34;&gt;åˆ†æ•£çš„å¯¹è±¡å¸¦æ¥çš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;LSM-treeå…è®¸å„å±‚ä¹‹é—´çš„keyèŒƒå›´é‡å ï¼Œå› æ­¤æœ‰åŒä¸€ä¸ªå‰ç¼€çš„ç›®å½•æˆ–è€…æ–‡ä»¶å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„Levelä¸­ï¼Œå¯¹äºè·å–ä¸€ä¸ªç›®å½•ä¸­æ‰€æœ‰ç›®å½•ã€æ–‡ä»¶çš„æ“ä½œï¼Œéœ€è¦å¯¹å¤šä¸ªé—ªå­˜é¡µè¿›è¡Œè®¿é—®ã€‚è¿™ä¸ªé—®é¢˜ä½œè€…æ²¡æœ‰ç»™å‡ºä¸€ä¸ªæ˜ç¡®çš„æ–¹æ¡ˆï¼ˆåœ¨å‹ç¼©åˆå¹¶æ—¶éšå¼è§£å†³ï¼‰ï¼Œä½†æ˜¯æä¾›äº†ä¸€ä¸ªç”¨æˆ·å·¥å…·æ¥ä¸»åŠ¨è§¦å‘åˆå¹¶ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…å¯¹æ¯”äº†å„ç§æ–¹æ³•åœ¨éšæœºè¯»ã€å±€éƒ¨è¯»ï¼ˆï¼Ÿï¼‰ã€é¡ºåºè¯»æƒ…å†µä¸‹å¯¹é—ªå­˜é¡µçš„è¯»å–æ¬¡æ•°ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ç¨³å®šä¼šæœ‰ä¸€æ¬¡è¯»å–&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨äº†KevinSSDåå¯¹äºSSDè€Œè¨€ï¼ŒI/Oå»¶è¿Ÿæœ‰è½»å¾®çš„å¢åŠ ï¼Œæ•´ä½“è€Œè¨€æ•ˆç‡æé«˜äº†&lt;/p&gt;
&lt;h1 id=&#34;0x03-implement-vfs&#34;&gt;0x03 Implement VFS&lt;/h1&gt;
&lt;h2 id=&#34;write&#34;&gt;write&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰çš„å†™ç›¸å…³ç³»ç»Ÿè°ƒç”¨å¯ä»¥é€šè¿‡SETå’ŒDELETEæ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚unlinkï¼Œåªéœ€è¦ä¸¤æ¬¡DELETEæŒ‡ä»¤ï¼Œç§»é™¤metaå’Œdata objectã€‚&lt;/p&gt;
&lt;p&gt;SETæ—¶ç°åœ¨Memtableä¸­ä¿å­˜ä¸€ä¸ªKVå¯¹è±¡ï¼Œç„¶åæŒä¹…åŒ–åˆ°flashä¸­ï¼Œè‹¥Keyå·²å­˜åœ¨åˆ™ä¸¢å¼ƒæ—§çš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;DELETEæ—¶åœ¨æ ‘ä¸Šå†™å…¥ä¸€ä¸ª4Bå¤§å°çš„å¢“ç¢‘&lt;/p&gt;
&lt;p&gt;å¤±æ•ˆçš„å¯¹è±¡ï¼ˆè¢«SETè¦†ç›–ï¼‰å’Œåˆ é™¤çš„å¯¹è±¡åœ¨å‹ç¼©æœŸé—´è¢«æ°¸ä¹…åˆ é™¤&lt;/p&gt;
&lt;h2 id=&#34;read&#34;&gt;read&lt;/h2&gt;
&lt;p&gt;é€šè¿‡GETå’ŒITERATEå®ç°&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œopenç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒæŸ¥è¯¢meta objectè·å–æ–‡ä»¶çš„inodeï¼Œé€šè¿‡GETå‘½ä»¤å®ç°&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œlookupç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç»™å®šä¸€ä¸ªå®Œæ•´çš„è·¯å¾„&lt;code&gt;/home/alice/&lt;/code&gt;ï¼Œä»æ ¹ç›®å½•å¼€å§‹è·å–å¤šä¸ªmeta objectï¼Œæœ€ç»ˆè·å–ç›®æ ‡æ–‡ä»¶çš„inode&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œreadç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå°†GETä¸€ä¸ªdata object&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œreaddirç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä½¿ç”¨ITERATEï¼Œæ‰¹é‡è·å–ä¸€ç»„meta objectsæ¥è·å–inode&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102210344432.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102210344432&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ç›¸è¾ƒäºExt4ï¼ŒKevinFSå¯ä»¥æ›´å¥½çš„é˜²æ­¢æ–‡ä»¶ç¢ç‰‡åŒ–å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x04-crash-consistency&#34;&gt;0x04 Crash Consistency&lt;/h1&gt;
&lt;h2 id=&#34;ä¸€è‡´æ€§ç»´æŠ¤&#34;&gt;ä¸€è‡´æ€§ç»´æŠ¤&lt;/h2&gt;
&lt;p&gt;é€šè¿‡äº‹åŠ¡å³å¯å®ç°åŸå­åŒ–çš„æ“ä½œ&lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿçš„æ—¥å¿—ç»“æ„ä¸­ï¼Œç”±äºäº‹åŠ¡çš„å¤§å°å—æ—¥å¿—å¤§å°çš„é™åˆ¶ï¼Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å¯èƒ½ä¼šè¢«åˆ’åˆ†åˆ°å¤šä¸ªäº‹åŠ¡ä¸­ã€‚KVFSé€šè¿‡å¼ºåˆ¶é™åˆ¶å¯¹ä¸€ä¸ªæ–‡ä»¶çš„æ“ä½œé©»ç•™åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ¥ç¡®ä¿åŸå­æ€§ã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡çš„éš”ç¦»ï¼Ÿå¯¹==fsync==æŒ‡ä»¤å•ç‹¬åˆ›å»ºä¸€ä¸ªå°å‹äº‹åŠ¡æ¥æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;KevinFSåŸºäºKVäº‹åŠ¡çš„ç‰¹æ€§æ¥ç»´æŠ¤ä¸€è‡´æ€§ï¼Œä¸ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;kväº‹åŠ¡çš„å®ç°&#34;&gt;KVäº‹åŠ¡çš„å®ç°&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨äº†ä¸‰ä¸ªæ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡è¡¨$TxTable$ï¼šè®°å½•äº‹åŠ¡åŸºæœ¬ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—$TxLogs$ï¼šç»´æŠ¤äº‹åŠ¡å¯¹è±¡çš„K2Vç´¢å¼•ï¼Œå­˜å‚¨åœ¨DRAMæˆ–è€…é—ªå­˜ä¸­&lt;/li&gt;
&lt;li&gt;æ¢å¤æ—¥å¿—$TxRecovery$ï¼šç”¨äºæ¢å¤å’Œç»ˆæ­¢äº‹åŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯æ”¶åˆ°BeginTxæŒ‡ä»¤æ—¶ï¼ŒKevinSSDåœ¨TxTableä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«TIDï¼Œå½“å‰äº‹åŠ¡çš„çŠ¶æ€ï¼Œä¸äº‹åŠ¡ç›¸å…³K2Vç´¢å¼•çš„ä½ç½®ï¼Œåˆå§‹çŠ¶æ€ä¸ºRUNNINGï¼ˆå¦‚â‘ ï¼‰ã€‚å½“åç»­æŒ‡ä»¤åˆ°è¾¾åï¼ŒKevinSSDå°†KVç´¢å¼•è®°å½•åœ¨TxLogsï¼Œå¹¶ç¼“å­˜åœ¨Memtableä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ”¶åˆ°EndTxæŒ‡ä»¤åï¼Œå®Œæˆäº‹åŠ¡çš„æäº¤ï¼Œæ ‡è®°äº‹åŠ¡çŠ¶æ€ä¸ºCOMMITTEDï¼ˆå¦‚â‘¡ï¼‰ã€‚å°†æäº¤çš„KVç´¢å¼•åŒæ­¥åˆ°LSM-treeä¸­&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221103102304181.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221103102304181&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘åœ¨COMMITTEDé˜¶æ®µï¼Œå°†TxLogsä¸­çš„KVç´¢å¼•åŒæ­¥åˆ°LSM tree L1ä¸­æ—¶çš„è´Ÿè½½ï¼Œå¯¹æ¯ä¸ªäº‹åŠ¡åœ¨DRAMä¸­ç»´æŠ¤äº†ä¸€ä¸ªSkiplistï¼Œä¾¿äºå¿«é€ŸæŸ¥æ‰¾KVå¯¹è±¡åœ¨TxLogsä¸­çš„ç´¢å¼•ï¼Œåœ¨L1å’ŒL2éœ€è¦è¿›è¡Œå‹ç¼©æ—¶å†å°†skiplistä¸­çš„æ•°æ®åŒæ­¥åˆ°checkpointï¼Œå½“åŒæ­¥å®Œæˆåï¼Œäº‹åŠ¡çš„çŠ¶æ€å°†å˜ä¸ºCHECKPOINTEDï¼ˆå¦‚â‘¢ï¼‰ï¼Œæœ€ç»ˆå³å°†å¯¹DRAMä¸­çš„TxTableå’ŒTxLogsè¿›è¡Œå›æ”¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;recovery&#34;&gt;Recovery&lt;/h2&gt;
&lt;p&gt;è‹¥å‘ç”Ÿæ‰ç”µï¼ŒKVSSDä¼šåˆ©ç”¨ç”µå®¹å°†KVç´¢å¼•æŒä¹…åŒ–åˆ°é—ªå­˜ä¸­çš„TxLogsï¼ŒTxTableæ›´æ–°å†…éƒ¨çš„æŒ‡é’ˆï¼Œåœ¨TxRecoveryä¸­è¿›è¡Œè®°å½•ã€‚åœ¨ç³»ç»Ÿé‡å¯æ—¶ï¼ŒKVSSDä¼šæ‰«æTx Recoveryï¼ŒåŠ è½½æœ€æ–°çš„TxTableï¼Œå¯¹äºå¤„äºCOMMITTEDçŠ¶æ€çš„äº‹åŠ¡ï¼Œå°†å…¶TxLogsç´¢å¼•åŠ è½½åˆ°Skiplistä¸­ï¼Œå¯¹äºå¤„äºRUNNINGçŠ¶æ€çš„äº‹åŠ¡ï¼Œç›´æ¥è¿›è¡ŒAbortå¹¶å›æ”¶å…¶èµ„æºã€‚&lt;/p&gt;
&lt;h1 id=&#34;conclusion--thinking&#34;&gt;Conclusion &amp;amp;&amp;amp; Thinking&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºK/Vå­˜å‚¨æ¶æ„çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡å¯¹Keyçš„è®¾è®¡ä¿è¯äº†åœ¨I/Oæ“ä½œä¸­çš„é«˜æ•ˆæ€§ã€‚é€šè¿‡æœ¬æ–‡äº†è§£äº†ä¸€äº›KVå­˜å‚¨çš„trickï¼Œå¯¹äºKVå­˜å‚¨çš„å„ç§åœºæ™¯ï¼Œæ— è®ºæ˜¯åœ¨Redisä¸­è¿˜æ˜¯åœ¨KVæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¯¹äºKeyçš„è®¾è®¡éƒ½è‡³å…³é‡è¦ï¼Œå¥½çš„è®¾è®¡å¾€å¾€èƒ½å¤Ÿå¸¦æ¥æå¤§çš„æ•ˆç‡æå‡ï¼Œä¾‹å¦‚å¸ƒéš†è¿‡æ»¤å™¨çš„åº”ç”¨ï¼Œæœ‰å¾ˆå¤šç»éªŒå€¼å¾—å­¦ä¹ ã€‚åŒæ—¶äº†è§£äº†å¯¹äº‹åŠ¡çš„ä¸€äº›æ§åˆ¶æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤ç¯‡è®ºæ–‡è®©æˆ‘æƒŠè®¶äºæ–‡ä»¶ç³»ç»Ÿè¿˜èƒ½é€šè¿‡KVå­˜å‚¨æ¥å®ç°çš„é€šçŸ¥ï¼Œè¿˜è®©æˆ‘å›æƒ³èµ·äº†TiDBï¼Œé€šè¿‡KVå­˜å‚¨ç³»ç»Ÿæ¥å®ç°äº†åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œå¹¶å®Œå…¨å…¼å®¹MySQLï¼Œè¯´æ˜åœ¨åˆ©ç”¨å¥½KVå­˜å‚¨çš„ç‰¹æ€§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³é—®é¢˜ï¼Œè¦å¤šå»å­¦ä¹ ä»–ä»¬çš„è®¾è®¡æ€æƒ³ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ã€å­˜å‚¨ç³»ç»Ÿã€‘æ–‡ä»¶ç³»ç»Ÿ</title>
        <link>https://blog.ipandai.club/p/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</link>
        <pubDate>Tue, 11 Oct 2022 13:44:49 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</guid>
        <description>&lt;h1 id=&#34;0x00-åŸºæœ¬æ¦‚å¿µ&#34;&gt;0x00 åŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;æ–‡ä»¶çš„åŸºæœ¬æ¦‚å¿µï¼Œ åŒ…å«ä¿¡æ¯çš„æ¯”ç‰¹æµ/å—ï¼Œè®¡ç®—æœºå¾€å¾€éœ€è¦å¤„ç†è¿œé«˜äºä¸»å­˜å®¹é‡çš„æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨æ–‡ä»¶æ¥ä¿å­˜ï¼›æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ›´é•¿ï¼Œä¸èƒ½å­˜å‚¨åœ¨å †æ ˆä¸­ï¼›å¯¹æ–‡ä»¶çš„æ•°æ®/ä¿¡æ¯å¯¹å¤–è¿›è¡Œåˆ†äº«çš„åª’ä»‹ã€‚å¯ä»¥ç”¨äºè¿›ç¨‹é—´çš„ä¿¡æ¯å…±äº«ï¼Œè‡ªç”±æ€§å’Œå®¹é‡ä¸Šéƒ½ä¼˜äºå…±äº«å†…å­˜çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½&#34;&gt;æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;Namespace å‘½åç©ºé—´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶ç›®å½•çš„å»ºç«‹ã€ç»´æŠ¤å’Œæ£€ç´¢ï¼ˆç›®å½•æ ‘ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å­˜å‚¨ç®¡ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç©ºé—´ç®¡ç†ï¼šå­˜å‚¨ç©ºé—´çš„åˆ†é…å’Œç®¡ç†ï¼ˆç®¡ç†ç©ºé—²çš„å—ï¼‰&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶å—ç®¡ç†ï¼šé€»è¾‘åœ°å€ä¸å­˜å‚¨ç‰©ç†åœ°å€çš„æ˜ å°„ï¼ˆlogical offsetâ€”Physical Block numberï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°æ®ä¿æŠ¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶å‡ºç°åå—&lt;/li&gt;
&lt;li&gt;ç¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é æ€§/ä¸€è‡´æ€§&lt;/p&gt;
&lt;h1 id=&#34;0x01-ç”¨æˆ·è§†è§’&#34;&gt;0x01 ç”¨æˆ·è§†è§’&lt;/h1&gt;
&lt;h2 id=&#34;æ–‡ä»¶ç›®å½•æ“ä½œ&#34;&gt;æ–‡ä»¶ç›®å½•æ“ä½œ&lt;/h2&gt;
&lt;p&gt;æ–‡ä»¶æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create/Delete&lt;/li&gt;
&lt;li&gt;Open/Close è¿”å›File Handle&lt;/li&gt;
&lt;li&gt;Read/Write&lt;/li&gt;
&lt;li&gt;Append è¿½åŠ å†™å…¥&lt;/li&gt;
&lt;li&gt;Seek ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆ offset&lt;/li&gt;
&lt;li&gt;Getattr/Setattr è¯»å–/ä¿®æ”¹inodeä¸­ä¿å­˜çš„æ–‡ä»¶ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;Rename&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å½•æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Createdir/rmdir&lt;/li&gt;
&lt;li&gt;Link è½¯é“¾æ¥ã€ç¡¬é“¾æ¥ è®²ç›®å½•é¡¹ç›®æŒ‡å‘æ–‡ä»¶çš„inode&lt;/li&gt;
&lt;li&gt;Unlink&lt;/li&gt;
&lt;li&gt;Readdir è¯»å–å­ç›®å½•ä»¥åŠç›®å½•é¡¹&lt;/li&gt;
&lt;li&gt;Rename&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–‡ä»¶ç›®å½•çš„æ„æˆ&#34;&gt;æ–‡ä»¶ç›®å½•çš„æ„æˆ&lt;/h2&gt;
&lt;p&gt;æ–‡ä»¶çš„ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶å†…å®¹ï¼Œå­—èŠ‚åºåˆ—&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶çš„å…ƒæ•°æ®metadataï¼Œæ–‡ä»¶æ§åˆ¶å—ï¼ŒUnixç³»ç»Ÿä¸­ç§°ä¸ºinode(index node)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å½•çš„ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬è´¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯å­ç›®å½•ã€æ–‡ä»¶ç­‰ç›®å½•é¡¹ç›®&lt;/li&gt;
&lt;li&gt;ç›®å½•ä¹Ÿæœ‰inode&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;file-handle&#34;&gt;File Handle&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºåŸæ–‡ä»¶çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œè¯»å†™ï¼ŒOffsetå¯ä»¥å…±äº«ç»™ä¸¤ä¸ªFile Handleï¼Œä¹Ÿå¯ä»¥æ¯ä¸ªFile Handleç‹¬æœ‰å„è‡ªçš„Offsetã€‚&lt;/p&gt;
&lt;p&gt;Linux VFSä¸­ä¸ºæ–‡ä»¶æè¿°ç¬¦fdï¼Œå¯¹åº”ä¸€ä¸ªFile Objectï¼ŒåŒ…å«æ–‡ä»¶çš„ä¿¡æ¯ï¼Œæ–‡ä»¶ç³»ç»Ÿç®¡ç†dentryã€inodeçš„ç¼“å­˜ï¼Œç”¨äºæŸ¥æ‰¾æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ã€‚å…³äº&lt;strong&gt;Linux VFS&lt;/strong&gt;çš„å†…å®¹ï¼Œè®¡åˆ’å†å•ç‹¬å¼€ä¸ªåšå®¢è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;file-control-block-inode&#34;&gt;File Control Block (Inode)&lt;/h2&gt;
&lt;p&gt;æ¯ä¸ªæ–‡ä»¶å”¯ä¸€çš„idï¼ŒåŒ…å«ä»¥ä¸‹ç»“æ„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Blockçš„ä¿¡æ¯ï¼Œæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ä½ç½®&lt;/li&gt;
&lt;li&gt;æ•°æ®å¤§å°&lt;/li&gt;
&lt;li&gt;Ctimeåˆ›å»ºæ—¶é—´ï¼Œutimeæ›´æ–°æ—¶é—´ï¼Œaccess timeæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰è€…ä¿¡æ¯ï¼ŒACL(access control lists)è®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;é“¾æ¥æƒ…å†µç»Ÿè®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;dirent---directory-entry&#34;&gt;Dirent - Directory Entry&lt;/h2&gt;
&lt;p&gt;ç›®å½•é¡¹çºªå½•å­æ–‡ä»¶å’Œå­ç›®å½•çš„åç§°&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªç›®å½•é¡¹çš„ç»“æ„&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;å¤§å°&lt;/th&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;__le32&lt;/td&gt;
&lt;td&gt;4bytes&lt;/td&gt;
&lt;td&gt;Inode&lt;/td&gt;
&lt;td&gt;inodeç¼–å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__le16&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;Rec_len&lt;/td&gt;
&lt;td&gt;ç›®å½•é¡¹çš„é•¿åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__u8&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;Name_len&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶åé•¿åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__u8&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;File_type&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;char[EXT2_NAME_LEN]&lt;/td&gt;
&lt;td&gt;æœ€å¤§255ä¸ªå­—ç¬¦&lt;/td&gt;
&lt;td&gt;Name&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶å&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ‰€æœ‰ç›®å½•éƒ½åŒ…å«çš„ç›®å½•é¡¹åŒ…æ‹¬å½“å‰ç›®å½•å’Œä¸Šçº§ç›®å½•:&lt;code&gt;.&lt;/code&gt;,&lt;code&gt;..&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¦å¯¹æ–‡ä»¶åè¿›è¡Œ4å­—èŠ‚å¯¹é½ï¼Œåé¢è¡¥&lt;code&gt;\0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ç›®å½•é¡¹é¡ºåºæ‹¼æ¥ç»„æˆç›®å½•ä¿¡æ¯ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶å¯ä»¥ä½¿ç”¨rec_lenæ¥è®¡ç®—åç§»é‡ï¼Œä¾¿äºæŸ¥æ‰¾ç›®å½•ä¸­çš„æ–‡ä»¶ï¼ˆé¡ºåºéå†ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;ç›®å½•æ ‘&#34;&gt;ç›®å½•æ ‘&lt;/h2&gt;
&lt;p&gt;ç›®å½•æ ‘çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªç›®å½•éƒ½æœ‰è‡ªå·±çš„inodeï¼ŒåŒæ—¶è¿˜æœ‰direntryï¼Œå¯¹å…¶ä¸­çš„å­ç›®å½•å¯ä»¥æ„å»ºå­æ ‘ï¼Œæ–‡ä»¶å¯ä»¥å»ºç«‹æ–‡ä»¶å­èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221011191955170.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221011191955170&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®PathnameæŸ¥æ‰¾æ–‡ä»¶çš„è¿‡ç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»æ ¹ç›®å½•&lt;code&gt;/&lt;/code&gt;å¼€å§‹æŸ¥è¯¢ï¼Œè§£æå‡ºè¦æŸ¥è¯¢çš„é¡¹ç›®&lt;/li&gt;
&lt;li&gt;è·å–å½“å‰ç›®å½•çš„ç›®å½•é¡¹ï¼ˆå¯èƒ½åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå¯èƒ½è¦å‘ç£ç›˜è¯·æ±‚ï¼‰&lt;/li&gt;
&lt;li&gt;æ¯”å¯¹ç›¸åº”çš„çºªå½•æ˜¯å¦å­˜åœ¨äºç›®å½•é¡¹ä¸­ï¼Œæ¯”å¯¹æˆåŠŸåˆ™è·å–å…¶inode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥æ‰¾è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æƒé™ï¼šåœ¨æ¯çº§ç›®å½•æŸ¥æ‰¾æ—¶ï¼Œéœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å¯¹å½“å‰ç›®å½•è¿›è¡Œè®¿é—®çš„æƒé™ï¼Œç„¶åæ‰èƒ½ç»§ç»­è¿›è¡Œæ“ä½œ&lt;/li&gt;
&lt;li&gt;æ£€æµ‹æ˜¯å¦ä¸ºè½¯é“¾æ¥/ç¬¦å·é“¾æ¥(Symbolic link)ï¼šç›®å½•é¡¹å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªinodeï¼Œé˜²æ­¢å‡ºç°å¾ªç¯é“¾æ¥&lt;/li&gt;
&lt;li&gt;æ£€æµ‹æ˜¯å¦æŒ‚è½½äº†å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯æŒ‚åœ¨æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ï¼Œè‹¥å‡ºç°æ­¤ç±»æƒ…å†µéœ€è¦è¿›å…¥æ–°çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒæŸ¥æ‰¾&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;access-control-lists-è®¿é—®æ§åˆ¶&#34;&gt;Access Control Lists è®¿é—®æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;åŸºæœ¬ACLçºªå½•å†…å®¹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è®°å½•ç±»å‹&lt;/th&gt;
&lt;th&gt;æ ¼å¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Owner&lt;/td&gt;
&lt;td&gt;user::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Owning Group&lt;/td&gt;
&lt;td&gt;group::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Others&lt;/td&gt;
&lt;td&gt;other::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;rwxä¸ºæ©ç å½¢å¼ï¼Œä½¿ç”¨ä¸‰ä½å…«è¿›åˆ¶ï¼Œ&lt;code&gt;777&lt;/code&gt;ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç³»ç»Ÿè°ƒç”¨ä¸º&lt;code&gt;chmod&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰æ‰©å±•ACLï¼Œè®°å½•å†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è®°å½•ç±»å‹&lt;/th&gt;
&lt;th&gt;æ ¼å¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Owner&lt;/td&gt;
&lt;td&gt;user::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Named User&lt;/td&gt;
&lt;td&gt;user:name:rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Owning Group&lt;/td&gt;
&lt;td&gt;group::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Named Group&lt;/td&gt;
&lt;td&gt;group:name:rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mask&lt;/td&gt;
&lt;td&gt;mask::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Others&lt;/td&gt;
&lt;td&gt;other::rwx&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯¹äºæ–‡ä»¶çš„è®¿é—®æƒé™é€šè¿‡Named Userï¼ŒOwning Groupå’ŒNamed Groupè¿›è¡Œæˆæƒï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨Maskè®¾ç½®æ©ç å¯¹æƒé™è¿›è¡Œæ§åˆ¶ï¼Œä¾‹å¦‚æœ‰æƒé™&lt;code&gt;r-x&lt;/code&gt;ï¼Œå¯¹äºMask:&lt;code&gt;mask::rw-&lt;/code&gt;ï¼Œæœ€ç»ˆçš„æ“ä½œæƒé™ä¸º&lt;code&gt;r--&lt;/code&gt;ï¼Œå°†æ©ç å’Œæƒé™è¿›è¡Œä¸æ“ä½œ&lt;/p&gt;
&lt;p&gt;ä¸åŒæ–‡ä»¶ç³»ç»Ÿæœ‰å¯¹ACLä¸åŒçš„æ‰©å±•å’Œå®ç°&lt;/p&gt;
&lt;h2 id=&#34;example&#34;&gt;Example&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;int fd = open(&amp;quot;/foo/bar.txt&amp;quot;, RO)&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æŸ¥æ‰¾æ–‡ä»¶çš„inode
&lt;ol&gt;
&lt;li&gt;åœ¨æ ¹ç›®å½•æŸ¥æ‰¾fooç›®å½•&lt;/li&gt;
&lt;li&gt;è¯»å–fooç›®å½•çš„å†…å®¹&lt;/li&gt;
&lt;li&gt;åœ¨fooç›®å½•ä¸­æŸ¥æ‰¾bar&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡æŸ¥è¯¢å…ˆåœ¨ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ä¸ºinodeåˆ›å»ºvnodeç»“æ„
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­inodeæ˜¯å¦åœ¨inode cacheä¸­ï¼Œè‹¥ä¸åœ¨åˆ™éœ€è¦ä»ç£ç›˜ä¸­è¯·æ±‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ååˆ›å»ºvnodeç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–File Object&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆfdï¼Œå¡«å……æ•°æ®ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;è¿”å›fdç»™è¿›ç¨‹&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x02-å®ç°è§’åº¦&#34;&gt;0x02 å®ç°è§’åº¦&lt;/h1&gt;
</description>
        </item>
        <item>
        <title>Linux Block I/O Stackç®€ä»‹</title>
        <link>https://blog.ipandai.club/p/linux-block-i/o-stack%E7%AE%80%E4%BB%8B/</link>
        <pubDate>Sun, 09 Oct 2022 13:44:18 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/linux-block-i/o-stack%E7%AE%80%E4%BB%8B/</guid>
        <description>&lt;p&gt;æœ¬æ–‡å°†ä»æ“ä½œç³»ç»Ÿå†…æ ¸å±‚é¢å»ä»‹ç»Linux I/O æ ˆ&lt;/p&gt;
&lt;p&gt;==æ¶‰åŠLinuxå†…æ ¸çš„éƒ¨åˆ†ä¸»è¦ä¸ºLinux 2.6==&lt;/p&gt;
&lt;h1 id=&#34;linux-io-æ ˆæ¦‚è¿°&#34;&gt;Linux I/O æ ˆæ¦‚è¿°&lt;/h1&gt;
&lt;p&gt;Linux I/O æ ˆçš„ç®€å›¾å¦‚ä¸‹&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221106012036118.png&#34; alt=&#34;image-20221106012036118&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;ä¸‹é¢åˆ†åˆ«ç®€è¿°å„ä¸ªå±‚æ¬¡çš„åŠŸèƒ½&lt;/p&gt;
&lt;h2 id=&#34;åº”ç”¨ç¨‹åºå±‚&#34;&gt;åº”ç”¨ç¨‹åºå±‚&lt;/h2&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºå±‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘VFSå‘èµ·I/Oè¯·æ±‚&lt;/p&gt;
&lt;h2 id=&#34;vfså±‚&#34;&gt;VFSå±‚&lt;/h2&gt;
&lt;p&gt;VFSä¸»è¦å‘ç”¨æˆ·ç©ºé—´æä¾›æ–‡ä»¶ç³»ç»Ÿå±‚é¢çš„æ¥å£ï¼ŒåŒæ—¶å‘ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿå®ç°æä¾›æŠ½è±¡ï¼Œä½¿ä»–ä»¬å¯ä»¥å…±å­˜ã€‚VFSå°†æ–‡ä»¶ç³»ç»Ÿåœ¨ç”¨æˆ·å±‚é¢è¿›è¡ŒæŠ½è±¡ï¼Œä¾¿äºç”¨æˆ·å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¥è‡ªåº”ç”¨ç¨‹åºçš„è¯·æ±‚åˆ°è¾¾VFSåï¼ŒVFSä¼šåˆ›å»ºåŒ…å«I/Oè¯·æ±‚ä¿¡æ¯çš„ç»“æ„ä½“æäº¤ç»™å—I/Oå±‚ã€‚&lt;/p&gt;
&lt;p&gt;Linuxåœ¨æ–‡ä»¶ç³»ç»Ÿå±‚æä¾›ä¸‰ç§IOè®¿é—®çš„å½¢å¼ï¼šBuffered IOã€MMap ã€Direct I/Oã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Buffered I/Oï¼šè¿™ç§è®¿é—®æƒ…å†µä¸‹æ–‡ä»¶æ•°æ®éœ€è¦ç»è¿‡è®¾å¤‡ã€Page Cacheã€ç”¨æˆ·æ€ç¼“å­˜ï¼Œéœ€è¦è¿›è¡Œä¸¤æ¬¡çš„æ‹·è´åŠ¨ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MMapï¼šå†…å­˜æ˜ å°„æŠ€æœ¯ï¼Œå°†å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´ä¸è®¾å¤‡è¿›è¡Œæ˜ å°„ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿå‘è®¿é—®æ™®é€šå†…å­˜ä¸€æ ·å¯¹æ–‡ä»¶è¿›è¡Œè®¿é—®ã€‚ä½¿æ–‡ä»¶æ•°æ®ä»…ç»è¿‡è®¾å¤‡ã€Page Cacheå³å¯ç›´æ¥ä¼ é€’åˆ°åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Direct I/Oï¼šé‡‡ç”¨Direct IOçš„æ–¹å¼å¯ä»¥è®©ç”¨æˆ·æ€ç›´æ¥ä¸å—è®¾å¤‡è¿›è¡Œå¯¹æ¥ï¼Œè·³è¿‡äº†Page Cacheï¼Œä»ç¡¬ç›˜å’Œç”¨æˆ·æ€ä¸­æ‹·è´æ•°æ®ï¼Œæé«˜æ–‡ä»¶ç¬¬ä¸€æ¬¡è¯»å†™çš„æ•ˆç‡ï¼Œè‹¥ä¹‹åéœ€è¦é‡å¤è®¿é—®åŒä¸€æ•°æ®ï¼Œéœ€è¦æ¶ˆè€—æ¯”åˆ©ç”¨Page Cacheæ›´å¤šçš„æ—¶é—´ï¼Œä¸€èˆ¬ç”¨äºæ•°æ®åº“ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å—ioå±‚&#34;&gt;å—I/Oå±‚&lt;/h2&gt;
&lt;p&gt;ç³»ç»Ÿèƒ½å¤Ÿéšæœºè®¿é—®å›ºå®šå¤§å°çš„æ•°æ®ç‰‡çš„è®¾å¤‡è¢«ç§°ä¸ºå—è®¾å¤‡ï¼Œæœ€å¸¸è§çš„å—è®¾å¤‡ä¸ºç¡¬ç›˜ï¼ˆæœºæ¢°ç¡¬ç›˜ï¼Œå›ºæ€ç›˜ï¼‰ï¼Œå¯¹å—è®¾å¤‡çš„è®¿é—®é€šå¸¸æ˜¯åœ¨å…¶å†…éƒ¨å®‰è£…æ–‡ä»¶ç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿä¸ºäº†å¯¹å…¶è®¿é—®å’Œä¿è¯æ€§èƒ½ï¼Œéœ€è¦ä¸€ä¸ªå­ç³»ç»Ÿæ¥å¯¹å—è®¾å¤‡å’Œå¯¹å—è®¾å¤‡çš„è¯·æ±‚è¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;scsiåº•å±‚--è®¾å¤‡é©±åŠ¨å±‚&#34;&gt;SCSIåº•å±‚ &amp;amp;&amp;amp; è®¾å¤‡é©±åŠ¨å±‚&lt;/h2&gt;
&lt;p&gt;å—I/Oå±‚å°†è¯·æ±‚å‘å¾€SCSIå±‚ï¼ŒSCSIå°±å¼€å§‹çœŸå®å¤„ç†è¿™äº›IOè¯·æ±‚ï¼Œä½†æ˜¯SCSIå±‚åˆå¯¹å…¶å†…éƒ¨æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†äº†ä¸åŒå±‚æ¬¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SCSIé«˜å±‚ï¼šé«˜å±‚é©±åŠ¨è´Ÿè´£ç®¡ç†diskï¼Œæ¥æ”¶å—I/Oå±‚å‘å‡ºçš„IOè¯·æ±‚ï¼Œæ‰“åŒ…æˆSCSIå±‚å¯è¯†åˆ«çš„å‘½ä»¤æ ¼å¼ï¼Œç»§ç»­å¾€ä¸‹å‘&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SCSIä¸­å±‚ï¼šä¸­å±‚è´Ÿè´£é€šç”¨åŠŸèƒ½ï¼Œå¦‚é”™è¯¯å¤„ç†ï¼Œè¶…æ—¶é‡è¯•ç­‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SCSIä½å±‚ï¼šåº•å±‚è´Ÿè´£è¯†åˆ«ç‰©ç†è®¾å¤‡ï¼Œå°†å…¶æŠ½è±¡æä¾›ç»™é«˜å±‚ï¼ŒåŒæ—¶æ¥æ”¶é«˜å±‚æ´¾å‘çš„SCSIå‘½ä»¤ï¼Œäº¤ç»™ç‰©ç†è®¾å¤‡å¤„ç†&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´æ­£ï¼šå¯¹äºä¼ ç»Ÿçš„å—è®¾å¤‡è€Œè¨€ï¼ŒæœåŠ¡å™¨é€šè¿‡SCSIåè®®ã€SASæ¥å£è¿æ¥ï¼Œä¸ªäººç”µè„‘é€šè¿‡AHCIåè®®/SATAæ¥å£è¿æ¥ï¼Œç›®å‰ä¸»æµçš„å‘å±•æ–¹å‘ä¸ºNVMeåè®®/M.2æ¥å£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç‰©ç†å¤–è®¾å±‚&#34;&gt;ç‰©ç†å¤–è®¾å±‚&lt;/h2&gt;
&lt;p&gt;åœ¨I/Oä¸­ä¸€èˆ¬ä¸ºç£ç›˜ã€å›ºæ€ç¡¬ç›˜ç­‰å­˜å‚¨è®¾å¤‡&lt;/p&gt;
&lt;h1 id=&#34;vfsç®€ä»‹&#34;&gt;VFSç®€ä»‹&lt;/h1&gt;
&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;VFSä¸»è¦å‘ç”¨æˆ·ç©ºé—´æä¾›æ–‡ä»¶ç³»ç»Ÿå±‚é¢çš„æ¥å£ï¼ŒåŒæ—¶å‘ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿå®ç°æä¾›æŠ½è±¡ï¼Œä½¿ä»–ä»¬å¯ä»¥å…±å­˜ã€‚&lt;/p&gt;
&lt;p&gt;VFSå°†æ–‡ä»¶ç³»ç»Ÿåœ¨ç”¨æˆ·å±‚é¢è¿›è¡ŒæŠ½è±¡ï¼Œä¾¿äºç”¨æˆ·å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;VFSä¸­æœ‰å››ä¸ªæœ€é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯dentryã€fileã€inodeã€superblockï¼Œä¸‹æ–‡å¯¹ä»–ä»¬åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;directory-entry-cache-dcache&#34;&gt;Directory Entry Cache (dcache)&lt;/h2&gt;
&lt;p&gt;VFSæä¾›äº†openï¼Œstatï¼Œchmodç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œéœ€è¦å‘ä»–ä»¬æä¾›æ–‡ä»¶çš„è·¯å¾„åï¼ŒVFSä¼šåœ¨dcacheä¸­å»æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;dcacheæä¾›äº†éå¸¸å¿«çš„æŸ¥æ‰¾æœºåˆ¶å°†è·¯å¾„åè½¬æ¢åˆ°ä¸€ä¸ªå…·ä½“çš„dentryç›®å½•é¡¹ï¼Œç¼“å­˜çš„ç›®å½•é¡¹å­˜å‚¨åœ¨RAMä¸­å¹¶ä¸”ä¸ä¼šæŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ²¡æœ‰å‘½ä¸­ç¼“å­˜æ—¶ï¼ŒVFSä¼šé€šè¿‡æŸ¥æ‰¾å’ŒåŠ è½½inodeæ¥åˆ›å»ºdentryç¼“å­˜ï¼Œæœ€ç»ˆå®ç°å¯ä»¥é€šè¿‡path nameæŸ¥æ‰¾åˆ°å¯¹åº”çš„dentryç›®å½•é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;the-inode-object&#34;&gt;The Inode Object&lt;/h2&gt;
&lt;p&gt;æ¯ä¸ªç‹¬ç«‹çš„dentryéƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªinodeçš„æŒ‡é’ˆï¼Œinodeä¸€èˆ¬ä¿å­˜åœ¨discï¼ˆå—è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸­æˆ–è€…å†…å­˜ä¸­ï¼ˆè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚discä¸­çš„inodeåœ¨è¢«è¯·æ±‚æˆ–ä¿®æ”¹æ—¶ä¼šå¤åˆ¶åˆ°å†…å­˜ä¸­ï¼Œå¹¶åœ¨ä¿®æ”¹åå›å†™åˆ°discã€‚å¤šä¸ªdentryå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªinodeï¼ˆç¡¬é“¾æ¥ï¼‰&lt;/p&gt;
&lt;p&gt;å¯¹äºæŸ¥æ‰¾inodeçš„è¯·æ±‚ï¼ŒVFSåœ¨çˆ¶ç›®å½•çš„inodeè°ƒç”¨lookupå‡½æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;the-file-object&#34;&gt;The File Object&lt;/h2&gt;
&lt;p&gt;åœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œéœ€è¦åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç»“æ„ä½“ï¼ˆå†…æ ¸å±‚é¢å¯¹file descriptorçš„å®ç°ï¼‰ï¼Œç»“æ„ä½“å†…å®¹çš„åˆ›å»ºé€šè¿‡dentryæŒ‡é’ˆæ¥è·å–ï¼Œæ–‡ä»¶ç»“æ„ä½“å­˜å‚¨åœ¨è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ–‡ä»¶çš„è¯»å†™ã€å…³é—­é€šè¿‡ç”¨æˆ·ç©ºé—´çš„fdæ¥æ“ä½œæ­£ç¡®çš„æ–‡ä»¶ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;åªè¦æ–‡ä»¶æ‰“å¼€ï¼Œå®ƒå°±ä¼šä¿æŒå¯¹dentryçš„ä½¿ç”¨çŠ¶æ€ï¼Œè¿™åŒæ—¶æ„å‘³ç€inodeä»åœ¨ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;the-dentry-object&#34;&gt;The Dentry Object&lt;/h2&gt;
&lt;p&gt;ç›®å½•é¡¹çºªå½•å­æ–‡ä»¶å’Œå­ç›®å½•çš„åç§°&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªç›®å½•é¡¹çš„ç»“æ„&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;å¤§å°&lt;/th&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;__le32&lt;/td&gt;
&lt;td&gt;4bytes&lt;/td&gt;
&lt;td&gt;Inode&lt;/td&gt;
&lt;td&gt;inodeç¼–å·&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__le16&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;Rec_len&lt;/td&gt;
&lt;td&gt;ç›®å½•é¡¹çš„é•¿åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__u8&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;Name_len&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶åé•¿åº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;__u8&lt;/td&gt;
&lt;td&gt;2bytes&lt;/td&gt;
&lt;td&gt;File_type&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;char[EXT2_NAME_LEN]&lt;/td&gt;
&lt;td&gt;æœ€å¤§255ä¸ªå­—ç¬¦&lt;/td&gt;
&lt;td&gt;Name&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶å&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ‰€æœ‰ç›®å½•éƒ½åŒ…å«çš„ç›®å½•é¡¹åŒ…æ‹¬å½“å‰ç›®å½•å’Œä¸Šçº§ç›®å½•:&lt;code&gt;.&lt;/code&gt;,&lt;code&gt;..&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¦å¯¹æ–‡ä»¶åè¿›è¡Œ4å­—èŠ‚å¯¹é½ï¼Œåé¢è¡¥&lt;code&gt;\0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ç›®å½•é¡¹é¡ºåºæ‹¼æ¥ç»„æˆç›®å½•ä¿¡æ¯ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶å¯ä»¥ä½¿ç”¨rec_lenæ¥è®¡ç®—åç§»é‡ï¼Œä¾¿äºæŸ¥æ‰¾ç›®å½•ä¸­çš„æ–‡ä»¶ï¼ˆé¡ºåºéå†ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;the-superblock-object&#34;&gt;The SuperBlock Object&lt;/h2&gt;
&lt;p&gt;superblockå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå­˜å‚¨æœ‰å…³æ–‡ä»¶ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯&lt;/p&gt;
&lt;h3 id=&#34;æ³¨å†Œå’ŒæŒ‚è½½ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ&#34;&gt;æ³¨å†Œå’ŒæŒ‚è½½ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹çš„API&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;linux/fs.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;register_filesystem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unregister_filesystem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½å¯ä»¥é€šè¿‡&lt;code&gt;-&amp;gt;mount()&lt;/code&gt;æ–¹æ³•å°†æ–°çš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æŒ‚è½½ç‚¹ï¼Œå½“pathnameè§£æè§£æåˆ°æŒ‚è½½ç‚¹æ—¶ï¼Œä¼šè·³è½¬åˆ°è¢«æŒ‚åœ¨æ–‡ä»¶ç³»ç»Ÿçš„rootã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸æ‰€æ³¨å†Œçš„æ–‡ä»¶ç³»ç»Ÿåœ¨&lt;code&gt;/proc/filesystems&lt;/code&gt;æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;p&gt;&lt;code&gt;file_system_type&lt;/code&gt;ç»“æ„çš„å®šä¹‰å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fs_flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dentry&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kill_sb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;super_block&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;module&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;owner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;list_head&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fs_supers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock_class_key&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;s_lock_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock_class_key&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;s_umount_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;mount()&lt;/code&gt;æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ä¸ªå‚æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_system_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fs_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;page-cache&#34;&gt;Page Cache&lt;/h1&gt;
&lt;p&gt;â€‹	é¡µé«˜é€Ÿç¼“å­˜(Page Cache)æ˜¯Linuxå†…æ ¸æ‰€ä½¿ç”¨çš„ä¸»è¦ç¡¬ç›˜é«˜é€Ÿç¼“å­˜ã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå†…æ ¸åœ¨è¯»å†™ç¡¬ç›˜æ—¶éƒ½å¼•ç”¨é¡µé«˜é€Ÿç¼“å­˜ã€‚æ–°é¡µè¢«è¿½åŠ åˆ°é¡µé«˜é€Ÿç¼“å­˜ä»¥æ»¡è¶³ç”¨æˆ·æ€è¿›ç¨‹çš„è¯»è¯·æ±‚ã€‚å¦‚æœé¡µä¸åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œæ–°é¡µå°±è¢«åŠ åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç„¶åç”¨ä»ç¡¬ç›˜è¯»å‡ºçš„æ•°æ®å¡«å……å®ƒ ã€‚ å¦‚ æœå†…å­˜æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´ ï¼Œå°±è®©è¯¥é¡µåœ¨é«˜é€Ÿç¼“å­˜ä¸­é•¿æœŸä¿ç•™ ï¼Œä½¿å…¶ä»–è¿›ç¨‹å†ä½¿ç”¨è¯¥é¡µæ—¶ä¸å†è®¿é—®ç¡¬ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	åŒæ—¶ï¼Œ åœ¨æŠŠä¸€é¡µæ•°æ®å†™åˆ°å—è®¾å¤‡ä¹‹å‰ï¼Œå†…æ ¸é¦–å…ˆæ£€æŸ¥å¯¹åº”çš„é¡µæ˜¯å¦å·²ç»åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ å¦‚æœä¸åœ¨ï¼Œå°±è¦å…ˆåœ¨å…¶ä¸­å¢åŠ  ä¸€ä¸ªæ–°é¡¹ï¼Œå¹¶ç”¨è¦å†™åˆ°ç¡¬ç›˜ä¸­çš„æ•°æ®å¡«å……è¯¥é¡¹ã€‚I/Oæ•°æ®çš„ä¼ é€å¹¶ä¸æ˜¯é©¬ ä¸Šå¼€å§‹ï¼Œè€Œæ˜¯è¦å»¶è¿Ÿå‡ ç§’ä¹‹åæ‰å¯¹ç¡¬ç›˜è¿›è¡Œæ›´æ–°ï¼Œä»è€Œä½¿è¿›ç¨‹æœ‰æœºä¼šå¯¹è¦å†™äººç¡¬ç›˜çš„æ•°æ®åšè¿› ä¸€æ­¥çš„ä¿®æ”¹ (å†…æ ¸æ‰§è¡Œå»¶è¿Ÿçš„å†™æ“ä½œ)ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å‡ ä¹æ‰€æœ‰çš„è¯»å†™éƒ½ä¾èµ–Page Cacheï¼Œé™¤éæŒ‡å®šäº†O_DIRECTæ ‡å¿—ä½ï¼Œæ­¤æ—¶I/Oå°†ä½¿ç”¨è¿›ç¨‹ç”¨æˆ·æ€åœ°å€ç©ºé—´çš„ç¼“å†²åŒºï¼Œä¸€èˆ¬æ•°æ®åº“åº”ç”¨ä¼šä½¿ç”¨æ­¤æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å¯¹Page Cacheä¸­é¡µçš„è¯†åˆ«é€šè¿‡ç´¢å¼•èŠ‚ç‚¹å’Œåœ¨ç›¸åº”æ–‡ä»¶ä¸­çš„åç§»é‡æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»è¦æ•°æ®ç»“æ„&#34;&gt;ä¸»è¦æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;â€‹	Page Cacheä¸­çš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯&lt;code&gt;address_space&lt;/code&gt;ï¼Œè¯¥å¯¹è±¡åœ¨é¡µé¢æ‰€å±çš„inodeä¸­ï¼Œç”±äºå¤šä¸ªé¡µé¢å¯èƒ½å±äºåŒä¸€ä¸ªæ‰€æœ‰è€…ï¼Œå› æ­¤å¤šä¸ªé¡µé¢å¯èƒ½è¢«è¿æ¥åˆ°åŒä¸€ä¸ªaddress spaceï¼Œè¯¥å¯¹è±¡åŒæ—¶è¿˜å°†æ‰€æœ‰è€…çš„é¡µé¢å’Œå¯¹é¡µé¢çš„æ“ä½œå»ºç«‹è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…³é¡µé¢çš„æ“ä½œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;==writepage== å†™æ“ä½œï¼Œå°†é¡µå†™å…¥åˆ°ç¡¬ç›˜æ˜ åƒ&lt;/li&gt;
&lt;li&gt;==readpage== è¯»æ“ä½œï¼Œå°†æ•°æ®ä»ç¡¬ç›˜æ˜ åƒåŠ è½½åˆ°é¡µ&lt;/li&gt;
&lt;li&gt;sync_page åœ¨æ‰€æœ‰è€…çš„é¡µé¢å·²ç»å‡†å¤‡å°±ç»ªåï¼Œå¯åŠ¨I/Oæ•°æ®çš„ä¼ è¾“&lt;/li&gt;
&lt;li&gt;wirtepages æŠŠæŒ‡å®šæ•°é‡çš„æ‰€æœ‰è€…è„é¡µå†™å›ç¡¬ç›˜&lt;/li&gt;
&lt;li&gt;==prepare_write== ä¸ºå†™æ“ä½œåšå‡†å¤‡ï¼ˆç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;==commit_write== å®Œæˆå†™æ“ä½œï¼ˆç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæ•°æ ‘-radix-tree&#34;&gt;åŸºæ•°æ ‘ Radix Tree&lt;/h2&gt;
&lt;p&gt;åŸºæ•°æ ‘ç±»ä¼¼äºå­—å…¸æ ‘ï¼Œé€šè¿‡è¦æŸ¥æ‰¾çš„IDçš„äºŒè¿›åˆ¶åºåˆ—ï¼Œæ¥ä¸€çº§ä¸€çº§çš„è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸ºäº†å‡å°‘æ ‘çš„é«˜åº¦å’Œå¶å­éç»“ç‚¹ä¸ªæ ‘ï¼Œå¯ä»¥ä½¿ç”¨2 bitæˆ–è€…4 bitä½œä¸ºæ ‘çš„ç»“ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸ä¸­ï¼ŒRadix Treeçš„å¶å­ç»“ç‚¹ä¿å­˜äº†æŒ‡å‘æ‰€æœ‰è€…é¡µæè¿°ç¬¦çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;Page Cache ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€æ£µåŸºæ•°æ ‘ï¼ˆradix treeï¼Œæœ¬è´¨ä¸Šæ˜¯å¤šå‰æœç´¢æ ‘ï¼‰ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªé¡µã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸é€šè¿‡æŠŠé¡µç´¢å¼•è½¬æ¢ä¸ºRadix Treeä¸­çš„è·¯å¾„ï¼Œä½¿ç”¨Radix Treeæ¥å¿«é€Ÿæœç´¢é¡µæè¿°ç¬¦æ‰€åœ¨çš„ä½ç½®ã€‚å†…æ ¸é€šè¿‡é¡µæè¿°ç¬¦å¯ä»¥ç¡®å®šé¡µé¢æ˜¯å¦ä¸ºç­‰å¾…åˆ·æ–°åˆ°ç¡¬ç›˜çš„è„é¡µæˆ–å…¶ä¸­æ•°æ®çš„I/Oä¼ è¾“æ˜¯å¦æ­£åœ¨è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Radix Treeä¸­çš„æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹æŒ‡å‘æ–‡ä»¶å†…ç›¸åº”åç§»æ‰€å¯¹åº”çš„Cacheé¡¹&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221101143123364.png&#34; alt=&#34;image-20221101143123364&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h2 id=&#34;page-cacheå¤„ç†å‡½æ•°&#34;&gt;Page Cacheå¤„ç†å‡½æ•°&lt;/h2&gt;
&lt;h3 id=&#34;find_get_page&#34;&gt;find_get_page()&lt;/h3&gt;
&lt;p&gt;ä¼ å…¥ address spaceå¯¹è±¡æŒ‡é’ˆå’Œä¾¿å®œäº†ï¼Œè·å–è‡ªæ—‹é”ï¼Œåœ¨Radix Treeä¸­æœç´¢å…·æœ‰æŒ‡å®šåç§»é‡çš„å¶å­ç»“ç‚¹ï¼Œè‹¥æˆåŠŸæ‰¾åˆ°ï¼Œä¼šå¢åŠ é¡µé¢ä½¿ç”¨è®¡æ•°å™¨ï¼Œé‡Šæ”¾è‡ªæ—‹é”ï¼Œå¹¶è¿”å›é¡µæè¿°ç¬¦çš„æŒ‡é’ˆï¼Œå¦åˆ™å°†é‡Šæ”¾è‡ªæ—‹é”å¹¶è¿”å›NULLã€‚&lt;/p&gt;
&lt;h3 id=&#34;add_to_page_cache&#34;&gt;add_to_page_cache()&lt;/h3&gt;
&lt;p&gt;ä¼ å…¥é¡µæè¿°ç¬¦åœ°å€ï¼Œaddress spaceå¯¹è±¡çš„address mappingå­—æ®µï¼Œé¡µç´¢å¼•åœ¨åœ°å€ç©ºé—´çš„åç§»é‡ï¼Œä¸ºRadix Treeåˆ†é…æ–°èŠ‚ç‚¹æ‰€ä½¿ç”¨çš„å†…å­˜åˆ†é…æ ‡å¿—gfp_maskï¼Œæ’å…¥æˆåŠŸåˆ™è¿”å›0&lt;/p&gt;
&lt;h3 id=&#34;remove_from_page_cache&#34;&gt;remove_from_page_cache()&lt;/h3&gt;
&lt;p&gt;è·å–è‡ªæ—‹é”ã€å…³é—­ä¸­æ–­ååœ¨Radix Treeä¸­åˆ é™¤èŠ‚ç‚¹ï¼Œè¿”å›åˆ é™¤é¡µçš„æè¿°ç¬¦æŒ‡é’ˆï¼Œpage-&amp;gt;mappingå­—æ®µè®¾ç½®ä¸ºNULLï¼Œå°†æ‰€ç¼“å­˜é¡µçš„page-&amp;gt;mapping-&amp;gt;nrpagesè®¡æ•°å™¨å€¼å‡1ï¼Œæœ€åé‡Šæ”¾è‡ªæ—‹é”ï¼Œæ‰“å¼€ä¸­æ–­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;read_cache_page&#34;&gt;read_cache_page()&lt;/h3&gt;
&lt;p&gt;ç¡®ä¿Page Cacheä¸­åŒ…æ‹¬æŒ‡å®šé¡µçš„æœ€æ–°ç‰ˆæœ¬ï¼Œé¦–å…ˆæ£€æŸ¥é¡µé¢æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ–°ç”³è¯·åˆ†é…ç©ºé—´ï¼Œè°ƒç”¨add_to_page_cacheæ’å…¥ç›¸åº”çš„é¡µæè¿°ç¬¦ï¼Œè°ƒç”¨lru cache addæ’å…¥åˆ°è¯¥åœ°å€ç©ºé—´çš„éæ´»è·ƒLRUé“¾è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¿è¯é¡µé¢å­˜åœ¨äºPage Cacheåï¼Œä½¿ç”¨mark page accessedè®°å½•é¡µé¢å·²ç»è¢«è®¿é—®è¿‡ï¼Œè‹¥PG_uptodateæ ‡å¿—ä½0ï¼Œåˆ™é¡µé¢ä¸æ˜¯æœ€æ–°çš„ï¼Œéœ€è¦ä»ç¡¬ç›˜é‡æ–°è¯»å–è¯¥é¡µ&lt;/p&gt;
&lt;h2 id=&#34;buffer-cache&#34;&gt;Buffer Cache&lt;/h2&gt;
&lt;p&gt;åœ¨Linuxå†…æ ¸2.4ç‰ˆæœ¬ä¹‹å‰ï¼ŒBuffer Cacheå’ŒPage Cacheæ˜¯ç‹¬ç«‹çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå¯¹ç¡¬ç›˜ç­‰å—è®¾å¤‡çš„è¯»å†™æ˜¯åŸºäºå—çš„ï¼Œè€Œéé¡µï¼Œæ–‡ä»¶çš„æ•°æ®åœ¨Page Cacheä¸­ç¼“å­˜ï¼Œç¡¬ç›˜çš„å—æ•°æ®åœ¨Buffer Cacheä¸­ç¼“å­˜ã€‚ä½†æ˜¯è¿™ç§è¡¨ç¤ºæ–¹å¼æ•ˆç‡éå¸¸ä½ï¼Œè‡ª2.4ç‰ˆæœ¬çš„å†…æ ¸å¼€å§‹ï¼ŒäºŒè€…å¼€å§‹ç»Ÿä¸€è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºVFSå’Œæ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯é€šè¿‡å—Blockæ¥ç»„ç»‡ç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œå› æ­¤Buffer Cacheå¿…é¡»å­˜åœ¨ï¼Œç›®å‰å®ƒä½œä¸ºBuffer Pageå­˜å‚¨åœ¨ç‰¹å®šçš„é¡µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ–‡ä»¶è¿™ç§é€šè¿‡Page Cacheæ¥è¡¨ç¤ºçš„æ•°æ®ï¼Œé€šè¿‡Page Cacheæ¥è¡¨ç¤ºBuffer Cacheï¼Œè€Œå¯¹äºæ–‡ä»¶çš„metadataï¼Œç›´æ¥ä½¿ç”¨Buffer Cacheæ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;è„é¡µçš„å¤„ç†&#34;&gt;è„é¡µçš„å¤„ç†&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›ç¨‹ä¿®æ”¹äº†é¡µé¢æ•°æ®åï¼Œè¯¥é¡µé¢å°±æˆä¸ºäº†è„é¡µï¼Œå¹¶å°†è„é¡µåˆ·æ–°åˆ°å—è®¾å¤‡ä¸Šçš„æ“ä½œå»¶è¿Ÿï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢ç¡¬ä»¶é”™è¯¯ã€æ‰ç”µç­‰æƒ…å†µå¯¼è‡´RAMå†…å®¹çš„ä¸¢å¤±ï¼Œä»¥åŠRAMå®¹é‡è¿‡å¤§çš„éœ€æ±‚ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸»åŠ¨åˆ·æ–°è„é¡µåˆ°ç¡¬ç›˜ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Page Cacheå¤ªæ»¡ï¼Œæˆ–è„é¡µæ•°é‡å¤ªå¤š&lt;/li&gt;
&lt;li&gt;è„é¡µå·²ç»å­˜åœ¨äº†è¾ƒé•¿çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹è¯·æ±‚å¯¹å—è®¾å¤‡æˆ–æ–‡ä»¶çš„å˜åŒ–è¿›è¡Œåˆ·æ–°ï¼ˆsyncã€fsyncå’Œfdatasyncç³»ç»Ÿè°ƒç”¨ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ–‡ä»¶çš„è®¿é—®&#34;&gt;æ–‡ä»¶çš„è®¿é—®&lt;/h1&gt;
&lt;p&gt;æ–‡ä»¶çš„è®¿é—®ä¸€èˆ¬æœ‰äº”ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;==è§„èŒƒæ¨¡å¼==ï¼šç”±ç³»ç»Ÿè°ƒç”¨readå’Œwriteæ¥è¯»å†™ï¼Œreadå°†é˜»å¡è°ƒç”¨è¿›ç¨‹ï¼Œç›´åˆ°æ•°æ®è¢«æ‹·è´åˆ°ç”¨æˆ·åœ°å€ç©ºé—´ï¼Œwriteåˆ™åœ¨æ•°æ®æ‹·è´åˆ°Page Cacheåç«‹å³ç»“æŸ&lt;/li&gt;
&lt;li&gt;==åŒæ­¥æ¨¡å¼==ï¼š&lt;code&gt;O_SYNC&lt;/code&gt;æ ‡å¿—ä¸º1ï¼Œå½±å“å†™æ“ä½œï¼ˆè¯»æ“ä½œæ€»æ˜¯é˜»å¡çš„ï¼‰ï¼Œå°†é˜»å¡å†™æ“ä½œï¼Œç›´åˆ°æ•°æ®è¢«æœ‰æ•ˆçš„å†™å…¥ç¡¬ç›˜ã€‚&lt;/li&gt;
&lt;li&gt;==å†…å­˜æ˜ å°„æ¨¡å¼==ï¼šæ–‡ä»¶æ‰“å¼€åï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨&lt;code&gt;mmap&lt;/code&gt;å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œæ­¤åæ–‡ä»¶æˆä¸ºå®Œå…¨ä¿å­˜åœ¨RAMä¸­çš„å­—èŠ‚æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;==ç›´æ¥I/Oæ¨¡å¼==ï¼šO_DIRECTæ ‡å¿—ä¸º1ï¼Œä»»ä½•è¯»å†™æ“ä½œéƒ½åœ¨ç”¨æˆ·åœ°å€ç©ºé—´å’Œç¡¬ç›˜é—´è¿›è¡Œä¼ è¾“ï¼Œç›´æ¥è·³è¿‡Page Cacheã€‚&lt;/li&gt;
&lt;li&gt;==å¼‚æ­¥æ¨¡å¼==ï¼šè¯¥æ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶å¯ä»¥é€šè¿‡ä¸€ç»„POSIX APIæˆ–è€…Linuxç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œè®¿é—®ï¼Œå¼‚æ­¥æ¨¡å¼ä¸‹æ•°æ®ä¼ è¾“è¯·æ±‚ä¸é˜»å¡è°ƒç”¨çš„è¿›ç¨‹ï¼Œè€Œæ˜¯åœ¨åå°æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¯»æ–‡ä»¶&#34;&gt;è¯»æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;å†…æ ¸å®ç°äº†&lt;code&gt;read()&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨ä¸ºè¿›ç¨‹æä¾›æ–‡ä»¶çš„è¯»å–åŠŸèƒ½ï¼Œå…¥å£ä¸º&lt;code&gt;sys_read()&lt;/code&gt;éœ€è¦æä¾›ä¸‰ä¸ªå‚æ•°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;ä¿å­˜æ•°æ®çš„ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;è¯»å–å­—ç¬¦æ•°ç›®çš„é•¿åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºVFSè€Œè¨€ï¼Œé¦–å…ˆæ ¹æ®æ–‡ä»¶æè¿°ç¬¦ç¼–å·ï¼Œå†…æ ¸(ä½¿ç”¨&lt;code&gt;fs/file_table.c&lt;/code&gt;ä¸­çš„&lt;code&gt;fget_light()&lt;/code&gt;å‡½æ•°)ä»è¿›ç¨‹çš„ &lt;code&gt;task_struct&lt;/code&gt;ä¸­æ‰¾åˆ°ä¸ä¹‹ç›¸å…³çš„æ–‡ä»¶å®ä¾‹ï¼Œ&lt;code&gt;file_pos_read()&lt;/code&gt;å‡½æ•°ç¡®å®šè¯»å–å½“å‰æ–‡ä»¶çš„ä½ç½®ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‚æ•°&lt;code&gt;file-&amp;gt;file_pos&lt;/code&gt;ï¼Œå®é™…çš„è¯»å–æ“ä½œé€šè¿‡&lt;code&gt;vfs_read()&lt;/code&gt;å‡½æ•°æ¥æ‰§è¡Œï¼Œè¯¥å‡½æ•°ä¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰&lt;code&gt;file-&amp;gt;f_op-&amp;gt;read&lt;/code&gt;æ–¹æ³•ï¼Œä»è€Œç¡®å®šåç»­ä½¿ç”¨çš„å‡½æ•°ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¼šè°ƒç”¨&lt;code&gt;do_sync_read&lt;/code&gt;å‡½æ•°ã€‚æœ€åé€šè¿‡&lt;code&gt;file_pos_write&lt;/code&gt;å‡½æ•°æ¥è®°å½•æ–‡ä»¶æ–°çš„è¯»å†™ä½ç½®ï¼Œé€šè¿‡ä¿®æ”¹&lt;code&gt;file_ops&lt;/code&gt;çš„å€¼æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221022151840698.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221022151840698&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æé«˜åœ¨æ–‡ä»¶è¯»å–æ—¶çš„æ€§èƒ½ï¼ŒLinux kernelæä¾›äº†ç¼“å†²åŒºå’Œç¼“å†²ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;Linuxå¯¹æ–‡ä»¶çš„è¯»æ˜¯åŸºäºé¡µçš„ï¼Œå†…æ ¸æ€»æ˜¯ä¸€æ¬¡ä¼ é€å‡ ä¸ªå®Œæ•´çš„æ•°æ®é¡µã€‚è‹¥å‘èµ·readè°ƒç”¨æ—¶æ•°æ®ä¸åœ¨RAMä¸­ï¼Œå†…æ ¸åˆ™åˆ†é…ä¸€ä¸ªæ–°çš„page frameï¼Œå¹¶è°ƒå–æ–‡ä»¶çš„ç›¸åº”éƒ¨åˆ†å¡«å…¥å…¶ä¸­ï¼Œå°†å…¶åŠ å…¥åˆ°Page Cacheä¸­ï¼Œæœ€åæŠŠè¯·æ±‚çš„æ•°æ®æ‹·è´åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°ç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨é€šç”¨å‡½æ•°generic_file_readæ¥å®ç°readç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;generic_file_read&#34;&gt;generic_file_read()&lt;/h3&gt;
&lt;p&gt;è¯¥å‡½æ•°æœ‰å¦‚ä¸‹å‡ ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;filp æ–‡ä»¶å¯¹è±¡çš„åœ°å€&lt;/li&gt;
&lt;li&gt;buf ç”¨æˆ·æ€å†…å­˜åŒºåŸŸçš„çº¿æ€§åœ°å€ï¼Œç”¨äºå­˜æ”¾è¯»å–å‡ºçš„æ–‡ä»¶æ•°æ®&lt;/li&gt;
&lt;li&gt;count è¯»å–å­—ç¬¦çš„ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;ppos å­˜æ”¾è¯»æ“ä½œå¼€å§‹å¤„çš„æ–‡ä»¶åç§»é‡ï¼Œä¸€èˆ¬ä¸º&lt;code&gt;filp-&amp;gt;f_pos&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆï¼Œå‡½æ•°åˆå§‹åŒ–ä¸¤ä¸ªæè¿°ç¬¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å±€éƒ¨å˜é‡iovecç±»å‹çš„local_iovï¼ŒåŒ…å«bufå’Œcountå­—æ®µ&lt;/li&gt;
&lt;li&gt;å±€éƒ¨å˜é‡kiocbç±»å‹çš„kiocbï¼Œè·Ÿè¸ªæ­£åœ¨è¿›è¡Œçš„åŒæ­¥å’Œå¼‚æ­¥I/Oæ“ä½œçš„å®ŒæˆçŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åè°ƒç”¨&lt;code&gt;__generic_file_aio_read()&lt;/code&gt;è·å–ä¸Šé¢ä¸¤ä¸ªæè¿°ç¬¦çš„åœ°å€ï¼Œè¿”å›å€¼æ—¶æ–‡ä»¶æœ‰æ•ˆè¯»å…¥çš„å­—èŠ‚æ•°ï¼Œåœ¨è¯¥å‡½æ•°è¿”å›åï¼Œ&lt;code&gt;generic_file_read()&lt;/code&gt;ä¹Ÿå°†ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;__generic_file_aio_read&#34;&gt;__generic_file_aio_read()&lt;/h3&gt;
&lt;p&gt;æ¥æ”¶å››ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kiocbæè¿°ç¬¦åœ°å€ï¼šiocb&lt;/li&gt;
&lt;li&gt;iovecæè¿°ç¬¦æ•°ç»„çš„åœ°å€ï¼šiovï¼ˆæè¿°ç­‰å¾…æ¥æ”¶æ•°æ®çš„ç”¨æˆ·æ€ç¼“å†²åŒºï¼‰&lt;/li&gt;
&lt;li&gt;iovecæè¿°ç¬¦æ•°ç»„çš„é•¿åº¦&lt;/li&gt;
&lt;li&gt;å­˜æ”¾æ–‡ä»¶å½“å‰æŒ‡é’ˆçš„å˜é‡åœ°å€ï¼šppos&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¥å‡½æ•°åœ¨å¯¹Page Cachè§¦å‘readæ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨access_ok()æ¥æ£€æŸ¥iovecæè¿°çš„ç”¨æˆ·æ€ç¼“å†²åŒºæ˜¯å¦åˆæ³•&lt;/li&gt;
&lt;li&gt;å»ºç«‹è¯»æ“ä½œæè¿°ç¬¦ï¼Œå­˜æ”¾ä¸ç”¨æˆ·ç¼“å†²åŒºæœ‰å…³çš„ã€æ­£åœ¨è¿›è¡Œçš„æ–‡ä»¶æ“ä½œçš„çŠ¶æ€&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;do_generic_file_read()&lt;/code&gt;ï¼Œç»™å®šå‚æ•°æ–‡ä»¶å¯¹è±¡æŒ‡é’ˆfilpï¼Œæ–‡ä»¶åç§»é‡æŒ‡é’ˆpposï¼Œè¯»æ“ä½œæè¿°ç¬¦åœ°å€ã€å‡½æ•°file_read_actor()çš„åœ°å€&lt;/li&gt;
&lt;li&gt;è¿”å›æ‹·è´åˆ°ç”¨æˆ·æ€ç¼“å†²åŒºçš„å­—èŠ‚æ•°ï¼Œå¯¹åº”è¯»æ“ä½œæè¿°ç¬¦çš„writtenå­—æ®µ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;do_generic_file_read()&lt;/p&gt;
&lt;h2 id=&#34;å†™æµç¨‹&#34;&gt;å†™æµç¨‹&lt;/h2&gt;
&lt;p&gt;â€‹	å¾ˆå¤šç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿé€šè¿‡é€šç”¨å‡½æ•°generic_file_writeå®ç°writeæ–¹æ³•ã€‚writeç³»ç»Ÿè°ƒç”¨è´Ÿè´£å°†ç”¨æˆ·åœ°å€ç©ºé—´ä¸­çš„æ•°æ®ç§»åŠ¨åˆ°å†…æ ¸æ•°æ®ç»“æ„ä¸­ï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°Page Cacheä¸­ï¼Œå°†è¿™äº›é¡µæ ‡è®°ä¸ºè„ï¼Œç„¶åæŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	writeç³»ç»Ÿè°ƒç”¨çš„ç»“æ„ä¸readåŒæ ·ç®€å•ã€‚é™¤äº†ç”¨f_op-&amp;gt;writeå’Œdo_sync_writeæ›¿æ¢äº†readä¸­å¯¹åº”çš„ä¾‹ç¨‹ä¹‹å¤–ï¼ŒäºŒè€…çš„ä»£ç æµç¨‹å›¾å‡ ä¹å®Œå…¨ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;â€‹	ä»å½¢å¼ä¸Šçœ‹æ¥ï¼Œsys_writeä¸sys_readçš„å‚æ•°ç›¸åŒ:ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€ä¸€ä¸ªæŒ‡é’ˆå˜é‡ã€ä¸€ä¸ªé•¿åº¦æŒ‡ç¤º(è¡¨ç¤ºä¸ºæ•´æ•°)ã€‚æ˜¾ç„¶ï¼Œå…¶è¯­ä¹‰ç¨æœ‰ä¸åŒã€‚æŒ‡é’ˆå¹¶éæŒ‡å‘å­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºï¼Œè€Œæ˜¯æŒ‡å‘éœ€è¦ å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚é•¿åº¦å‚æ•°æŒ‡å®šäº†æ•°æ®çš„å­—èŠ‚é•¿åº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¢„å–æœºåˆ¶&#34;&gt;é¢„å–æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;â€‹	å¾ˆå¤šç¡¬ç›˜çš„è®¿é—®éƒ½æ˜¯é¡ºåºçš„ã€‚æ™®é€šæ–‡ä»¶ä»¥ç›¸é‚»æ‰‡åŒºæˆç»„å­˜æ”¾åœ¨ç¡¬ç›˜ä¸Šï¼Œå› æ­¤å¾ˆå°‘ç§»åŠ¨ç£å¤´å°±å¯ä»¥å¿«é€Ÿæ£€ç´¢åˆ°æ–‡ä»¶ã€‚å½“ç¨‹åºè¯»æˆ–æ‹·è´ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå®ƒé€šå¸¸ä»ç¬¬ä¸€ä¸ªå­—èŠ‚åˆ°æœ€åä¸€ä¸ªå­—èŠ‚é¡ºåºåœ°è®¿é—®æ–‡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†è¿›ç¨‹å¯¹åŒä¸€æ–‡ä»¶çš„ä¸€ç³»åˆ—è¯»è¯·æ±‚æ—¶ï¼Œå¯ä»¥ä»ç¡¬ç›˜ä¸Šå¾ˆå¤šç›¸é‚»çš„æ‰‡åŒºè¯»å–ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	é¢„è¯»(Read-ahead)æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œè¿™ç§æŠ€æœ¯åœ¨äºåœ¨å®é™…è¯·æ±‚å‰è¯»æ™®é€šæ–‡ä»¶æˆ–å—è®¾å¤‡æ–‡ä»¶çš„å‡ ä¸ªç›¸é‚»çš„æ•°æ®é¡µã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé¢„è¯»èƒ½æå¤§åœ°æé«˜ç¡¬ç›˜çš„æ€§èƒ½ï¼Œå› ä¸ºé¢„è¯»ä½¿ç¡¬ç›˜æ§åˆ¶å™¨å¤„ç†è¾ƒå°‘çš„å‘½ä»¤ï¼Œå…¶ä¸­çš„æ¯æ¡å‘½ä»¤éƒ½æ¶‰åŠä¸€å¤§ç»„ç›¸é‚»çš„æ‰‡åŒºã€‚æ­¤å¤–ï¼Œé¢„è¯»è¿˜èƒ½æé«˜ç³»ç»Ÿçš„æ™Œåº”èƒ½åŠ›ã€‚é¡ºåºè¯»å–æ–‡ä»¶çš„è¿›ç¨‹é€šå¸¸ä¸éœ€è¦ç­‰å¾…è¯·æ±‚çš„æ•°æ®ï¼Œå› ä¸ºè¯·æ±‚çš„æ•°æ®å·²ç»åœ¨RAMä¸­äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼“å­˜å›å†™æœºåˆ¶&#34;&gt;ç¼“å­˜å›å†™æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;ç¼“å­˜å›å†™æœºåˆ¶ä¹Ÿå°±æ˜¯Page Cacheå¯¹è„é¡µè¿›è¡Œå›å†™ï¼Œå°†å¯¹æ–‡ä»¶çš„I/Oä¿®æ”¹æ°¸ä¹…æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šçš„è¿‡ç¨‹ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚åç»­è®¡åˆ’æ·±å…¥äº†è§£Linuxå†…æ ¸å¯¹å›å†™çš„æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ–‡ä»¶ç³»ç»Ÿ&#34;&gt;æ–‡ä»¶ç³»ç»Ÿ&lt;/h1&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿä½œä¸ºæ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼Œè´Ÿè´£åœ¨å­˜å‚¨è®¾å¤‡ä¸Šç®¡ç†ã€å­˜å‚¨ã€è·å–æ•°æ®ã€ç»´æŠ¤ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Linuxä¸­ï¼Œå†…æ ¸é€šè¿‡VFSè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå‘ç”¨æˆ·æä¾›é€šç”¨çš„æ¥å£ï¼Œå‘ä¸‹å¯¹æ¥å„ç§ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥æœ‰æ•ˆé¿å…ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„å®ç°å·®å¼‚å¯¹ä¸Šå±‚å¸¦æ¥å½±å“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ext4&#34;&gt;ext4&lt;/h2&gt;
&lt;p&gt;æœ¬éƒ¨åˆ†å¤§é‡å†…å®¹æ¥è‡ªkernel.orgçš„æ–‡æ¡£&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.kernel.org/doc/html/latest/filesystems/ext4/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ext4 Data Structures and Algorithms â€” The Linux Kernel documentation&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ext-æ–‡ä»¶ç³»ç»Ÿå‘å±•å†å²&#34;&gt;ext æ–‡ä»¶ç³»ç»Ÿå‘å±•å†å²&lt;/h3&gt;
&lt;h4 id=&#34;ext1&#34;&gt;ext1&lt;/h4&gt;
&lt;p&gt;Extended file systemï¼Œæ‰©å±•æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;Linuxæœ€æ—©ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¸ºMinixçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯è¯¥ç³»ç»Ÿå­˜åœ¨æ–‡ä»¶å¤§å°é™åˆ¶çš„é—®é¢˜ï¼ŒåŒæ—¶æ€§èƒ½ä¸ä½³ã€‚åœ¨1992å¹´4æœˆï¼ŒRÃ©my Cardå¼€å‘äº†æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼Œé¦–ä¸ªç‰ˆæœ¬ä½œä¸ºLinuxä¸­çš„æ–‡ä»¶ç³»ç»Ÿä¸€èµ·å‘è¡Œï¼Œæœ€å¤§æ”¯æŒ2GBç©ºé—´ï¼ŒåŒæ—¶å®ƒè¿˜æ˜¯Linuxä¸­ç¬¬ä¸€ä¸ªä½¿ç”¨VFSå®ç°å‡ºçš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h4 id=&#34;ext2&#34;&gt;ext2&lt;/h4&gt;
&lt;p&gt;åœ¨é¦–ä¸ªextæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶è®¿é—®ã€å­˜åœ¨inodeä¿®æ”¹ä»¥åŠæ–‡ä»¶å†…å®¹ä¿®æ”¹æ²¡æœ‰ä½¿ç”¨ç‹¬ç«‹æ—¶é—´æˆ³çš„é—®é¢˜ï¼ŒåŒæ—¶æœ€å¤§ä»…æ”¯æŒ255ä¸ªå­—ç¬¦çš„æ–‡ä»¶åä»¥åŠ2GBçš„ç©ºé—´ï¼Œext2ç³»ç»Ÿé™¤äº†ä¿®å¤äº†è¿™ä¸ªé—®é¢˜å¤–ï¼Œè¿˜åœ¨ç¡¬ç›˜å­˜å‚¨æ•°æ®ç»“æ„ä¸­é¢„ç•™äº†å¾ˆå¤šç©ºé—´ä¾›æœªæ¥å¼€å‘ä½¿ç”¨ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‹“å±•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå—é©±åŠ¨çš„é™åˆ¶ï¼Œext2æ–‡ä»¶ç³»ç»Ÿæœ€å¤§æ”¯æŒ2TBçš„å•ä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ext3&#34;&gt;ext3&lt;/h4&gt;
&lt;p&gt;ext3åœ¨å½“æ—¶æ€§èƒ½ä¸æ˜¯å¾ˆå‡ºä¼—ï¼Œä½†æ˜¯æ”¯æŒä»å½“æ—¶æœ€æµè¡Œçš„ext2æ–‡ä»¶ç³»ç»Ÿå‡çº§ï¼Œæ— éœ€å¤‡ä»½å’Œæ•°æ®æ¢å¤ï¼ŒåŒæ—¶æœ‰è¾ƒå°‘çš„èµ„æºå ç”¨ï¼ˆCPUå¼€é”€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ext3ç›¸è¾ƒäºext2å¢åŠ äº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¥å¿—æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ç³»ç»Ÿåœ¨çº¿å¢é•¿&lt;/li&gt;
&lt;li&gt;å¯¹å¤§ç›®å½•æä¾›HTreeå“ˆå¸Œæ ‘ç´¢å¼•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ext3æä¾›äº†ä¸‰ä¸ªæ—¥å¿—çº§åˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ—¥å¿—ï¼ˆæœ€ä½é£é™©ï¼‰ï¼šmetadataå’Œæ–‡ä»¶å†…å®¹ä¸€èµ·å†™å…¥æ—¥å¿—ä¸­ï¼Œç”±äºè¿˜è¦å†™å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰åºï¼ˆä¸­ç­‰é£é™©ï¼‰ï¼šåªå°†metadataå†™å…¥æ—¥å¿—ï¼Œä½†æ˜¯ä¿è¯metadataæäº¤å‰ï¼Œæ–‡ä»¶å†…å®¹ä¼šè¢«å†™å…¥ã€‚å¤§éƒ¨ä»½å‘è¡Œç‰ˆé»˜è®¤çš„æ–¹å¼ã€‚å†™å…¥è¿‡ç¨‹ä¸­å´©æºƒæ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šæ¸…é™¤è¿˜æ²¡æœ‰è¢«æäº¤çš„æ–‡ä»¶ä¿®æ”¹/åˆ›å»ºï¼Œä½†æ˜¯å¯¹äºæ–‡ä»¶çš„è¦†ç›–å†™å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶å¤„äºæ–°æ—§æ–‡ä»¶çš„ä¸­é—´æ€ã€‚&lt;/li&gt;
&lt;li&gt;å›å†™ï¼ˆæœ€é«˜é£é™©ï¼‰ï¼šåªè®°å½•metadataåˆ°æ—¥å¿—ï¼Œæ–‡ä»¶å†…å®¹åœ¨æ—¥å¿—æäº¤å‰æˆ–è€…æäº¤åå†™å…¥ã€‚å¦‚æœåœ¨æ—¥å¿—æäº¤å‰å†™å…¥å¤±è´¥ï¼Œä¼šå¯¼è‡´ç¡¬ç›˜å‡ºç°åƒåœ¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ext3å­˜åœ¨çš„ä¸€äº›ç¼ºé™·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰åœ¨çº¿çš„ç¢ç‰‡æ•´ç†å·¥å…·&lt;/li&gt;
&lt;li&gt;å®˜æ–¹ç¼ºå°‘å‹ç¼©å·¥å…·&lt;/li&gt;
&lt;li&gt;ä¸æ”¯æŒæ¢å¤å·²ç»åˆ é™¤çš„æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ç¼ºå°‘å¿«ç…§æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æ—¥å¿—ä¸­ä¸æ”¯æŒæ ¡éªŒå’Œ&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å››ä¸ªå­—èŠ‚å­˜å‚¨Unixæ—¶é—´ï¼Œå› æ­¤åœ¨2038å¹´1æœˆ18æ—¥ä¹‹åå°†æ— æ³•ç»§ç»­å¤„ç†æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ext4-1&#34;&gt;ext4&lt;/h4&gt;
&lt;p&gt;ext4åœ¨Linux 2.6.28ä¸­ä½œä¸ºåŠŸèƒ½å®Œæ•´ç¨³å®šçš„æ–‡ä»¶ç³»ç»Ÿå‘å¸ƒï¼Œext4æ–‡ä»¶ç³»ç»Ÿé¦–å…ˆå…¼å®¹äº†åŸæœ‰çš„ext3ç³»ç»Ÿï¼Œæä¾›å®‰å…¨å¯é çš„å¿«é€Ÿè¿ç§»ã€‚åŒæ—¶è¿˜æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶å¤§å°&lt;/p&gt;
&lt;p&gt;ä»¥4KBå—ï¼Œç›®å‰æ”¯æŒæœ€å¤§&lt;code&gt;1EiB(1024*1024*1024GB)&lt;/code&gt;çš„æ–‡ä»¶ç³»ç»Ÿå¤§å°å’Œ16TiBçš„æ–‡ä»¶å¤§å°ï¼Œä½¿ç”¨48bitæ¥ç¼–å€ï¼Œæœªæ¥ä¼šæ”¯æŒ64bit&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­ç›®å½•å¯æ‰©å±•æ€§&lt;/p&gt;
&lt;p&gt;ext4æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæœ€å¤š64000ä¸ªå­ç›®å½•ï¼Œæ˜¯ext3æ–‡ä»¶ç³»ç»Ÿçš„ä¸¤å€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰©å±•æ•°æ®å—&lt;/p&gt;
&lt;p&gt;é¼“åŠ±å¯¹å¤§æ–‡ä»¶åˆ’åˆ†å¤šä¸ªè¿ç»­æ•°æ®å—ï¼Œåœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œè¿ç»­å¸ƒå±€ï¼Œä»è€Œå‡å°‘ç»´æŠ¤å¤§é‡çš„é—´æ¥æ˜ å°„ï¼Œæœ‰åŠ©äºæé«˜æ€§èƒ½ï¼Œå‡å°‘ç¡¬ç›˜ç¢ç‰‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤šå—åŒæ—¶åˆ†é…ï¼Œ&lt;/p&gt;
&lt;p&gt;åœ¨ext3æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿåœ¨åˆ†é…ç©ºé—²å—æ—¶ï¼Œåªèƒ½ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå—ç”³è¯·ï¼Œext4æ”¯æŒå¤šå—åˆ†é…æœºåˆ¶ï¼Œå¯ä»¥ä¸€æ¬¡ç”³è¯·å¤šä¸ªå—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å—çš„å»¶æ—¶åˆ†é…&lt;/p&gt;
&lt;p&gt;å€Ÿé‰´äº†XFSã€ZFSã€btrfsç­‰ç°ä»£æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨æ‰§è¡Œå†™å…¥è¿‡ç¨‹æ—¶ï¼Œåœ¨ä»¥å¾€çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œéƒ½æ˜¯å¯¹å†™å…¥åˆ°cacheçš„æ•°æ®ç«‹å³åˆ†é…ç›¸åº”çš„blockï¼Œæ¶ˆè€—äº†å¤§é‡çš„æ—¶é—´ï¼Œå»¶æ—¶åˆ†é…åï¼Œåªæœ‰å½“æ•°æ®éœ€è¦è¢«åˆ·æ–°åˆ°ç¡¬ç›˜æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå—çš„åˆ†é…ï¼Œå¯ä»¥å’Œä¸Šé¢ä¸¤ä¸ªfeatè¿›è¡Œé…åˆï¼Œæé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¿«é€Ÿfsck&lt;/p&gt;
&lt;p&gt;fsckæ˜¯æå…¶è€—æ—¶çš„è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯éœ€è¦æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰çš„inodeã€‚ext4ä¸­ï¼Œåœ¨æ¯ä¸ªgroup&amp;rsquo;s inode tableä¸­éƒ½ä¿å­˜äº†ä¸€ä¸ªç©ºé—²inodeé“¾è¡¨ï¼ˆåŒæ—¶ä¿å­˜äº†checksumï¼‰ï¼Œå› æ­¤fsckå°±ä¸å¿…å†æ£€æŸ¥è¿™äº›inode&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¥å¿—æ ¡éªŒå’Œ&lt;/p&gt;
&lt;p&gt;æ—¥å¿—åœ¨ç¡¬ç›˜ä¸­æ˜¯å¾ˆå®¹æ˜“å‡ºé”™çš„éƒ¨åˆ†ï¼Œæ·»åŠ æ ¡éªŒå’Œå¯ä»¥é¿å…æ–‡ä»¶ç³»ç»Ÿæ¢å¤é”™è¯¯çš„æ—¥å¿—å¸¦æ¥æ›´å¤§çš„æŸå¤±ã€‚ä½¿ç”¨æ ¡éªŒå’Œè¿˜ä½¿å¾—åœ¨ext3ä¸­æ—¥å¿—çš„ä¸¤æ­¥æäº¤ç®€åŒ–ä¸ºä¸€æ­¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ— æ—¥å¿—æ¨¡å¼&lt;/p&gt;
&lt;p&gt;ext4ä¸­å¯ä»¥å…³é—­æ—¥å¿—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨çº¿ç¢ç‰‡æ•´ç†&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨e4defragå·¥å…·æ‰‹åŠ¨è¿›è¡Œç¢ç‰‡æ•´ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;inodeç›¸å…³feat&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ›´å¤§çš„inode&lt;/p&gt;
&lt;p&gt;ä»128bytesæé«˜åˆ°256bytes&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;inodeé¢„ç•™&lt;/p&gt;
&lt;p&gt;åˆ›å»ºç›®å½•æ—¶é¢„ç•™ä¸€äº›inodeæé«˜æ€§èƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çº³ç§’çº§æ—¶é—´æˆ³&lt;/p&gt;
&lt;p&gt;æé«˜ç³»ç»Ÿçš„time resolution&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡¬ç›˜ç©ºé—´é¢„åˆ†é…&lt;/p&gt;
&lt;p&gt;åº”ç”¨å¯ä»¥è®©æ–‡ä»¶ç³»ç»Ÿé¢„å…ˆåˆ†é…ä¸€éƒ¨åˆ†ç¡¬ç›˜ä¸Šçš„ç©ºé—´ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šæå‰åˆ›å»ºå¥½ç›¸å…³çš„æ•°æ®ç»“æ„å¹¶åˆ†é…ç›¸åº”çš„å—ï¼Œåç»­å¯ä»¥ç›´æ¥å†™å…¥æ•°æ®ï¼Œç±»ä¼¼P2Pä¸‹è½½æ—¶é¢„åˆ†é…ï¼Œ1.å¯ä»¥é˜²æ­¢ç±»ä¼¼åŠŸèƒ½çš„ä½æ•ˆç‡åº”ç”¨çº§å®ç°ï¼›2.å‡å°‘ç¡¬ç›˜ç¢ç‰‡ï¼›3.å¯¹äºå®æ—¶åº”ç”¨æ¥è¯´ï¼ˆå»¶è¿Ÿæ•æ„Ÿï¼Œèˆªç©ºå·¥ä¸šç­‰ï¼‰ï¼Œè¿™ä¸ªç‰¹ç‚¹æ”¹å–„äº†å»¶è¿Ÿã€‚æ­¤featé€šè¿‡&lt;code&gt;libc posix_fallocate()&lt;/code&gt;å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤å¯ç”¨å†™å±éšœ&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ¶ˆè€—ä¸€äº›æ€§èƒ½æ¥æ”¹å–„æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§ï¼Œå®ƒç¡®ä¿æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®åœ¨ç¡¬ç›˜ä¸Šè¢«æ­£ç¡®åœ°å†™å…¥å’Œæ’åºï¼Œå³ä½¿åœ¨æ‰ç”µæ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯¹äºä¸€äº›åˆ›å»ºå¤§é‡å°æ–‡ä»¶æˆ–è€…æ“ä½œå…ƒæ•°æ®çš„ç¨‹åºï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½å½±å“ã€‚å¦‚æœç¡¬ç›˜æ˜¯ç”µæ± ä¾›ç”µï¼Œé€šè¿‡&lt;code&gt;barrier=0&lt;/code&gt;å¯ä»¥å…³é—­å†™å±éšœï¼ˆä¼šä¿è¯å®‰å…¨æ€§ï¼‰ã€‚å†™å±éšœä¿æŠ¤ä¿è¯åœ¨æ•°æ®å†™å…¥&lt;code&gt;ç¼“å­˜ï¼ˆç¡¬ç›˜ç¼“å­˜ï¼‰&lt;/code&gt;åï¼Œå…ˆå†™å…¥æ—¥å¿—ä¸­çš„å…ƒæ•°æ®åˆ·æ–°åˆ°ç¡¬ç›˜ï¼Œé˜²æ­¢å‡ºç°å› ä¸ºè°ƒåº¦ç­–ç•¥å¯¼è‡´çš„æ•°æ®å…ˆäºæ—¥å¿—å†™å…¥ç¡¬ç›˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;discard/TRIM&lt;/p&gt;
&lt;p&gt;ä¸ºSSDæä¾›çš„TRIMæ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºSSDè€Œè¨€ï¼Œç”±äºæ–‡ä»¶ç³»ç»Ÿåœ¨åˆ é™¤æ—¶åªå¯¹å—æ ‡è®°ä¸ºç©ºé—²ï¼Œè€ŒSSDå´å¹¶ä¸çŸ¥é“å“ªäº›æ•°æ®å—å¯ç”¨ï¼Œå†æ¬¡å†™å…¥æ—¶ä¼šå…ˆæ¸…é™¤é—ªå­˜ä¸­çš„æ•°æ®ï¼Œå†è¿›è¡Œå†™å…¥ï¼Œè¦æ“¦é™¤æ— æ•ˆé¡µï¼Œè¦å…ˆç§»èµ°æœ‰æ•ˆé¡µï¼Œç„¶åå†å¯¹ä¸€æ•´è¡Œè¿›è¡Œæ“¦é™¤ï¼Œæœ€åæ‰èƒ½æ‰§è¡Œå†™å…¥è¿‡ç¨‹ï¼Œè¿™ä¸ªç°è±¡ä¹Ÿè¢«ç§°ä¸º&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Write_amplification&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å†™å…¥æ”¾å¤§(Write Amplification)&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;TRIMä¸»è¦ä½¿å¾—æ–‡ä»¶ç³»ç»Ÿå‘ŠçŸ¥SSDå“ªäº›é¡µä¸å†åŒ…å«æœ‰æ•ˆçš„æ•°æ®ï¼Œæœ‰åŠ©äºæé«˜SSDçš„å¯¿å‘½å’Œç£¨æŸå‡è¡¡&lt;/p&gt;
&lt;p&gt;éšç€ä½¿ç”¨çš„blockæ•°é‡æ¥è¿‘SSDçš„å®¹é‡ä¸Šé™ï¼Œä¼šå¯¼è‡´SSDçš„æ€§èƒ½ä¸‹é™ï¼Œæ–‡ä»¶ç³»ç»Ÿé€šè¿‡discardæŒ‡ä»¤å‘ŠçŸ¥SSDå“ªäº›èŒƒå›´å†…çš„blockå·²ç»ä¸å†ä½¿ç”¨ï¼ŒSSDå¯ä»¥å°†å…¶å›æ”¶æˆ–è€…ç”¨æ¥å®ç°ç£¨æŸå‡è¡¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ•°æ®ç»„ç»‡&#34;&gt;æ•°æ®ç»„ç»‡&lt;/h3&gt;
&lt;p&gt;ext4æ–‡ä»¶ç³»ç»Ÿå°†éƒ¨åˆ†blockç»„ç»‡ä¸ºä¸€ä¸ªgroupï¼Œé»˜è®¤blockå¤§å°é‡‡ç”¨4KBï¼Œå› æ­¤ä¸€ä¸ªgroupä¸­çš„blockæ•°é‡ä¸º&lt;code&gt;8*block_size_in_bytes=32768 blocks&lt;/code&gt;ï¼Œç©ºé—´ä¸º128MBã€‚&lt;/p&gt;
&lt;p&gt;ext4éƒ¨åˆ†åœ¨ç¡¬ç›˜ä¸­æŒ‰å°ç«¯å†™å…¥ï¼Œjdb2æ—¥å¿—éƒ¨åˆ†åœ¨ç¡¬ç›˜ä¸­æŒ‰å¤§ç«¯å†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ext4åœ¨åˆ†é…ç¡¬ç›˜ç©ºé—´æ—¶åªèƒ½åˆ†é…è‹¥å¹²ä¸ªblockï¼Œä¸€ä¸ªblockåŒ…å«ç¡¬ç›˜ä¸Šçš„è‹¥å¹²ä¸ªæ‰‡åŒºï¼Œæ‰‡åŒºçš„æ•°é‡å¿…é¡»æ˜¯2çš„å¹‚æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä½¿ç”¨æ‰©å±•å¸ƒå±€çš„æ–‡ä»¶ï¼ˆé€šè¿‡blockæ˜ å°„ç»´æŠ¤ï¼‰å¿…é¡»å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿå‰$2^{32}$ä¸ªblockä¸­ï¼Œé€šè¿‡æ‰©å±•å¸ƒå±€æ¥ä¿å­˜çš„æ–‡ä»¶ï¼Œå¿…é¡»å­˜æ”¾åœ¨å‰$2^{48}$ä¸ªblockä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº32ä½å’Œ64ä½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå„ä¸ªæ•°æ®ç»“æ„çš„å¤§å°é™åˆ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221115165058013.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221115165058013&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221115165128885.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221115165128885&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªBlock Groupä¸­ï¼Œæ•°æ®çš„ç»„ç»‡å¦‚è¡¨æ ¼æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Group 0 Padding&lt;/th&gt;
&lt;th&gt;ext4 Super Block&lt;/th&gt;
&lt;th&gt;Group Descriptors&lt;/th&gt;
&lt;th&gt;Reserved GDT Blocks&lt;/th&gt;
&lt;th&gt;Data Block Bitmap&lt;/th&gt;
&lt;th&gt;inode Bitmap&lt;/th&gt;
&lt;th&gt;inode Table&lt;/th&gt;
&lt;th&gt;Data Blocks&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1024 bytes&lt;/td&gt;
&lt;td&gt;1 block&lt;/td&gt;
&lt;td&gt;many blocks&lt;/td&gt;
&lt;td&gt;many blocks&lt;/td&gt;
&lt;td&gt;1 block&lt;/td&gt;
&lt;td&gt;1 block&lt;/td&gt;
&lt;td&gt;many blocks&lt;/td&gt;
&lt;td&gt;many more blocks&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç¡¬ç›˜ä¸­ä¼šé¢„ç•™1024 bytesï¼Œç”¨äºæ“ä½œç³»ç»Ÿçš„å¼•å¯¼æ¨¡å—å®‰è£…ï¼Œè¯¥paddingåˆ†åŒºåªæœ‰group 0å«æœ‰ï¼Œä¸ºäº†é¿å…supper blockæŸåå¯¼è‡´æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸å¯ç”¨ï¼Œåœ¨å…¶ä»–block groupä¸­è¿˜ä¼šæœ‰å¤‡ä»½ï¼Œå¦‚æœä¸€ä¸ªblock groupä¸å«æœ‰å†—ä½™å¤‡ä»½ï¼Œé‚£ä¹ˆå®ƒå°†ä»¥data block bitmapå¼€å¤´ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ‰§è¡Œmkfsæ—¶ï¼Œè¿˜ä¼šåœ¨group descriptoræè¿°ç¬¦åˆ†åŒºå’Œdata block bitmapåˆ†åŒºä¹‹é—´åˆ†é…ä¸€ä¸ªä¿ç•™çš„GDT blocksåˆ†åŒºï¼Œç”¨äºæ–‡ä»¶ç³»ç»Ÿæ—¥åçš„æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;ext4æ–‡ä»¶ç³»ç»Ÿä¸­è¿˜å¼•å…¥äº†Flexible Block Groupsçš„æ¦‚å¿µ(flex_bg)ï¼Œä¸»è¦æ€æƒ³æ˜¯å°†è‹¥å¹²ä¸ªblock groupç»„åˆæˆä¸€ä¸ªå¤§çš„Groupï¼Œå°†æ‰€æœ‰block groupä¸­çš„å…ƒæ•°æ®ï¼ˆinodeï¼Œbitmapï¼‰éƒ½é›†ä¸­åˆ°ç¬¬ä¸€ä¸ªblock groupä¸­ï¼Œæé«˜å¯¹å…ƒæ•°æ®åŠ è½½å’ŒæŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¹¶ä¸”ä½¿å¾—æ–‡ä»¶æ•°æ®åœ¨ç¡¬ç›˜ä¸Šè¿ç»­ï¼Œæ›´ç´§å‡‘ã€‚ä¸€èˆ¬é€šè¿‡&lt;code&gt;2^sb.s_log_groups_per_flex&lt;/code&gt;ä¸ªblock groupæ¥ç»„æˆä¸€ä¸ªå¤§çš„Groupã€‚&lt;/p&gt;
&lt;p&gt;è‡ªext3èµ·ï¼Œextæ–‡ä»¶ç³»ç»Ÿå°±å¼€å§‹ä½¿ç”¨Meta block groups(META_BG)ï¼Œæ˜¯ä¸€ç»„åªç”¨ä¸€ä¸ªgroup descriptoræ¥æè¿°çš„block groupsï¼Œé¦–ä¸ªblock groupä¸å†å­˜å‚¨æ¯ä¸ªblock groupçš„æè¿°ç¬¦ï¼Œè½¬ç”±meta block groupæ¥å­˜å‚¨ï¼Œå¹¶ä¸”ä¼šåœ¨å…¶ä¸­å­˜å‚¨å‡ ä¸ªå†—ä½™å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºext4æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æµç¨‹è®¡åˆ’åœ¨æ­¤åå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« è¿›è¡Œæ€»ç»“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;f2fs&#34;&gt;F2FS&lt;/h2&gt;
&lt;p&gt;F2FSæ–‡ä»¶ç³»ç»Ÿæå‡ºäº&lt;code&gt;USENIX FAST&#39;15&lt;/code&gt;ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast15/technical-sessions/presentation/lee&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;F2FS: A New File System for Flash Storage | USENIX&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…¨ç§°ä¸ºFlash-Friendly File Systemï¼ŒåŸºäºæ—¥å¿—ç»“æ„æ–‡ä»¶ç³»ç»Ÿ(Log-structured File System, LFS)ï¼Œé’ˆå¯¹LFSä¸­wandering treeå’Œgcå¼€é”€å¤§çš„é—®é¢˜è¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»è¦ç‰¹ç‚¹&#34;&gt;ä¸»è¦ç‰¹ç‚¹&lt;/h3&gt;
&lt;p&gt;é’ˆå¯¹é—ªå­˜è¿›è¡Œäº†ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;==æ‰©å¤§éšæœºå†™å…¥åŒºåŸŸæ¥æé«˜æ€§èƒ½==ï¼ˆæ­¤å¤„å­˜åœ¨ç–‘é—®ï¼‰ï¼Œä½†å¸¦æ¥äº†ç©ºé—´å±€éƒ¨æ€§&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½ä½¿å¾—æ–‡ä»¶ç³»ç»Ÿçš„å¤„ç†å•å…ƒä¸FTLä¸­ä¿æŒä¸€è‡´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é’ˆå¯¹wandering treeé—®é¢˜ï¼Œè¯¥é—®é¢˜æ˜¯å› ä¸ºLFSçš„è„æ•°æ®é€šè¿‡è¿½åŠ æ›´æ–°ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®å—å˜æˆè„æ•°æ®ï¼Œé‚£ä¹ˆå…¶ç´¢å¼•å—ï¼Œä»¥åŠé—´æ¥ç´¢å¼•å—éƒ½ä¼šå˜æˆè„å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨nodeæ¥ä»£æ›¿inodeå’ŒæŒ‡é’ˆå—&lt;/li&gt;
&lt;li&gt;é€šè¿‡åŒ…å«æ‰€æœ‰nodeå—åœ°å€çš„Node Address Table(NAT)æ¥åˆ‡æ–­æ›´æ–°é€’å½’çš„ä¼ æ’­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åƒåœ¾å›æ”¶é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒåå°æ¸…ç†&lt;/li&gt;
&lt;li&gt;æ”¯æŒè´ªå¿ƒå’Œcost-benefitç®—æ³•&lt;/li&gt;
&lt;li&gt;ä¸ºåŠ¨æ€/é™æ€å†·çƒ­æ•°æ®åˆ†ç¦»æä¾›multi-head logs&lt;/li&gt;
&lt;li&gt;å¼•å…¥è‡ªé€‚åº”æ—¥å¿—æ¥å®ç°é«˜æ•ˆçš„å—åˆ†é…&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;btrfs&#34;&gt;Btrfs&lt;/h2&gt;
&lt;p&gt;Btrfsæ˜¯ä¸€ä¸ªå†™æ—¶å¤åˆ¶çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŸºäºB-treeå®ç°ï¼Œä¸“æ³¨äºå®¹é”™ï¼Œä¿®å¤å’Œæ˜“äºç®¡ç†ï¼Œå‘å¸ƒäº2014å¹´ï¼Œå‘å±•ç›®æ ‡æ˜¯ä¸ºäº†å–ä»£ext3æ–‡ä»¶ç³»ç»Ÿï¼Œè§£å†³ext3çš„é™åˆ¶ã€‚åœ¨2021å¹´ï¼ŒFedora 33å®£å¸ƒå°†ä½¿ç”¨Btrfsä½œä¸ºå®‰è£…æ—¶é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚è€ŒFedoraå—åˆ°redhatçš„ç›´æ¥èµåŠ©ï¼Œè¯´æ˜Btrfsåœ¨ä¸æ–­å‘å±•çš„è¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°äº†ç¤¾åŒºä¸­éƒ¨åˆ†ç”¨æˆ·ä»¥åŠä¼ä¸šçš„è®¤å¯ï¼Œç›®å‰è¿˜å¤„åœ¨æµ‹è¯•å’Œä¸æ–­å®Œå–„çš„é˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦ç‰¹ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºB-Treeç»´æŠ¤å…ƒæ•°æ®ï¼Œæ’å…¥æŸ¥è¯¢æ“ä½œé«˜æ•ˆ&lt;/li&gt;
&lt;li&gt;åŸºäºCOWï¼Œæé«˜ç¡¬ç›˜å¯¿å‘½&lt;/li&gt;
&lt;li&gt;æ”¯æŒåªè¯»/å¯è¯»å¿«ç…§&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å—ioå±‚-ä¸-ioè°ƒåº¦å™¨&#34;&gt;å—I/Oå±‚ ä¸ I/Oè°ƒåº¦å™¨&lt;/h1&gt;
&lt;h2 id=&#34;å—è®¾å¤‡&#34;&gt;å—è®¾å¤‡&lt;/h2&gt;
&lt;p&gt;å¯¹äºUnixç³»ç»Ÿæ¥è¯´ï¼Œæœ‰ç€ä¸€åˆ‡çš†æ–‡ä»¶çš„è®¾è®¡å“²å­¦ï¼Œå› æ­¤å¤–éƒ¨è®¾å¤‡åœ¨æ“ä½œç³»ç»Ÿçœ‹æ¥æ˜¯ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ã€‚è®¾å¤‡æ–‡ä»¶å…±åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å—è®¾å¤‡ï¼šæ•°æ®å¯ä»¥è¢«éšæœºè®¿é—®&lt;/li&gt;
&lt;li&gt;å­—ç¬¦è®¾å¤‡ï¼šæ•°æ®ä¸å¯ä»¥è¢«éšæœºè®¿é—®ï¼Œæˆ–è€…åŒ…å«å—é™åˆ¶çš„éšæœºè®¿é—®ï¼ˆè®¾å¤‡å†…éƒ¨æ„æˆï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å—è®¾å¤‡çš„ä¸€ä¸ªä¸»è¦ç‰¹ç‚¹å°±æ˜¯CPUå’Œæ€»çº¿è¯»å†™æ•°æ®çš„æ—¶é—´å¼€é”€ä¸ç¡¬ç›˜ç¡¬ä»¶é€Ÿåº¦ä¸åŒ¹é…ã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸å†å¯¹å—è®¾å¤‡å‘å‡ºI/Oè¯·æ±‚æ—¶ï¼Œå†…æ ¸åˆ©ç”¨&lt;code&gt;é€šç”¨å—å±‚&lt;/code&gt;å‘èµ·I/Oï¼Œæ¯æ¬¡I/Oè¯·æ±‚éƒ½æ˜¯é€šè¿‡ä¸€ä¸ª&lt;code&gt;bio&lt;/code&gt;ç»“æ„ä½“æ¥æè¿°ã€‚é€šç”¨å—å±‚ä¸‹çš„I/Oè°ƒåº¦ç¨‹åºä¼šæ ¹æ®ç­–ç•¥å°†å¾…å¤„ç†çš„I/Oè¯·æ±‚è¿›è¡Œå½’ç±»ï¼Œå°†ç›¸é‚»çš„è¯·æ±‚èšé›†åœ¨ä¸€èµ·ï¼Œå‡å°‘ç¡¬ç›˜ç£å¤´çš„ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å—æ˜¯æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶è®¾å¤‡åœ¨ä¼ è¾“æ•°æ®æ—¶çš„åŸºæœ¬å•ä½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»mq-deadlineï¼Œkyberï¼Œbfqä¸‰ä¸ªå¤šé˜Ÿåˆ—è®¾è®¡çš„è°ƒåº¦å™¨&lt;/p&gt;
&lt;h2 id=&#34;mq-deadline&#34;&gt;mq-deadline&lt;/h2&gt;
&lt;p&gt;mq-deadlineè°ƒåº¦å™¨ä¸»è¦æ ¹æ®deadlineè°ƒåº¦å™¨æ¥è®¾è®¡ï¼Œæ˜¯deadlineè°ƒåº¦å™¨çš„å¤šé˜Ÿåˆ—ç‰ˆæœ¬ï¼Œé€‚é…äº†blockå±‚çš„å¤šé˜Ÿåˆ—&lt;/p&gt;
&lt;p&gt;mq-deadlineè°ƒåº¦å™¨å°†IOåˆ†ä¸ºreadå’Œwriteä¸¤ç§ç±»å‹ï¼Œå¯¹äºè¿™æ¯ç§ç±»å‹çš„IOæœ‰ä¸€æ£µçº¢é»‘æ ‘å’Œä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œçº¢é»‘æ ‘ç”¨äºå°†I/OæŒ‰ç…§å…¶è®¿é—®çš„LBAæ’åˆ—æ–¹ä¾¿æŸ¥æ‰¾åˆå¹¶ï¼ŒFIFOé˜Ÿåˆ—åˆ™è®°å½•äº†I/Oè¿›å…¥mq-deadlineè°ƒåº¦å™¨çš„é¡ºåºï¼Œä»¥æä¾›è¶…æ—¶æœŸé™çš„ä¿éšœ&lt;/p&gt;
&lt;p&gt;readè¯·æ±‚çš„I/Oå¯ä»¥æŠ¢å writeçš„åˆ†å‘æœºä¼šï¼Œä½†ä¸èƒ½ä¸€ç›´å æœ‰ï¼Œç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°ä¿è¯readè¯·æ±‚ä¸ä¼šå¯¼è‡´writeè¯·æ±‚é¥¥é¥¿&lt;/p&gt;
&lt;p&gt;mq-deadlineè°ƒåº¦å™¨ä¼šä¼˜å…ˆå»æ‰¹é‡å¼åœ°åˆ†å‘I/Oè€Œä¸å»ç®¡I/Oçš„åˆ°æœŸæ—¶é—´ï¼Œå½“æ‰¹é‡åˆ†å‘åˆ°ä¸€å®šçš„ä¸ªæ•°å†å…³å¿ƒåˆ°æœŸæ—¶é—´ï¼Œç„¶åå»åˆ†å‘å³å°†åˆ°æœŸçš„I/O&lt;/p&gt;
&lt;p&gt;æœ€åmq-deadlineé’ˆå¯¹syncç©¿é€æ€§I/Oè¿™ç§éœ€è¦å°½å¿«å‘é€åˆ°è®¾å¤‡çš„I/Oè®¾ç½®å¦å¤–ä¸€ä¸ªdispatché˜Ÿåˆ—ï¼Œç„¶åæ¯æ¬¡æ´¾å‘çš„æ—¶å€™éƒ½ä¼˜å…ˆæ´¾å‘dispatché˜Ÿåˆ—ä¸Šçš„I/O&lt;/p&gt;
&lt;h2 id=&#34;bfq&#34;&gt;bfq&lt;/h2&gt;
&lt;p&gt;å…¨ç§°ä¸ºBudget Fair Queueingï¼Œbfqæ˜¯ä¸€ç§æ¯”ä¾‹å…±äº«çš„I/Oè°ƒåº¦å™¨ï¼Œæœ‰ä¸€äº›ä½å»¶è¿Ÿèƒ½åŠ›ã€‚æ”¯æŒcgroupã€‚&lt;/p&gt;
&lt;p&gt;BFQçš„ä¸»è¦ç‰¹ç‚¹æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BFQä¿è¯äº†ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å“åº”èƒ½åŠ›ï¼Œä»¥åŠå¯¹æ—¶é—´æ•æ„Ÿç¨‹åºä¿è¯ä½å»¶è¿Ÿï¼ˆéŸ³è§†é¢‘æ’­æ”¾ï¼‰&lt;/li&gt;
&lt;li&gt;BFQåœ¨è¿›ç¨‹æˆ–è€…ç»„ä¹‹é—´åˆ†é…å¸¦å®½ã€æ—¶é—´ï¼Œåœ¨ä¿æŒååé‡æ—¶è¿›è¡Œæ—¶é—´åˆ†é…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒBFQä¼˜å…ˆè€ƒè™‘å»¶è¿Ÿè€Œéååé‡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®&lt;code&gt;low_latency=0&lt;/code&gt;æ¥å…³é—­ä½å»¶è¿Ÿå¯å‘å¼ç®—æ³•ï¼Œæ¥æé«˜è®¾å¤‡ååé‡ã€‚BFQé€šè¿‡é”æ¥ä¿æŠ¤æ¯ä¸ªI/Oè¯·æ±‚ï¼Œä¼šå¢åŠ ä¸€äº›é¢å¤–å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;BFQæ˜¯ä¸€ç§æ¯”ä¾‹ä»½é¢è°ƒåº¦å™¨ï¼Œä¸»è¦éƒ¨åˆ†å€Ÿé‰´äº†CFQï¼Œæ˜¯ä¸€ç§å…¬å¹³çš„è°ƒåº¦å™¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªåœ¨è®¾å¤‡ä¸Šæ‰§è¡ŒI/Oçš„è¿›ç¨‹éƒ½ä¸ä¸€ä¸ªæƒé‡å’Œä¸€ä¸ªbfq é˜Ÿåˆ—ç›¸å…³è”&lt;/li&gt;
&lt;li&gt;BFQæˆæƒä¸€ä¸ªé˜Ÿåˆ—ï¼ˆè¿›ç¨‹ï¼‰å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…å¯¹è®¾å¤‡çš„ç‹¬å è®¿é—®ï¼Œå¹¶é€šè¿‡å°†æ¯ä¸ªé˜Ÿåˆ—ä¸é¢„ç®—ï¼ˆè¯·æ±‚æ‰‡åŒºæ•°é‡ï¼‰ç›¸å…³è”æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé˜Ÿåˆ—è·å¾—è®¾å¤‡è®¿é—®æˆæƒåï¼Œé˜Ÿåˆ—çš„é¢„ç®—ä¼šåœ¨æ¯æ¬¡è¯·æ±‚å‘é€æ—¶æ ¹æ®è¯·æ±‚å¤§å°é€’å‡&lt;/li&gt;
&lt;li&gt;å½“å‘ç”Ÿï¼šé˜Ÿåˆ—å®Œæˆå…¶é¢„ç®—ã€é˜Ÿåˆ—æ¸…ç©ºã€è§¦å‘é¢„ç®—è¶…æ—¶æ—¶ï¼Œé˜Ÿåˆ—æ‰ä¼šè¿‡æœŸï¼Œé¢„ç®—è¶…æ—¶æœºåˆ¶å¯ä»¥é˜²æ­¢éšæœºI/Oè¿›ç¨‹å¯¹è®¾å¤‡é•¿æ—¶é—´çš„å ç”¨é™ä½ååé‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kyber&#34;&gt;kyber&lt;/h2&gt;
&lt;p&gt;Kyber I/Oè°ƒåº¦å™¨æ˜¯Linuxä¸Šé¢é’ˆå¯¹é«˜é€Ÿå­˜å‚¨è®¾å¤‡ï¼ˆNVMeé—ªå­˜ï¼‰è®¾è®¡çš„ä¸€ä¸ªæ–°çš„I/Oè°ƒåº¦å™¨ï¼Œé…å’Œå¤šé˜Ÿåˆ—çš„Blockå±‚ä½¿ç”¨ã€‚åœ¨Linux 4.12çš„æ—¶å€™å’ŒBFQè°ƒåº¦å™¨ä¸€èµ·æˆä¸ºå†…æ ¸ä¸­çš„ä¸€ä¸ªå¯é€‰é¡¹&lt;/p&gt;
&lt;p&gt;Kyberè°ƒåº¦å™¨çš„åŸºæœ¬æ€è·¯æ˜¯ä¼šä¸ºæ¯ä¸€ä¸ªçš„ç¡¬ä»¶çš„é˜Ÿåˆ—ç»´æŠ¤ä¸€ä¸ªä¸åŒç±»å‹I/Oè¯·æ±‚çš„é˜Ÿåˆ—ï¼Œè¿™äº›è¯·æ±‚ä¸»è¦æ ¹æ®I/Oæ“ä½œçš„æ–¹å¼æ¥è¿›è¡ŒåŒºåˆ†ã€‚KyberæŒ‰ç…§è¯»ã€åŒæ­¥å†™ä»¥åŠå…¶å®ƒçš„(å¼‚æ­¥å†™ç­‰)å°†I/Oè¯·æ±‚åˆ†ä¸ºäº†3ç±»ã€‚åœ¨Kyberçš„è®¾è®¡ä¸­ï¼Œæ›´åŠ å€¾å‘äºè®©è¯»ä¼˜å…ˆï¼Œè¿™ä¸ªç­–ç•¥ä¹Ÿå’Œå…¶å®ƒçš„ä¸€äº›è°ƒåº¦å™¨çš„è®¾è®¡ç±»ä¼¼&lt;/p&gt;
&lt;p&gt;Kyberåœ¨ä¸€ä¸ªKyberä¸Šä¸‹æ–‡ä¸­ç»´æŠ¤äº†å…³äºè¿™å‡ ç±»è¯·æ±‚çš„é˜Ÿåˆ—ã€‚å®ƒé€šè¿‡é™åˆ¶æ¯ä¸€ä¸ªé˜Ÿåˆ—çš„é•¿åº¦æ¥å¯¹åœ¨è¿™é‡Œäº§ç”Ÿçš„è¯·æ±‚çš„å»¶è¿Ÿè¿›è¡Œæ§åˆ¶ã€‚Kyberåªæœ‰åœ¨è¿™äº›é˜Ÿåˆ—é‡Œé¢çš„è¯·æ±‚è¢«å¤„ç†äº†ä¹‹åæ‰ä¼šæ”¶é›†æ–°çš„è¯·æ±‚ã€‚è¿™é‡Œé™åˆ¶çš„æ–¹å¼é‡‡ç”¨äº†åŸºäºTokençš„æ–¹å¼&lt;/p&gt;
&lt;p&gt;ç”±äºKyberé¢å‘çš„æ˜¯é«˜é€Ÿå­˜å‚¨ï¼Œè¿™ç±»è®¾å¤‡ä¸€èˆ¬æ˜¯NVMe SSDã€NVMã€‚é‡‡ç”¨ç±»ä¼¼CFQä¸­çš„ä¸€äº›å¯¹è¯·æ±‚æ’åºçš„æ–¹æ³•å¯èƒ½æœ‰æŸäºæ€§èƒ½ï¼Œæ‰€ä»¥åœ¨Kyberä¸­æ²¡æœ‰å¯¹è¯·æ±‚æ’åºçš„é€»è¾‘ã€‚Kyberä¼šå¯¹ä¸€äº›I/Oè¯·æ±‚è¿›è¡Œåˆå¹¶æ“ä½œï¼Œä»¥åŠä¼šå°è¯•æ‰¹é‡å¤„ç†è¿™äº›è¯·æ±‚æ¥æé«˜æ€§èƒ½ã€‚æ‰¹é‡å¤„ç†çš„å¤§å°æ ¹æ®è¯·æ±‚ç±»å‹æ¥å†³å®š&lt;/p&gt;
&lt;h1 id=&#34;nvmeæ¥å£åè®®&#34;&gt;NVMeæ¥å£åè®®&lt;/h1&gt;
&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;NVMeåè®®çš„äº§ç”Ÿæ˜¯ä¸ºäº†å–ä»£å›ºæ€ç¡¬ç›˜åŸæœ‰çš„AHCIåè®®+SATAæ¥å£ï¼Œéšç€å›ºæ€ç¡¬ç›˜æŠ€æœ¯çš„å‘å±•ï¼Œä½¿å¾—æ€§èƒ½ç“¶é¢ˆä»å­˜å‚¨è®¾å¤‡ä¸Šçš„è½¬ç§»åˆ°äº†åè®®å’Œæ¥å£ä¸­ï¼Œäºæ˜¯å›ºæ€ç¡¬ç›˜çš„å‡ å¤§ç”Ÿäº§å•†ä¸€èµ·åˆ¶å®šäº†è¯¥åè®®ã€‚&lt;/p&gt;
&lt;p&gt;NVMeå®é™…ä¸Šæ˜¯éæ˜“å¤±æ€§å­˜å‚¨å™¨æ ‡å‡†ï¼Œä¸é™äºé—ªå­˜SSDï¼Œä½¿ç”¨PCIeæ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”äºAHCIåè®®ï¼ŒNVMeçš„ä¸»è¦ç‰¹ç‚¹ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½æ—¶å»¶ï¼šå­˜å‚¨ä»‹è´¨æ–¹é¢ï¼Œå­˜å‚¨ä»‹è´¨å¾—åˆ°äº†å·¨å¤§æå‡ï¼›æ§åˆ¶å™¨æ–¹é¢ï¼ŒPCIeä¸»æ§ç›´æ¥ä¸CPUç›¸è¿ï¼ŒSATAæ¥å£éœ€è¦å—æ¡¥æ§åˆ¶å™¨ä¸­è½¬å†è¿æ¥CPUï¼›è½¯ä»¶æ¥å£æ–¹é¢ï¼Œç®€åŒ–äº†æŒ‡ä»¤è·¯å¾„ï¼Œæé«˜äº†å¹¶å‘èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;é«˜æ€§èƒ½ï¼šç›¸è¾ƒäºAHCIåšå‡ºäº†å¤§é‡ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;ä½åŠŸè€—ï¼šè‡ªåŠ¨åŠŸè€—çŠ¶æ€åˆ‡æ¢ï¼ŒåŠ¨æ€èƒ½è€—ç®¡ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;nvmeå·¥ä½œåŸç†&#34;&gt;NVMeå·¥ä½œåŸç†&lt;/h2&gt;
&lt;p&gt;NVMeä½œä¸ºé«˜å±‚æ¬¡çš„åè®®ï¼ŒåŸåˆ™ä¸Šå¯ä»¥ç”¨äºä»»ä½•æ¥å£ï¼Œä¸€èˆ¬ä½¿ç”¨PCIe&lt;/p&gt;
&lt;p&gt;NVMeåˆ¶å®šäº†ä¸»æœºå’ŒSSDä¹‹é—´çš„é€šä¿¡å‘½ä»¤ï¼ŒNVMeå…±æœ‰ä¸¤ç§å‘½ä»¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Adminå‘½ä»¤ï¼šç”¨äºä¸»æœºç®¡ç†ã€SSDæ§åˆ¶&lt;/li&gt;
&lt;li&gt;I/O å‘½ä»¤ï¼šç”¨äºä¸»æœºå’ŒSSDä¹‹é—´çš„æ•°æ®ä¼ è¾“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adminå‘½ä»¤é›†æœ‰ï¼š&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105160942779.png&#34; alt=&#34;image-20221105160942779&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;NVM I/OæŒ‡ä»¤é›†æœ‰ï¼š&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105161030669.png&#34; alt=&#34;image-20221105161030669&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h3 id=&#34;ä»ä¸»æœºioè¯·æ±‚åˆ°ssd&#34;&gt;ä»ä¸»æœºI/Oè¯·æ±‚åˆ°SSD&lt;/h3&gt;
&lt;p&gt;NVMeæœ‰ä¸‰ä¸ªé‡è¦çš„æœºåˆ¶ï¼ŒSubmission Queueã€Completion Queueã€Doorbell Registerã€‚&lt;/p&gt;
&lt;p&gt;SQå’ŒCQä½äºä¸»æœºçš„å†…å­˜ä¸­ï¼ŒDBä½äºSSDæ§åˆ¶å™¨å†…éƒ¨ï¼Œä¸‹å›¾ç›´è§‚çš„å±•ç¤ºäº†ä»–ä»¬ä¹‹é—´çš„ä½ç½®å…³ç³»ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105161458148.png&#34; alt=&#34;image-20221105161458148&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;åœ¨ä¸»æœºå‘èµ·I/OæŒ‡ä»¤æ—¶ï¼Œç°å°†æŒ‡ä»¤æ”¾åœ¨SQä¸­ï¼Œä¸»æœºä¼šé€šè¿‡ä¿®æ”¹DBå¯„å­˜å™¨æ¥é€šçŸ¥SSDä»SQä¸­å–å‡ºéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚CQè®°å½•äº†æŒ‡ä»¤æ‰§è¡Œçš„çŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰ï¼ŒSSDè´Ÿè´£å‘CQä¸­å†™å…¥å‘½ä»¤çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;NVMeå¯¹æŒ‡ä»¤çš„å¤„ç†æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105162016851.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221105162016851&#34;
	
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»æœºå†™è¯·æ±‚åˆ°SQ&lt;/li&gt;
&lt;li&gt;ä¸»æœºå†™SQå°¾DBå¯„å­˜å™¨ï¼Œé€šçŸ¥SSDéœ€è¦æ‰§è¡ŒI/Oè¯·æ±‚&lt;/li&gt;
&lt;li&gt;SSDæ§åˆ¶å™¨å–å‡ºSQä¸­çš„è¯·æ±‚&lt;/li&gt;
&lt;li&gt;SSDæ§åˆ¶å™¨æ‰§è¡Œå‘½ä»¤&lt;/li&gt;
&lt;li&gt;SSDæ§åˆ¶å™¨å°†è¯·æ±‚çš„çŠ¶æ€å†™å…¥CQ&lt;/li&gt;
&lt;li&gt;SSDæ§åˆ¶å™¨å‘å‡ºMSI-Xä¸­æ–­ï¼Œé€šçŸ¥ä¸»æœºæŒ‡ä»¤å®Œæˆ&lt;/li&gt;
&lt;li&gt;ä¸»æœºæ”¶åˆ°ä¸­æ–­åï¼Œå¤„ç†CQï¼Œçœ‹æŸ¥è¯·æ±‚çš„å®ŒæˆçŠ¶æ€&lt;/li&gt;
&lt;li&gt;ä¸»æœºå†™å…¥CQå¤´DBå¯„å­˜å™¨ï¼Œå‘ŠçŸ¥SSDè¯¥æŒ‡ä»¤çš„ç»“æœå·²ç»æ”¶åˆ°å¹¶å¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;submission-queueå’Œcompletion-queueç®€ä»‹&#34;&gt;Submission Queueå’ŒCompletion Queueç®€ä»‹&lt;/h2&gt;
&lt;p&gt;ç”±äºNVMeçš„SQã€CQæœºåˆ¶ï¼Œè¿™ä¸¤ä¸ªæ•°æ®ç»“æ„å¿…ç„¶æ˜¯æˆå¯¹å­˜åœ¨çš„ï¼Œä¹Ÿå­˜åœ¨å¤šå¯¹ä¸€çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºI/OæŒ‡ä»¤å’ŒAdminæŒ‡ä»¤ï¼Œåˆ†åˆ«ç”±ä¸“æœ‰çš„SQå’ŒCQè¿›è¡Œç®¡ç†ï¼Œå³Admin SQ/CQå’ŒI/O SQ/CQã€‚&lt;/p&gt;
&lt;p&gt;I/O SQå’ŒSQæ˜¯é€šè¿‡Adminçš„ç›¸å…³æŒ‡ä»¤æ¥è¿›è¡Œåˆ›å»ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»æœºæ–¹é¢æ¯ä¸ªCPUæ ¸å¿ƒå¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªSQï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªCQã€‚ä¸€ä¸ªæ ¸å¿ƒåˆ›å»ºå¤šä¸ªSQä¸»è¦æ˜¯ä¸ºäº†æé«˜å¤šçº¿ç¨‹çš„å¹¶å‘èƒ½åŠ›ï¼ŒåŒæ—¶å¯ä»¥å¯¹ä¸åŒSQè®¾ç½®ä¼˜å…ˆçº§æ¥æé«˜æœåŠ¡è´¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105165937311.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221105165937311&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºAdmin SQ/CQé˜Ÿåˆ—ï¼Œæ·±åº¦åœ¨$2-4096(4K)$&lt;/p&gt;
&lt;p&gt;å¯¹äºI/O SQ/CQé˜Ÿåˆ—ï¼Œæ·±åº¦åœ¨$2-65536(64K)$ï¼Œä¸€ä¸ªSQå‘½ä»¤æ¡ç›®å¤§å°ä¸º$64Byte$ï¼Œä¸€ä¸ªCQæ¡ç›®å¤§å°ä¸º$16Byte$ï¼Œé˜Ÿåˆ—æ·±åº¦å¯ä»¥è‡ªè¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªPCIeæ¥å£ä¹Ÿæ”¯æŒå¤šä¸ªlaneã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªNVMeçš„å·¥ä½œæµç¨‹åƒæ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ä¸¤ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221105234231636.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221105234231636&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;db-doorbell-register&#34;&gt;DB: Doorbell Register&lt;/h2&gt;
&lt;p&gt;åœ¨SQå’ŒCQé˜Ÿåˆ—ä¸­éƒ½æœ‰Headå’ŒTailï¼Œå¹¶ä¸”åˆ†åˆ«æœ‰å¯¹åº”çš„Doorbellï¼Œå³Head DBå’ŒTail DBï¼ŒDBåœ¨SSDä¸€ç«¯ï¼Œè®°å½•SQå’ŒCQé˜Ÿåˆ—å¤´ã€å°¾çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºSSDè€Œè¨€ï¼Œè¦é¢‘ç¹ä»SQå¤´å–å‡ºæ•°æ®ï¼Œå¯ä»¥è½»æ¾çš„è·å–SQé˜Ÿå¤´çš„ä½ç½®ï¼Œæ‰€ä»¥SQ Head DBç”±SSDæ¥ç»´æŠ¤ï¼Œè€Œå¯¹äºSQçš„é˜Ÿå°¾å¯¹äºä¸»æœºè€Œè¨€æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå› ä¸ºè¦é¢‘ç¹çš„å‘é˜Ÿå°¾æ’å…¥æ•°æ®ï¼Œå› æ­¤SQ Tail DBç”±ä¸»æœºç»´æŠ¤ï¼ŒSSDæ ¹æ®SQçš„å¤´å°¾å¯ä»¥è·å–å½“å‰é˜Ÿåˆ—ä¸­&lt;code&gt;æœ‰å¤šå°‘è¯·æ±‚åœ¨ç­‰å¾…æ‰§è¡Œ&lt;/code&gt;ã€‚åŒç†ï¼ŒCQ Head DBç”±ä¸»æœºæ¥ç»´æŠ¤ï¼ŒCQ Tail DBç”±SSDæ¥ç»´æŠ¤ï¼ŒSSDæ ¹æ®CQé˜Ÿåˆ—çš„å¤´å°¾æ¥åˆ¤æ–­CQé˜Ÿåˆ—æ˜¯å¦è¿˜èƒ½æ¥å—æ–°çš„&lt;code&gt;è¯·æ±‚å®Œæˆä¿¡æ¯&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»Doorbellçš„åå­—æ¥çœ‹ï¼Œè¿˜æœ‰é€šçŸ¥çš„ä½œç”¨ï¼Œå½“Doorbell Registerçš„å€¼æ”¹å˜æ—¶ï¼ŒSSDå°±çŸ¥é“æœ‰æ–°çš„è¯·æ±‚éœ€è¦å¤„ç†ï¼›ä¸»æœºå°±çŸ¥é“æœ‰æ–°çš„è¯·æ±‚å·²ç»å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¯¹äºä¸»æœºæ¥è¯´ï¼ŒDBæ˜¯å¯ä»¥å†™ä¸å¯è¯»çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–æœ‰å…³nvmeçš„å†…å®¹&#34;&gt;å…¶ä»–æœ‰å…³NVMeçš„å†…å®¹&lt;/h2&gt;
&lt;p&gt;å¯»å€é—®é¢˜ï¼ˆPRPã€SGLï¼‰&lt;/p&gt;
&lt;p&gt;Namespace&lt;/p&gt;
&lt;p&gt;æ•°æ®ä¿æŠ¤é—®é¢˜&lt;/p&gt;
&lt;p&gt;åç»­æœ‰æ—¶é—´å†å¯¹è¿™äº›å†…å®¹è¿›è¡Œå­¦ä¹ &lt;/p&gt;
&lt;h1 id=&#34;åŸºäºé—ªå­˜çš„å›ºæ€ç›˜&#34;&gt;åŸºäºé—ªå­˜çš„å›ºæ€ç›˜&lt;/h1&gt;
&lt;p&gt;æ­¤å‰ä¸€ç¯‡åšå®¢æ•´ç†äº†æœ‰å…³é—ªå­˜å’Œå›ºæ€ç›˜çš„å†…å®¹ï¼Œä¸‹æ–‡ä¸ºè½¬è½½è¿‡æ¥çš„å†…å®¹&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.ipandai.club/p/%e5%ad%98%e5%82%a8%e6%8a%80%e6%9c%af%e5%9f%ba%e7%a1%80%e5%9b%ba%e6%80%81%e7%a1%ac%e7%9b%98/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Flash Memory &amp;amp;&amp;amp; å›ºæ€ç¡¬ç›˜&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦ç”±Flash Memory å’ŒFTLç»„æˆ&lt;/p&gt;
&lt;p&gt;Non-Volatile Memory æä¾›ä½å»¶è¿ŸæŒä¹…æ€§çš„å†…å­˜/å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšå†…å­˜&lt;/p&gt;
&lt;p&gt;æ ¹æ®å»¶è¿Ÿæ•°é‡çº§ï¼Œä¸€èˆ¬ç”¨PCMåšå†…å­˜ï¼ŒFlash Memoryåšå¤–å­˜&lt;/p&gt;
&lt;h2 id=&#34;flash-memory&#34;&gt;Flash Memory&lt;/h2&gt;
&lt;h3 id=&#34;é—ªå­˜åŸç†&#34;&gt;é—ªå­˜åŸç†&lt;/h3&gt;
&lt;h4 id=&#34;ç±»å‹&#34;&gt;ç±»å‹&lt;/h4&gt;
&lt;p&gt;NORé—ªå­˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨å¯†åº¦ä½&lt;/li&gt;
&lt;li&gt;å¯å­—èŠ‚æ”¹å†™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NANDé—ªå­˜ï¼ˆä¸»æµï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨å¯†åº¦é«˜&lt;/li&gt;
&lt;li&gt;ä¸å¯è¦†ç›–å†™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨äºå¤–å­˜éœ€è¦è¾ƒé«˜çš„å­˜å‚¨é‡çº§ï¼Œä¸€èˆ¬ç”¨NAND&lt;/p&gt;
&lt;h4 id=&#34;é—ªå­˜å•å…ƒ&#34;&gt;é—ªå­˜å•å…ƒ&lt;/h4&gt;
&lt;p&gt;è¯»ï¼šç”µå‹ä»£è¡¨ä¸åŒæ•°å€¼&lt;/p&gt;
&lt;p&gt;å†™ï¼šç”µå­æ³¨å…¥&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”æ™¶ä½“ç®¡æ·»åŠ äº†æµ®æ …é—¨ï¼Œä¿å­˜ç”µå­&lt;/p&gt;
&lt;p&gt;åŸç†å…¶å®æ¯”è¾ƒç®€å•ï¼Œéç”µå­ç³»å°±ä¸åšå¤ªè¯¦ç»†çš„ç ”ç©¶äº†&lt;/p&gt;
&lt;p&gt;é—ªå­˜é¡µ(4KB,8KB,16KBï¼Œè¯»å†™å•å…ƒ)ï¼Œé˜µåˆ—ä¸­çš„æ¯ä¸€è¡Œ&lt;/p&gt;
&lt;p&gt;é—ªå­˜å—(æ“¦é™¤å•å…ƒ)ï¼Œç”±å¤šä¸ªé¡µç»„æˆçš„å•å…ƒ&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922124359358.png&#34; alt=&#34;image-20220922124359358&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;p&gt;é€‰ä¸­è¡Œå’Œåˆ—ï¼Œç„¶åå°†æ•°æ®åŠ è½½åˆ°Sense Amplifiers&lt;/p&gt;
&lt;p&gt;å­˜å‚¨å•å…ƒæœ‰ä¸¤ä¸ªé˜ˆå€¼çš„ç”µå‹ï¼Œå¯ä»¥æ ¹æ®ä¸¤ä¸ªç”µå‹çš„ä¸­ç‚¹ä½œä¸ºè¯»ç”µå‹ï¼Œ2.5Vè¯»ç”µå‹æ—¶å·¦è¾¹é€šç”µï¼Œæ•°æ®ä¸º1ï¼Œå³è¾¹åˆ™ä¸é€šç”µï¼Œæ•°æ®ä¸º0&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922124755447.png&#34; alt=&#34;image-20220922124755447&#34; style=&#34;zoom:25%;&#34; /&gt;
&lt;p&gt;Pass Through&lt;/p&gt;
&lt;p&gt;é€‰å–ä¸€ä¸ªè¾ƒå¤§çš„ç”µå‹ï¼Œä½¿å¾—æ‰€æœ‰çš„å•å…ƒéƒ½æ¥é€šï¼Œæ•°æ®ä¸º1ï¼Œä¸å½±å“å…¶ä»–è¡Œçš„çŠ¶æ€&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922131649578.png&#34; alt=&#34;image-20220922131649578&#34; style=&#34;zoom:25%;&#34; /&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºçš„å­˜å‚¨ç»“æ„ï¼Œåœ¨ç¬¬äºŒè¡Œæ–½åŠ 2.5Vç”µå‹ï¼Œå…¶ä»–è¡Œæ–½åŠ 5Vï¼Œæœ€ç»ˆè¯»å–æ•°æ®ä¸º0011&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922134857889.png&#34; alt=&#34;image-20220922134857889&#34; style=&#34;zoom:33%;&#34;/&gt;
&lt;p&gt;ä¸Šè¿°ä¸ºSLCï¼ŒSingle Level Cellï¼Œå•å­˜å‚¨å•å…ƒ&lt;/p&gt;
&lt;h4 id=&#34;å¤šæ¯”ç‰¹é—ªå­˜&#34;&gt;å¤šæ¯”ç‰¹é—ªå­˜&lt;/h4&gt;
&lt;p&gt;å¤šæ¯”ç‰¹é—ªå­˜å•å…ƒMLCï¼ŒåŒ…å«2Bits 4ä¸ªLevelçš„æ•°æ®&lt;/p&gt;
&lt;p&gt;TLC 3 Bits 8ä¸ªLevel&lt;/p&gt;
&lt;p&gt;QLC 4 Bits 16ä¸ªLevel&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¤šæ¯”ç‰¹ä½¿ç”¨æ ¼é›·ç æ¥ç¼–ç &lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨æ ¼é›·ç ä½¿å¾—ç›¸é‚»å•å…ƒåªæœ‰ä¸€ä½å·®å¼‚ï¼Œæ–¹ä¾¿çº é”™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤šæ¯”ç‰¹æé«˜äº†å­˜å‚¨å¯†åº¦ï¼Œä½†æ˜¯æé«˜äº†é”™è¯¯ç‡ï¼Œå› ä¸ºæ–½åŠ çš„ç”µå‹å·®è·å¾ˆå°ã€‚å¯é æ€§ä¼šé™ä½ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922135516463.png&#34; alt=&#34;image-20220922135516463&#34; style=&#34;zoom:45%;&#34; /&gt;
&lt;p&gt;å¯¹äºå¤šæ¯”ç‰¹çš„å†™ï¼ŒMLCåˆ†ä¸ºé«˜æ¯”ç‰¹å’Œä½æ¯”ç‰¹ï¼Œå¯¹äºä½æ¯”ç‰¹çš„çŠ¶æ€åŠ åç§»ç”µå‹ç¡®å®šé«˜æ¯”ç‰¹ï¼Œåœ¨ä½æ¯”ç‰¹æ—¶éœ€è¦åŠ çš„ç”µå‹è¾ƒå¤§ï¼Œæ“ä½œéš¾åº¦ä½ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œåœ¨é«˜æ¯”ç‰¹æ—¶éœ€è¦åŠ çš„ç”µå‹å°ï¼Œæ³¢å½¢çš„é—´è·å°ï¼Œæ“ä½œéš¾åº¦é«˜ï¼Œè¿è¡Œçš„é€Ÿåº¦è¾ƒæ…¢ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922140421405.png&#34; alt=&#34;image-20220922140421405&#34; style=&#34;zoom:40%;&#34; /&gt;
&lt;p&gt;å¯¹äºå¤šæ¯”ç‰¹çš„è¯»ï¼Œå…ˆçœ‹lower bitï¼ŒåŠ ä¸€æ¬¡ç”µå‹ï¼Œå³å¯ç­›é€‰å‡ºä½ä½çš„0ï¼Œ1ï¼Œå†åŠ ä¸¤æ¬¡ç”µå‹ç¡®å®šupper bitã€‚å› ä¸ºupper bitä¸º0çš„åœ¨ä¸­é—´éƒ¨åˆ†ï¼Œä¸º1çš„åœ¨ä¸¤ä¾§ï¼Œå› æ­¤éœ€è¦åœ¨ä¸¤ä¸ªåˆ†ç•Œçº¿åˆ†åˆ«åŠ ä¸€æ¬¡ç”µå‹æ¥ç¡®å®šupper bitä¸ºå¤šå°‘ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922141455826.png&#34; alt=&#34;image-20220922141455826&#34; style=&#34;zoom:40%;&#34; /&gt;
&lt;h4 id=&#34;é—ªå­˜&#34;&gt;é—ªå­˜&lt;/h4&gt;
&lt;p&gt;Blockçš„å¤§å°çš„ä¸€ç§é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;ä¸€è¡Œæœ‰ä¸¤ä¸ªPageï¼ŒUpper Pageå’ŒLower Pageï¼Œæ¯ä¸ªå•å…ƒä¸­ï¼Œä½ä½æ„æˆLower Pageï¼Œé«˜ä½æ„æˆUpper Pageï¼Œæœ‰128ä¸ªå•å…ƒï¼Œ128K/8=16KB&lt;/p&gt;
&lt;p&gt;æœ‰64åˆ—bitlinesï¼Œä¸€ä¸ªblockçš„å¤§å°å³ä¸º&lt;code&gt;16KB*64*2=2MB&lt;/code&gt;ï¼Œä¸€èˆ¬æŒ‰ç…§æ­¤æ¯”ä¾‹é…ç½®Block&lt;/p&gt;
&lt;p&gt;å†™å…¥æ—¶æŒ‰ç…§å›ºå®šé¡ºåºï¼Œå†™å…¥é«˜ä½é¡µé¢ç›¸äº’ç‹¬ç«‹ï¼Œä¸èƒ½åŒæ—¶å†™ï¼Œåœ¨å†™å…¥åŠ å‹æ—¶å®¹æ˜“ä½¿ç›¸é‚»å•å…ƒå‘ç”Ÿæ•°æ®åç§»ï¼Œè¦é™ä½é”™è¯¯ç‡&lt;/p&gt;
&lt;p&gt;å†™å…¥æ˜¯éœ€è¦å…ˆæ“¦é™¤å†å†™å…¥ï¼Œæ“¦é™¤æ•´ä¸ªå—&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922143608667.png&#34; alt=&#34;image-20220922143608667&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h4 id=&#34;é—ªå­˜ç‰¹æ€§&#34;&gt;é—ªå­˜ç‰¹æ€§&lt;/h4&gt;
&lt;h5 id=&#34;è¯»å†™ç²’åº¦&#34;&gt;è¯»å†™ç²’åº¦&lt;/h5&gt;
&lt;p&gt;é—ªå­˜é¡µè¯»å†™ç²’åº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;4KBï¼Œ8KBï¼Œ16KBå¿…é¡»å…¨éƒ¨è¯»å–æˆ–è€…å†™å…¥&lt;/li&gt;
&lt;li&gt;uså»¶è¿Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é—ªå­˜å—æ“¦é™¤åŠ›åº¦&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2MBæ“¦é™¤&lt;/li&gt;
&lt;li&gt;mså»¶è¿Ÿï¼Œå¯ä»¥é€šè¿‡FTLæ¥ä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;ä¸å¯è¦†ç›–å†™&#34;&gt;ä¸å¯è¦†ç›–å†™&lt;/h5&gt;
&lt;p&gt;å†™å‰éœ€è¦æ“¦é™¤ï¼Œè¯»å†™ç²’åº¦ä¸æ“¦é™¤ç²’åº¦ä¸åŒ&lt;/p&gt;
&lt;p&gt;å­˜åœ¨64bytesçš„OOBï¼ˆout of bound areaï¼‰ï¼Œä¿å­˜ECCï¼Œç”¨äºçº é”™ï¼Œå®¹å¿å†™å…¥æ—¶éƒ¨åˆ†æ¯”ç‰¹å‡ºé”™&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922162139217.png&#34; alt=&#34;image-20220922162139217&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h5 id=&#34;æœ‰é™æ¬¡æ“¦é™¤&#34;&gt;æœ‰é™æ¬¡æ“¦é™¤&lt;/h5&gt;
&lt;p&gt;éšç€æ“¦é™¤æ¬¡æ•°çš„å¢åŠ ï¼Œå­˜å‚¨å•å…ƒä¸èƒ½å¯é çš„ä¿æŒçŠ¶æ€ï¼ˆå­˜å‚¨æ•°æ®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ°§åŒ–å±‚è€åŒ–å˜è–„ï¼ŒæŸç¼šç”µå­èƒ½åŠ›å˜å¼±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è€ä¹…æ€§ å˜è–„åœ°æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;ä¿æŒåŠ› ä¸é€šç”µå¯ä»¥æ”¾ç½®çš„æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SLCï¼š10wæ¬¡&lt;/p&gt;
&lt;p&gt;MLCï¼š1wæ¬¡&lt;/p&gt;
&lt;p&gt;TLCï¼š1kæ¬¡&lt;/p&gt;
&lt;p&gt;æ ¹æ®ç‰¹æ€§æ¥è®¾è®¡FTLå›ºä»¶&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922164523965.png&#34; alt=&#34;image-20220922164523965&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h2 id=&#34;ftl&#34;&gt;FTL&lt;/h2&gt;
&lt;p&gt;å›ºæ€ç¡¬ç›˜æ•´ä½“æ„æˆ&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922164728094.png&#34; alt=&#34;image-20220922164728094&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;SSDä¸­çš„é€šé“å¯ä»¥å¹¶è¡Œï¼Œé€šé“ä¸­ä¹Ÿå¯ä»¥å¹¶è¡Œè¯»å–ï¼Œæ¯ä¸ªPlaneä¸­æœ‰å¯„å­˜å™¨ï¼Œæš‚æ—¶å­˜å‚¨å‡†å¤‡å¥½çš„æ•°æ®ã€‚ä¸åŒå•å…ƒå¹¶è¡Œï¼Œå› æ­¤å†…éƒ¨å¸¦å®½å¤§&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922165354311.png&#34; alt=&#34;image-20220922165354311&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h3 id=&#34;åƒåœ¾å›æ”¶&#34;&gt;åƒåœ¾å›æ”¶&lt;/h3&gt;
&lt;p&gt;pageå¯¹äºOSè€Œè¨€ï¼Œæ˜¯å†™å…¥æ—¶çš„block&lt;/p&gt;
&lt;p&gt;Pageä¸‰ç§çŠ¶æ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç©ºé—² free page&lt;/li&gt;
&lt;li&gt;æœ‰æ•ˆé¡µ live/valid page&lt;/li&gt;
&lt;li&gt;æ— æ•ˆé¡µ dead/invalid page&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922184349456.png&#34; alt=&#34;image-20220922184349456&#34; style=&#34;zoom:25%;&#34; /&gt;
&lt;p&gt;éœ€è¦æ“¦é™¤æ— æ•ˆé¡µï¼Œå…ˆç§»èµ°æœ‰æ•ˆé¡µï¼Œç„¶åå†å¯¹ä¸€æ•´è¡Œè¿›è¡Œæ“¦é™¤ï¼Œè½¬ä¸ºç©ºé—²&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220922184406162.png&#34; alt=&#34;image-20220922184406162&#34; style=&#34;zoom:25%;&#34; /&gt;
&lt;p&gt;æ—¶é—´å¼€é”€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤åˆ¶æœ‰æ•ˆæ•°æ®åˆ°$(R_{Latency}+W_{Latency})*N$ï¼ŒNæ˜¯ç§»åŠ¨pageçš„æ•°é‡&lt;/li&gt;
&lt;li&gt;æ“¦é™¤äº§ç”Ÿçš„å¼€é”€ msçº§å»¶è¿Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;gcç­–ç•¥&#34;&gt;GCç­–ç•¥&lt;/h4&gt;
&lt;p&gt;è¦è§£å†³çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½•æ—¶å¯åŠ¨GC&lt;/li&gt;
&lt;li&gt;é€‰ä¸­é‚£äº›/å¤šå°‘Blockè¿›è¡ŒGC&lt;/li&gt;
&lt;li&gt;æœ‰æ•ˆçš„é¡µå¦‚ä½•è¢«è½¬å†™&lt;/li&gt;
&lt;li&gt;æ–°æ•°æ®å†™åˆ°å“ªé‡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GCçš„æ—¶é—´å¼€é”€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å—æ“¦é™¤çš„æ—¶é—´ ms&lt;/li&gt;
&lt;li&gt;æœ‰æ•ˆé¡µçš„å¤åˆ¶æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è´ªå¿ƒç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¾åˆ°è„é¡µæœ€å¤šçš„blockæ¥è¿›è¡Œæ“¦é™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Age&lt;/li&gt;
&lt;li&gt;Hot/Cold æ•°æ®éš”ç¦»ï¼Œåˆ†ç»„é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç£¨æŸå‡è¡¡&#34;&gt;ç£¨æŸå‡è¡¡&lt;/h3&gt;
&lt;p&gt;ä¼˜åŒ–å¯¿å‘½ï¼Œæœ‰é™æ€å’ŒåŠ¨æ€ç­–ç•¥&lt;/p&gt;
&lt;p&gt;é™æ€ï¼šå‘¨æœŸæ€§çš„è°ƒæ•´å†·çƒ­æ•°æ®å­˜å‚¨çš„ä½ç½®&lt;/p&gt;
&lt;p&gt;å†·çƒ­æ•°æ®çš„åˆ†åŒºï¼šå°†å†·æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œçƒ­æ•°æ®æ”¾åœ¨ä¸€èµ·&lt;/p&gt;
&lt;h3 id=&#34;ftlç®€ä»‹&#34;&gt;FTLç®€ä»‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç»´æŠ¤æ˜ å°„ï¼Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨SRAMå­˜å‚¨æ˜ å°„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘ä¸Šå±‚éšè—æ“¦é™¤æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¿å…åŸåœ°æ›´æ–°-&amp;gt;å¼‚åœ°æ›´æ–°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°ä¸€ä¸ªæ–°é¡µé¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é«˜æ€§èƒ½çš„åƒåœ¾å›æ”¶å’Œæ“¦é™¤&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;OOBæœ‰ç‰©ç†åœ°å€åˆ°è™šæ‹Ÿåœ°å€çš„æ˜ å°„ï¼Œç”¨äºæ‰ç”µæ¢å¤ï¼Œè¿™é‡Œå¼•ç”¨ä¸€æ®µ&lt;a class=&#34;link&#34; href=&#34;https://pages.cs.wisc.edu/~remzi/OSTEP/file-ssd.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;wiscçš„OSTEPä¸­çš„ä¸€æ®µè§£é‡Šï¼ˆ44 Flash- based SSDï¼‰&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;OOBä¿å­˜çš„åœ¨æ¯ä¸ªé¡µä¸­æ˜ å°„ä¿¡æ¯ï¼Œå½“æ‰ç”µæˆ–è€…é‡å¯æ—¶ç”¨å®ƒåœ¨å†…å­˜ä¸­é‡å»ºæ˜ å°„&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢åœ¨é‡å»ºæ—¶æ‰«ç æ•´ä¸ªSSDï¼Œå¯ä»¥ä½¿ç”¨æ—¥å¿—æˆ–è€…æ£€æŸ¥ç‚¹çš„æ–¹å¼æ¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;å¤§è‡´çœ‹äº†ä¸€ä¸‹OSTEPï¼Œæ˜¯æœ‰å…³æ“ä½œç³»ç»Ÿçš„ä¸€æœ¬éå¸¸å¥½çš„ä¹¦ï¼Œå¸Œæœ›ä»¥åæœ‰æ—¶é—´è¯»ä¸€ä¸‹&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220924141132556.png&#34; alt=&#34;image-20220924141132556&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h3 id=&#34;page-level-ftl&#34;&gt;Page-Level FTL&lt;/h3&gt;
&lt;p&gt;åŸç†ç±»ä¼¼OSä¸­çš„é¡µè¡¨ï¼Œç”±Logical Page NumberæŸ¥è¯¢é¡µè¡¨å¾—åˆ°Physical Page Number&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹æ˜¯é¡µè¡¨å ç”¨å¾ˆå¤§çš„ç©ºé—´&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220924152322358.png&#34; alt=&#34;image-20220924152322358&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h3 id=&#34;block-level-ftl&#34;&gt;Block-Level FTL&lt;/h3&gt;
&lt;p&gt;ä¿æŒBlock åˆ°Blockçš„æ˜ å°„&lt;/p&gt;
&lt;p&gt;å…ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„Blockï¼Œåœ¨æ ¹æ®offsetå¾—åˆ°pageï¼Œå—å†…çš„é¡µç åç§»offsetæ˜¯å›ºå®šçš„&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20220924152259043.png&#34; alt=&#34;image-20220924152259043&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;ä¼˜ç‚¹æ˜¯å ç”¨ç©ºé—´å¾ˆå°ï¼Œç¼ºç‚¹æ˜¯GCè´Ÿè½½å¢åŠ &lt;/p&gt;
&lt;p&gt;åŸå› ï¼šoffsetåœ¨ä¸åŒBlockä¸­ä¿æŒä¸å˜ï¼Œåœ¨å¼‚åœ°æ›´æ–°æ—¶ï¼Œè¦é€‰æ‹©å…¶ä»–blockä¸­ç›¸åŒçš„offsetè¿›è¡Œå†™å…¥ï¼Œå¦‚æœé€‰ä¸­çš„blockå·²ç»å­˜åœ¨æ•°æ®ï¼Œéœ€è¦æŠŠæ•°æ®è¿ç§»ã€‚ã€TODO è¿™é‡Œè®²å¾—ä¸æ˜¯éå¸¸çš„æ¸…æ¥šã€‘&lt;/p&gt;
&lt;h3 id=&#34;hybrid-ftl&#34;&gt;Hybrid FTL&lt;/h3&gt;
&lt;p&gt;å¯¹å†™å…¥åˆ†ä¸ºæ–°/æ—§æ•°æ®ï¼Œæ–°å†™å…¥çš„æ•°æ®ç”¨Page-Level Mappingæ•ˆç‡é«˜ï¼Œå†™å…¥Log Blocksä½œä¸ºç¼“å†²ï¼Œä¹‹åå†æ›´æ–°åˆ°Data Blocks&lt;/p&gt;
&lt;p&gt;æ—§æ•°æ®å› ä¸ºå†™å…¥åæ›´æ–°ç›¸å¯¹ä¸é¢‘ç¹ï¼Œä½¿ç”¨Block-Level Mappingï¼Œå†™å…¥Data Blocks&lt;/p&gt;
&lt;h1 id=&#34;reference&#34;&gt;Reference&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;NNSSå®éªŒå®¤æš‘æœŸå®ä¹ æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;ã€ŠLinuxå†…æ ¸è®¾è®¡ä¸å®ç°ã€‹&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥ç†è§£Linuxå†…æ ¸ã€‹&lt;/li&gt;
&lt;li&gt;ã€ŠLinuxè®¾å¤‡é©±åŠ¨ç¨‹åºã€‹&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥æµ…å‡ºSSDï¼šå›ºæ€å­˜å‚¨æ ¸å¿ƒæŠ€æœ¯ã€åŸç†ä¸å®æˆ˜ã€‹&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.enterprisestorageforum.com/hardware/nand-dram-sas-scsi-and-sata-ahci-not-dead-yet/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;NAND, DRAM, SAS/SCSI and SATA/AHCI: Not Dead, Yet | Enterprise Storage Forum&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.quora.com/Linux-Kernel/What-is-the-major-difference-between-the-buffer-cache-and-the-page-cache-Why-were-they-separate-entities-in-older-kernels-Why-were-they-merged-later-on/answer/Robert-Love-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€Quoraã€‘Robert Loveå¯¹ç¼“å†²åŒºç¼“å­˜å’Œé¡µé¢ç¼“å­˜çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆçš„å›ç­”ï¼Ÿä¸ºä»€ä¹ˆå®ƒä»¬åœ¨è¾ƒæ—§çš„å†…æ ¸ä¸­æ˜¯ç‹¬ç«‹çš„å®ä½“ï¼Ÿä¸ºä»€ä¹ˆåæ¥ä»–ä»¬è¢«åˆå¹¶äº†ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://pages.cs.wisc.edu/~remzi/OSTEP/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€OSTEPã€‘Operating Systems: Three Easy Pieces (wisc.edu)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1xE411T7Dy/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€bilibili æ¸…åå¤§å­¦ã€‘å­˜å‚¨æŠ€æœ¯åŸºç¡€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://ext4.wiki.kernel.org/index.php/Ext4_Howto&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€kernel.org Ext4æ–‡ä»¶ç³»ç»Ÿä»‹ç»ã€‘Ext4 Howto - Ext4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://btrfs.wiki.kernel.org/index.php/Status&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€kernel.org Btrfsæ–‡ä»¶ç³»ç»Ÿç°çŠ¶ã€‘Status - btrfs Wiki&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.kernel.org/doc/html/latest/filesystems/ext4/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€kernel.org Ext4æ–‡ä»¶ç³»ç»Ÿè®¾è®¡ã€‘ext4 Data Structures and Algorithms&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast15/technical-sessions/presentation/lee&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€USENIX FAST&#39;21ã€‘F2FS: A New File System for Flash Storage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://wiki.archlinux.org/title/Ext4_%28%e7%ae%80%e4%bd%93%e4%b8%ad%e6%96%87%29#%e5%85%b3%e9%97%ad%e5%b1%8f%e9%9a%9c&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€archlinux.org ArchWikiã€‘Ext4 &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-ssd&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€Red Hat Customer Portal | SSD discardã€‘Chapter 21. Solid-State Disk Deployment Guidelines Red Hat Enterprise Linux 7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.51cto.com/u_15061941/3859244&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€mq-deadlineã€‘mq-deadlineè°ƒåº¦å™¨åŸç†åŠæºç åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://nan01ab.github.io/2019/02/Kyber.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€Kyber I/Oã€‘Kyber IO Scheduler of Linux Â· Columba M71&amp;rsquo;s Blog&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>[ATC&#39;19] Asynchronous I/O Stack: A Low-latency Kernel I/O Stack for Ultra-Low Latency SSDs</title>
        <link>https://blog.ipandai.club/p/atc19-asynchronous-i/o-stack-a-low-latency-kernel-i/o-stack-for-ultra-low-latency-ssds/</link>
        <pubDate>Wed, 17 Aug 2022 10:30:41 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/atc19-asynchronous-i/o-stack-a-low-latency-kernel-i/o-stack-for-ultra-low-latency-ssds/</guid>
        <description>&lt;h1 id=&#34;intro&#34;&gt;Intro&lt;/h1&gt;
&lt;p&gt;ä¼˜åŒ–I/Oçš„æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å±‚é¢ç›´æ¥è°ƒç”¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ï¼Œéœ€è¦åº”ç”¨åŒ…å«æ–‡ä»¶ç³»ç»Ÿçš„è°ƒç”¨ï¼Œè‡ƒè‚¿ï¼ŒåŒæ—¶ä¸åŒåº”ç”¨å’Œç”¨æˆ·é—´çš„å†²çªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ“ä½œç³»ç»Ÿå†…æ ¸çš„I/O æ ˆ
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è½®è¯¢æ¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€&lt;/li&gt;
&lt;li&gt;åœ¨åº•å±‚å‡å°‘ä¸€åŠçš„ä¸­æ–­å¤„ç†&lt;/li&gt;
&lt;li&gt;åˆ†æ•£I/OæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;I/O blockè°ƒåº¦æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;related-work&#34;&gt;Related Work&lt;/h1&gt;
&lt;p&gt;å‡å°‘å†…æ ¸çš„å¼€é”€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ä¸­æ–­å¤„ç†çš„ååŠéƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;æ˜¯ç”¨è½®è¯¢æŠ€æœ¯è€Œéä¸­æ–­ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;æ··åˆè½®è¯¢&lt;/li&gt;
&lt;li&gt;åŸºäºSSDçš„é—ªå­˜éšæœºè¯»å†™ç®€åŒ–è°ƒåº¦ç­–ç•¥&lt;/li&gt;
&lt;li&gt;åœ¨NVMeå›ºä»¶ä¸­è¿›è¡Œè°ƒåº¦&lt;/li&gt;
&lt;li&gt;å¯¹é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæä¾›ä¸åŒçš„IO pathæ”¯æŒï¼Œæœ€å°åŒ–IO pathçš„å¼€é”€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¿®æ”¹å­˜å‚¨æ¥å£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†æ•£/åˆ†æ•£ IOåˆå¹¶å¤šä¸ªIOåˆ°ä¸€ä¸ªæŒ‡ä»¤ï¼Œå‡å°‘å¾€è¿”æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;ç§»é™¤doorbellæœºåˆ¶å’Œå®Œæˆä¿¡å·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ”¹å–„fsync&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†²fsyncè¯·æ±‚å‘å‡ºåˆ°æ”¶åˆ°responseï¼Œå»¶é•¿æ•°æ®æŒä¹…åŒ–çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;åœ¨æ—¥å¿—æäº¤è®°å½•ä¸­ä½¿ç”¨æ ¡éªŒå’Œï¼Œæœ‰æ•ˆçš„é‡å æ—¥å¿—å†™å…¥å’Œå—å†™å…¥&lt;/li&gt;
&lt;li&gt;æå‡º&lt;code&gt;å†™å®ˆåºç³»ç»Ÿè°ƒç”¨&lt;/code&gt;ï¼Œé‡å çš„fsyncæ•ˆæœç›¸åŒï¼Œå½“åº”ç”¨éœ€è¦ä½¿ç”¨fsyncæ—¶ï¼Œå…³äºIOçš„æ“ä½œå°†åŒæ­¥è¿›è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æˆ·å±‚ç›´æ¥è®¿é—®å¤–è®¾ï¼Œå­˜åœ¨éš”ç¦»ã€ä¿æŠ¤ç­‰å®‰å…¨é—®é¢˜&lt;/p&gt;
&lt;h1 id=&#34;motivation&#34;&gt;Motivation&lt;/h1&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ç°çŠ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I/O è¯·æ±‚è¿‡ç¨‹ä¸­å¤ªå¤šçš„æ­¥éª¤&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜åˆ†é…å’Œç´¢å¼•&lt;/li&gt;
&lt;li&gt;DMAï¼Œä¸€ç³»åˆ—æ•°æ®ç»“æ„çš„åˆ›å»º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰çš„ ULL SDDå®ç°äº†ä½äº10å¾®å¦™çš„IOå»¶è¿Ÿï¼Œç„¶è€Œæ“ä½œç³»ç»Ÿå†…æ ¸äº§ç”Ÿçš„å»¶è¿Ÿæ²¡æœ‰æ˜æ˜¾å˜åŒ–&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸“æ³¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linuxå†…æ ¸ä¸­çš„&lt;code&gt;read()&lt;/code&gt;å’Œ&lt;code&gt;write()+fsync()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŸºäºNVMe SSDçš„Ext4æ–‡ä»¶ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;for-read-path&#34;&gt;For Read Path&lt;/h2&gt;
&lt;p&gt;ç ”ç©¶å‘ç°è®¸å¤šå‰©ä½™çš„æ“ä½œä¸å¿…åœ¨è®¾å¤‡I/Oä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;æ­¤ç±»æ“ä½œå¯ä»¥åœ¨è®¾å¤‡I/Oæ“ä½œè¿›è¡Œæ—¶æ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ­¤ç±»æ“ä½œå¤§å¤šç‹¬ç«‹äºè®¾å¤‡I/Oæ“ä½œï¼Œå› æ­¤è€ƒè™‘è®©è¿™äº›æ“ä½œä¸IOé‡å &lt;/p&gt;
&lt;h2 id=&#34;for-write-path&#34;&gt;For Write Path&lt;/h2&gt;
&lt;p&gt;ç¼“å†²å†™&lt;code&gt;write()&lt;/code&gt;ï¼Œå¹¶ä¸å‘èµ·IOè¯·æ±‚ï¼Œä¸èƒ½å¼‚æ­¥å¤„ç†&lt;/p&gt;
&lt;p&gt;ç”±äºfsyncçš„å›å†™æœºåˆ¶å’Œæ–‡ä»¶ç³»ç»Ÿå´©æºƒä¸€è‡´æ€§ï¼ˆæ—¥å¿—ç³»ç»Ÿï¼‰ï¼ŒåŒ…å«éƒ¨åˆ†IOè¯·æ±‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ–‡ä»¶ç³»ç»Ÿå¸¦æ¥çš„ä¸‰æ¬¡IOæ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®å—å†™&lt;/li&gt;
&lt;li&gt;jbd2å‘èµ·å†™å…¥æ—¥å¿—Block I/O&lt;/li&gt;
&lt;li&gt;æäº¤Block I/O&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™äº›IOçš„åˆ›å»ºï¼Œæ¶‰åŠä¼—å¤šè¿‡ç¨‹ï¼ˆblockåˆ†é…ï¼Œè¯·æ±‚ç¼“å†²é¡µï¼Œåˆ›å»ºå’Œæäº¤bioï¼Œè®¾ç½®DMAåœ°å€ï¼‰ï¼Œå› æ­¤å¯ä»¥è®©CPUå°†è¿™äº›å‰ç½®æ“ä½œåœ¨IOè¯·æ±‚å‘èµ·å‰é¢„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;for-lightweight-block-layer&#34;&gt;For Lightweight Block Layer&lt;/h2&gt;
&lt;p&gt;ä¼ ç»ŸBlock Layeræ¶‰åŠè¿‡å¤šè¿‡ç¨‹ï¼Œæ¨è¿Ÿäº†IOæŒ‡ä»¤æäº¤ç»™è®¾å¤‡çš„æ—¶é—´&lt;/p&gt;
&lt;p&gt;å› ä¸ºULL SSDçš„é«˜é€ŸéšæœºIOæ€§èƒ½å’Œä½é€Ÿçš„é¡ºåºIOï¼Œè¯·æ±‚é‡æ’çš„æ•ˆæœå¾ˆä½&lt;/p&gt;
&lt;p&gt;ç®€åŒ–block layerï¼Œé’ˆå¯¹å¼‚æ­¥IO stackè¿›è¡Œä¼˜åŒ–&lt;/p&gt;
&lt;h1 id=&#34;design&#34;&gt;Design&lt;/h1&gt;
&lt;h2 id=&#34;è½»é‡åŒ–çš„block-io-layer&#34;&gt;è½»é‡åŒ–çš„Block I/O Layer&lt;/h2&gt;
&lt;p&gt;LBIOï¼Œä¸ºLL NVMe SSDè€Œè®¾è®¡ï¼Œåªæ”¯æŒIO submission/completionå’ŒIOæŒ‡ä»¤tagging&lt;/p&gt;
&lt;p&gt;åªä½¿ç”¨&lt;code&gt;lbio&lt;/code&gt;æ¥è¡¨ç¤ºä¸€ä¸ªblock I/Oè¯·æ±‚ï¼Œå‡å°‘äº†&lt;code&gt;bio-to-request&lt;/code&gt;çš„æ—¶é—´&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªlbioåŒ…æ‹¬&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LBA&lt;/li&gt;
&lt;li&gt;I/O é•¿åº¦&lt;/li&gt;
&lt;li&gt;å¤åˆ¶çš„é¡µé¢&lt;/li&gt;
&lt;li&gt;é¡µé¢çš„DMAåœ°å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨å…¨å±€çš„lbioäºŒä½æ•°ç»„æ¥è®°å½•&lt;/p&gt;
&lt;p&gt;è¡Œçš„ä¸ªæ•°ä¸ºCPUæ ¸å¿ƒæ•°ï¼Œè¡Œæˆç»„è¢«åˆ†é…åˆ°ä¸€ä¸ªNVMeé˜Ÿåˆ—&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚8æ ¸å¿ƒï¼Œ4NVMeé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—åˆ†é…2ä¸ªæ ¸å¿ƒçš„lbio
å½“æ ¸å¿ƒæ•°ç­‰äºé˜Ÿåˆ—æ•°æ—¶ï¼Œå¯ä»¥å®ç°æ— é”çš„å‘½ä»¤æäº¤&lt;/p&gt;
&lt;p&gt;lbioåœ¨å…¨å±€æ•°ç»„ä¸­çš„ç´¢å¼•ç”¨ä½œNVMeæŒ‡ä»¤çš„tagï¼Œå‡å°‘äº†ä¹‹å‰èµ‹tagçš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;lbioæäº¤åï¼Œè°ƒç”¨&lt;code&gt;nvme_queue_lbio&lt;/code&gt;æ¥æäº¤I/OæŒ‡ä»¤&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;LBIOä¸ä¼šåˆå¹¶å’Œè°ƒåº¦IOè¯·æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;read-path&#34;&gt;Read Path&lt;/h2&gt;
&lt;p&gt;Ext4æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”±extent status treeä¿å­˜ç¼“å­˜åˆ°ç‰©ç†æ–‡ä»¶blockçš„æ˜ å°„&lt;/p&gt;
&lt;p&gt;é¢„åŠ è½½æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå½“æ ‘å¤ªå¤§æ—¶ï¼Œå¯ä»¥åªå¯¹æŸä¸ªæ–‡ä»¶é¢„åŠ è½½&lt;/p&gt;
&lt;h3 id=&#34;å¼‚æ­¥é¡µé¢ç”³è¯·å’Œdmaåˆ†é…&#34;&gt;å¼‚æ­¥é¡µé¢ç”³è¯·å’ŒDMAåˆ†é…&lt;/h3&gt;
&lt;p&gt;æå‰åˆ†é…ç©ºé—²é¡µæ± &lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘é¡µé¢DMAçš„åˆ†é…ï¼Œä¸ºæ¯ä¸ªæ ¸ç»´æŠ¤ä¸€ä¸ªDMAæ˜ å°„ç©ºé—²é¡µï¼ˆ4KB DMAæ˜ å°„é¡µçš„é“¾è¡¨ï¼‰&lt;/p&gt;
&lt;p&gt;å½“ç©ºé—²é¡µæ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†é€€åŒ–ä¸ºåŒæ­¥è¿›è¡Œï¼ˆoriginï¼‰&lt;/p&gt;
&lt;h3 id=&#34;ç¼“å­˜é¡µç´¢å¼•&#34;&gt;ç¼“å­˜é¡µç´¢å¼•&lt;/h3&gt;
&lt;p&gt;è‡ªæ—‹é”é˜²æ­¢å¹¶å‘é—®é¢˜ï¼Œå½±å“æ•ˆç‡&lt;/p&gt;
&lt;p&gt;åœ¨è¯·æ±‚å‘å‡ºï¼Œä½†æ˜¯é¡µé¢è¿˜æ²¡æœ‰æ›´æ–°æ—¶ï¼Œå¯èƒ½é‡å¤è¯·æ±‚æ›´æ–°é¡µé¢&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆæ˜¯ä¸é™åˆ¶requestï¼Œåœ¨request completioné˜¶æ®µè§£å†³é—®é¢˜&lt;/p&gt;
&lt;p&gt;å°½ç®¡å¤šä¸ªblockè¯·æ±‚ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªé¡µé¢è¢«ç´¢å¼•&lt;/p&gt;
&lt;p&gt;å¯¹äºå…¶ä»–é¡µé¢ï¼Œæ ‡è®°ä¸ºabandonedï¼Œä¸­æ–­å‘ç”Ÿä¹‹åï¼Œå¦‚æœæ ‡è®°ä¸ºabandonedï¼Œåˆ™æ¸…é™¤å·²ç»å®Œæˆçš„é¡µé¢&lt;/p&gt;
&lt;h3 id=&#34;dmaè§£é™¤æ˜ å°„&#34;&gt;DMAè§£é™¤æ˜ å°„&lt;/h3&gt;
&lt;p&gt;åŸæœ¬ä½¿ç”¨ä¸­æ–­æ¥å¤„ç†ï¼Œæ”¹ä¸ºå½“ç³»ç»Ÿç©ºé—²æˆ–ç­‰å¾…ä¸€ä¸ªIOè¯·æ±‚æ—¶å¤„ç†&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹å¼å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´çª—å£ï¼Œè‹¥ä¸å—åˆ°æ¶æ„è®¿é—®ï¼Œä¸ä¼šäº§ç”Ÿå½±å“ï¼Œå¦åˆ™ç”¨æˆ·å¯ä»¥è‡ªè¡Œé€‰æ‹©å…³é—­æƒ°æ€§DMAæ˜ å°„æ¥è§¦&lt;/p&gt;
&lt;h2 id=&#34;write--fsync-path&#34;&gt;Write &amp;amp;&amp;amp; fsync Path&lt;/h2&gt;
&lt;p&gt;å½“fsyncæ¶‰åŠæ–‡ä»¶ç³»ç»Ÿä¸­äº‹åŠ¡æ—¶ï¼Œå¯ä»¥å°†jbd2æ—¥å¿—å¤„ç†é‡å å¤„ç†&lt;/p&gt;
&lt;h1 id=&#34;experiment&#34;&gt;Experiment&lt;/h1&gt;
&lt;p&gt;åŸºäºLinuxå†…æ ¸5.0.5ç‰ˆæœ¬&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦&lt;code&gt;O_AIOS&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;evaluation&#34;&gt;Evaluation&lt;/h1&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;æå‡ºäº†AIOS&lt;/p&gt;
&lt;p&gt;LBIOå±‚&lt;/p&gt;
&lt;p&gt;AIOSå°†I/Oè·¯å¾„ä¸­çš„åŒæ­¥æ“ä½œæ›¿æ¢ä¸ºå¼‚æ­¥æ“ä½œï¼Œä»¥å°†ä¸è¯»å–å’Œfsyncç›¸å…³çš„è®¡ç®—ä¸è®¾å¤‡I/Oè®¿é—®é‡å ã€‚&lt;/p&gt;
&lt;p&gt;AIOSåœ¨Optane SSDä¸Šå®ç°äº†ä¸€ä½æ•°å¾®ç§’çš„I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒAIOSé€šè¿‡Z-SSDå’ŒOptane SSDä¸Šçš„æ¨¡æ‹Ÿå®éªŒå’Œå®é™…æµ‹è¯•æ˜¾è‘—é™ä½å»¶è¿Ÿå’Œæ€§èƒ½æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸€äº›å¯å‘&#34;&gt;ä¸€äº›å¯å‘&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ä¼˜åŒ–I/Oå¯ä»¥ä»CPUçš„ç©ºé—²æ—¶é—´åˆ†æï¼Œéœ€è¦è€ƒè™‘å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨CPUèµ„æºï¼Œå‡å°‘ç©ºé—²ã€‚&lt;/li&gt;
&lt;li&gt;ç¡¬ä»¶è®¾å¤‡åœ¨å‘å±•çš„åŒæ—¶ï¼Œè½¯ä»¶åº”è¯¥æä¾›å¿…è¦é€‚é…&lt;/li&gt;
&lt;li&gt;å‡å°‘å†…æ ¸ä¸­ä¸I/Oç›¸å…³çš„ç»“æ„ç±»å‹è½¬åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœæ—¶é—´å¼€é”€&lt;/li&gt;
&lt;li&gt;æƒ°æ€§ä¿®æ”¹ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œåœ¨ä¿è¯å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æé«˜æ•ˆç‡&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>[OSDI&#39;19] Flashshare: Punching Through Server Storage Stack from Kernel to Firmware for Ultra-Low Latency SSDs</title>
        <link>https://blog.ipandai.club/p/osdi19-flashshare-punching-through-server-storage-stack-from-kernel-to-firmware-for-ultra-low-latency-ssds/</link>
        <pubDate>Wed, 17 Aug 2022 10:30:30 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/osdi19-flashshare-punching-through-server-storage-stack-from-kernel-to-firmware-for-ultra-low-latency-ssds/</guid>
        <description>&lt;p&gt;è¶…ä½å»¶è¿Ÿå›ºæ€ç¡¬ç›˜ä»å†…æ ¸åˆ°å›ºä»¶çš„æœåŠ¡å™¨å­˜å‚¨å †æ ˆ&lt;/p&gt;
&lt;h1 id=&#34;ä¸ªåˆ«åè¯è§£é‡Š&#34;&gt;ä¸ªåˆ«åè¯è§£é‡Š&lt;/h1&gt;
&lt;p&gt;the 99^th percentile è¶…è¿‡ç»Ÿè®¡æ•°æ®99%çš„æ•°æ˜¯å¤šå°‘&lt;/p&gt;
&lt;p&gt;blk-mq Linux Multiqueue block layer å†…æ ¸å¯¹ssdéšæœºI/Oçš„ä¼˜åŒ–&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;message signaled interrupt (MSI)&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;1æ‘˜è¦&#34;&gt;1.æ‘˜è¦&lt;/h1&gt;
&lt;p&gt;flash share&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸ä¸­ï¼Œæ‰©å±•äº†ç³»ç»Ÿå †æ ˆçš„æ•°æ®ç»“æ„ï¼Œä¼ é€’åº”ç”¨ç¨‹åºçš„å±æ€§ï¼ˆï¼Ÿï¼‰ï¼ŒåŒ…æ‹¬å†…æ ¸å±‚åˆ°SSDå›ºä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç»™å®šçš„å±æ€§ï¼ŒFlashShareçš„å—å±‚ç®¡ç†IOè°ƒåº¦å¹¶å¤„ç†NVMeä¸­æ–­ã€‚&lt;/p&gt;
&lt;p&gt;è¯„ä¼°ç»“æœè¡¨æ˜ï¼ŒFLASHSHAREå¯ä»¥å°†å…±åŒè¿è¡Œåº”ç”¨ç¨‹åºçš„å¹³å‡å‘¨è½¬å“åº”æ—¶é—´åˆ†åˆ«ç¼©çŸ­22%å’Œ31%ã€‚&lt;/p&gt;
&lt;h1 id=&#34;10-intro&#34;&gt;1.0 Intro&lt;/h1&gt;
&lt;h2 id=&#34;11-ç°çŠ¶&#34;&gt;1.1 ç°çŠ¶&lt;/h2&gt;
&lt;p&gt;ç½‘ç»œæœåŠ¡æä¾›å•†ï¼Œæ»¡è¶³æœåŠ¡çº§åˆ«åè®®SLAï¼Œå»¶è¿Ÿæ•æ„Ÿ&lt;/p&gt;
&lt;p&gt;æŸä¸ªæ®µæ—¶é—´çŸ­å¯èƒ½æœ‰å¤§é‡è¯·æ±‚æ¶Œå…¥ï¼Œä¾›åº”å•†ä¼šè¶…é¢é…ç½®æœºå™¨ä»¥æ»¡è¶³SLA&lt;/p&gt;
&lt;p&gt;ç°çŠ¶ï¼šè¯¥åœºæ™¯å¹¶ä¸å¸¸è§ï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹æœåŠ¡å™¨çš„èµ„æºå ç”¨ç‡éå¸¸ä½ï¼Œèƒ½è€—æ¯”ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³åˆ©ç”¨ç‡ä½ï¼ŒæœåŠ¡å™¨ä¼šè¿è¡Œç¦»çº¿çš„æ•°æ®åˆ†æåº”ç”¨ï¼Œå»¶è¿Ÿä¸æ•æ„Ÿï¼Œä»¥ååé‡ä¸ºå¯¼å‘ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨è¿è¡Œäº†å¤šä¸ªè¿›ç¨‹çš„æœåŠ¡å™¨ä¸Šï¼ŒI/Oå»¶è¿Ÿå¢é«˜ï¼Œæ»¡è¶³SLAéå¸¸å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;ç°æœ‰çš„ULL SSDç›¸è¾ƒäºNVMe SSDå¯ä»¥å‡å°‘10å€çš„å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™äº›ULL SSDåœ¨åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ä¸‹é«˜å¼ºåº¦å‹æ¦¨æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¸èƒ½å……åˆ†åˆ©ç”¨ULL SSDçš„ä¼˜åŠ¿/è¡¨ç°ä¸€èˆ¬ã€‚&lt;/p&gt;
&lt;p&gt;the 99th percentile æ˜¯0.8msï¼ˆapacheï¼‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å½“æœåŠ¡å™¨åŒæ—¶è¿è¡Œpagerankçš„æ—¶å€™ï¼Œå»¶è¿Ÿä¼šå¢åŠ 228.5%ã€‚&lt;/p&gt;
&lt;p&gt;åŸå› ï¼šç•¥&lt;/p&gt;
&lt;p&gt;ä»å›ºä»¶åˆ°å†…æ ¸ä¼˜åŒ–å †æ ˆçš„å­˜å‚¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…æ ¸çº§åˆ«çš„å¢å¼ºï¼š&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªæŒ‘æˆ˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linuxçš„blk-mqå¯¼è‡´I/Oè¯·æ±‚é˜Ÿåˆ—åŒ–ï¼Œå¼•å…¥å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;NVMeçš„é˜Ÿåˆ—æœºåˆ¶æ²¡æœ‰å¯¹I/Oä¼˜å…ˆçº§çš„ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ¥è‡ªç¦»çº¿åº”ç”¨çš„IOè¯·æ±‚å®¹æ˜“é˜»å¡åœ¨çº¿åº”ç”¨çš„ç´§æ€¥è¯·æ±‚ï¼Œé€ æˆå»¶è¿Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºlatency criticalçš„è¯·æ±‚ï¼Œç»•è¿‡NVMeçš„è¯·æ±‚é˜Ÿåˆ—ã€‚åŒæ—¶ä»¤NVMeçš„é©±åŠ¨é€šè¿‡çŸ¥æ™“æ¯ä¸ªåº”ç”¨çš„å»¶è¿Ÿä¸´ç•ŒåŒ¹é…NVMeçš„æäº¤å’Œè¯·æ±‚é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›ºä»¶å±‚è®¾è®¡ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹		å³ä½¿å†…æ ¸çº§çš„ä¼˜åŒ–ä¿è¯äº†å»¶è¿Ÿæ•æ„Ÿçš„è¯·æ±‚å¯ä»¥è·å¾—é«˜ä¼˜å…ˆçº§ï¼Œä½†å¦‚æœåŸºç¡€å›ºä»¶ä¸äº†è§£å»¶è¿Ÿä¸´ç•Œå€¼ï¼ŒULLç‰¹æ€§ï¼ˆç±»ä¼¼å†…å­˜çš„æ€§èƒ½ï¼‰æ— æ³•å®Œå…¨æš´éœ²ç»™ç”¨æˆ·ã€‚æœ¬æ–‡ä¸­é‡æ–°è®¾è®¡äº†I/Oè°ƒåº¦å’Œç¼“å­˜çš„å›ºä»¶ï¼Œä»¥ç›´æ¥å‘ç”¨æˆ·æš´éœ²ULLç‰¹æ€§ã€‚å°†ULL SSDçš„é›†æˆç¼“å­˜è¿›è¡Œåˆ†åŒºï¼Œå¹¶æ ¹æ®å·¥ä½œè´Ÿè½½çš„å±æ€§å¯¹æ¯ä¸ªI/OæœåŠ¡ç‹¬ç«‹çš„åˆ†é…ç¼“å­˜ã€‚å›ºä»¶åŠ¨æ€çš„æ›´æ–°åˆ†åŒºå¤§å°å¹¶ä»¥ç²¾ç»†ç²’åº¦è°ƒæ•´é¢„å–I/Oç²’åº¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ULL SSDçš„æ–°ä¸­æ–­å¤„ç†æœåŠ¡ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹	å½“å‰çš„NVMeä¸­æ–­æœºåˆ¶æ²¡æœ‰å¯¹ULL I/OæœåŠ¡ä¼˜åŒ–ã€‚è½®è¯¢æ–¹æ³•ï¼ˆLinux 4.9.30ï¼‰æ¶ˆè€—äº†å¤§é‡çš„CPUèµ„æºå»æ£€æŸ¥I/OæœåŠ¡çš„å®Œæˆæƒ…å†µã€‚å½“è½®è¯¢åœ¨çº¿äº¤äº’æœåŠ¡çš„IOè¯·æ±‚å®ŒæˆçŠ¶æ€æ—¶ï¼ŒflashShareä½¿ç”¨ä¸€ä¸ªä»…å¯¹ç¦»çº¿åº”ç”¨ç¨‹åºä½¿ç”¨æ¶ˆæ¯ä¿¡å·ä¸­æ–­çš„é€‰æ‹©æ€§ä¸­æ–­æœåŠ¡ç¨‹åºSelect-ISRã€‚&lt;/p&gt;
&lt;p&gt;â€‹	é€šè¿‡å°†NVMeé˜Ÿåˆ—å’ŒISRå¸è½½åˆ°ç¡¬ä»¶åŠ é€Ÿå™¨ä¸­æ¥è¿›ä¸€æ­¥ä¼˜åŒ–NVMe completion routineã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å„ç§ä»¿çœŸå®éªŒåæ•ˆæœä¸é”™ï¼Œæ•ˆç‡æé«˜äº†22%å’Œ31%ã€‚&lt;/p&gt;
&lt;h1 id=&#34;20-background&#34;&gt;2.0 Background&lt;/h1&gt;
&lt;h2 id=&#34;21-å­˜å‚¨å†…æ ¸æ ˆ&#34;&gt;2.1 å­˜å‚¨å†…æ ¸æ ˆ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220810145032258.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220810145032258&#34;
	
	
&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Linuxæ–‡ä»¶ç³»ç»ŸIO&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bio&lt;/li&gt;
&lt;li&gt;request&lt;/li&gt;
&lt;li&gt;nvme_rw_command&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å­˜å‚¨å †æ ˆä¸­ï¼ŒNVMeé©±åŠ¨å‘èµ·çš„è¯·æ±‚é€šè¿‡nvme_rw_commandçš„å½¢å¼ä¼ é€’åˆ°PCI/PCIeè®¾å¤‡é©±åŠ¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å½“I/Oè¯·æ±‚å®Œæˆåï¼Œå‘é€ä¿¡å·ä¸­æ–­ï¼Œä¸­æ–­ç›´æ¥è¢«å†™å…¥åˆ°ä¸­æ–­å¤„ç†å™¨çš„ä¸­æ–­å‘é‡ä¸­ã€‚è¢«ä¸­æ–­çš„æ ¸å¿ƒé€‰æ‹©ISRå¤„ç†è¯¥ä¸­æ–­è¯·æ±‚ï¼ŒéšåNVMeé©±åŠ¨å†SQ/CQä¸­æ¸…ç©ºç›¸åº”çš„è®°å½•å¹¶å°†ç»“æœè¿”å›è‡³ä¸Šä¸€å±‚ï¼ˆæ¯”å¦‚blk-mqå’Œæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;22-è®¾å¤‡å›ºä»¶æ ˆ&#34;&gt;2.2 è®¾å¤‡å›ºä»¶æ ˆ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220810232230437.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220810232230437&#34;
	
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ”¶åˆ°request&lt;/li&gt;
&lt;li&gt;SQ tail++å…¥é˜Ÿ&lt;/li&gt;
&lt;li&gt;å†™å…¥SQé—¨é“ƒå¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;é€šè¿‡DMAè¯»å–æ•°æ®çš„ç‰©ç†ä½ç½®&lt;/li&gt;
&lt;li&gt;SQ head++å‡ºé˜Ÿ&lt;/li&gt;
&lt;li&gt;å°†è¯·æ±‚è½¬å‘è‡³åµŒå…¥å¼ç¼“å­˜å±‚æˆ–è€…FTL&lt;/li&gt;
&lt;li&gt;å½“å‡ºç°ç¼ºé¡µæˆ–è€…é¡µé¢æ›¿æ¢æ—¶ï¼ŒFTLå°†ç›®æ ‡LBAè½¬æ¢æˆZ-NANDä¸­ç›¸åº”çš„ç‰©ç†åœ°å€ï¼Œå¿…è¦æ—¶è‡ªè¡ŒGC&lt;/li&gt;
&lt;li&gt;åœ¨å®ŒæˆI/Oè¯·æ±‚ä¹‹åï¼ŒNVMeæ§åˆ¶å™¨å¢åŠ è¿™ä¸ªCQçš„tailï¼Œå…¥é˜Ÿ&lt;/li&gt;
&lt;li&gt;é€šè¿‡DMAä¼ è¾“æ•°æ®ï¼Œå¹¶ä¿®æ”¹phase tag&lt;/li&gt;
&lt;li&gt;ä¸»æœºISRé€šè¿‡æœç´¢é˜Ÿåˆ—ä¸­æ£€æŸ¥phase tagï¼Œå¯¹äºæœ‰æ•ˆçš„phase tagï¼ŒISRæ¸…é™¤tagä½ï¼Œå¹¶ä¸”å¤„ç†å‰©ä½™çš„I/Oå®Œæˆè¯·æ±‚ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;CQ head++å‡ºé˜Ÿï¼Œåœ¨SQä¸­ç§»é™¤ç›¸åº”çš„è®°å½•ï¼Œå¹¶ä¸”å†™å…¥CQçš„head doorbell&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;30-è·¨å±‚è®¾è®¡&#34;&gt;3.0 è·¨å±‚è®¾è®¡&lt;/h1&gt;
&lt;h2 id=&#34;31-å¿«é€Ÿå­˜å‚¨çš„æŒ‘æˆ˜&#34;&gt;3.1 å¿«é€Ÿå­˜å‚¨çš„æŒ‘æˆ˜&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811110758918.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811110758918&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯å­˜å‚¨æ ˆæ— æ³•åŒºåˆ†æ¥è‡ªApacheçš„I/Oè¯·æ±‚ï¼ŒåŠæ—¶ä¸¤ä¸ªåº”ç”¨éœ€è¦ä¸åŒçº§åˆ«I/Oçš„å“åº”ã€‚&lt;/p&gt;
&lt;h1 id=&#34;32-é¢„çŸ¥çµæ•å“åº”&#34;&gt;3.2 é¢„çŸ¥çµæ•å“åº”&lt;/h1&gt;
&lt;p&gt;ä¸ºäº†è®©å†…æ ¸å¯ä»¥åŒºåˆ†I/O è¯·æ±‚çš„ä¼˜å…ˆçº§å’Œç´§è¿«ç¨‹åº¦ï¼Œä¿®æ”¹Linuxçš„è¿›ç¨‹æ§åˆ¶å¿«&lt;code&gt;task_struct&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯æœ‰æ•ˆæ€§ï¼Œåœ¨&lt;code&gt;address_space&lt;/code&gt;,&lt;code&gt;bio&lt;/code&gt;,&lt;code&gt;request&lt;/code&gt;,&lt;code&gt;nvme_rw_command&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸­éƒ½ä¿å­˜å·¥ä½œè´Ÿè½½å±æ€§ï¼Œåœ¨å­˜å‚¨å †æ ˆä¸Šæ‰“å­”ã€‚&lt;/p&gt;
&lt;p&gt;FlashShareåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šé…ç½®è¿™äº›å±æ€§çš„å·¥å…·ã€‚å«åš&lt;code&gt;chworkload_attr&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥æ–¹ä¾¿çš„ä¿®æ”¹æ¯ä¸ªåº”ç”¨çš„å±æ€§å¹¶ç»‘å®šåˆ°&lt;code&gt;task_struct&lt;/code&gt;ä¸­&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹äº†syscallè¡¨&lt;code&gt;arch/x86/entry/syscalls/syscall 64.tbl&lt;/code&gt;æ·»åŠ äº†ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ä»&lt;code&gt;task_struct&lt;/code&gt;ä¸­set/getå·¥ä½œå±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;/linux/syscall.h&lt;/code&gt;ä¸­è¿›è¡Œæ³¨å†Œï¼Œå¹¶å¸¦æœ‰&lt;code&gt;asmlinkage&lt;/code&gt;æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·é€šè¿‡shellç»™å®šç‰¹å®šè¿›ç¨‹ï¼Œå®ç°äº&lt;code&gt;/sched/cores.c&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;33-å†…æ ¸ä¼˜åŒ–&#34;&gt;3.3 å†…æ ¸ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿä¸­çš„blk-mqå’ŒNVMeé©±åŠ¨&lt;/p&gt;
&lt;p&gt;blk-mqåˆå¹¶é‡æ’è¯·æ±‚æé«˜äº†å¸¦å®½ä½¿ç”¨ï¼Œä½†æ˜¯å¼•å…¥äº†å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;è·³è¿‡æ‰€æœ‰åœ¨çº¿åº”ç”¨çš„I/O è¯·æ±‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç¦»çº¿åº”ç”¨ç¨‹åºçš„ I/O è¯·æ±‚è¢« blk-mq è°ƒåº¦åˆ°åç»­åœ¨çº¿åº”ç”¨ç¨‹åºå‘å‡ºçš„åŒä¸€ LBAï¼Œåˆ™å¯èƒ½å‘ç”Ÿå±é™©ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸¤ä¸ªè¯·æ±‚çš„æ“ä½œç±»å‹ä¸åŒï¼Œblk-mqä¼šå°†ä¸¤ä¸ªè¯·æ±‚ä¸²è”ã€‚å¦åˆ™blk-mqä¼šå°†ä¸¤ä¸ªè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ª&lt;code&gt;request&lt;/code&gt;å¹¶äº¤ç»™NVMeé©±åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢å»¶è¿Ÿæ•æ„Ÿçš„I/O è¢«NVMeæ§åˆ¶å™¨æ€æ­»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºæ¯ä¸ªæ ¸å¿ƒåˆ›å»ºä¸¤ä¸ªSQé˜Ÿåˆ—å’Œä¸€ä¸ªCQé˜Ÿåˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811173922087.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811173922087&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ä¸€ä¸ªSQä¿å­˜æ¥è‡ªåœ¨çº¿åº”ç”¨çš„I/Oè¯·æ±‚ã€‚&lt;strong&gt;NVMeé©±åŠ¨ç¨‹åºé€šè¿‡ç®¡ç†å‘˜é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥NVMeæ§åˆ¶å™¨é€‰æ‹©ä¸€ç§æ–°çš„é˜Ÿåˆ—è°ƒåº¦æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å§‹ç»ˆä¼˜å…ˆå®‰æ’è¯¥SQä¸­çš„è¯·æ±‚ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœªæ¥é¿å…å› ä¼˜å…ˆçº§å¸¦æ¥çš„é¥¥é¥¿ï¼Œå½“è¯¥é˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ•°é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œæˆ–è€…æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…è¢«æ»¡è¶³ï¼ŒNVMeé©±åŠ¨ä¼šæ»¡è¶³æ‰€æœ‰ç¦»çº¿åº”ç”¨I/O ã€‚&lt;/p&gt;
&lt;p&gt;å®éªŒè¡¨æ˜ï¼Œé˜Ÿåˆ—å¤§å°ä¸º8æˆ–è€…200usçš„é˜ˆå€¼æœ€å¥½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;40-io-completionå’Œç¼“å­˜&#34;&gt;4.0 I/O Completionå’Œç¼“å­˜&lt;/h1&gt;
&lt;p&gt;é‡‡ç”¨è½®è¯¢æœºåˆ¶æ—¶æŸ¥è¯¢I/O Completionæ—¶ï¼Œå†…æ ¸æ€å ç”¨97%ã€‚&lt;/p&gt;
&lt;p&gt;å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ²¡æœ‰ä¸ºå¤„ç†I/O å“åº”å•ç‹¬åˆ†é…æ ¸å¿ƒï¼Œå¯¹äºå¤šè¿›ç¨‹ä¸‹ä½æ•ˆ&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬è¦å‡è½»å¤„ç†I/Oè½®è¯¢çš„æ ¸å¿ƒå¼€é”€ï¼Œè¿›ä¸€æ­¥é™ä½å»¶è¿Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;41-ä¸­æ–­å¤„ç†ç¨‹åº&#34;&gt;4.1 ä¸­æ–­å¤„ç†ç¨‹åº&lt;/h2&gt;
&lt;p&gt;flash shareä»…å¯¹æ¥è‡ªåœ¨çº¿åº”ç”¨çš„I/O è¯·æ±‚ä½¿ç”¨è½®è¯¢&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¿¡å·å¤„ç†ç¦»çº¿åº”ç”¨&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811231355037.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811231355037&#34;
	
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®æ”¹blk-mqä¸­çš„&lt;code&gt;submit_bio()&lt;/code&gt;ï¼Œå°†ç”±æ–‡ä»¶ç³»ç»Ÿæˆ–ç¼“å­˜çš„bioæ’å…¥åˆ°mq&lt;/li&gt;
&lt;li&gt;å¦‚æœbioæ˜¯æ¥è‡ªç¦»çº¿åº”ç”¨çš„ï¼Œåˆ™æ’å…¥é˜Ÿåˆ—ï¼Œas normal&lt;/li&gt;
&lt;li&gt;å¦‚æœbioæ˜¯æ¥è‡ªåœ¨çº¿åº”ç”¨çš„ï¼Œblk-mqåˆ™è°ƒç”¨&lt;code&gt;queue_rq()&lt;/code&gt;å°†è¯·æ±‚å‘é€è‡³NVMeé©±åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;NVMeé©±åŠ¨è½¬æ¢I/O è¯·æ±‚ä¸ºNVMeæŒ‡ä»¤å¹¶éæ’å…¥åˆ°å“åº”SQé˜Ÿåˆ—ä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½¿ç”¨Select-ISRï¼Œå½“è¯·æ±‚ä¸ºç¦»çº¿åº”ç”¨æ—¶ï¼ŒCPUæ ¸å¿ƒå¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢ä»NVMeé©±åŠ¨ä¸­é‡Šæ”¾ã€‚å¦åˆ™ï¼Œblk-mqè°ƒç”¨è½®è¯¢æœºåˆ¶&lt;code&gt;blk-poll()&lt;/code&gt;ã€‚&lt;code&gt;blk-poll()&lt;/code&gt;æŒç»­è°ƒç”¨&lt;code&gt;nvme_poll()&lt;/code&gt;ï¼Œæ£€æŸ¥æœ‰æ•ˆçš„å®Œæˆè®°å½•æ˜¯å¦å­˜åœ¨äºç›®æ ‡NVMe CQä¸­ã€‚å¦‚æœå­˜åœ¨ï¼Œblk-mqç¦ç”¨æ­¤CQçš„IRQï¼Œä»¥è‡³äºMSIä¿¡å·æ— æ³•å†æ¬¡æ•è·blk-mqç¨‹åºã€‚&lt;code&gt;nvme_poll()&lt;/code&gt;é€šè¿‡æ£€æŸ¥CQä¸­çš„phase tagsæŸ¥æ‰¾CQä¸­çš„æ–°è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œ&lt;code&gt;nvme poll()&lt;/code&gt;æœç´¢ä¸€ä¸ªCQè®°å½•ï¼Œå…¶è¯·æ±‚ä¿¡æ¯ä¸&lt;code&gt;blk poll()&lt;/code&gt;ç­‰å¾…å®Œæˆçš„æ ‡ç­¾åŒ¹é…ã€‚ä¸€æ—¦æ£€æµ‹åˆ°è¿™æ ·çš„æ–°è®°å½•ï¼Œblk-mqå°±ä¼šé€€å‡ºåœ¨&lt;code&gt;blk poll()&lt;/code&gt;ä¸­å®ç°çš„æ— é™è¿­ä»£ï¼Œå¹¶å°†ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å…¶ç”¨æˆ·è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æå‡º&lt;code&gt;I/O-stack accelerator&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦ç›®çš„æ˜¯å°†blk-mqçš„ä»»åŠ¡è¿ç§»åˆ°é™„å±äºPCIeçš„åŠ é€Ÿå™¨ä¸­&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿å¾—é€šè¿‡ä¸Šå±‚æ–‡ä»¶ç³»ç»Ÿç”Ÿæˆçš„bioç›´æ¥è½¬æ¢æˆ&lt;code&gt;nvm_rw_command&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç‰¹æ®Šçš„tagç´¢å¼•æœç´¢é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œå¹¶ä¸”ä»£è¡¨CPUåˆå¹¶bio&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹æ³•å¯ä»¥å‡å°‘36%çš„I/O completionæ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;42-å›ºä»¶å±‚&#34;&gt;4.2 å›ºä»¶å±‚&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºä¸¤ä¸ªå†…å­˜åˆ†åŒºï¼Œä¸€ä¸ªæœåŠ¡äºåœ¨çº¿åº”ç”¨ï¼Œä¸€ä¸ªæœåŠ¡äºç¦»çº¿åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰ç§æ¨¡å¼&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å›ºå®šæ‹†åˆ†ç¼“å­˜&lt;/li&gt;
&lt;li&gt;æ ¹æ®I/OåŠ¨æ€åˆ’åˆ†&lt;/li&gt;
&lt;li&gt;æ•°æ®å¯ä¿ç•™&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220812003132031.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220812003132031&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;43-io-stack-acceleration&#34;&gt;4.3 I/O-Stack Acceleration&lt;/h2&gt;
&lt;p&gt;æ·»åŠ äº†ä¸€ä¸ªbarrier logicï¼Œç®€å•çš„MUXï¼Œä½œä¸ºç¡¬ä»¶ä»²è£&lt;/p&gt;
&lt;p&gt;å¼•å…¥status bitmapæ¥è¿‡æ»¤SQé˜Ÿåˆ—ä¸­çš„è®°å½•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå¹¶é€»è¾‘æ’å…¥ä¸€ä¸ªè¡Œçš„nvme æŒ‡ä»¤ï¼Œstatus bitmapè®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;å¦‚æœç›‘æµ‹åˆ°ULL SSDä»I/O SQä¸­è¯»å–NVMeæŒ‡ä»¤ï¼Œstatus bitmapè®¾ç½®ä¸º0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœçŠ¶æ€ä½å›¾è¡¨æ˜CAMä¸­çš„è¯·æ±‚æ¡ç›®ï¼ˆä¸ç›®æ ‡SQç›¸å…³è”ï¼‰æ— æ•ˆï¼ŒCAMå°†è·³è¿‡å¯¹è¿™äº›æ¡ç›®çš„æœç´¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;50-å®éªŒ&#34;&gt;5.0 å®éªŒ&lt;/h1&gt;
&lt;h2 id=&#34;51-å®éªŒæ­¥éª¤&#34;&gt;5.1 å®éªŒæ­¥éª¤&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨gem5ç³»ç»Ÿç»“æ„æ¨¡æ‹Ÿ&lt;/p&gt;
&lt;p&gt;64ä½armæŒ‡ä»¤é›†&lt;/p&gt;
&lt;p&gt;Linux 4.9.30&lt;/p&gt;
&lt;p&gt;8æ ¸å¿ƒ2GHz&lt;/p&gt;
&lt;p&gt;L1 Cache 64KB&lt;/p&gt;
&lt;p&gt;2GB Memory&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220812191343849.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220812191343849&#34;
	
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;related-work&#34;&gt;Related Work&lt;/h1&gt;
&lt;p&gt;å°†SSDå›ºä»¶è½¬ç§»åˆ°ä¸»æœºä¸Šï¼Œæ¶ˆé™¤å†—ä½™çš„åœ°å€è½¬æ¢&lt;/p&gt;
&lt;p&gt;æ ¹æ®åº”ç”¨ç¨‹åºç‰¹å¾å¯¹ç¼“å­˜è¿›è¡Œåˆ†åŒºå¤„ç†ï¼Œç„¶è€Œä¸èƒ½å‘æŒ¥ULL SSDçš„ä½œç”¨&lt;/p&gt;
&lt;p&gt;ä»æ–‡ä»¶ç³»ç»Ÿå’Œblock IOè®¾å¤‡æ–¹é¢ä¼˜åŒ–ç§»åŠ¨ç«¯æ“ä½œç³»ç»Ÿï¼Œä½¿å…¶æé«˜SQLiteçš„æ€§èƒ½ï¼Œæœ‰å±€é™æ€§ï¼Œåº”ç”¨ç¨‹åºã€ULL SSD&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸çš„å¤šä¸ªå±‚å¯¹å†™è¯·æ±‚è¿›è¡Œè°ƒåº¦ï¼Œå®¹æ˜“é˜»å¡è¯»è¯·æ±‚å’ŒULLæ“ä½œ&lt;/p&gt;
&lt;p&gt;æ ¹æ®å‰å°ä»»åŠ¡å’Œåå°ä»»åŠ¡ä¸­çš„ä¾èµ–å…³ç³»ï¼Œåˆ†é…ä¼˜å…ˆçº§ï¼Œå…è®¸åå°ä»»åŠ¡é«˜ä¼˜å…ˆçº§ï¼ŒIOé€šå¸¸æƒ…å†µä¸‹æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œæ•ˆæœå·®ï¼ŒæœåŠ¡å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šè¿›ç¨‹&lt;/p&gt;
&lt;p&gt;è€ƒè™‘å¯¹åœ¨çº¿åº”ç”¨è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼Œä½†æ˜¯æ²¡æœ‰è€ƒè™‘å¯¹IO stackä¸­å…¶ä»–éƒ¨åˆ†çš„å½±å“&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ã€æ“ä½œç³»ç»Ÿã€‘ç³»ç»Ÿçº§IO</title>
        <link>https://blog.ipandai.club/p/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%B3%BB%E7%BB%9F%E7%BA%A7io/</link>
        <pubDate>Mon, 03 Jan 2022 10:31:33 +0000</pubDate>
        
        <guid>https://blog.ipandai.club/p/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%B3%BB%E7%BB%9F%E7%BA%A7io/</guid>
        <description>&lt;p&gt;é«˜çº§åˆ«çš„IOç¨‹åºï¼Œå¦‚cä¸­çš„printfå’Œscanfï¼Œc++ä¸­çš„&lt;code&gt;&amp;gt;&amp;gt;&lt;/code&gt;å’Œ&lt;code&gt;&amp;lt;&amp;lt;&lt;/code&gt;ï¼Œéƒ½ä¾èµ–Unix ç³»ç»Ÿçº§IO&lt;/p&gt;
&lt;p&gt;CSAPP Ch-10 ç¬”è®°&lt;/p&gt;
&lt;h2 id=&#34;unix-io&#34;&gt;Unix IO&lt;/h2&gt;
&lt;p&gt;Linuxæ–‡ä»¶å³æ˜¯mä¸ªå­—èŠ‚çš„åºåˆ—$B_0, B_1, &amp;hellip;, B_k, &amp;hellip;, B_{m-1}$&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„IOè®¾å¤‡ï¼ˆç½‘ç»œï¼Œç£ç›˜ï¼Œç»ˆç«¯ï¼‰è¢«æŠ½è±¡ä¸ºæ–‡ä»¶ï¼Œè¾“å…¥å’Œè¾“å‡ºè¢«ä½œä¸ºç›¸åº”æ–‡ä»¶çš„è¯»å’Œå†™è¿›è¡Œï¼ŒLinuxå†…æ ¸åªéœ€è¦æš´éœ²ä¸€ä¸ªç®€å•ä½çº§çš„åº”ç”¨æ¥å£&lt;/p&gt;
&lt;p&gt;è¾“å…¥å’Œè¾“å‡ºçš„ç»Ÿä¸€æ–¹å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€æ–‡ä»¶ï¼šåº”ç”¨ç¨‹åºè¯·æ±‚IOè®¾å¤‡ï¼Œå†…æ ¸è¿”å›æè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;Linux Shellåˆ›å»ºçš„è¿›ç¨‹å¼€å§‹æ—¶æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼šæ ‡å‡†è¾“å…¥0ï¼Œæ ‡å‡†è¾“å‡º1ï¼Œæ ‡å‡†é”™è¯¯2&lt;/li&gt;
&lt;li&gt;æ”¹å˜å½“å‰çš„æ–‡ä»¶ä½ç½®ï¼šå†…æ ¸å­˜å‚¨æ–‡ä»¶ä½ç½®kï¼Œåˆå§‹ä¸º0ï¼Œé€šè¿‡seekæ”¹å˜è¿™ä¸ªåç§»é‡&lt;/li&gt;
&lt;li&gt;è¯»å†™æ–‡ä»¶ï¼šè¯»ä¸ºå¤åˆ¶å­—èŠ‚åˆ°å†…å­˜ï¼Œå½“k&amp;gt;=mæ—¶ï¼Œä¼šè§¦å‘EOFæ¡ä»¶ï¼›å†™ä¸ºå¤åˆ¶å­—èŠ‚åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»å½“å‰ä½ç½®kå¼€å§‹ï¼Œç„¶åæ›´æ–°k&lt;/li&gt;
&lt;li&gt;å…³é—­æ–‡ä»¶ï¼šé€šçŸ¥å†…æ ¸ï¼Œå†…æ ¸é‡Šæ”¾æ–‡ä»¶æ‰“å¼€æ—¶åˆ›å»ºçš„æ•°æ®ç»“æ„ï¼Œé‡Šæ”¾æè¿°ç¬¦ï¼Œè¿›ç¨‹ç»ˆæ­¢æ—¶å†…æ ¸ä¼šé‡Šæ”¾æ‰“å¼€çš„æ–‡ä»¶ä»¥åŠå†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–‡ä»¶&#34;&gt;æ–‡ä»¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šæ–‡ä»¶ï¼šæ–‡æœ¬æ–‡ä»¶ï¼šASCIIæˆ–Unicodeå­—ç¬¦æ–‡ä»¶ï¼Œå…¶ä»–çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹å†…æ ¸è€Œè¨€æ— åŒºåˆ«ï¼Œæ¢è¡Œç¬¦&lt;code&gt;\n&lt;/code&gt;å¯¹åº”ASCII LF&lt;/li&gt;
&lt;li&gt;ç›®å½•ï¼šåŒ…å«ä¸€ç»„é“¾æ¥çš„æ–‡ä»¶ï¼Œé“¾æ¥å°†æ–‡ä»¶åæ˜ å°„åˆ°ä¸€ä¸ªæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;å¥—æ¥å­—socketï¼šä¸å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œè·¨ç½‘ç»œé€šä¿¡çš„æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;å‘½åé€šé“named pipeï¼Œç¬¦å·é“¾æ¥ï¼Œå­—ç¬¦å’Œå—è®¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»å¯¹è·¯å¾„ï¼šä»¥æ–œæ å¼€å§‹&lt;code&gt;/home/test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç›¸å¯¹è·¯å¾„ï¼šä»¥æ–‡ä»¶åå¼€å§‹,&lt;code&gt;../test&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ‰“å¼€å’Œå…³é—­æ–‡ä»¶&#34;&gt;æ‰“å¼€å’Œå…³é—­æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;openå‡½æ•°æ‰“å¼€æˆ–åˆ›å»ºæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨è¿›ç¨‹ä¸­æ²¡æœ‰æ‰“å¼€çš„æœ€å°æè¿°ç¬¦
å‡ ç§æ§åˆ¶å‚æ•°flags&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_RDONLY&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åªè¯»&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_WRONLY&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åªå†™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_RDWR&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;å¯è¯»å¯å†™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_CREAT&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºç©ºæ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_TRUNC&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;å­˜åœ¨åˆ™æˆªæ–­ï¼Œæ¸…ç©º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;O_APPEND&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;è¿½åŠ å†™å…¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;modeå‚æ•°æ§åˆ¶è¯»å†™æƒé™&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰umask&lt;/p&gt;
&lt;p&gt;è®¿é—®æƒé™ä¸º&lt;code&gt;mode &amp;amp; ~umask&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;close(int fd)å…³é—­æ–‡ä»¶ï¼ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥-1&lt;/p&gt;
&lt;h2 id=&#34;è¯»å†™æ–‡ä»¶&#34;&gt;è¯»å†™æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;readå’Œwrite&lt;/p&gt;
&lt;p&gt;è¾“å…¥çš„sizeä¸ºunsigned longç±»å‹ï¼Œssize_tä¸ºlongç±»å‹ï¼Œå› ä¸ºreadå’Œwriteå‡½æ•°éœ€è¦è¿”å›-1&lt;/p&gt;
&lt;p&gt;readå’Œwriteè¯»å†™é‡åˆ°ä¸è¶³çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–æ—¶é‡åˆ°EOF&lt;/li&gt;
&lt;li&gt;ä»ç»ˆç«¯è¯»æ–‡æœ¬è¡Œ&lt;/li&gt;
&lt;li&gt;è¯»å†™socketï¼šç½‘ç»œå»¶è¿Ÿå¯¼è‡´readå’Œwriteè¿”å›å€¼ä¸è¶³&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rioåŒ…-robust-io&#34;&gt;RIOåŒ… Robust IO&lt;/h2&gt;
&lt;h2 id=&#34;è¯»å–æ–‡ä»¶å…ƒæ•°æ®&#34;&gt;è¯»å–æ–‡ä»¶å…ƒæ•°æ®&lt;/h2&gt;
&lt;p&gt;statå’Œfstatå‡½æ•°ï¼Œè¯»å–æ–‡ä»¶ä¿¡æ¯&lt;/p&gt;
&lt;h2 id=&#34;è¯»å–ç›®å½•å†…å®¹&#34;&gt;è¯»å–ç›®å½•å†…å®¹&lt;/h2&gt;
&lt;p&gt;opendirå‡½æ•°&lt;/p&gt;
&lt;h2 id=&#34;å…±äº«æ–‡ä»¶&#34;&gt;å…±äº«æ–‡ä»¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æè¿°ç¬¦è¡¨ï¼Œæ¯ä¸ªè¿›ç¨‹ä¹‹é—´ç‹¬ç«‹&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶è¡¨ï¼Œæ‰“å¼€æ–‡ä»¶çš„é›†åˆï¼Œæ‰€æœ‰è¿›ç¨‹å…±äº«ï¼ŒåŒ…å«æ–‡ä»¶ä½ç½®ï¼Œå¼•ç”¨è®¡æ•°ï¼ŒæŒ‡å‘vnodeè¡¨çš„æŒ‡é’ˆï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆ é™¤è¡¨é¡¹&lt;/li&gt;
&lt;li&gt;v-nodeï¼Œè¿›ç¨‹é—´å…±äº«ï¼ŒåŒ…å«statä¸­çš„ä¿¡æ¯ï¼Œst modeï¼Œst size&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ioé‡å®šå‘&#34;&gt;IOé‡å®šå‘&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ ‡å‡†è¾“å‡º&lt;/strong&gt;é‡å®šå‘åˆ°ç£ç›˜æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;è¦†ç›–å†™å…¥æ–‡ä»¶ä¹‹å‰çš„å†…å®¹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨dup2å‡½æ•°ï¼Œå°†ç»ˆç«¯çš„è¾“å‡ºå…³é—­ï¼Œæ”¹ä¸ºç£ç›˜æ–‡ä»¶ï¼Œç£ç›˜æ–‡ä»¶å¼•ç”¨æ¬¡æ•°+1&lt;/p&gt;
&lt;h2 id=&#34;æ ‡å‡†io&#34;&gt;æ ‡å‡†IO&lt;/h2&gt;
&lt;p&gt;æ ‡å‡†IOå°†æ‰“å¼€çš„æ–‡ä»¶æ¨¡å‹åŒ–ä¸ºä¸€ä¸ªæµï¼Œå‡å°‘ç³»ç»Ÿçº§IOæ“ä½œçš„è°ƒç”¨&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡getcè°ƒç”¨IO readå‡½æ•°è¯»å–åˆ°ç¼“å†²åŒºï¼Œä¹‹åè°ƒç”¨å°†ç¼“å†²åŒºç¬¬ä¸€ä¸ªå­—èŠ‚è¿”å›ç»™åº”ç”¨ç¨‹åº&lt;/p&gt;
&lt;h2 id=&#34;é€‰å–ioå‡½æ•°é—®é¢˜&#34;&gt;é€‰å–IOå‡½æ•°é—®é¢˜&lt;/h2&gt;
&lt;p&gt;socketä¸­ä¸è¦ä½¿ç”¨æ ‡å‡†IOï¼Œå¯èƒ½ä¼šå¯¼è‡´å´©æºƒï¼Œä½¿ç”¨RIOå‡½æ•°/Unix IO&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
