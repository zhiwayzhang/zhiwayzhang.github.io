<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Paper on Coding_Panda&#39;s Blog</title>
        <link>https://blog.ipandai.club/tags/paper/</link>
        <description>Recent content in Paper on Coding_Panda&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 02 Mar 2023 15:11:40 +0800</lastBuildDate><atom:link href="https://blog.ipandai.club/tags/paper/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>[FAST&#39;23] More Than Capacity: Performance-oriented Evolution of Pangu in Alibaba</title>
        <link>https://blog.ipandai.club/p/fast23-more-than-capacity-performance-oriented-evolution-of-pangu-in-alibaba/</link>
        <pubDate>Thu, 02 Mar 2023 15:11:40 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/fast23-more-than-capacity-performance-oriented-evolution-of-pangu-in-alibaba/</guid>
        <description>&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast23/presentation/li-qiang-deployed&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[FAST&#39;23] More Than Capacity: Performance-oriented Evolution of Pangu in Alibaba&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;FAST&#39;23 ä¼šè®®è®ºæ–‡ç¿»è¯‘ï¼Œã€Šä¸ä»…ä»…æ˜¯å®¹é‡:ç›˜å¤é¢å‘æ€§èƒ½çš„æ¼”å˜ã€‹&lt;/p&gt;
&lt;p&gt;æœ¬è®ºæ–‡è®²è¿°äº†Panguå­˜å‚¨ç³»ç»Ÿæ˜¯å¦‚ä½•éšç€ç¡¬ä»¶åŠå•†ä¸šéœ€æ±‚ï¼Œå»æ¼”å˜æä¾›æ›´é«˜çš„æ€§èƒ½çš„ï¼Œå­˜å‚¨æœåŠ¡çš„I/Oå»¶è¿Ÿè¾¾åˆ°äº†100-usã€‚ç›˜å¤çš„æ¼”å˜ä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Phase 1: ç›˜å¤é€šè¿‡ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿå¹¶è®¾è®¡äº†ç”¨æˆ·ç«¯çš„å­˜å‚¨æ“ä½œç³»ç»Ÿï¼Œç§¯æå¼•å…¥é«˜é€ŸSSDå’ŒRemote Direct Memory Access(RDMA)ç½‘ç»œæŠ€æœ¯ã€‚å› æ­¤ï¼Œç›˜å¤åœ¨æœ‰æ•ˆé™ä½äº†I/Oå»¶è¿Ÿçš„åŒæ—¶ï¼Œè¿˜æé«˜äº†ååé‡å’ŒIOPSã€‚&lt;/li&gt;
&lt;li&gt;Phase 2: ç›˜å¤ä»é¢å‘å·çš„å­˜å‚¨ä¾›åº”å•†è½¬å˜ä¸ºé¢å‘æ€§èƒ½ã€‚ä¸ºäº†é€‚åº”è¿™ä¸€å•†ä¸šæ¨¡å¼çš„æ”¹å˜ï¼Œç›˜å¤ä½¿ç”¨è¶³å¤Ÿå¤šçš„SSDå’Œ25Gbps-100Gbpsçš„RDMAå¸¦å®½æ›´æ–°äº†åŸºç¡€è®¾æ–½ã€‚è¿™å¼•å…¥äº†ä¸€äº›åˆ—çš„å…³é”®è®¾è®¡ï¼ŒåŒ…æ‹¬å‡å°‘æµé‡æ”¾å¤§ï¼Œè¿œç¨‹ç›´æ¥ç¼“å­˜è®¿é—®ï¼Œå’ŒCPUè®¡ç®—å¸è½½ï¼Œæ¥ä¿è¯ç›˜å¤å®Œå…¨è·å¾—åŸºäºç¡¬ä»¶å‡çº§æ‰€å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é™¤äº†æŠ€æœ¯ä¸Šçš„åˆ›æ–°ï¼Œä½œè€…è¿˜åˆ†äº«äº†ç›˜å¤å‘å±•è¿‡ç¨‹ä¸­çš„è¿è¥ç»éªŒï¼Œå¹¶è®¨è®ºäº†å…¶ä¸­çš„é‡è¦æ•™è®­ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;ç›˜å¤çš„å¼€å‘å§‹äº2009å¹´ï¼Œç›®å‰å·²ç»æ˜¯é˜¿é‡Œå·´å·´é›†å›¢å’Œé˜¿é‡Œäº‘ç»Ÿä¸€å­˜å‚¨å¹³å°ã€‚ç›˜å¤ä¸ºé˜¿é‡Œçš„æ ¸å¿ƒä¸šåŠ¡æä¾›äº†å¯ä¼¸ç¼©æ€§ã€é«˜æ€§èƒ½å’Œå¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Elastic Block Storage(EBS), Object Storage Service(OSS), Network-Attached Storage(NAS), PolarDB, MaxComputeè¿™äº›äº‘æœåŠ¡åŸºäºç›˜å¤å»ºç«‹ã€‚ç»è¿‡åå‡ å¹´çš„å‘å±•ï¼Œç›˜å¤å·²ç»æˆä¸ºäº†ä¸€ä¸ªæ‹¥æœ‰ExaByteså¹¶ç®¡ç†ä¸‡äº¿æ–‡ä»¶çš„å…¨å±€å­˜å‚¨ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›˜å¤-10-æä¾›å­˜å‚¨å®¹é‡&#34;&gt;ç›˜å¤ 1.0: æä¾›å­˜å‚¨å®¹é‡&lt;/h2&gt;
&lt;p&gt;Pangu 1.0è®¾è®¡äº2009-2015å¹´ï¼Œé€šè¿‡é«˜æ€§èƒ½çš„CPUå’ŒHDDç»„æˆï¼Œå¯ä»¥æä¾›msæ¯«ç§’çº§åˆ«çš„I/Oå»¶è¿Ÿå’ŒGbpsçº§åˆ«çš„&lt;strong&gt;æ•°æ®ä¸­å¿ƒå¸¦å®½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Pangu 1.0åŸºäºLinux Ext4è®¾è®¡äº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„å†…æ ¸æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸TCPï¼Œå¹¶ç»™äºˆä¸åŒç§ç±»çš„å­˜å‚¨æœåŠ¡æä¾›å¤šç§æ–‡ä»¶ç±»å‹æ”¯æŒï¼ˆTempfileï¼ŒLogFileï¼ŒRandom Access fileï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶æ­£å¤„äºäº‘è®¡ç®—çš„åˆå§‹é˜¶æ®µï¼Œæ€§èƒ½å—é™äºHDDæ€§èƒ½å’Œç½‘ç»œå¸¦å®½ï¼Œç›¸è¾ƒäºæ›´å¿«çš„è®¿é—®é€Ÿåº¦ï¼Œç”¨æˆ·æ›´å…³æ³¨å­˜å‚¨å®¹é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–°çš„ç¡¬ä»¶æ–°çš„è®¾è®¡&#34;&gt;æ–°çš„ç¡¬ä»¶ï¼Œæ–°çš„è®¾è®¡&lt;/h2&gt;
&lt;p&gt;è‡ª2015å¹´èµ·ï¼Œä¸ºäº†å¼•å…¥æ–°å…´çš„SSDå’ŒRDMAæŠ€æœ¯ï¼Œç›˜å¤2.0å¼€å§‹è®¾è®¡å’Œå¼€å‘ã€‚ç›˜å¤2.0çš„ç›®æ ‡æ˜¯æä¾›100usçº§åˆ«I/Oå»¶è¿Ÿçš„é«˜æ€§èƒ½çš„å­˜å‚¨æœåŠ¡ã€‚å°½ç®¡SSDå’ŒRDMAåœ¨å­˜å‚¨å’Œç½‘ç»œä¸­å®ç°ä½å»¶è¿Ÿã€é«˜æ€§èƒ½çš„I/Oï¼Œå›¢é˜Ÿå‘ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›˜å¤1.0ä¸­ä½¿ç”¨çš„å¤šç§æ–‡ä»¶ç±»å‹ï¼Œç‰¹åˆ«æ˜¯å…è®¸éšæœºè®¿é—®çš„æ–‡ä»¶ç±»å‹ï¼Œåœ¨å›ºæ€ç¡¬ç›˜ä¸Šçš„è¡¨ç°å¾ˆå·®ï¼Œè€Œå›ºæ€ç¡¬ç›˜åœ¨é¡ºåºæ“ä½œä¸Šå¯ä»¥å®ç°é«˜ååé‡å’ŒIOPSã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºæ•°æ®å¤åˆ¶å’Œé¢‘ç¹çš„ä¸­æ–­ï¼Œå†…æ ¸ç©ºé—´çš„è½¯ä»¶æ ˆæ— æ³•è·Ÿä¸ŠSSDå’ŒRDMAçš„é«˜IOPSå’Œä½I/Oå»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;ä»ä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„æ•°æ®ä¸­å¿ƒæ¶æ„å‘èµ„æºåˆ†æ•£çš„æ•°æ®ä¸­å¿ƒæ¶æ„çš„èŒƒå¼è½¬å˜ï¼Œå¯¹å®ç°ä½I/Oå»¶è¿Ÿæå‡ºäº†é¢å¤–çš„æŒ‘æˆ˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç›˜å¤20-phase-1-é€šè¿‡é‡æ„æ–‡ä»¶ç³»ç»Ÿä¸ç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿæ¥æ‹¥æŠ±ssdå’Œrdma&#34;&gt;ç›˜å¤2.0 Phase 1: é€šè¿‡é‡æ„æ–‡ä»¶ç³»ç»Ÿä¸ç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿæ¥æ‹¥æŠ±SSDå’ŒRDMA&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†å®ç°é«˜æ€§èƒ½å’Œä½I/Oå»¶è¿Ÿï¼Œç›˜å¤2.0é¦–å…ˆåœ¨å…¶æ–‡ä»¶ç³»ç»Ÿä¸­çš„å…³é”®ç»„ä»¶æå‡ºäº†æ–°çš„è®¾è®¡ã€‚ä¸ºäº†ç®€åŒ–æ•´ä¸ªç³»ç»Ÿçš„å¼€å‘å’Œç®¡ç†ï¼Œç›˜å¤è®¾è®¡äº†ä¸€ä¸ªç»Ÿä¸€ã€è¿½åŠ å†™å…¥çš„æŒä¹…åŒ–å±‚ã€‚å®ƒè¿˜å¼•å…¥äº†ä¸€ä¸ªç‹¬ç«‹çš„åˆ†å—å¸ƒå±€ï¼Œä»¥å‡å°‘æ–‡ä»¶å†™å…¥æ“ä½œçš„I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›˜å¤2.0è®¾è®¡äº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„å­˜å‚¨æ“ä½œç³»ç»Ÿï¼ˆUSSOSï¼‰ï¼ŒUSSOSSä½¿ç”¨ä¸€ä¸ªRTC(Run to completion)çº¿ç¨‹æ¨¡å‹æ¥å®ç°ç”¨æˆ·ç©ºé—´å­˜å‚¨æ ˆå’Œç”¨æˆ·ç©ºé—´ç½‘ç»œæ ˆçš„é«˜æ•ˆåä½œã€‚å®ƒè¿˜ä¸ºé«˜æ•ˆçš„CPUå’Œå†…å­˜èµ„æºåˆ†é…æå‡ºäº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›˜å¤2.0éƒ¨ç½²äº†åœ¨åŠ¨æ€ç¯å¢ƒä¸‹æä¾›SLAä¿è¯çš„æœºåˆ¶ã€‚é€šè¿‡è¿™äº›åˆ›æ–°ï¼Œç›˜å¤2.0å®ç°äº†æ¯«ç§’çº§åˆ«çš„P999 I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç›˜å¤20-phase-2-é€šè¿‡åŸºç¡€è®¾æ–½æ›´æ–°å’Œçªç ´ç½‘ç»œå†…å­˜cpuç“¶é¢ˆé€‚åº”ä»¥æ€§èƒ½ä¸ºå¯¼å‘çš„ä¸šåŠ¡æ¨¡å¼&#34;&gt;ç›˜å¤2.0 Phase 2: é€šè¿‡åŸºç¡€è®¾æ–½æ›´æ–°å’Œçªç ´ç½‘ç»œ/å†…å­˜/CPUç“¶é¢ˆï¼Œé€‚åº”ä»¥æ€§èƒ½ä¸ºå¯¼å‘çš„ä¸šåŠ¡æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;2018å¹´èµ·ï¼Œç›˜å¤é€æ¸ä»å®¹é‡å¯¼å‘çš„å•†ä¸šæ¨¡å¼è½¬å˜ä¸ºæ€§èƒ½å¯¼å‘ã€‚è¿™æ˜¯å› ä¸ºè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šç”¨æˆ·å°†ä»–ä»¬çš„ä¸šåŠ¡è½¬ç§»åˆ°äº†é˜¿é‡Œäº‘å¹¶ä¸”ä»–ä»¬å¯¹å­˜å‚¨æ€§èƒ½çš„å»¶è¿Ÿå’Œæ€§èƒ½æœ‰å¾ˆä¸¥æ ¼çš„è¦æ±‚ã€‚è¿™åœ¨COVID-19ç–«æƒ…çˆ†å‘ä¹‹åå˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œä¸ºäº†é€‚åº”è¿™ä¸€å•†ä¸šæ¨¡å¼è½¬å˜å’Œæ—¥ç›Šå¢é•¿çš„ç”¨æˆ·ï¼Œç›˜å¤2.0éœ€è¦ç»§ç»­å‡çº§åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨åŸæœ‰çš„æœåŠ¡å™¨å’Œäº¤æ¢æœºæ²¿ç€åŸºäºCLOSæ¶æ„çš„æ‹“æ‰‘ç»“æ„æ¥å¯¹åŸºç¡€è®¾æ–½è¿›è¡Œæ‰©å®¹æ˜¯ä¸ç»æµçš„ï¼ŒåŒ…æ‹¬é«˜æ˜‚çš„æ€»æˆæœ¬ï¼ˆæœºæ¶ç©ºé—´ã€ç”µåŠ›ã€æ•£çƒ­ã€äººåŠ›æˆæœ¬ï¼‰å’Œæ›´é«˜çš„ç¢³æ’æ”¾/ç¯å¢ƒé—®é¢˜ã€‚å› æ­¤ï¼Œç›˜å¤å¼€å‘æ¥å®¤å†…é«˜å®¹é‡å­˜å‚¨æœåŠ¡å™¨ï¼ˆæ¯ä¸ªæœåŠ¡å™¨96TB SSDï¼‰å¹¶ä¸”å‡çº§åˆ°äº†25Gbps-100Gbpsçš„ç½‘ç»œå¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œå…¨è·å¾—è¿™äº›å‡çº§å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œç›˜å¤2.0æå‡ºäº†ä¸€ç³»åˆ—çš„æŠ€æœ¯æ¥å¤„ç†åœ¨{ç½‘ç»œ/å†…å­˜/CPU}çš„æ€§èƒ½ç“¶é¢ˆå¹¶å……åˆ†åˆ©ç”¨å…¶å¼ºå¤§çš„ç¡¬ä»¶èµ„æºã€‚å…·ä½“æ¥è¯´ï¼Œç›˜å¤2.0é€šè¿‡å‡å°‘ç½‘ç»œæµé‡æ”¾å¤§ç‡å’ŒåŠ¨æ€è°ƒæ•´ä¸åŒæµé‡çš„ä¼˜å…ˆçº§æ¥ä¼˜åŒ–ç½‘ç»œå¸¦å®½ï¼›é€šè¿‡æå‡ºRemote Direct Cache Access(RDCA)æ¥å¤„ç†å†…å­˜ç“¶é¢ˆï¼›é€šè¿‡æ¶ˆé™¤æ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¼€é”€å¹¶å¼•å…¥CPUç­‰å¾…æŒ‡ä»¤æ¥åŒæ­¥è¶…çº¿ç¨‹ï¼Œä»¥æ­¤æ¥è§£å†³CPUç“¶é¢ˆé—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿäº§ä¸­çš„é«˜æ€§èƒ½&#34;&gt;ç”Ÿäº§ä¸­çš„é«˜æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;ç›˜å¤2.0æˆåŠŸæ”¯æŒäº†elastic SSD blockå­˜å‚¨æœåŠ¡ï¼Œå¹¶å¯è¾¾åˆ°100usçº§åˆ«çš„I/Oå»¶è¿Ÿå’Œ1Mçš„IOPSã€‚åœ¨2018å¹´åŒåä¸€æ´»åŠ¨ï¼Œç›˜å¤2.0åŠ æŒä¸‹çš„é˜¿é‡Œæ•°æ®åº“å®ç°äº†280usçš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºOTSå­˜å‚¨æœåŠ¡ï¼ŒåŒæ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ã€‚ç›˜å¤2.0çš„I/Oå»¶è¿Ÿæ¯”ç›˜å¤1.0é™ä½äº†ä¸€ä¸ªæ•°é‡çº§ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå†™æ•æ„Ÿçš„æœåŠ¡ï¼ˆEBSäº‘ç›˜ï¼‰ï¼ŒP999 I/Oå»¶è¿Ÿä½äº1msã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè¯»æ•æ„Ÿçš„æœåŠ¡ï¼ˆåœ¨çº¿æœç´¢ï¼‰ï¼ŒP999 I/Oå»¶è¿Ÿä½äº11msã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬äºŒé˜¶æ®µï¼Œé€šè¿‡å°†2x25Gbpså¸¦å®½å‡çº§åˆ°2x100Gbpsï¼Œå¹¶è§£å†³äº†ç½‘ç»œã€å†…å­˜ã€CPUç“¶é¢ˆï¼Œæ¯å°æ³°å±±å­˜å‚¨æœåŠ¡å™¨çš„æœ‰æ•ˆååé‡å¢åŠ äº†6.1å€ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Elastic SSD Block/EBSäº‘ç›˜ï¼šæ˜¯ä¸ºé˜¿é‡Œäº‘ä¸ºäº‘æœåŠ¡å™¨ECSæä¾›çš„ä½æ—¶å»¶ã€æŒä¹…æ€§ã€é«˜å¯é çš„å—çº§éšæœºå­˜å‚¨ã€‚å—å­˜å‚¨æ”¯æŒåœ¨å¯ç”¨åŒºå†…è‡ªåŠ¨å¤åˆ¶ç”¨æˆ·çš„æ•°æ®ï¼Œé˜²æ­¢æ„å¤–ç¡¬ä»¶æ•…éšœå¯¼è‡´çš„æ•°æ®ä¸å¯ç”¨ï¼Œä¿æŠ¤ä¸šåŠ¡å…äºç¡¬ä»¶æ•…éšœçš„å¨èƒã€‚&lt;/p&gt;
&lt;p&gt;OTSï¼šOpen Table Serviceï¼Œå·²æ›´åTable Storeï¼Œæ˜¯æ„å»ºåœ¨é˜¿é‡Œäº‘é£å¤©åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹ä¸Šçš„NoSQLæ•°æ®åº“æœåŠ¡ï¼Œæä¾›æµ·é‡ç»“æ„åŒ–æ•°æ®çš„å­˜å‚¨å’Œå®æ—¶è®¿é—®ã€‚Table Storeä»¥å®ä¾‹å’Œè¡¨çš„å½¢å¼ç»„ç»‡æ•°æ®ï¼Œé€šè¿‡æ•°æ®åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå®ç°è§„æ¨¡ä¸Šçš„æ— ç¼æ‰©å±•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x01-bg&#34;&gt;0x01 Bg&lt;/h1&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;ç›˜å¤æ˜¯å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œç”±ï¼šç›˜å¤æ ¸å¿ƒï¼Œç›˜å¤æœåŠ¡å±‚ï¼Œç›˜å¤ç›‘æ§ç³»ç»Ÿç»„æˆï¼ˆFigure 1ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230303140052844.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230303140052844&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤core&#34;&gt;ç›˜å¤Core&lt;/h3&gt;
&lt;p&gt;ç›˜å¤æ ¸å¿ƒç”±ï¼šclientsï¼Œmastersï¼Œchunk seversç»„æˆï¼Œæä¾›è¿½åŠ å†™å…¥çš„å­˜å‚¨è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Client&lt;/strong&gt;æä¾›è®¿é—®ç›˜å¤äº‘å­˜å‚¨æœåŠ¡ï¼ˆEBSï¼ŒOSSï¼‰çš„SDKï¼Œå¹¶è´Ÿè´£æ¥æ”¶ä»æœåŠ¡ç«¯å‘é€çš„æ–‡ä»¶è¯·æ±‚ï¼Œä¸masterså’Œchunk serversé€šä¿¡æ¥å®ç°è¿™äº›è¯·æ±‚ã€‚ç±»ä¼¼äºå…¶ä»–åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆTectonicï¼ŒColossusï¼‰ï¼Œç›˜å¤ä¸­çš„Clientsè´Ÿè´£è¾ƒé‡çš„å·¥ä½œå¹¶åœ¨ç›˜å¤çš„å¤åˆ¶ç®¡ç†ã€SLAä¿éšœã€æ•°æ®ä¸€è‡´æ€§ç®¡ç†ä¸­æ‰®æ¼”å…³é”®è§’è‰²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Master&lt;/strong&gt;ç®¡ç†ç›˜å¤ä¸­çš„æ‰€æœ‰å…ƒæ•°æ®å¹¶ä½¿ç”¨åŸºäºRaftçš„åè®®æ¥ç»´æŠ¤å…ƒæ•°æ®çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ã€‚ä¸ºäº†æ›´å¥½çš„æ°´å¹³æ‰©å±•æ€§å’Œå»¶ä¼¸æ€§ï¼ˆå¤§é‡çš„æ–‡ä»¶æ•°ï¼‰ï¼Œç›˜å¤masteråˆ†è§£å…ƒæ•°æ®æœåŠ¡ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šnamespaceæœåŠ¡å’Œstream metaæœåŠ¡ï¼Œstreamæ˜¯ä¸€ç»„chunkçš„æŠ½è±¡ã€‚è¿™ä¸¤ä¸ªæœåŠ¡é¦–å…ˆæ ¹æ®ç›®å½•æ ‘åˆ†éš”å…ƒæ•°æ®æ¥å®ç°å±€éƒ¨åŸæ•°æ®ï¼Œç„¶åé€šè¿‡å“ˆå¸Œå°†è¿™äº›streamè¿›ä¸€æ­¥åˆ†éš”ä»¥è¾¾åˆ°è´Ÿè½½å‡è¡¡ã€‚namespaceæœåŠ¡æä¾›æ–‡ä»¶çš„ä¿¡æ¯ï¼ˆç›®å½•æ ‘å’Œå‘½åç©ºé—´ï¼‰ï¼Œstreamå…ƒæ•°æ®æœåŠ¡æä¾›ä»æ–‡ä»¶åˆ°chunkçš„æ˜ å°„ï¼ˆchunkçš„ä½ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ChunkServers&lt;/strong&gt;ä»¥chunkå­˜å‚¨æ•°æ®å¹¶é…å¤‡æœ‰è‡ªå®šä¹‰çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿï¼ˆUSSFSï¼‰ï¼ŒUSSFSä¸ºä¸åŒç¡¬ä»¶ï¼ˆSMRSTORE for HM-SMR drivesï¼‰æä¾›é«˜æ€§èƒ½ï¼Œè¿½åŠ å†™å…¥çš„å­˜å‚¨å¼•æ“ã€‚åœ¨ç›˜å¤2.0çš„ç¬¬ä¸€é˜¶æ®µï¼Œæ¯ä¸ªå­˜å‚¨åœ¨chunkserversçš„æ–‡ä»¶éƒ½æœ‰ä¸‰ä¸ªå†—ä½™ï¼Œç”±GCWorkerè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¹¶ä½¿ç”¨ECï¼ˆErasure Codingï¼‰ç¼–ç æ¥å­˜å‚¨æ–‡ä»¶ã€‚åœ¨ç›˜å¤2.0çš„ç¬¬äºŒé˜¶æ®µï¼Œåœ¨å•†ä¸šæ¨¡å¼ä¸­ï¼Œä½¿ç”¨ECæ›¿æ¢3ä¸ªå†—ä½™çš„å­˜å‚¨æ–¹å¼æ¥å‡å°‘æµé‡æ”¾å¤§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤service&#34;&gt;ç›˜å¤Service&lt;/h3&gt;
&lt;p&gt;ç›˜å¤æœåŠ¡å±‚æä¾›ä¼ ç»Ÿçš„äº‘å­˜å‚¨æœåŠ¡ï¼ˆEBSã€OSSã€NASï¼‰ï¼Œé€šè¿‡é¢ç›¸äº‘åŸç”Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆFiscï¼‰æä¾›äº‘åŸç”Ÿå­˜å‚¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›˜å¤monitoring-system&#34;&gt;ç›˜å¤Monitoring System&lt;/h3&gt;
&lt;p&gt;Perseusä¸ºç›˜å¤æ ¸å¿ƒå’Œç›˜å¤æœåŠ¡æä¾›å®æ—¶ç›‘æ§å’Œäººå·¥æ™ºèƒ½è¾…åŠ©çš„æ ¹æœ¬åŸå› åˆ†ææœåŠ¡ã€‚ç›˜å¤Coreã€ç›˜å¤Serviceã€ç›˜å¤Monitoring Systemé€šè¿‡é«˜é€Ÿç½‘ç»œç›¸è¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›˜å¤20çš„è®¾è®¡ç›®æ ‡&#34;&gt;ç›˜å¤2.0çš„è®¾è®¡ç›®æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½å»¶è¿Ÿï¼šç›˜å¤2.0è¦åˆ©ç”¨SSDå’ŒRDMAä½å»¶è¿Ÿçš„ç‰¹æ€§ï¼Œåœ¨è®¡ç®—-å­˜å‚¨åˆ†ç¦»æ¶æ„ä¸­å®ç°å¹³å‡100usçº§åˆ«I/Oå»¶è¿Ÿçš„æ€§èƒ½ç›®æ ‡ï¼Œå³ä½¿åœ¨ç½‘ç»œæµé‡æŠ–åŠ¨å’ŒæœåŠ¡å™¨æ•…éšœç­‰åŠ¨æ€ç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½æä¾›æ¯«ç§’çº§åˆ« P999 SLAã€‚&lt;/li&gt;
&lt;li&gt;é«˜ååé‡ï¼šä½¿å­˜å‚¨æœåŠ¡å™¨çš„æœ‰æ•ˆååé‡æ¥è¿‘å…¶å®¹é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ‰€æœ‰æœåŠ¡æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½æ”¯æŒï¼šä¸ºè¿è¡Œåœ¨å…¶ä¸Šçš„æ‰€æœ‰ä¸šåŠ¡æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½æ”¯æŒï¼Œä¾‹å¦‚åœ¨çº¿æœç´¢ã€æ•°æ®æµåˆ†æã€EBSã€OSSå’Œæ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;related-work&#34;&gt;Related Work&lt;/h2&gt;
&lt;p&gt;ç›®å‰æœ‰å¾ˆå¤šåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿè¢«æå‡ºå’Œä½¿ç”¨&lt;/p&gt;
&lt;p&gt;å¼€æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://hadoop.apache.org/docs/r1.2.1/hdfs_design.htmll&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HDFSï¼ˆHadoop FSï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://ceph.com/en/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cephï¼ˆRedhatï¼‰[OSDI&#39;06] Ceph: A Scalable, High-Performance Distributed File System&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç§æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://pdos.csail.mit.edu/6.824/papers/gfs.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GFSï¼ˆGoogleï¼‰[SOSP&#39;03] The Google File System&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast21/presentation/pan&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Tectonic (FaceBook)[FAST&#39;21] Facebookâ€™s Tectonic Filesystem: Efficiency from Exascale&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://aws.amazon.com/products/storage/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;AWS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é˜¿é‡Œå·´å·´çš„ç›˜å¤å›¢é˜Ÿåˆ†äº«è¿‡å¾ˆå¤šç›˜å¤çš„è®¾è®¡ç†å¿µï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RDMAå¤§å‹éƒ¨ç½²,&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/system/files/nsdi21-gao.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[NSDI&#39;21] When Cloud Storage Meets RDMA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¨ªå‘æ‰©å±•äº‘å­˜å‚¨æœåŠ¡çš„Key-Valueé”®å€¼å­˜å‚¨å¼•æ“&lt;a class=&#34;link&#34; href=&#34;https://dl.acm.org/doi/abs/10.1145/3448016.3457553&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[SIGMOD&#39;21] A Key-Value Engine for Scalable Cloud Storage Services&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;EBSå­˜å‚¨æœåŠ¡çš„ç½‘ç»œå’Œå­˜å‚¨è½¯ä»¶æ ˆååŒè®¾è®¡&lt;a class=&#34;link&#34; href=&#34;https://dl.acm.org/doi/abs/10.1145/3544216.3544238&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[SIGCOMM&#39;22] From Luna to Solar: the Evolu- tions of the Compute-to-Storage Networks in Alibaba Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;namespaceå…ƒæ•°æ®æœåŠ¡çš„å…³é”®è®¾è®¡&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast22/presentation/lv&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[FAST&#39;22] InfiniFS: An Efficient Metadata Service for Large-Scale Distributed Filesystems&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x02-phase-one-embracing-ssd-and-rdma&#34;&gt;0x02 Phase One: Embracing SSD and RDMA&lt;/h1&gt;
&lt;p&gt;ç›¸è¾ƒäºHDDå’ŒTCPï¼ŒSSDå’ŒRDMAæŠ€æœ¯æ˜¾è‘—é™ä½äº†I/Oå»¶è¿Ÿå’Œç½‘ç»œé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤é€šè¿‡å¼€å‘ç”¨æˆ·ç©ºé—´å­˜å‚¨æ“ä½œç³»ç»Ÿå¹¶æå‡ºä¸€äº›æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡æ¥å®ç°é«˜ååé‡ã€100usçº§åˆ«I/Oå»¶è¿Ÿçš„é«˜IOPSæ€§èƒ½ã€‚åŒæ—¶æä¾›äº†æ–°çš„æœºåˆ¶æ¥ä¿éšœSLAã€‚&lt;/p&gt;
&lt;h2 id=&#34;append-only-file-system&#34;&gt;Append-Only File System&lt;/h2&gt;
&lt;p&gt;ç›˜å¤æå‡ºäº†ç»Ÿä¸€ã€è¿½åŠ å†™å…¥çš„æŒä¹…å±‚ï¼Œé€šè¿‡åä¸ºFlatLogFileçš„è¿½åŠ å†™å…¥æ¥å£æ¥ç®€åŒ–æ¶æ„ã€‚FlatLogFileå…·æœ‰é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚åŸºäºFlatLogFileï¼Œç›˜å¤é‡‡ç”¨è¿½åŠ å†™å…¥çš„chunkï¼Œå¹¶ä½¿ç”¨ç‹¬ç«‹chunkå¸ƒå±€æ¥ç®¡ç†chunkserverä¸­çš„chunk&lt;/p&gt;
&lt;h3 id=&#34;unified-append-only-persistence-layer&#34;&gt;Unified, Append-Only Persistence Layer&lt;/h3&gt;
&lt;p&gt;ç›˜å¤çš„æŒä¹…åŒ–å±‚ä¸ºå­˜å‚¨æœåŠ¡æä¾›æ¥å£ã€‚åœ¨æ—©æœŸå¼€å‘é˜¶æ®µï¼Œä¸åŒçš„å­˜å‚¨æœåŠ¡ä¼šä½¿ç”¨ä¸åŒçš„æ¥å£ï¼Œä¾‹å¦‚LogFileæ¥å£æœåŠ¡äºä½å»¶è¿Ÿçš„NASæœåŠ¡ï¼ŒTempFileæ¥å£æœåŠ¡äºé«˜ååé‡çš„å¤§å‹è®¡ç®—æ•°æ®åˆ†ææœåŠ¡ã€‚ç„¶è€Œï¼Œè¿™ç§è®¾è®¡ä½¿å¼€å‘å’Œç®¡ç†éå¸¸å¤æ‚ã€‚æ¯ä¸ªæ¥å£éƒ½éœ€è¦æœ‰äººå¼€å‘å’Œç»´æŠ¤ï¼ŒäººåŠ›æˆæœ¬é«˜åˆ‡å®¹æ˜“å‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œéœ€è¦ç®€åŒ–å¼€å‘ç®¡ç†è¿‡ç¨‹ï¼Œè¿˜è¦å¼•å…¥ä½å»¶è¿Ÿçš„SSDï¼Œå—åˆ°è®¡ç®—æœºç½‘ç»œåˆ†å±‚æ¶æ„çš„å¯å‘ï¼Œç›˜å¤æå‡ºäº†ç»Ÿä¸€çš„æ–‡ä»¶ç±»å‹ï¼šFlatLogFileï¼ˆFigure 2ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230303201714075.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230303201714075&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;FlatLogFileä»…æ”¯æŒè¿½åŠ å†™å…¥ï¼Œä¸Šå±‚æœåŠ¡ï¼ˆOSSï¼‰å¯ä»¥å¯ä»¥ä½¿ç”¨ç±»ä¼¼é”®å€¼çš„æ˜ å°„æ¥æ›´æ–°æ•°æ®ï¼Œå¹¶ä½¿ç”¨åƒåœ¾æ”¶é›†æœºåˆ¶æ¥å‹ç¼©å†å²æ•°æ®ã€‚FlatLogFileä¸ºå­˜å‚¨æœåŠ¡æä¾›ç®€å•ã€ç»Ÿä¸€çš„æ¥å£æ“ä½œæ•°æ®ã€‚ç›˜å¤çš„å¼€å‘è€…å¿…é¡»ä¿è¯æ•°æ®æ“ä½œéƒ½æ˜¯é€šè¿‡FlatLogFileï¼Œå°¤å…¶æ˜¯å†™å…¥æ“ä½œï¼Œå¯ä»¥é«˜æ•ˆå¹¶å¯é çš„åœ¨å­˜å‚¨ä»‹è´¨ä¸Šæ‰§è¡Œã€‚å› æ­¤ï¼Œå­˜å‚¨æœåŠ¡çš„ä»»ä½•å‡çº§å’Œæ”¹å˜å¯¹äºå¼€å‘è€…è€Œè¨€éƒ½æ˜¯é€æ˜çš„ï¼Œç®€åŒ–äº†å¼€å‘å’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åº•å±‚ï¼Œå›¢é˜Ÿè§‚å¯Ÿåˆ°SSDç”±äºå…¶è‡ªèº«çš„å­˜å‚¨å•å…ƒå’Œé—ªå­˜äº‹åŠ¡å±‚çš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨é¡ºåºæ“ä½œä¸Šè·å¾—è¾ƒé«˜çš„ååé‡å’ŒIOPSã€‚ä¸ºäº†ä¿è¯é€šè¿‡FlatLogFileè¿›è¡Œçš„æ•°æ®æ“ä½œèƒ½å¤Ÿåœ¨SSDä¸Šé«˜æ•ˆåœ°æ‰§è¡Œï¼Œæˆ‘ä»¬å°†FlatLogFileä¸Šçš„é¡ºåºæ“ä½œå¯¹é½ä»¥å®ç°é«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;heavy-weight-client&#34;&gt;Heavy weight Client&lt;/h3&gt;
&lt;p&gt;è„æ´»ç´¯æ´»éƒ½æ˜¯Clientæ¥å¹²ã€‚Clientè´Ÿè´£ä¸chunkserversä¸€èµ·è¿›è¡Œæ•°æ®æ“ä½œï¼Œä¸masterä¸€èµ·è¿›è¡Œå…ƒæ•°æ®ä¿¡æ¯çš„æ£€ç´¢å’Œæ›´æ–°ã€‚åœ¨ä»mastersè·å–chunkä¿¡æ¯åï¼Œä¸€ä¸ªç›˜å¤Clientå°†è´Ÿè´£ç›¸åº”çš„å¤åˆ¶åè®®å’ŒECåè®®ã€‚Clientæœ‰é‡è¯•æœºåˆ¶ï¼ˆå¤‡ä»½è¯»å–Â¥3.3ï¼‰æ¥å¤„ç†æ„å¤–çš„æ€§èƒ½æŠ–åŠ¨ï¼ˆä¸¢åŒ…ï¼‰æ¥ä¿éšœI/O SLAã€‚&lt;/p&gt;
&lt;p&gt;Clientè¿˜æœ‰æ¢æµ‹æœºåˆ¶ï¼Œå®šæœŸä»mastersè·å–æœ€æ–°çš„ chunkserver çŠ¶æ€ï¼Œå¹¶è¯„ä¼° chunkserver çš„æœåŠ¡è´¨é‡ã€‚ç±»ä¼¼äºFacebook Tectonic FSçš„clientï¼Œç›˜å¤çš„Clientå¯ä»¥é€‰æ‹©åˆé€‚çš„è¯»å†™å‚æ•°æ¥å¤„ç†å…·ä½“çš„å­˜å‚¨æœåŠ¡æŒ‡ä»¤ï¼ˆEBS/OSSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;append-only-chunk-management&#34;&gt;Append-Only Chunk Management&lt;/h3&gt;
&lt;p&gt;ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿåœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼ŒåŒæ—¶åˆ†ç¦»å†™å…¥æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œäº§ç”Ÿä¸¤æ¬¡SSDçš„å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é™ä½å»¶è¿Ÿå’Œå»¶é•¿SSDå¯¿å‘½ï¼Œç›˜å¤åŸºäºFlatLogFileçš„append-onlyè¯­ä¹‰ï¼Œé€‰æ‹©ä»¥chunkä¸ºå•ä½å­˜å‚¨æ–‡ä»¶ï¼Œè€Œéblockï¼Œchunkå­˜å‚¨åœ¨chunkseverä¸­ï¼Œå¹¶æœ‰ç‹¬ç«‹çš„å¸ƒå±€ï¼Œæ¯ä¸ªchunkéƒ½ä¿å­˜äº†è‡ªå·±çš„æ•°æ®å’Œå…ƒæ•°æ®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;chunkåªéœ€è¦ä¸€æ¬¡æ“ä½œå°±å¯ä»¥è¢«å†™å…¥åˆ°å­˜å‚¨ä»‹è´¨ä¸­ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å†™å…¥å»¶è¿Ÿå’Œå­˜å‚¨ä»‹è´¨çš„å¯¿å‘½ã€‚&lt;/p&gt;
&lt;p&gt;Figure 3æ˜¯chunkçš„å¸ƒå±€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230304141646186.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230304141646186&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªchunkåŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼šdataã€paddingã€footerã€‚&lt;/p&gt;
&lt;p&gt;footerä¿å­˜äº†chunkçš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚chunk IDã€chunk é•¿åº¦ã€CRCæ ¡éªŒå’Œã€‚&lt;/p&gt;
&lt;p&gt;ç‹¬ç«‹çš„chunkå¸ƒå±€ä¹Ÿä½¿å¾—chunkserverå¯ä»¥æ‰§è¡Œè¿›è¡Œçº é”™æ¢å¤ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªclientè¿ç»­å†™å…¥chunkåˆ°å­˜å‚¨è®¾å¤‡æ—¶ï¼Œchunkserveråœ¨å†…å­˜ä¸­å­˜å‚¨è¿™äº›chunkçš„å…ƒæ•°æ®ï¼Œå¹¶ä¸”å‘¨æœŸæ€§åœ°å°†è¿™äº›ä¿¡æ¯çš„æ£€æŸ¥ç‚¹ä¼ é€’ç»™å­˜å‚¨è®¾å¤‡ã€‚å½“å‘ç”Ÿé”™è¯¯å¯¼è‡´ä¸€äº›ä¸èƒ½å®Œæˆçš„å†™å…¥æ“ä½œæ—¶ï¼Œchunkserverä¼šåŠ è½½æ£€æŸ¥ç‚¹ä¸­çš„å…ƒæ•°æ®å¹¶ä¸”å’Œchunkä¸­çš„å…ƒæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœäºŒè€…ä¸åŒï¼Œchunkserverä¼šæ£€æŸ¥Chunkçš„CRCæ¥è¿›è¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;metadata-operation-optimization-å…ƒæ•°æ®æ“ä½œä¼˜åŒ–&#34;&gt;Metadata Operation Optimization å…ƒæ•°æ®æ“ä½œä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ç›˜å¤çš„Masteræä¾›ä¸¤ç§å…ƒæ•°æ®æœåŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;namespaceï¼šè´Ÿè´£ç›®å½•æ ‘å’Œæ–‡ä»¶ç®¡ç†&lt;/li&gt;
&lt;li&gt;Streamï¼šè´Ÿè´£chunkä¿¡æ¯çš„ç»´æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Streamå†…åŒ…å«ä¸€ç»„chunkï¼ŒåŒä¸€ä¸ªStreamä¸­çš„chunkä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæœåŠ¡éƒ½æ˜¯ç”¨äº†åˆ†å¸ƒå¼æ¶æ„æ¥ä¿è¯æ›´å¥½çš„ä¼¸ç¼©æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä»–ä»¬æ ¹æ®å…ƒæ•°æ®å±€éƒ¨æ€§å’Œè´Ÿè½½å‡è¡¡å¯¹å…ƒæ•°æ®è¿›è¡Œåˆ’åˆ†ï¼ˆå…ˆæ ¹æ®ç›®å½•æ ‘åˆ’åˆ†ï¼Œå†è¿›è¡Œå“ˆå¸Œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶è¿˜ç”¨å¤šç§æœºåˆ¶æ¥ä¼˜åŒ–å…ƒæ•°æ®æ“ä½œçš„é«˜æ•ˆæ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¹¶è¡Œçš„å…ƒæ•°æ®å¤„ç†&#34;&gt;å¹¶è¡Œçš„å…ƒæ•°æ®å¤„ç†&lt;/h4&gt;
&lt;p&gt;namespaceå’Œstreaméƒ½ä½¿ç”¨å¹¶è¡Œå¤„ç†ï¼ˆInfiniFSï¼‰æ¥å®ç°å…ƒæ•°æ®çš„ä½å»¶è¿Ÿè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;ç›˜å¤ä½¿ç”¨å“ˆå¸Œç®—æ³•æ¥æ˜ å°„å…³è”æ€§å¼ºçš„å…ƒæ•°æ®åˆ°ä¸åŒçš„å…ƒæ•°æ®æœåŠ¡å™¨ä¸­ã€‚ä½¿ç”¨ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¯é¢„æµ‹çš„ç›®å½•IDï¼Œå¹¶å…è®¸Clienté«˜æ•ˆåœ°å¹³è¡Œæ‰§è¡Œè·¯å¾„è§£æã€‚åŒæ—¶è¿˜å¼•å…¥äº†å‡ ç§åŠ é€ŸClientä»StreamæœåŠ¡ä¸­æ£€ç´¢chunkä¿¡æ¯çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯å˜é•¿åº¦çš„chunk&#34;&gt;å¯å˜é•¿åº¦çš„chunk&lt;/h4&gt;
&lt;p&gt;ç›˜å¤2.0é‡‡ç”¨å¤§chunkï¼Œæœ‰ä¸‰ä¸ªå¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘äº†å…ƒæ•°æ®çš„æ•°é‡&lt;/li&gt;
&lt;li&gt;é¿å…äº†Clienté¢‘ç¹è¯·æ±‚chunkäº§ç”Ÿçš„I/Oå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;æé«˜äº†SSDçš„å¯¿å‘½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä»…ä»…æé«˜chunk sizeä¼šæœ‰ç¢ç‰‡çš„é£é™©ï¼Œå› æ­¤é‡‡ç”¨äº†å¯å˜é•¿åº¦çš„chunkï¼ˆä»1MBåˆ°2GBï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚EBSæœåŠ¡çš„chunk sizeçš„95%åˆ†ä½æ•°ä¸º64MBï¼Œ99%åˆ†ä½æ•°ä¸º286.4MBã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœ¨clientä¸­ç¼“å­˜chunkä¿¡æ¯&#34;&gt;åœ¨Clientä¸­ç¼“å­˜chunkä¿¡æ¯&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªclientç»´æŠ¤äº†ä¸€ä¸ªæœ¬åœ°çš„å…ƒæ•°æ®ç¼“å­˜æ± ï¼Œæ¥å‡å°‘å…ƒæ•°æ®çš„è¯·æ±‚æ¬¡æ•°ã€‚ç¼“å­˜æ± é€šè¿‡LRUè¿›è¡Œç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªç¨‹åºæƒ³è®¿é—®æ•°æ®æ—¶ï¼Œclienté¦–å…ˆè®¿é—®å…ƒæ•°æ®ç¼“å­˜ï¼Œå½“ç¼“å­˜æ²¡æœ‰å‘½ä¸­æ—¶å°†å‘èµ·å¯¹masterçš„è¯·æ±‚ï¼Œå½“ç¼“å­˜å‘½ä¸­æ—¶ï¼Œå“åº”è¯·æ±‚æ—¶ï¼Œå¯¹åº”çš„chunkserverä¼šé€šçŸ¥clientå…¶å…ƒæ•°æ®å·²ç»è¿‡æœŸï¼ˆç”±äºå‰¯æœ¬è¿ç§»ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ‰¹å¤„ç†chunkä¿¡æ¯è¯·æ±‚&#34;&gt;æ‰¹å¤„ç†chunkä¿¡æ¯è¯·æ±‚&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªclientåœ¨çŸ­æ—¶é—´å†…æ±‡æ€»å¤šä¸ªchunkè¯·æ±‚ï¼Œå¹¶å°†å…¶æ‰¹é‡å‘é€ç»™masterï¼Œæ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä¸»ç«™å¹¶è¡Œå¤„ç†æˆæ‰¹çš„è¯·æ±‚ï¼Œæ±‡æ€»ç»“æœå¹¶å°†å…¶å‘å›ç»™clientã€‚clientå¯¹ç»“æœè¿›è¡Œåˆ†è§£ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ç›¸åº”çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¨æµ‹chunkä¿¡æ¯è¿›è¡Œé¢„å–&#34;&gt;æ¨æµ‹chunkä¿¡æ¯è¿›è¡Œé¢„å–&lt;/h4&gt;
&lt;p&gt;è®¾è®¡äº†ä¸€ä¸ªåŸºäºè´ªå¿ƒå’Œç»Ÿè®¡å­¦çš„é¢„å–æœºåˆ¶æ¥å‡å°‘chunkä¿¡æ¯çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å½“masterèŠ‚ç‚¹æ”¶åˆ°äº†æ¥è‡ªclientçš„è¯»è¯·æ±‚æ—¶ï¼Œmasterå°†è¿”å›æœ‰å…³çš„chunkå…ƒæ•°æ®å’Œå…¶ä»–chunkçš„å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“masteræ”¶åˆ°å†™å…¥è¯·æ±‚æ—¶ï¼Œmasterå°†è¿”å›å¤šä¸ªchunkï¼Œè¶…å‡ºclientçš„è¯·æ±‚æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;clientå› æ­¤å¯ä»¥åœ¨ä¸è¯·æ±‚å—çš„æƒ…å†µä¸‹åˆ‡æ¢å—ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ•°æ®æå¸¦å‡å°‘å¾€è¿”æ—¶å»¶&#34;&gt;æ•°æ®æå¸¦å‡å°‘å¾€è¿”æ—¶å»¶&lt;/h4&gt;
&lt;p&gt;å—åˆ°äº†QUICå’ŒHTTP3çš„å¯å‘ï¼Œä½¿ç”¨æ•°æ®æå¸¦æ¥æ”¹å–„å†™å…¥å»¶è¿Ÿï¼Œåœ¨clientä»masteræ£€ç´¢åˆ°chunkåœ°å€åï¼Œä»–å°†chunkåˆ›å»ºè¯·æ±‚å’Œæ•°æ®å†™å…¥è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åå‘é€ç»™chunkserverã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤å¯ä»¥å‡å°‘ä¸€ä¸ªRTTã€‚ï¼ˆä½†æ˜¯å½“ä¸ªRTTé•¿äº†ï¼Œæ•°æ®åŒ…å¤§å°é—®é¢˜ï¼Ÿï¼‰&lt;/p&gt;
&lt;h2 id=&#34;chunkserver-ussos&#34;&gt;ChunkServer USSOS&lt;/h2&gt;
&lt;p&gt;chunkserverè´Ÿè´£æ‰§è¡Œæ‰€æœ‰çš„æ•°æ®æ“ä½œã€‚å› æ­¤ï¼Œç²¾å¿ƒè®¾è®¡è¿è¡Œæ—¶æ“ä½œç³»ç»Ÿä»¥ç¡®ä¿æ•°æ®æ“ä½œèƒ½ä»¥&lt;strong&gt;ä½å»¶è¿Ÿ&lt;/strong&gt;å’Œ&lt;strong&gt;é«˜ååé‡&lt;/strong&gt;å®Œæˆæ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨æ–°å…´çš„é«˜é€Ÿç½‘ç»œæŠ€æœ¯å’Œå­˜å‚¨é¢†åŸŸï¼ŒåšæŒé€šè¿‡å†…æ ¸ç©ºé—´è¿›è¡Œæ•°æ®æ“ä½œçš„ä¼ ç»Ÿè®¾è®¡æ˜¯ä½æ•ˆçš„ã€‚è¿™ä¸ä»…ä¼šå¯¼è‡´é¢‘ç¹çš„ç³»ç»Ÿä¸­æ–­ï¼Œä»è€Œæ¶ˆè€—CPUèµ„æºï¼Œè€Œä¸”è¿˜ä¼šå¯¼è‡´ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ä¸å¿…è¦çš„æ•°æ®é‡å¤ã€‚
ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç›˜å¤é‡‡ç”¨äº†kernel-bypassç»•è¿‡å†…æ ¸çš„è®¾è®¡ï¼Œä¸ºchunkserverå¼€å‘äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ“ä½œç³»ç»Ÿï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ç”¨æˆ·ç©ºé—´å­˜å‚¨è½¯ä»¶å¹³å°ã€‚é™¤äº†åœ¨USSOSä¸­å®ç°è®¾å¤‡ç®¡ç†å’ŒRTCè¿è¡Œåˆ°å®Œæˆçš„çº¿ç¨‹æ¨¡å‹ï¼Œç›˜å¤è¿˜å®ç°äº†ç”¨æˆ·çº§çš„å†…å­˜ç®¡ç†ï¼Œè½»é‡çº§çš„ç”¨æˆ·ç©ºé—´è°ƒåº¦ç­–ç•¥ï¼Œè¿˜ä¸ºSSDå®šåˆ¶äº†é«˜æ€§èƒ½append-onlyçš„ç”¨æˆ·ç©ºé—´å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿï¼ˆUSSFSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨æˆ·çº§åˆ«å†…å­˜ç®¡ç†&#34;&gt;ç”¨æˆ·çº§åˆ«å†…å­˜ç®¡ç†&lt;/h3&gt;
&lt;p&gt;chunkserverçš„USSOSåŸºäºç°æœ‰çš„ç”¨æˆ·ç©ºé—´æŠ€æœ¯ï¼Œå¦‚ç½‘ç»œæ ˆä¸­çš„RDMAï¼Œå­˜å‚¨æ ˆä¸­çš„DPDKå’ŒSPDKã€‚ç›˜å¤å¯¹ç½‘ç»œæ ˆå’Œå­˜å‚¨æ ˆè¿›è¡Œäº†æ•´åˆï¼Œä»¥å‡å°‘å»¶è¿Ÿå¹¶å®ç°é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨RTCçº¿ç¨‹æ¨¡å‹ï¼Œåœ¨ä¼ ç»Ÿçš„æµæ°´çº¿pipelineçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚è¢«åˆ†è§£æˆå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µè¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ã€‚ç›¸åï¼ŒUSSOSä¸­ä¸€ä¸ªè¯·æ±‚è‡ªå§‹è‡³ç»ˆéƒ½å¤„äºä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹é—´é€šä¿¡çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹è¯·æ±‚ä¸€ä¸ªå¤§é¡µå†…å­˜ç©ºé—´ç”¨ä½œç½‘ç»œæ ˆå’Œå­˜å‚¨æ ˆçš„å…±äº«å†…å­˜ã€‚ä»ç½‘ç»œä¸­æ¥å—çš„æ•°æ®å¯ä»¥é€šè¿‡RDMAå­˜å‚¨åœ¨å¤§é¡µå†…å­˜ç©ºé—´ä¸­ã€‚å‘é€å¤§é¡µå†…å­˜çš„å…ƒæ•°æ®ä¹‹åï¼ˆåœ°å€å’Œå¤§å°ï¼‰ï¼Œæ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡SPDKä»å¤§é¡µå†…å­˜å†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶&#34;&gt;ç”¨æˆ·ç©ºé—´çš„è°ƒåº¦æœºåˆ¶&lt;/h3&gt;
&lt;h4 id=&#34;é€šè¿‡é˜»å¡åç»­è¯·æ±‚é˜»æ­¢ä»»åŠ¡&#34;&gt;é€šè¿‡é˜»å¡åç»­è¯·æ±‚é˜»æ­¢ä»»åŠ¡&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªchunkserveréƒ½æœ‰å›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ–°çš„è¯·æ±‚é€šè¿‡å“ˆå¸Œæ˜ å°„è¢«ä¸‹å‘ç»™ä¸€ä¸ªworkingçº¿ç¨‹ã€‚è¢«å‘é€åˆ°åŒä¸€ä¸ªçº¿ç¨‹çš„è¯·æ±‚åŸºäºå…ˆåˆ°å…ˆæ‰§è¡ŒFIFSçš„æœºåˆ¶æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè¯·æ±‚å ç”¨äº†å¤ªå¤šçš„æ—¶é—´ç‰‡ï¼ˆè¡¨æŸ¥è¯¢æœç´¢ï¼Œå†…å­˜ç”³è¯·ï¼‰ï¼Œå°†ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºè´Ÿè½½è¾ƒé«˜çš„ä»»åŠ¡ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶æ¥ç›‘æ§ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œå¹¶è®¾ç½®å‘Šè­¦ã€‚å¦‚æœä»»åŠ¡è¶…å‡ºäº†è§„å®šæ—¶é—´ç‰‡ï¼Œä¼šå°†å…¶ä¸‹å‘åˆ°åå°çº¿ç¨‹è¿›è¡Œæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºç³»ç»Ÿäº§ç”Ÿçš„è´Ÿè½½ï¼Œç›˜å¤ä½¿ç”¨TCMallocï¼ˆThread Cached Mallocï¼‰ç¼“å­˜æ¥å…è®¸åœ¨ç¼“å­˜ä¸­æ‰§è¡Œé«˜é¢‘ç‡çš„æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ä¼˜å…ˆçº§è°ƒåº¦ä¿éšœé«˜qos&#34;&gt;ä¼˜å…ˆçº§è°ƒåº¦ä¿éšœé«˜QoS&lt;/h4&gt;
&lt;p&gt;ç›˜å¤å¯¹ä¸åŒè¯·æ±‚æ ‡æ³¨ä¸åŒçš„QoSæ ‡ç­¾ï¼ˆç”¨æˆ·è¯·æ±‚é«˜ä¼˜å…ˆçº§ï¼ŒGCè¯·æ±‚ä½ä¼˜å…ˆçº§ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;USSOSåˆ›å»ºäº†ä¸€ä¸ª&lt;strong&gt;ä¼˜å…ˆé˜Ÿåˆ—&lt;/strong&gt;ï¼Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ ¹æ®QoSç›®æ ‡æ¥è¿›è¡Œè°ƒåº¦ã€‚ä»¥æ­¤æ¥é˜²æ­¢ä½QoSä»»åŠ¡è¿‡å¤šå¯¼è‡´é«˜QoSä¸èƒ½è¢«æŒ‰æ—¶å®Œæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;è½®è¯¢å’Œäº‹ä»¶é©±åŠ¨çš„åˆ‡æ¢napi&#34;&gt;è½®è¯¢å’Œäº‹ä»¶é©±åŠ¨çš„åˆ‡æ¢ï¼ˆNAPIï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢é¢‘ç¹å‘èµ·ä¸­æ–­å¯¼è‡´é«˜CPUåˆ©ç”¨ç‡ï¼ŒUSSOSä½¿ç”¨åˆ‡æ¢æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;NICï¼ˆNetwork Interface Controllerï¼Œç½‘å¡ï¼‰æä¾›äº†&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦fd&lt;/strong&gt;çš„ç›‘æ§ï¼ŒåŸºäºç›‘å¬æ•°æ®è¾¾åˆ°åçš„fdäº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç¨‹åºé»˜è®¤ä½¿ç”¨&lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;ï¼Œå½“ç¨‹åºæ”¶åˆ°äº†NICçš„é€šçŸ¥ï¼Œå°†åˆ‡æ¢ä¸ºè½®è¯¢æ¨¡å¼ã€‚å¦‚æœç¨‹åºä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•I/Oè¯·æ±‚ï¼Œå°†ä¼šåˆ‡æ¢ä¼šäº‹ä»¶é©±åŠ¨æ¨¡å¼å¹¶å‘ŠçŸ¥NICã€‚&lt;/p&gt;
&lt;h3 id=&#34;append-only-ussos&#34;&gt;Append Only USSOS&lt;/h3&gt;
&lt;p&gt;USSFSä½¿ç”¨ä¸€ç³»åˆ—åŸºäºchunkçš„æŒ‡ä»¤ï¼ˆopenï¼Œcloseï¼Œsealï¼Œformatç­‰ï¼‰ï¼Œæ”¯æŒappend-only writeã€‚&lt;/p&gt;
&lt;p&gt;æ”¯æŒappend-onlyçš„é¡ºåºå†™å…¥ï¼Œå……åˆ†åˆ©ç”¨äº†SSDçš„é¡ºåºå†™å’Œéšæœºè¯»ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¤šç§æœºåˆ¶æœ€å¤§åŒ–SSDæ€§èƒ½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å……åˆ†åˆ©ç”¨ç‹¬ç«‹chunkå¸ƒå±€ï¼Œæå¤§çš„å‡å°‘äº†æ•°æ®æ“ä½œçš„æ¬¡æ•°ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨page cacheå’Œæ—¥å¿—ç­‰æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦å»ºç«‹åˆ†çº§çš„ç´¢å¼•æœºåˆ¶ï¼ˆä¾‹å¦‚ext4çš„inodeå’Œæ–‡ä»¶ç›®å½•dentriesï¼‰ã€‚æ‰€æœ‰çš„æ“ä½œä¼šé€šè¿‡æ—¥å¿—è¿›è¡Œè®°å½•ï¼Œè¯¥æ—¥å¿—å¯ä»¥ç”¨æ¥åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶é‡å»ºå…ƒæ•°æ®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è½®è¯¢æœºåˆ¶å‡å°‘ä¸­æ–­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å•ä¸ªSSDçš„å®¹é‡ä¸€èˆ¬å¾ˆå¤§ï¼Œå¹¶ä¸”ä¸€ä¸ªchunkçš„å¤§å°é€šå¸¸æ˜¯64MBï¼Œè®¾å®šUSSFSçš„æœ€å°ç©ºé—´åˆ†é…ç²’åº¦ä¸º1MBï¼Œä¸»è¦è€ƒè™‘ä½¿ç”¨çš„å†…å­˜å¤§å°å’ŒSSDçš„ç©ºé—´åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é«˜æ€§èƒ½slaä¿éšœ&#34;&gt;é«˜æ€§èƒ½SLAä¿éšœ&lt;/h2&gt;
&lt;h3 id=&#34;chasing&#34;&gt;Chasing&lt;/h3&gt;
&lt;p&gt;å‡å°‘ç³»ç»ŸæŠ–åŠ¨åœ¨å†™å»¶è¿Ÿä¸Šçš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å½“$MaxCopy$ä¸ªå‰¯æœ¬ä¸­çš„$MinCopy$ä¸ªåœ¨chunkserverä¸­æˆåŠŸå†™å…¥æ—¶ï¼Œå…è®¸clientå‘åº”ç”¨è¿”å›successã€‚è§„å®š$2\times MinCopy\ \ \ \textgreater \ \ \ MaxCopy$ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾Figure 4å±•ç¤ºäº†Chasingåœ¨$MaxCopy=3\and MinCopy=2$æƒ…å†µä¸‹çš„å·¥ä½œæƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230308133528640.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230308133528640&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºè¯·æ±‚Clientå†™å…¥æ•°æ®$[1,2,3]$åˆ°3ä¸ªå‰¯æœ¬chunkserverä¸­ï¼Œåœ¨æ—¶é—´$T$æ—¶ï¼Œchunkserver1å’Œ2å·²ç»å‘clientè¿”å›äº†å†™æ“ä½œsuccessï¼Œä½†æ˜¯chunkserver3è¿˜æ²¡æœ‰å›å¤ã€‚æ­¤æ—¶Clientå°†å‘åº”ç”¨ç¨‹åºå›å¤successã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Clientä¸­è¿˜éœ€è¦åœ¨å†…å­˜ä¸­ä¿ç•™å†™å…¥çš„æ•°æ®ï¼Œå¹¶ç­‰å¾…ä¸€ä¸ªæ—¶é—´æ®µ$t$ï¼ˆmsçº§åˆ«ï¼‰ï¼Œå¦‚æœchunkserver 3åœ¨$T+t$æ—¶é—´ä»¥å‰å›å¤äº†successï¼ŒClientå°±ä¼šåœ¨å†…å­˜ä¸­åˆ é™¤é‡Šæ”¾è¦å†™å…¥çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœchunkserver 3æ²¡æœ‰å®Œæˆå†™å…¥æ“ä½œï¼Œä¸”æ²¡æœ‰å®Œæˆçš„éƒ¨åˆ†å°äºé˜ˆå€¼$k$ï¼ŒClientå°†åœ¨chunkserver 3ä¸­å‘èµ·é‡è¯•æ“ä½œï¼›è‹¥æ²¡æœ‰å®Œæˆçš„éƒ¨åˆ†å¤§äº$k$ï¼ŒClientå°†ä¼šåœ¨chunkserver 3ä¸­å°å­˜è¿™ä¸ªchunkï¼Œä¿è¯ä¸ä¼šæ”¶åˆ°åç»­è¿½åŠ å†™å…¥çš„å½±å“ï¼ŒClienté€šçŸ¥masterï¼Œmasterå°†ä»chunkserver 1æˆ–è€…2å¤åˆ¶ä¸€ä¸ªä¸åŒçš„chunkæ¥ä¿è¯æ€»å…±å­˜åœ¨3ä¸ªå‰¯æœ¬ï¼Œ&lt;strong&gt;Clientçš„å†…å­˜ä¸­è¿˜æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Ÿ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‚£ä¹ˆchunkserver 3ä¸­å°å­˜è¿‡çš„chunkæ€ä¹ˆå¤„ç†ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§Early- Write- Acknowledgmentæœºåˆ¶ï¼Œå‡å°‘äº†å†™å…¥æ“ä½œçš„å°¾å»¶è¿Ÿï¼Œåœ¨ç›˜å¤ä¸Šéƒ¨ç½²äº†åå¤šå¹´ï¼Œæ²¡å‘ç”Ÿè¿‡æ•°æ®ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;non-stop-write-ä¸åœå†™&#34;&gt;Non-stop write ä¸åœå†™&lt;/h3&gt;
&lt;p&gt;å‡å°‘å½“ä¸€ä¸ªchunkå†™å…¥å¤±è´¥å¯¼è‡´çš„å†™å…¥å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å½“å†™å…¥å¤±è´¥æ—¶ï¼ŒClientğŸå°å­˜chunkå¹¶ä¸”æ±‡æŠ¥masterå½“å‰å·²ç»æˆåŠŸå†™å…¥çš„æ•°æ®é•¿åº¦ï¼Œmasterä½¿ç”¨ä¸€ä¸ªæ–°çš„chunkæ¥ç»§ç»­å†™å…¥æ•°æ®ã€‚å¦‚æœå†™å…¥åˆ°å°å­˜çš„chunkä¸­çš„æ•°æ®æŸåï¼Œä¼šåœ¨åå°ä½¿ç”¨å…¶ä»–å·²ç»æˆåŠŸå†™å…¥çš„å‰¯æœ¬å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„chunkä¸­ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨å‰¯æœ¬ï¼ŒClientå°†å†æ¬¡å†™å…¥æ•°æ®åˆ°ä¸€ä¸ªæ–°çš„chunkã€‚&lt;/p&gt;
&lt;h3 id=&#34;backup-read&#34;&gt;Backup read&lt;/h3&gt;
&lt;p&gt;å‡å°‘åŠ¨æ€ç¯å¢ƒä¸‹è¯»å»¶è¿Ÿã€‚åœ¨æ”¶åˆ°è¯»è¯·æ±‚çš„responseå‰ï¼ŒClientå‘å…¶ä»–Chunkserverå‘é€é¢å¤–çš„è¯»è¯·æ±‚ä½œä¸ºå¤‡ä»½ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æœºåˆ¶æ¶‰åŠä¸¤ä¸ªå‚æ•°ï¼Œå‘é€è¯·æ±‚çš„æ•°é‡å’Œç­‰å¾…æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œç›˜å¤è®¡ç®—äº†ä¸åŒç¡¬ç›˜ç±»å‹å’ŒI/Oå¤§å°çš„å»¶è¿Ÿï¼Œå¹¶ä½¿ç”¨è¿™äº›ä¿¡æ¯åŠ¨æ€è°ƒæ•´å‘é€å¤‡ä»½è¯»å–è¯·æ±‚çš„æ—¶é—´ã€‚å®ƒè¿˜é™åˆ¶äº†å¤‡ä»½è¯»å–è¯·æ±‚çš„æ•°é‡ï¼Œä»¥æ§åˆ¶ç³»ç»Ÿçš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;blacklisting&#34;&gt;Blacklisting&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†é¿å…å‘æœåŠ¡è´¨é‡å·®çš„chunkserverå‘é€I/Oè¯·æ±‚ï¼Œç›˜å¤ä½¿ç”¨ä¸¤ä¸ªé»‘åå•ï¼Œ&lt;strong&gt;ç¡®å®šé»‘åå•&lt;/strong&gt;å’Œ&lt;strong&gt;éç¡®å®šé»‘åå•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç›˜å¤ç¡®å®šä¸€ä¸ªchunkserverå·²ç»æ— æ³•æä¾›æœåŠ¡ï¼ˆchunkserverçš„SSDæŸåï¼‰ï¼Œè¿™ä¸ªæœåŠ¡å™¨å°†è¢«åŠ å…¥ç¡®å®šé»‘åå•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªchunkserverå¯ä»¥æä¾›æœåŠ¡ï¼Œä½†æ˜¯å»¶è¿Ÿè¶…è¿‡ä¸Šé™ï¼Œå°†ä¼šè¢«åŠ å…¥&lt;/p&gt;
&lt;h2 id=&#34;è¯„ä¼°&#34;&gt;è¯„ä¼°&lt;/h2&gt;
&lt;h1 id=&#34;0x03-phase-two-adapting-to-performance-oriented-business-model&#34;&gt;0x03 Phase Two: Adapting to Performance-Oriented Business Model&lt;/h1&gt;
&lt;h1 id=&#34;0x04-operation-experiences&#34;&gt;0x04 Operation Experiences&lt;/h1&gt;
&lt;h1 id=&#34;0x05-lessons&#34;&gt;0x05 Lessons&lt;/h1&gt;
&lt;h1 id=&#34;0x06-conclusion&#34;&gt;0x06 Conclusion&lt;/h1&gt;
&lt;h1 id=&#34;0x07-reference&#34;&gt;0x07 Reference&lt;/h1&gt;
</description>
        </item>
        <item>
        <title>[OSDI&#39;22] XRP: In-Kernel Storage Functions with eBPF</title>
        <link>https://blog.ipandai.club/p/osdi22-xrp-in-kernel-storage-functions-with-ebpf/</link>
        <pubDate>Thu, 09 Feb 2023 14:51:48 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/osdi22-xrp-in-kernel-storage-functions-with-ebpf/</guid>
        <description>&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;éšç€è¶…ä½å»¶è¿ŸSSDçš„å‘å±•ï¼ŒI/Oè¿‡ç¨‹ä¸­æ¥è‡ªå†…æ ¸çš„å»¶è¿Ÿæ¯”é‡ä¸æ–­å‡é«˜ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230224131538122.png&#34; alt=&#34;image-20230224131538122&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;è§‚å¯Ÿä¸€ä¸ªè¯·æ±‚çš„ä»å‘èµ·åˆ°å®Œæˆçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå†…æ ¸éƒ¨åˆ†å æ®äº†48.6%çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230224132654967.png&#34; alt=&#34;image-20230224132654967&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230225105147344.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230225105147344&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤å¯ä»¥è€ƒè™‘è·³è¿‡å†…æ ¸ä¸­ä¸€ç³»åˆ—çš„æ•°æ®ä¼ é€’ï¼Œå³Kernel Bypassã€‚ç›®å‰ç°æœ‰çš„ç ”ç©¶å¤§éƒ½å¯¹å†…æ ¸è¿›è¡Œäº†æ¿€è¿›çš„ä¿®æ”¹ç­–ç•¥ï¼Œæˆ–å¼•å…¥äº†æ–°çš„ç¡¬ä»¶ï¼ŒKernel Bypassä¸»è¦ä½¿ç”¨SPDKï¼Œç›´æ¥å¯¹ç¡¬ä»¶è®¾å¤‡è¿›è¡Œè®¿é—®ï¼Œè€ŒSPDKä¼šå¼ºåˆ¶å¼€å‘è€…å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦è‡ªè¡Œç»´æŠ¤éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç­‰å¾…I/Oå®Œæˆæ—¶ï¼Œå¾€å¾€ä¼šè¿›è¡Œè½®è¯¢ï¼Œç»™CPUå¸¦æ¥äº†ä¸€äº›æ€§èƒ½æŸå¤±ã€‚æœ‰ç ”ç©¶è¡¨æ˜å½“å¯è°ƒåº¦çš„çº¿ç¨‹æ•°é‡è¶…è¿‡äº†CPUæ ¸å¿ƒæ•°é‡æ—¶ï¼Œä½¿ç”¨SPDKä¼šæé«˜å¹³å‡å»¶è¿Ÿå’Œå°¾å»¶è¿Ÿï¼Œä¸¥é‡é™ä½äº†ååé‡ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ä½œè€…çš„æ ¸å¿ƒæ€æƒ³ä¸ºæ—¢å¯ä»¥å®ŒæˆKernel Bypassï¼Œä¹Ÿä¸éœ€è¦å¼•å…¥é¢å¤–ç¡¬ä»¶å¹¶ä¸å¯¹å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¾ˆå¤§çš„ä¿®æ”¹ï¼Œä½œè€…å€ŸåŠ©BPF(Berkeley Packet Filter)æ¥å®ç°ï¼ŒBPFå…è®¸åº”ç”¨ç¨‹åºä¸‹æ”¾éƒ¨åˆ†å·¥ä½œåˆ°å†…æ ¸ä¸­ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œå…è®¸å¤šçº¿ç¨‹å…±äº«ä¸€ä¸ªCPUæ ¸å¿ƒï¼Œæé«˜åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;è®¸å¤šI/Oè´Ÿè½½éœ€è¦å¤šæ¬¡è°ƒç”¨å‡½æ•°è®¿é—®ç¡¬ç›˜ä¸Šçš„å¤§å‹æ•°æ®ç»“æ„ï¼ˆB+ treeï¼‰ï¼Œä½œè€…ç§°ä¹‹ä¸ºresubmissionã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…æå‡ºäº†eXpress Resubmission Pathï¼ŒXRPåœ¨NVMeé©±åŠ¨ä¸­çš„ä¸­æ–­å¤„ç†å™¨ä¸Šæ·»åŠ äº†ä¸€ä¸ªhookï¼Œä½¿å¾—XRPå¯ä»¥åœ¨I/Oå®Œæˆæ—¶ç›´æ¥ä»NVMeé©±åŠ¨å±‚æ¥å‘èµ·BPFå‡½æ•°è°ƒç”¨ï¼Œå¿«é€Ÿå¯åŠ¨I/Oçš„é‡æ–°æäº¤ã€‚&lt;/p&gt;
&lt;p&gt;XRPçš„ä¸»è¦è´¡çŒ®ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é¦–æ¬¡ä½¿ç”¨BPFæ¥å¸è½½I/Oä»»åŠ¡åˆ°å†…æ ¸&lt;/li&gt;
&lt;li&gt;å°†B-treeçš„æŸ¥æ‰¾ååé‡æé«˜äº†2.5å€&lt;/li&gt;
&lt;li&gt;XRPæä¾›äº†æ¥è¿‘Kernel Bypassçš„å»¶è¿Ÿï¼Œè€Œä¸”å…è®¸çº¿ç¨‹å’Œè¿›ç¨‹é«˜æ•ˆåœ°å…±äº«CPUæ ¸å¿ƒ&lt;/li&gt;
&lt;li&gt;XRPé€‚ç”¨äºå¤šç§ä¸åŒç”¨ä¾‹ï¼Œæ”¯æŒä¸åŒç±»å‹æ•°æ®ç»“æ„ä»¥åŠå­˜å‚¨æ“ä½œ&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x01-bg--motivation&#34;&gt;0x01 Bg &amp;amp;&amp;amp; Motivation&lt;/h1&gt;
&lt;h2 id=&#34;ioæ˜¯ç›®å‰çš„ç“¶é¢ˆ&#34;&gt;I/Oæ˜¯ç›®å‰çš„ç“¶é¢ˆ&lt;/h2&gt;
&lt;h3 id=&#34;æ—¶é—´éƒ½å»å“ªäº†&#34;&gt;æ—¶é—´éƒ½å»å“ªäº†&lt;/h3&gt;
&lt;p&gt;ä½œè€…é€šè¿‡å®éªŒå‘ç°å»¶è¿Ÿçš„éƒ¨åˆ†æ¥æºæ˜¯è½¯ä»¶å±‚é¢ï¼Œå³ç³»ç»Ÿå†…æ ¸éƒ¨åˆ†ä¸­block I/Oçš„ä¼ é€’&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸å•çº¯çš„kernel-bypass&#34;&gt;ä¸ºä»€ä¹ˆä¸å•çº¯çš„kernel bypass&lt;/h3&gt;
&lt;p&gt;å¤§éƒ¨åˆ†bypassçš„æ–¹æ³•éƒ½æ˜¯ç›´æ¥å¯¹NVMe driverå‘èµ·è¯·æ±‚ï¼Œæ­¤ç±»æ–¹æ¡ˆä¸èƒ½å®ç°ç»†ç²’åº¦çš„éš”ç¦»æˆ–è€…å†ä¸åŒåº”ç”¨ä¹‹é—´å…±äº«æ•°æ®ï¼ŒåŒæ—¶ä¸èƒ½æœ‰æ•ˆçš„å»æ¥æ”¶I/Oå®Œæˆäº§ç”Ÿçš„ä¸­æ–­ï¼Œéœ€è¦åº”ç”¨ä¸æ–­è½®è¯¢ï¼Œå› æ­¤CPUå°±è¢«æŸä¸ªåº”ç”¨ç‹¬å ï¼Œä¸èƒ½å¾—åˆ°å…±äº«ã€‚è€Œä¸”å½“å¤šä¸ªè½®è¯¢çº¿ç¨‹å…±äº«ä¸€ä¸ªCPUå¤„ç†å™¨æ—¶ï¼Œä»–ä»¬ä¹‹é—´å¯¹CPUçš„ç«äº‰åŒæ—¶ç¼ºå°‘åŒæ­¥ä¼šå¯¼è‡´å°¾å»¶è¿Ÿå‡é«˜å’Œååé‡çš„é™ä½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bpf&#34;&gt;BPF&lt;/h2&gt;
&lt;p&gt;Berkeley Packet Filterå…è®¸ç”¨æˆ·å°†ä¸€äº›ç®€å•å‡½æ•°ä¸‹æ”¾åˆ°å†…æ ¸å±‚æ¥æ‰§è¡Œï¼Œèµ·åˆæ˜¯ç”¨äºTCPçš„æ•°æ®åŒ…è¿‡æ»¤ã€è´Ÿè½½å‡è¡¡ã€æ•°æ®åŒ…è½¬å‘ï¼Œç›®å‰æ¨å‡ºäº†eBPFæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;BPFå¯ä»¥éªŒè¯å‡½æ•°çš„å®‰å…¨æ€§ï¼Œä¸»è¦æ£€æŸ¥æ˜¯å¦è¶…å‡ºå†…å­˜åœ°å€ç©ºé—´ã€æ˜¯å¦æœ‰æ­»å¾ªç¯ã€æŒ‡ä»¤æ˜¯å¦å¤ªå¤šã€‚&lt;/p&gt;
&lt;p&gt;BPFå¯ä»¥ç›´æ¥å‘èµ·ä¸€ç³»åˆ—I/Oè¯·æ±‚ï¼Œæ¥è·å–é‚£äº›ä¸è¢«ç¨‹åºç›´æ¥åˆ©ç”¨çš„ä¸­é—´æ•°æ®ï¼Œä¾‹å¦‚æŒ‡é’ˆå¯»å€è¿‡ç¨‹ï¼ŒB-treeç´¢å¼•ä¾¿åˆ©ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›åœ¨ç¡¬ç›˜ç»´æŠ¤å¹¶ä¸”ä½¿ç”¨æŒ‡é’ˆæ¥æŸ¥æ‰¾çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚LSM treeï¼Œå¯ä»¥ç”¨äºåŠ é€ŸæŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ç ”ç©¶å¯¹æ¯”äº†åˆ†åˆ«ä»User Spaceã€Syscallã€NVMe Driverå±‚å‘èµ·I/Oä¹‹é—´ååé‡å’Œå»¶è¿Ÿçš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230225134629890.png&#34; alt=&#34;image-20230225134629890&#34; style=&#34;zoom: 33%;&#34; /&gt;
&lt;p&gt;åœ¨NVMe Driverä¸­å‘èµ·I/Oæœ‰æ•ˆæé«˜äº†ååé‡é™ä½äº†å»¶è¿Ÿï¼ŒåŸå› æ˜¯è¶Šé è¿‘å­˜å‚¨è®¾å¤‡çš„ä¸€å±‚ï¼Œæ€»ä½“çš„å»¶è¿Ÿå’Œæ€§èƒ½è¶Šé«˜ã€‚å› æ­¤XRPé€‰æ‹©åœ¨NVMe Driverå±‚æ¥å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;io_uring&#34;&gt;io_uring&lt;/h3&gt;
&lt;p&gt;io_uringæ˜¯Linuxçš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥æ‰¹é‡æäº¤å¼‚æ­¥I/Oï¼Œå¹¶ä¸”ç›¸è¾ƒäºaioå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä½œè€…é€šè¿‡å®éªŒéªŒè¯äº†åœ¨NVMe Driverå±‚æäº¤I/Oä¹Ÿå¯ä»¥æé«˜io_uringçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-challenges--principles&#34;&gt;0x02 Challenges &amp;amp;&amp;amp; Principles&lt;/h1&gt;
&lt;h2 id=&#34;challenges&#34;&gt;Challenges&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ°å€è½¬æ¢å’Œå®‰å…¨é—®é¢˜ï¼šNVMe Driverä¸èƒ½è®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼Œå› æ­¤ä¸èƒ½å®Œæˆé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ï¼›BPFå¯ä»¥è®¿é—®å…¶ä»–æ–‡ä»¶å’Œç”¨æˆ·çš„ä»»ä½•blockã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘å’Œç¼“å­˜é—®é¢˜ï¼šå¯¹äºä»æ–‡ä»¶ç³»ç»Ÿå‘èµ·çš„å¹¶å‘è¯»å†™å¾ˆéš¾ç»´æŠ¤ã€‚ä»æ–‡ä»¶ç³»ç»Ÿå‘å‡ºçš„å†™è¯·æ±‚å°†å†™å…¥åˆ°page cacheä¸­ï¼Œå¯¹äºXRPä¸å¯è§ï¼›åŒæ—¶å¯¹äºç¡¬ç›˜ä¸Šæ•°æ®ç»“æ„å¸ƒå±€çš„ä¿®æ”¹ï¼Œä¾‹å¦‚æ”¹å˜æŸä¸€ä¸ªæŒ‡é’ˆï¼Œå°†ä¼šå¯¼è‡´XRPè·å–åˆ°é”™è¯¯çš„æ•°æ®ï¼Œè™½ç„¶å¯ä»¥è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯ä»NVMeä¸­æ–­è®¿é—®é”çš„å¼€é”€å¤ªå¤§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;observation&#34;&gt;Observation&lt;/h2&gt;
&lt;p&gt;ä½œè€…ç ”ç©¶å‘ç°ï¼Œå¤§éƒ¨åˆ†çš„å­˜å‚¨å¼•æ“çš„ç¡¬ç›˜æ•°æ®ç»“æ„éƒ½æ˜¯ç¨³å®šçš„ï¼Œæˆ–ä¸ä¼šè¿›è¡Œå°±åœ°æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚åœ¨LSM-treeä¸­ï¼Œè¿›è¡Œç´¢å¼•çš„å†™å…¥æ“ä½œï¼Œå†™å…¥åˆ°æ–‡ä»¶&lt;code&gt;SSTables&lt;/code&gt;ä¸­ï¼Œè¿™äº›æ–‡ä»¶ä¸ºä¸å¯å˜ï¼Œç›´è‡³å…¶è¢«åˆ é™¤ï¼Œä¸å¯å˜æ–‡ä»¶è¿˜é™ä½äº†æ–‡ä»¶å¹¶å‘è®¿é—®çš„æˆæœ¬ã€‚B-treeçš„ç´¢å¼•è™½ç„¶å¯ä»¥å°±åœ°æ›´æ–°ï¼Œä½†æ˜¯åœ¨å®é™…æµ‹è¯•ä¸­ï¼ˆ24å°æ—¶YCSBè¯»å†™æ”¹å®éªŒï¼‰å‘ç°ï¼Œç´¢å¼•çš„ä¿®æ”¹æ¬¡æ•°å¾ˆå°‘ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦åœ¨NVMe Driverä¸­é¢‘ç¹çš„æ›´æ–°æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œç´¢å¼•ä¸€èˆ¬å­˜å‚¨åœ¨å°‘é‡çš„å¤§æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ¯ä¸ªç´¢å¼•ä¸ä¼šè·¨è¶Šå¤šä¸ªæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;design-principles&#34;&gt;Design Principles&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€æ¬¡åªè®¿é—®ä¸€ä¸ªæ–‡ä»¶ï¼šå¯ä»¥ç®€åŒ–åœ°å€è½¬æ¢å’Œè®¿é—®æ§åˆ¶ï¼Œè¿˜æœ€å°åŒ–äº†éœ€è¦ä¼ é€’ç»™NVMe driverçš„å…ƒæ•°æ®&lt;/li&gt;
&lt;li&gt;é¢å‘äºç¨³å®šçš„æ•°æ®ç»“æ„ï¼šXRPä»¥ä¸ä¼šé¢‘ç¹æ›´æ–°çš„æ•°æ®ç»“æ„ä¸ºç›®æ ‡RocksDBã€LevelDBã€TokuDBã€WiredTigerï¼Œä¸æ”¯æŒéœ€è¦é”æ¥è®¿é—®çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ç®¡ç†ç¼“å­˜ï¼šXRPæ— æ³•ç›´æ¥è®¿é—®Page Cacheï¼Œå› æ­¤å¦‚æœblockä½äºPage Cacheä¸­ï¼ŒXRPå‡½æ•°ä¸èƒ½å®‰å…¨çš„å¹¶å‘æ‰§è¡Œï¼Œè€Œå¤§å¤šæ•°å­˜å‚¨å¼•æ“éƒ½æ˜¯åœ¨ç”¨æˆ·ç©ºé—´è‡ªè¡Œç®¡ç†Cacheã€‚&lt;/li&gt;
&lt;li&gt;é”™è¯¯å¤„ç†ï¼šå¦‚æœè®¿é—®å¤±è´¥ï¼ˆæ˜ å°„ä¿¡æ¯è¿‡æœŸï¼‰ï¼Œéœ€è¦ç¨‹åºåœ¨ç”¨æˆ·ç©ºé—´é‡è¯•æˆ–å›æ»šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x03-design--implementation&#34;&gt;0x03 Design &amp;amp;&amp;amp; Implementation&lt;/h1&gt;
&lt;p&gt;XRPçš„æ¶æ„å›¾ï¼š&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230225161425201.png&#34; alt=&#34;image-20230225161425201&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h2 id=&#34;resubmission-logic&#34;&gt;Resubmission Logic&lt;/h2&gt;
&lt;p&gt;XRPçš„Resubmissionä¸»è¦åŒ…å«3ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BPF hook&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ç³»ç»Ÿåœ°å€ç¿»è¯‘&lt;/li&gt;
&lt;li&gt;NVMeè¯·æ±‚çš„æ„å»ºå’Œæäº¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“NVMeæŒ‡ä»¤è¯·æ±‚å®Œæˆåï¼Œè®¾å¤‡å‘èµ·ä¸­æ–­ä½¿å†…æ ¸å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ‰§è¡Œä¸­æ–­å¤„ç†ï¼Œå¯¹äºåœ¨&lt;code&gt;ä¸­æ–­ä¸Šä¸‹æ–‡&lt;/code&gt;(å³ISRä¸­æ–­å¤„ç†ç¨‹åºä¿å­˜çš„è¯·æ±‚å‘èµ·ç¨‹åºçš„ä¸Šä¸‹æ–‡)æ¯ä¸ªNVMeè¯·æ±‚ï¼ŒXRPè°ƒç”¨ç›¸å…³çš„BPFå‡½æ•°ï¼Œå³ä¸Šå›¾çš„&lt;code&gt;bpf_func_0&lt;/code&gt;ï¼Œè¯¥å‡½æ•°æŒ‡é’ˆå­˜å‚¨åœ¨å†…æ ¸I/Oè¯·æ±‚çš„ç»“æ„ä½“ä¸­ï¼ˆbioï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒç”¨BPFå‡½æ•°åï¼ŒXRPè°ƒç”¨å…ƒæ•°æ®ä¿¡æ¯æ‘˜è¦ï¼Œæ­¤æ–‡ä»¶ç³»ç»Ÿæ‘˜è¦ç”¨äºåšåœ°å€è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼ŒXRPå‘èµ·ä¸‹ä¸€æ¬¡NVMeè¯·æ±‚ï¼Œå°†è¯·æ±‚appendåˆ°ç›¸åº”CPUæ ¸å¿ƒNVMeçš„SQä¸­å®Œæˆresubmissionï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;bpf-hook&#34;&gt;BPF Hook&lt;/h3&gt;
&lt;p&gt;XRPå¼•å…¥&lt;code&gt;BPF_PROG_TYPE_XRP&lt;/code&gt;ä½œä¸ºBPFå‡½æ•°çš„ç­¾åï¼ˆå‡½æ•°ç­¾åä¸€èˆ¬åŒ…æ‹¬å‡½æ•°çš„å‚æ•°ç±»å‹ã€ä¸ªæ•°ç­‰ï¼‰ï¼Œç¬¦åˆè¯¥ç­¾åçš„ç¨‹åºå¯ä»¥è¢«BPF Hookè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230225182708553.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230225182708553&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å‚æ•°è§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;data&lt;/code&gt;ï¼šå­˜å‚¨ä»ç¡¬ç›˜ä¸­è¯»å–çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚B-tree Pageï¼‰ï¼Œå¯ä»¥è¢«BPFå‡½æ•°è§£æ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;done&lt;/code&gt;ï¼šåœ¨resubmissioné˜¶æ®µé€šè¿‡æ­¤å­—æ®µåˆ¤æ–­æ˜¯å¦å°†æ•°æ®ä¸ŠæŠ¥ç»™ç”¨æˆ·ç¨‹åºï¼Œæˆ–æ˜¯è¿›è¡Œåç»­I/O&lt;/li&gt;
&lt;li&gt;&lt;code&gt;next_addr&lt;/code&gt;ï¼šè¡¨ç¤ºä¸‹ä¸€æ¬¡resubmissionè¦è¯·æ±‚çš„é€»è¾‘åœ°å€ï¼Œæœ€å¤§è¾“å…¥é‡fanouté»˜è®¤é™åˆ¶åœ¨16&lt;/li&gt;
&lt;li&gt;&lt;code&gt;size&lt;/code&gt;ï¼šè¡¨ç¤º&lt;code&gt;next_addr&lt;/code&gt;é€»è¾‘åœ°å€çš„å¤§å°ï¼ŒæŸäº›æƒ…å†µä¸‹å¯ä»¥å°†å…¶è®¾ç½®ä¸º0è¡¨ç¤ºä¸å‘èµ·I/O&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scratch&lt;/code&gt;ï¼šå¯¹äºç”¨æˆ·å’ŒBPFå‡½æ•°ç§æœ‰ï¼Œç”¨äºå‘BPFå‡½æ•°ä¼ é€’ç”¨æˆ·çš„å‚æ•°ï¼ŒBPFå‡½æ•°ä¹Ÿå¯ä»¥åœ¨æ­¤å­˜å‚¨ä¸¤æ¬¡I/Oä¹‹é—´çš„ä¸­é—´å˜é‡ï¼Œäº¦æˆ–æ˜¯ä¿å­˜ä¼ é€’ç»™ç”¨æˆ·çš„æ•°æ®ã€‚ç›¸å½“äºBPFå¯ä»¥åˆ©ç”¨çš„ä¸€ä¸ª4KBçš„bufferã€‚å¦‚æœBPFå‡½æ•°éœ€è¦æ›´å¤§çš„ç©ºé—´ï¼Œè¿˜å¯ä»¥ä½¿ç”¨BPF maps&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;BPFä¸Šä¸‹æ–‡å¯¹äºä¸€ä¸ªNVMeè¯·æ±‚æ˜¯ç§æœ‰çš„ï¼Œä¸éœ€è¦è€ƒè™‘åŠ é”ã€‚ä¸ºç”¨æˆ·æä¾›scratch bufferé¿å…äº†è°ƒç”¨&lt;code&gt;bpf_map_lookup_elem&lt;/code&gt;æ¥è®¿é—®bufferäº§ç”Ÿçš„å¼€é”€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;bpf-verifier&#34;&gt;BPF Verifier&lt;/h3&gt;
&lt;p&gt;BPFæ ¡éªŒå™¨é€šè¿‡è¿½è¸ª&lt;code&gt;å¯„å­˜å™¨ä¸­valueçš„è¯­ä¹‰&lt;/code&gt;æ¥ä¿è¯å†…å­˜å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæœ‰æ•ˆçš„valueæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ ‡é‡ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SCALAR_TYPE&lt;/code&gt;è¡¨ç¤ºä¸€ä¸ªä¸èƒ½è¢«æŒ‡é’ˆå–å€¼(cannot be dereference)çš„valueã€‚&lt;/p&gt;
&lt;p&gt;verifierå®šä¹‰äº†å¤šç§æŒ‡é’ˆç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªBPFå‡½æ•°éƒ½å®šä¹‰äº†ä¸€ä¸ªå›è°ƒå‡½æ•°&lt;code&gt;is_valid_access()&lt;/code&gt;æ¥æ£€æŸ¥ä¸Šä¸‹æ–‡è®¿é—®æ˜¯å¦æ­£ç¡®å¹¶è¿”å›ä¸Šä¸‹æ–‡ä¸­value typeå­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;PTR_TO_MEMè¡¨ç¤ºä¸€ä¸ªæŒ‡å‘å›ºå®šå†…å­˜å¤§å°çš„æŒ‡é’ˆï¼Œæ”¯æŒç›´æ¥é€šè¿‡offsetå–å€¼ï¼ˆä¸è¶…è¿‡è¾¹ç•Œçš„æƒ…å†µä¸‹ï¼‰ï¼Œ&lt;code&gt;BPF_PROG_TYPE_XRP&lt;/code&gt;çš„dataå’Œscratchå­—æ®µé€šè¿‡&lt;code&gt;PTR_TO_MEM&lt;/code&gt;è®¿é—®ï¼Œå…¶ä½™éƒ¨åˆ†åˆ™ä¸ºSCALAR_TYPEã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;is_valid_access()&lt;/code&gt;è¿˜å¯ä»¥ç”¨æ¥ä¼ é€’data/scratch bufferçš„å¤§å°ï¼Œç”¨äºåšè¾¹ç•Œæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;metadata-digest&#34;&gt;Metadata Digest&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å®Œæˆåœ¨NVMe Driverä¸­çš„åœ°å€è½¬æ¢ï¼ŒXRPåœ¨æ–‡ä»¶ç³»ç»Ÿå’Œä¸­æ–­å¤„ç†ç¨‹åºä¹‹é—´æ·»åŠ äº†ä¸€ä¸ªæ¥å£ã€‚æ–‡ä»¶ç³»ç»Ÿå…±äº«é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;å…ƒæ•°æ®æ‘˜è¦å…±æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;å½“åœ°å€æ˜ å°„è¢«æ›´æ–°æ—¶ï¼Œ&lt;strong&gt;æ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;å°†è°ƒç”¨updateå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–­å¤„ç†ç¨‹åº&lt;/strong&gt;åˆ™è´Ÿè´£è°ƒç”¨lookupå‡½æ•°ï¼Œé€šè¿‡æ¥æ”¶åˆ°çš„inodeåœ°å€ï¼Œç»™å‡ºoffsetå’Œé•¿åº¦è·å–åœ°å€æ˜ å°„ï¼›lookupä¸­ä¹Ÿä¼šæœ‰è¶Šç•Œæ£€æŸ¥æ¥ä¿è¯å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230225205022040.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230225205022040&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å½“æ£€æµ‹åˆ°ä¸åˆæ³•çš„é€»è¾‘åœ°å€ï¼ŒXRPå°†ç«‹å³è¿”å›é”™è¯¯ä»£ç åˆ°ç”¨æˆ·ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…åœ¨ext4æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä¸­ï¼Œå…ƒæ•°æ®æ‘˜è¦æ¥è‡ªç¼“å­˜ä¸­çš„extent status treeï¼Œä½¿ç”¨RCUæœºåˆ¶è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¤ªé•¿ä¸çœ‹ï¼š&lt;/p&gt;
&lt;p&gt;RCUæ˜¯ä¸€ç§ç±»ä¼¼äºCOWå†™æ—¶å¤åˆ¶çš„æœºåˆ¶ï¼Œå› ä¸ºè¯»å–æ“ä½œä¸éœ€è¦åŠ é”ï¼Œåœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶å¯ä»¥ä¿è¯é«˜æ€§èƒ½ï¼ŒRCUä¸»è¦ç”¨äºLinuxå†…æ ¸ä¸­å¯¹é«˜å¹¶å‘è®¿é—®æ•°æ®ç»“æ„çš„ä¼˜åŒ–ï¼Œè€Œå†™æ—¶å¤åˆ¶ä¸»è¦ç”¨äºå†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿç­‰é¢†åŸŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Linux RCUï¼š&lt;/p&gt;
&lt;p&gt;Linux RCUï¼ˆRead-Copy-Updateï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å¹¶å‘è®¿é—®å…±äº«æ•°æ®ç»“æ„çš„æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§æ— é”å¹¶å‘æœºåˆ¶ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«æ•°æ®ï¼Œè€Œä¸éœ€è¦äº’æ–¥é”æˆ–è¯»å†™é”ç­‰ä¼ ç»Ÿçš„åŒæ­¥æœºåˆ¶ï¼Œä»è€Œæé«˜äº†å¹¶å‘æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚&lt;/p&gt;
&lt;p&gt;RCUçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ›´æ–°å…±äº«æ•°æ®æ—¶ï¼Œå®ƒå°†æ•°æ®å¤åˆ¶ä¸€ä»½ï¼Œå¹¶åœ¨å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸æ˜¯åœ¨åŸå§‹æ•°æ®ä¸Šè¿›è¡Œä¿®æ”¹ã€‚å…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®åŸå§‹æ•°æ®ï¼Œç›´åˆ°æ›´æ–°å®Œæˆã€‚åœ¨æ›´æ–°å®Œæˆåï¼Œæ–°çš„æ•°æ®å‰¯æœ¬å°†æ›¿æ¢åŸå§‹æ•°æ®ï¼Œå¹¶ä¸”RCUæœºåˆ¶å°†ç¡®ä¿åœ¨è¯¥æ›´æ–°ä¹‹å‰ä»»ä½•å·²ç»è¯»å–çš„æ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;RCUé€‚ç”¨äºé«˜å¹¶å‘è®¿é—®æ•°æ®ç»“æ„çš„åœºæ™¯ï¼Œä¾‹å¦‚å“ˆå¸Œè¡¨ã€é“¾è¡¨å’Œæ ‘ç­‰æ•°æ®ç»“æ„ã€‚å®ƒå·²ç»è¢«å¹¿æ³›åº”ç”¨äºLinuxå†…æ ¸ä¸­ï¼Œä½¿å¾—Linuxå†…æ ¸åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„æ€§èƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;ext4ä¸­ï¼Œextentsæ‰©å±•å—æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€æ®µè¿ç»­çš„å—ï¼Œä¸€èˆ¬ç”¨äºå­˜å‚¨å¤§æ–‡ä»¶çš„æ•°æ®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯ç¼“å­˜æ•°æ®ä¸ext4ä¸­çš„extentsä¸€è‡´ï¼Œupdateå‡½æ•°ä¼šåœ¨extentså‘ç”Ÿä¿®æ”¹æˆ–è€…åˆ é™¤æ—¶è°ƒç”¨ã€‚åŒæ—¶ä¸ºäº†é˜²æ­¢ç«æ€ï¼Œä¸ºæ¯ä¸ªæ‰©å±•å—ç»´æŠ¤äº†ä¸€ä¸ªç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ•°æ®è¯»å–åï¼Œä½†è¿˜æ²¡æœ‰ä¼ é€’ç»™BPFå‡½æ•°ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨å…ƒæ•°æ®æ‘˜è¦çš„æŸ¥æ‰¾ã€‚å¦‚ä½•ç›¸åº”çš„extentså·²ç»è¢«åˆ é™¤æˆ–è€…å½“å‰ç‰ˆæœ¬å·å·²ç»è½åï¼ŒXRPå°†ä¸­æ–­æ­¤æ¬¡æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬è€Œè¨€ï¼Œä¸ºä¿éšœå®‰å…¨å’Œæ­£ç¡®æ€§ï¼Œåœ¨ç¨‹åºä¹‹é—´è¿›è¡ŒåŒæ­¥æ—¶å°±ä¼šå¯¹æ–‡ä»¶ä¸­ä¸€ä¸ªéƒ¨åˆ†çš„åŠ é”ï¼Œå› æ­¤ç‰ˆæœ¬å·çš„æ”¹å˜å¤§å¤šæ¥è‡ªäºæ¶æ„ä¿®æ”¹æˆ–ç¨‹åºå‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç§æ›´ç®€å•çš„å®ç°åˆ©ç”¨ext4æ–‡ä»¶ç³»ç»Ÿç°æœ‰çš„extent treeæ›´æ–°å’Œè®¿é—®å‡½æ•°æ¥è·å–å…ƒæ•°æ®æ‘˜è¦ï¼Œè¿™ä¼šä¿è¯ext4ä¸­çš„extent treeæ—¶åˆ»æ˜¯æœ€æ–°çŠ¶æ€ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾ext4ä¸­extentæŸ¥æ‰¾å‡½æ•°ä¼šè·å–è‡ªæ—‹é”ï¼Œå¯¹äºä¸­æ–­å¤„ç†ç¨‹åºå¸¦æ¥äº†æå¤§çš„å¼€é”€ï¼Œå› æ­¤ä¸å¤ªåˆé€‚ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰XRPä»…æ”¯æŒäº†ext4æ–‡ä»¶ç³»ç»Ÿã€‚å¯¹äºF2FSå¯ä»¥ç›´æ¥åˆ©ç”¨å­˜å‚¨äº†é€»è¾‘ç‰©ç†åœ°å€å—æ˜ å°„çš„Node Address Tableï¼ˆNATï¼‰ï¼Œé€šè¿‡ä¿å­˜ä¸€ä¸ªNATçš„å‰¯æœ¬æ¥å¾—åˆ°å…ƒæ•°æ®æ‘˜è¦ã€‚æ¯æ¬¡æ›´æ–°NATéƒ½è°ƒç”¨&lt;code&gt;update_mapping&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;resubmitting-nvme-request&#34;&gt;Resubmitting NVMe Request&lt;/h3&gt;
&lt;p&gt;åœ¨æŸ¥è¯¢åˆ°æ•°æ®å—çš„ç‰©ç†åœ°å€åï¼ŒXRPå°†å‡†å¤‡æäº¤NVMeè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;XRPé‡å¤åˆ©ç”¨åˆšåˆšå®Œæˆçš„NVMeè¯·æ±‚ç»“æ„ï¼Œä¿®æ”¹NVMeè¯·æ±‚ä¸­çš„ç‰©ç†æ‰‡åŒºå’Œå—åœ°å€ä¸ºé€šè¿‡lookupå‡½æ•°æŸ¥è¯¢åˆ°çš„åç§»é‡ï¼Œç„¶åç»§ç»­è¿›è¡Œè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºbpf_xrpæ”¯æŒçš„æœ€å¤§åœ°å€ä¸ªæ•°ä¸º16ï¼Œç›®å‰çš„resubmitåªèƒ½è·å–åˆ°å’Œåˆå§‹NVMeè¯·æ±‚ä¸€æ ·å¤šçš„ç‰©ç†æ®µã€‚ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªNVMeè¯·æ±‚åªç”³è¯·äº†ä¸€ä¸ªç‰©ç†æ®µï¼Œé‚£ä¹ˆåç»­çš„NVMeè¯·æ±‚ä¹Ÿåªèƒ½å»è·å–ä¸€ä¸ªç‰©ç†æ®µã€‚&lt;/p&gt;
&lt;p&gt;XRPä¼šä¸­æ–­åŒ…å«æ— æ•ˆåœ°å€çš„BPFè°ƒç”¨ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€æ¬¡I/Oä¸­next_addrä¸­è®¾ç½®16ä¸ªä¼ªNVMeæŒ‡ä»¤ï¼Œä»¥ä¿è¯åç»­çš„è¯·æ±‚å¯ä»¥æœ‰è¶³å¤Ÿçš„è®¿é—®ç©ºé—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;synchronization-limitations&#34;&gt;Synchronization Limitations&lt;/h2&gt;
&lt;p&gt;BPFç›®å‰åªæ”¯æŒè‡ªæ—‹é”è¿›è¡ŒåŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;Verifieråªå…è®¸BPFç¨‹åºä¸€æ¬¡åªè·å–ä¸€ä¸ªé”ï¼Œå¹¶ä¸”åœ¨å‡½æ•°é€€å‡ºå‰è¦å°†å…¶é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·ç¨‹åºä¸éœ€è¦ç›´æ¥å»è®¿é—®BPFçš„è‡ªæ—‹é”ï¼Œå¯ä»¥ç›´æ¥è¿›è¡ŒBPFçš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨å¯ä»¥åœ¨æŒæœ‰é”æ—¶å¯¹ä¿æŠ¤çš„æ•°æ®ç»“æ„è¿›è¡Œè¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦åœ¨å¤šä¸ªè¯»å†™æ“ä½œä¹‹é—´è¿›è¡ŒåŒæ­¥çš„å¤æ‚æ“ä½œåœ¨ç”¨æˆ·ç©ºé—´æ— æ³•å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·å¯ä»¥é€šè¿‡BPFçš„åŸå­æ“ä½œå®ç°è‡ªå®šä¹‰çš„è‡ªæ—‹é”ï¼Œè¿™å…è®¸BPFå‡½æ•°å’Œç”¨æˆ·ç¨‹åºç›´æ¥è·å–ä»»ä½•è‡ªæ—‹é”ã€‚ç„¶è€ŒBPFå‡½æ•°çš„è¡Œä¸ºä¼šè¢«é™åˆ¶ï¼Œé˜²æ­¢æ— é™åœ°ç­‰å¾…æŸä¸€ä¸ªè‡ªæ—‹é”ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§åŒæ­¥æ–¹æ³•å°±æ˜¯RCUã€‚XRP BPFéƒ½è¿è¡Œåœ¨NVMeä¸­æ–­å¤„ç†ç¨‹åºä¸Šï¼Œè€Œä¸­æ–­å¤„ç†ç¨‹åºä¸èƒ½è¢«æŠ¢å ï¼Œå¯ä»¥è®¤ä¸ºä»–ä»¬å·²ç»è¿›å…¥äº†RCUè¯»ç«¯ä¸´ç•ŒåŒºï¼ˆa RCU read-side critical sectionï¼‰çš„çŠ¶æ€ï¼Œå› ä¸ºåœ¨ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œæ—¶ï¼Œå…¶ä»–ä»»åŠ¡æ— æ³•è®¿é—®å…±äº«æ•°æ®ç»“æ„ï¼Œä»è€Œé¿å…äº†å¹¶å‘å†²çªã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBPFç¨‹åºä¸éœ€è¦è·å¾—é”æ¥è¯»å–å…±äº«æ•°æ®ç»“æ„ï¼Œä»è€Œé¿å…äº†é”çš„å¼€é”€ï¼Œå¹¶æé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;linux-schedulers&#34;&gt;Linux Schedulers&lt;/h2&gt;
&lt;h3 id=&#34;è¿›ç¨‹è°ƒåº¦&#34;&gt;è¿›ç¨‹è°ƒåº¦&lt;/h3&gt;
&lt;p&gt;ä½œè€…ç ”ç©¶å‘ç°æ ¹æ®Linuxçš„CFSå®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼Œå½“è®¡ç®—å¯†é›†å‹çš„è¿›ç¨‹å’ŒI/Oå¯†é›†å‹çš„è¿›ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªæ ¸å¿ƒæ—¶ï¼Œç”±äºè¶…ä½å»¶è¿ŸSSDçš„ä¸­æ–­è¿‡äºé¢‘ç¹ï¼Œä½¿å¾—I/Oå¯†é›†å‹åº”ç”¨äº§ç”Ÿçš„I/Oä¸­æ–­å ç”¨å¤§é‡æ—¶é—´ç‰‡ï¼Œå¯¼è‡´è®¡ç®—å¯†é›†å‹è¿›ç¨‹çš„é¥¥é¥¿ã€‚è€Œåœ¨æ™®é€šSSDä¸Šï¼Œç”±äºä¸­æ–­äº§ç”Ÿçš„é¢‘ç‡è¾ƒä½ï¼Œä¸ä¼šå‘ç”Ÿæ­¤ç°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿ç»­äº§ç”Ÿä¸­æ–­è¾ƒå¤šçš„XRPã€ç½‘ç»œä¸­æ–­è¾ƒå¤šçš„ç¨‹åºä¼šåŠ å‰§ï¼ˆexarcerbatesï¼‰æ­¤é—®é¢˜ï¼Œä½œè€…è®¡åˆ’åœ¨ä¹‹åè€ƒè™‘æ­¤é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ioè°ƒåº¦&#34;&gt;I/Oè°ƒåº¦&lt;/h3&gt;
&lt;p&gt;NVMeé»˜è®¤ä½¿ç”¨noopè°ƒåº¦å™¨ï¼Œå¦‚æœéœ€è¦å…¬å¹³è°ƒåº¦ï¼Œå¯ä»¥å¼€å¯ç¡¬ä»¶é˜Ÿåˆ—æ€»è£ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x04-case-studies&#34;&gt;0x04 Case Studies&lt;/h1&gt;
&lt;h2 id=&#34;use-xrp&#34;&gt;Use XRP&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·è°ƒç”¨ä¸‹å›¾ä¸¤ä¸ªæ¥å£æ¥åŠ è½½BPFå‡½æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bpf_prog_load&lt;/code&gt;ï¼šåŠ è½½&lt;code&gt;BPF_PROG_TYPE_XRP&lt;/code&gt;ç±»å‹çš„BPFå‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;read_xrp&lt;/code&gt;ï¼šå°†è°ƒç”¨BPFå‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ªå…·ä½“çš„è¯·æ±‚ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230226143117688.png&#34; alt=&#34;image-20230226143117688&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;p&gt;å…·ä½“çš„ä½¿ç”¨å®ä¾‹ï¼Œä½œè€…ç»™å‡ºäº†ä¸¤ä¸ªç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bpf-kv&#34;&gt;BPF-KV&lt;/h2&gt;
&lt;p&gt;ä½œè€…ä½¿ç”¨B+æ ‘åœ¨ç£ç›˜ç»„ç»‡æ•°æ®ï¼ŒåŒæ—¶è‡ªè¡Œç»´æŠ¤DRAM Cacheæ¥å¯¹å—å’Œå¯¹è±¡è¿›è¡Œç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¤§è¯·æ±‚æ•°é‡é™åˆ¶ä¸º31ï¼Œä¿è¯å¯ä»¥éå†ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰31ä¸ªå­©å­ã€‚&lt;/p&gt;
&lt;p&gt;BPFå‡½æ•°ç”¨äºæŸ¥æ‰¾KVå¯¹ï¼Œé¦–å…ˆè·å–åœ¨scratch bufferä¸­çš„æŸ¥è¯¢ç›®æ ‡keyï¼Œå¹¶çº¿æ€§åœ°åœ¨nodeä¸­æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;read_xrp&lt;/code&gt;æ¥å®ç°readç³»ç»Ÿè°ƒç”¨ï¼ŒBPF-KVé¦–å…ˆä¸ºscratch bufferåˆ†é…ä¸€å—ç©ºé—´ï¼Œå¹¶è®¡ç®—å‡ºoffsetæ¥å¯åŠ¨readã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230226152454999.png&#34; alt=&#34;image-20230226152454999&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;BPF-KVæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®ä¿å­˜åœ¨scratch bufferä¸­ã€‚&lt;/p&gt;
&lt;p&gt;BPF-KVæ”¯æŒSUMã€MAXã€MINæ­¤ç±»æ“ä½œ&lt;/p&gt;
&lt;h2 id=&#34;wiredtiger&#34;&gt;WiredTiger&lt;/h2&gt;
&lt;p&gt;WiredTigeræ˜¯MongoDBçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥ä½¿ç”¨LSM-treeä½œä¸ºæ•°æ®ç»“æ„ï¼Œæ•°æ®ä¿å­˜äºLSMçš„ä¸åŒlevelä¹‹é—´ï¼Œæ¯ä¸ªlevelä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ²¡ä¸ªæ–‡ä»¶ä½¿ç”¨B-treeç´¢å¼•ã€‚æ‰€æœ‰çš„æ–‡ä»¶ä¸ºåªè¯»ï¼Œæ›´æ–°å’Œæ’å…¥æ“ä½œå…ˆå†™å…¥å¦‚bufferä¸­ï¼Œbufferç©ºé—´ä¸è¶³æ—¶ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;XRPåªé’ˆå¯¹readæ“ä½œåšä¼˜åŒ–ï¼Œupdateå’Œinsertåœ¨bufferä¸­ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;WTçš„BPFå‡½æ•°å’ŒBPF-KVå·®ä¸å¤šï¼ŒWTéœ€è¦å¯¹B-treeçš„Pageåšè§£ææ“ä½œã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x05-thinking&#34;&gt;0x05 Thinking&lt;/h1&gt;
&lt;p&gt;XRPæ˜¯OSDI&#39;22çš„best paperï¼Œæ–‡ç« æ•´ä½“çš„å·¥ä½œé‡éå¸¸å¤§ï¼Œä¿®æ”¹äº†ext4æ–‡ä»¶ç³»ç»Ÿã€BPFæ¨¡å—ï¼Œå¹¶è®¾è®¡äº†ä¼˜åŒ–åçš„KVå­˜å‚¨å¼•æ“ã€‚æ–‡ç« ä»å¾ˆæ–°é¢–çš„è§’åº¦ä¼˜åŒ–äº†æ•°æ®åº“å¼•æ“ç­‰I/Oå¯†é›†å‹åº”ç”¨ï¼Œä¸éœ€è¦é¢‘ç¹ä¼ é€’æ•°æ®äºç”¨æˆ·ç©ºé—´å’ŒNVMe Driveræ—¶é—´ï¼Œä¹Ÿå‡å°‘äº†I/Oè¿‡ç¨‹ä¸­åœ¨è½®è¯¢æ—¶çš„å¼€é”€ï¼Œæé«˜äº†CPUåˆ©ç”¨ç‡ï¼Œé€šè¿‡BPFè¿™ä¸€å†…æ ¸ç‰¹æ€§å¯ä»¥å®ç°è‡ªå®šä¹‰I/Oå‡½æ•°ï¼ŒåŒæ—¶ä¿è¯ä¸€å®šçš„å®‰å…¨æ€§å’Œéš”ç¦»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x06-reference--more-information&#34;&gt;0x06 Reference &amp;amp;&amp;amp; More information&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://medium.com/databasss/on-disk-io-part-3-lsm-trees-8b2da218496f&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;LSM ä¸å¯ä¿®æ”¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.kernel.org/doc/html/latest/RCU/whatisRCU.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€kernel.orgã€‘ RCU&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/mongodb-wiredtiger/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€dravenessã€‘MongoDBå’ŒWiretigerå­˜å‚¨å¼•æ“&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>[FAST&#39;22] MT^2: Memory Bandwidth Regulation on Hybrid NVM/DRAM Platforms</title>
        <link>https://blog.ipandai.club/p/fast22-mt2-memory-bandwidth-regulation-on-hybrid-nvm/dram-platforms/</link>
        <pubDate>Mon, 19 Dec 2022 16:50:00 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/fast22-mt2-memory-bandwidth-regulation-on-hybrid-nvm/dram-platforms/</guid>
        <description>&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;NVMå’ŒDRAMå…±äº«å†…å­˜æ€»çº¿ï¼ŒäºŒè€…ä¹‹é—´çš„è´Ÿè½½ç›¸äº’å¹²æ‰°ï¼Œç»™æ··åˆNVM/DRAMå¹³å°çš„å¸¦å®½åˆ†é…å¸¦æ¥äº†æŒ‘æˆ˜&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†MT2ï¼Œå¯ä»¥åœ¨æ··åˆNVM/DRAMå¹³å°ä¸­ç®¡ç†å¹¶å‘ç¨‹åºé—´çš„å†…å­˜å¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;MT2é¦–å…ˆæ£€æŸ¥å†…å­˜æµé‡é—´çš„å¹²æ‰°å¹¶é€šè¿‡ç¡¬ä»¶ç›‘è§†å™¨å’Œè½¯ä»¶æ±‡æŠ¥ä»æ··åˆæµé‡ç›‘æ§ä¸åŒç±»å‹çš„å†…å­˜å¸¦å®½&lt;/p&gt;
&lt;p&gt;ç„¶åMT2åˆ©ç”¨ä¸€ä¸ªåŠ¨æ€çš„å¸¦å®½æµé‡è°ƒèŠ‚ç®—æ³•åŸºäºå¤šç§æ–¹å¼æ¥ç®¡ç†å†…å­˜å¸¦å®½&lt;/p&gt;
&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„ç®¡ç†ä¸åŒç¨‹åºï¼ŒMT2è¢«é›†æˆåˆ°äº†cgroupä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªç”¨äºå¸¦å®½åˆ†é…çš„cgroup subsystem&lt;/p&gt;
&lt;p&gt;æ–°å…´çš„NVMå­˜å‚¨å™¨é€æ¸è¢«ç”¨æ¥åšä¸ºå¯æŒä¹…åŒ–å†…å­˜æ¥ä½¿ç”¨ï¼ŒåŸºäºNVMï¼Œæå‡ºäº†NVMæ–‡ä»¶ç³»ç»Ÿï¼ŒNVMç¼–ç¨‹åº“ï¼ŒNVMæ•°æ®ç»“æ„ã€NVMæ•°æ®åº“ï¼ŒNVMä½œä¸ºå¤§å®¹é‡å†…å­˜æˆ–è€…å¿«é€Ÿçš„å­—èŠ‚å¯»å€å­˜å‚¨è®¾å¤‡ç”¨äºæ•°æ®ä¸­å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€ŒNVM/DRAMæ··åˆå¹³å°åŠ å‰§äº†åµé—¹é‚»å±…é—®é¢˜ã€‚åœ¨äº‘å­˜å‚¨ç¯å¢ƒä¸­ï¼Œå¤šä¸ªç”¨æˆ·å¸¸å¸¸å…±äº«ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸åŒç”¨æˆ·çš„ä¸åŒåº”ç”¨ç¨‹åºå…±äº«ä¸»æœºçš„ä¸€æ¡æ€»çº¿ï¼ŒæŸäº›åº”ç”¨å¯èƒ½ä¼šè¿‡åº¦ä½¿ç”¨å†…å­˜å¸¦å®½ã€‚åœ¨NVM/DRAMä¸­ï¼ŒNVMå’ŒDRAMå…±äº«åŒä¸€ä¸ªæ€»çº¿ï¼Œå› æ­¤ä¸åŒçš„åº”ç”¨ç¨‹åºå°†ç«äº‰æœ‰é™çš„å†…å­˜å¸¦å®½ï¼Œå½±å“æ•´ä½“çš„æ€§èƒ½&lt;/p&gt;
&lt;p&gt;åœ¨NVM/DRAMä¸­è°ƒèŠ‚å¸¦å®½æœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜å¸¦å®½ä¸å¯¹ç§°ï¼Œåœ¨NVM/DRAMï¼Œä¸åŒçš„å†…å­˜è®¿é—®ï¼ˆå¦‚DRAM readï¼ŒDRAM writeï¼ŒNVM readå’ŒNVM writeï¼‰ä¼šäº§ç”Ÿä¸åŒçš„æœ€å¤§å†…å­˜å¸¦å®½ã€‚å†…å­˜çš„å®é™…å¯ç”¨å¸¦å®½ä¸»è¦å–å†³äºè´Ÿè½½ä¸­ä¸åŒç±»å‹è®¿é—®çš„å æ¯”ã€‚åŒæ—¶è®¾ç½®é™æ€çš„å†…å­˜å¸¦å®½è€Œä¸è€ƒè™‘å®é™…çš„I/Oè®¿é—®å æ¯”æ˜¯ä¸æ­£ç¡®çš„åšæ³•ã€‚åŒæ—¶NVMæœ€å¤§å¸¦å®½é€šå¸¸å°äºDRAMã€‚è€Œä¸”ä¸åŒç±»å‹çš„å†…å­˜è®¿é—®çš„å¹²æ‰°ç¨‹åº¦ä¸åŒï¼Œå› æ­¤ä¸èƒ½å•çº¯å°†æ‰€æœ‰å†…å­˜==è®¿é—®å»¶è¿Ÿ==è§†ä¸ºç›¸ç­‰&lt;/li&gt;
&lt;li&gt;NVMå’ŒDRAMå…±äº«å†…å­˜æ€»çº¿ï¼ŒNVMæµé‡å’ŒDRAMæµé‡ä¸å¯é¿å…åœ°ä¼šæ··åˆå¹¶ä¸”å¾ˆéš¾åŒºåˆ†ã€‚å¯¹äºæ··åˆçš„æµé‡ï¼Œç›‘æ§ä¸åŒç§ç±»çš„å†…å­˜å¸¦å®½ã€‚ç”±äºå†…å­˜æµé‡æ··åˆï¼Œå‡ ä¹ä¸å¯èƒ½åœ¨æ¯ä¸ªè¿›ç¨‹çš„åŸºç¡€ä¸Šç›‘æ§ä¸åŒç±»å‹çš„å†…å­˜å¸¦å®½ï¼Œè¿™ä½¿ä¸ºDRAMè®¾è®¡çš„ç°æœ‰ç¡¬ä»¶å’Œè½¯ä»¶è°ƒèŠ‚æ–¹æ³•æ— æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;å†…å­˜è°ƒèŠ‚çš„ç¡¬ä»¶å’Œè½¯ä»¶æœºåˆ¶ä¸è¶³ã€‚ç”±äºNVMå’ŒDRAMéƒ½å¯ä»¥é€šè¿‡CPUè´Ÿè½½/å­˜å‚¨æŒ‡ä»¤ç›´æ¥è®¿é—®ï¼Œå› æ­¤ä¸ºäº†æ€§èƒ½ï¼Œå¯¹æ¯ä¸ªå†…å­˜è®¿é—®è¿›è¡Œè®¡ç®—å’Œé™æµæ˜¯ä¸åˆ‡å®é™…çš„ã€‚CPUä¾›åº”å•†ï¼Œå¦‚è‹±ç‰¹å°”ï¼Œæ”¯æŒç¡¬ä»¶æœºåˆ¶æ¥è°ƒèŠ‚å†…å­˜å¸¦å®½ã€‚ç„¶è€Œï¼Œå¸¦å®½é™åˆ¶æ˜¯ç²—ç²’åº¦å’Œå®šæ€§è¿­ä»£çš„ï¼Œè¿™ä¸è¶³ä»¥ç²¾ç¡®çš„å†…å­˜å¸¦å®½è°ƒèŠ‚ã€‚å…¶ä»–ä¸€äº›æ–¹æ³•ï¼Œå¦‚é¢‘ç‡ç¼©æ”¾å’ŒCPUè°ƒåº¦ï¼Œå¯èƒ½ä¼šæä¾›ç›¸å¯¹ç»†ç²’åº¦çš„å¸¦å®½è°ƒæ•´ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä¹Ÿæ˜¯å®šæ€§çš„ï¼Œå¹¶å‡æ…¢äº†è®¡ç®—å’Œå†…å­˜è®¿é—®çš„é€Ÿåº¦ï¼Œå› æ­¤å¯¹æ•´ä¸ªå¹³å°æ€§èƒ½ç¼ºä¹å½±å“ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;MT2ä½œä¸ºLinux Cgroupä¸­çš„ä¸€ä¸ªSubsystemï¼Œç”¨äºå‡è½»åµé—¹é‚»å±…é—®é¢˜ã€‚åœ¨å†…å­˜å¸¦å®½åˆ†é…å’Œäº‘SLOä¿è¯æ–¹é¢æé«˜æ•ˆç‡ã€‚æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‘ç°äº†å¯¼è‡´NVM/DRAMæ··åˆå¹³å°ä¸Šå†…å­˜å¯†é›†å‹åº”ç”¨ç¨‹åºæ˜¾è‘—æ€§èƒ½æµå¤±çš„å†…å­˜å¸¦å®½å¹²æ‰°é—®é¢˜&lt;/li&gt;
&lt;li&gt;é¦–æ¬¡å¯¹åœ¨NVM/DRAMå¹³å°ç°å­˜çš„ç¡¬ä»¶å’Œè½¯ä»¶å¸¦å®½åˆ†é…æœºåˆ¶è¿›è¡Œç ”ç©¶&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆæœ‰æ•ˆåœ°è°ƒèŠ‚å…·æœ‰çº¿ç¨‹çº§ç²’åº¦çš„NVM/DRAMæ··åˆå¹³å°ä¸Šçš„å†…å­˜å¸¦å®½&lt;/li&gt;
&lt;li&gt;åœ¨è‹±ç‰¹å°”Optane SSDä¸Šè¿›è¡Œäº†æµ‹è¯•å’Œåˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸‹ç®€ç§°NVM/DRAM&lt;/p&gt;
&lt;h1 id=&#34;0x01-bg&#34;&gt;0x01 BG&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;MT^2&lt;/strong&gt; æŒä¹…å†…å­˜ï¼ˆPMï¼‰/ éæ˜“å¤±æ€§å†…å­˜ï¼ˆNVMï¼‰çš„å‡ºç°æ­£æ”¹å˜ç€å­˜å‚¨ç³»ç»Ÿçš„é‡‘å­—å¡”å±‚æ¬¡ç»“æ„ã€‚æœ¬æ–‡å‘ç°ï¼Œç”±äº NVM å’Œ DRAM å…±äº«åŒä¸€æ¡å†…å­˜æ€»çº¿ï¼Œå¸¦å®½å¹²æ‰°é—®é¢˜å˜å¾—æ›´ä¸ºä¸¥é‡å’Œå¤æ‚ï¼Œç”šè‡³ä¼šæ˜¾è‘—é™ä½ç³»ç»Ÿçš„æ€»å¸¦å®½ã€‚æœ¬å·¥ä½œä»‹ç»äº†å¯¹å†…å­˜å¸¦å®½å¹²æ‰°çš„åˆ†æï¼Œå¯¹ç°æœ‰è½¯ç¡¬ä»¶æŠ€æœ¯è¿›è¡Œäº†æ·±å…¥è°ƒç ”ï¼Œå¹¶æå‡ºäº†ä¸€ç§åœ¨ NVM/DRAM æ··åˆå¹³å°ä¸Šç›‘æ§è°ƒèŠ‚å¹¶å‘åº”ç”¨çš„å†…å­˜å¸¦å®½çš„è®¾è®¡ï¼ˆMT^2ï¼‰ã€‚MT^2 ä»¥çº¿ç¨‹ä¸ºç²’åº¦å‡†ç¡®ç›‘æµ‹æ¥è‡ªæ··åˆæµé‡çš„ä¸åŒç±»å‹çš„å†…å­˜å¸¦å®½ï¼Œä½¿ç”¨è½¯ç¡¬ä»¶ç»“åˆæŠ€æœ¯æ§åˆ¶å†…å­˜å¸¦å®½ã€‚åœ¨å¤šä¸ªä¸åŒçš„ç”¨ä¾‹ä¸­ï¼ŒMT^2 èƒ½å¤Ÿæœ‰æ•ˆé™åˆ¶â€œåµé—¹é‚»å±…â€ï¼ˆnoisy neighborsï¼‰ï¼Œæ¶ˆé™¤å¸¦å®½å¹²æ‰°ï¼Œä¿è¯é«˜ä¼˜å…ˆçº§åº”ç”¨çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;noisy-neighbors&#34;&gt;Noisy Neighbors&lt;/h2&gt;
&lt;p&gt;åœ¨å¤šç§Ÿæˆ·çš„äº‘ç¯å¢ƒä¸­ï¼Œå†…å­˜å¸¦å®½å¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ç§å¯ä»¥å‡è½»åµé—¹é‚»å±…é—®é¢˜çš„æ–¹æ³•æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Preventionï¼šä¸»åŠ¨ä¸ºåº”ç”¨ç¨‹åºè®¾ç½®å¸¦å®½é™åˆ¶ï¼ˆå›ºå®šçš„ï¼‰&lt;/li&gt;
&lt;li&gt;Remedyï¼šç³»ç»Ÿæ£€æµ‹åµé—¹é‚»å±…æƒ…å†µçš„å‡ºç°å¹¶è¯†åˆ«å‡ºåµé—¹çš„â€œé‚»å±…â€å¯¹å…¶è¿›è¡Œé™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æ–¹æ³•éœ€è¦å»ç›‘æ§åº”ç”¨çš„å¸¦å®½ä½¿ç”¨æƒ…å†µ&lt;/p&gt;
&lt;h2 id=&#34;nvm&#34;&gt;NVM&lt;/h2&gt;
&lt;p&gt;NVMå¾—ç›Šäºå…¶å­˜å‚¨å®¹é‡å¤§ï¼Œè®¿é—®é€Ÿåº¦å¿«çš„ç‰¹æ€§ï¼Œæ­£åœ¨é€æ­¥ä½œä¸ºå†…å­˜ä½¿ç”¨äºå•†ä¸šæœåŠ¡å™¨ä¸­ã€‚å¾—ç›ŠäºPMDKï¼ˆPersistent Memory Development Kitï¼‰åŒæ—¶è¿˜æ¶Œç°å‡ºäº†å¤§é‡åŸºäºNVM Memoryçš„åº”ç”¨ç¨‹åºï¼Œå¦‚PmemKVï¼ŒPmem-RocksDBã€‚&lt;/p&gt;
&lt;p&gt;NVMå¯ä»¥ç›´æ¥é€šè¿‡CPUçš„load/storeæŒ‡ä»¤è¿›è¡Œè®¿é—®&lt;/p&gt;
&lt;h2 id=&#34;memory-bandwidth-interference&#34;&gt;Memory Bandwidth Interference&lt;/h2&gt;
&lt;p&gt;ç”±äºNVMå’ŒDRAMå…±äº«å†…å­˜æ€»çº¿ï¼Œå› æ­¤å­˜åœ¨å¹²æ‰°é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ä¸¤ä¸ªFlexible I/O Testeræ¥ç«äº‰æ€»å¸¦å®½è¿›è¡Œæµ‹è¯•ï¼ŒåŒ…æ‹¬NVM/DRAMçš„è¯»å†™ï¼Œåˆ†åˆ«æ¯”è¾ƒåœ¨ä¸åŒçš„è®¿é—®æ–¹å¼ä¸‹çš„å¸¦å®½å¹²æ‰°æƒ…å†µ&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¢œè‰²è¶Šæ·±è¡¨æ˜å¹²æ‰°è¶Šæ˜æ˜¾ï¼Œå›¾ä¸­æ•°æ®è¡¨ç¤ºä¸ºåœ¨Task Bè¿è¡Œçš„æƒ…å†µä¸‹Task Açš„ååé‡å Task Aloneæƒ…å†µä¸‹çš„ç™¾åˆ†æ¯”ï¼ˆGB/sï¼‰&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230223132031882.png&#34; alt=&#34;image-20230223132031882&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;ä»å›¾ä¸­å¾—å‡ºçš„ä¸¤ä¸ªç»“è®ºä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜çš„å¹²æ‰°å’Œå†…å­˜çš„è®¿é—®æƒ…å†µæœ‰å…³ï¼Œå æ®æ›´å°å¸¦å®½çš„å†…å­˜è®¿é—®å¯èƒ½ä¼šå¯¹å…¶ä»–è®¿é—®é€ æˆæ›´å¤§çš„å½±å“&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NVMçš„è®¿é—®æ¯”DRAMè®¿é—®å¯¹å…¶ä»–ä»»åŠ¡çš„å½±å“æ›´å¤§ï¼Œä¾‹å¦‚å›¾ä¸­NVM Readåˆ—å’ŒDRAM Readåˆ—çš„å¯¹æ¯”ï¼Œè¯´æ˜æ‰§è¡ŒNVM writeè¾ƒå¤šçš„åº”ç”¨æ›´å¯èƒ½æˆä¸ºå½±å“å…¶ä»–ä»»åŠ¡&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½œè€…è¿˜åšäº†Task Bè¿›è¡ŒNVM Writeï¼ŒTask Açš„å»¶è¿Ÿå’Œååé‡çš„å˜åŒ–ï¼Œå‘ç°äº†&lt;strong&gt;éšç€å¸¦å®½çš„é€æ¸é™ä½ï¼ŒTask Açš„å»¶è¿Ÿé€æ¸å¢åŠ ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;memory-bandwidth-monitoring&#34;&gt;Memory Bandwidth Monitoring&lt;/h2&gt;
&lt;p&gt;Intelçš„MBMæŠ€æœ¯å¯ä»¥ç”¨æ¥ç›‘æ§ä»L3 Cacheåˆ°ä¸‹ä¸€çº§å†…å­˜ç³»ç»Ÿçš„å¸¦å®½ä½¿ç”¨æƒ…å†µï¼Œå³NVMæˆ–è€…DRAMï¼Œä¸ºæ¯ä¸ªé€»è¾‘æ ¸å¿ƒéƒ½æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„å†…å­˜å¸¦å®½æµ‹é‡ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªé€»è¾‘æ ¸å¿ƒåˆ†é…äº†ä¸€ä¸ªResource Monitoring IDï¼ˆRMIDï¼‰ï¼Œä¸€ç»„é€»è¾‘æ ¸å¿ƒå¯ä»¥åˆ†é…ç›¸åŒçš„RMIDï¼Œåº•å±‚çš„ç¡¬ä»¶é€šè¿‡è¿½è¸ªå…·æœ‰ç›¸åŒRMIDçš„å†…å­˜å¸¦å®½å¹¶å°†å®ƒä»¬è¿›è¡Œæ±‡æ€»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;memory-bandwidth-allocation&#34;&gt;Memory Bandwidth Allocation&lt;/h2&gt;
&lt;p&gt;Intel MBAæŠ€æœ¯æä¾›é—´æ¥å’Œç²—ç•¥å†…å­˜å¸¦å®½æ§åˆ¶ï¼ŒåŸºæœ¬æ— æ€§èƒ½æŸå¤±ã€‚&lt;/p&gt;
&lt;p&gt;MBAåœ¨æ¯ä¸ªç‰©ç†æ ¸å¿ƒå’Œå…±äº«L3 Cacheä¹‹é—´å¼•å…¥äº†ä¸€ä¸ªå¯ç¼–ç¨‹çš„è¯·æ±‚é€Ÿç‡æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨é€šè¿‡åœ¨å†…å­˜è¯·æ±‚ä¹‹é—´æ’å…¥å»¶è¿Ÿæ¥å¯¹å†…å­˜å¸¦å®½çš„ä½¿ç”¨è¿›è¡Œé™æµã€‚&lt;/p&gt;
&lt;p&gt;Intelè¦æ±‚ä½¿ç”¨Classes of Serviceï¼ˆCLOSï¼‰ä¸ºçº¿ç¨‹è¿›è¡Œåˆ†ç»„ï¼Œç„¶åä¸ºæ¯ä¸ªCLOSè®¾ç½®ä¸€ä¸ªé™æµå€¼ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-design&#34;&gt;0x02 Design&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221223002925874.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221223002925874&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒMT2å·¥ä½œåœ¨Kernel spaceï¼Œå¯ä»¥æ›´æ–¹ä¾¿é«˜æ•ˆåœ°è®¿é—®ç¡¬ä»¶ä¿¡æ¯ã€‚è¿˜èƒ½ä¸å†…æ ¸å…¶ä»–ç»„ä»¶é«˜æ•ˆçš„é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;MT2å¯¹user spaceæš´éœ²äº†ç›¸å…³ç®¡ç†æ¥å£ï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥å°†çº¿ç¨‹åˆ†é…åˆ°ä¸åŒçš„groupå¹¶ä¸”åˆ¶å®šå„ä¸ªgroupæ‰€ä½¿ç”¨çš„å¸¦å®½ï¼Œç§°ä¸ºTGroupï¼ŒThrottling Group&lt;/p&gt;
&lt;p&gt;MT2ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Monitorï¼Œè´Ÿè´£ä»VFSï¼ŒPerformance Monitoring Unitï¼ˆPMUï¼‰ï¼ŒMBMæ”¶é›†æ€§èƒ½æ•°æ®ï¼Œå¹¶å°†å…¶åˆ†ä¸ºå››ç§ç±»å‹DRAM/NVM R/Wï¼Œå°†ä¿¡æ¯è½¬å‘åˆ°Regulator&lt;/li&gt;
&lt;li&gt;Regulatorï¼Œæ ¹æ®ç›‘æ§çš„æ•°æ®å’Œç­–ç•¥ï¼Œæ‰§è¡Œä¸¤ç§æœºåˆ¶ï¼š
&lt;ul&gt;
&lt;li&gt;è°ƒæ•´MBAé™æµå€¼&lt;/li&gt;
&lt;li&gt;è°ƒæ•´CPUé…é¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MT2ä½¿ç”¨åŠ¨æ€å¸¦å®½é™æµç®—æ³•ï¼Œæ ¹æ®å®æ—¶å¸¦å®½å’Œå¹²æ‰°çº§åˆ«ä¸æ–­ç›‘æ§å’Œè°ƒæ•´é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;MT2æä¾›ä¸¤ç§ç¼“è§£åµé—¹é‚»å±…çš„æ–¹æ¡ˆï¼Œæ¥é€‚åº”ä¸åŒåœºæ™¯ï¼Œå¦‚ä¸Šæ–‡æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Preventionï¼šç³»ç»Ÿç®¡ç†å‘˜ä¸ºæ¯ä¸ªTGroupè®¾ç½®å¸¦å®½ä¸Šé™ï¼ŒMT2ç›‘æ§å®æ—¶å¸¦å®½å¹¶ä»¤æ‰€æœ‰groupä¸ä¼šä½¿ç”¨è¶…è¿‡è®¾å®šå€¼çš„å¸¦å®½ã€‚&lt;/li&gt;
&lt;li&gt;Remedyï¼šå¯¹äºæ²¡æœ‰è¶…è¿‡å¸¦å®½é™åˆ¶ï¼Œä½†æ˜¯ä»ç„¶æœ‰å¾ˆå¤§å½±å“çš„TGroupï¼Œå¯ä»¥ç”±ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œé™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ’åˆ†TGroupä¹‹åï¼Œç®¡ç†å‘˜é™åˆ¶æ¯ä¸ªTGroupçš„æœ€å¤§å¸¦å®½ï¼Œç›‘æ§å™¨ä¼šä¿è¯æ¯ä¸ªTGroupçš„å¸¦å®½ä¸ä¼šè¶…è¿‡é˜ˆå€¼&lt;/p&gt;
&lt;p&gt;è¿˜è¦ä¿è¯åœ¨å¤§éƒ¨åˆ†çº¿ç¨‹æ²¡æœ‰è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œäº§ç”Ÿçš„I/Oå¹²æ‰°é—®é¢˜ï¼ˆç©ºé—²çŠ¶æ€ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;monitor&#34;&gt;Monitor&lt;/h2&gt;
&lt;h3 id=&#34;å¸¦å®½ä¼°è®¡&#34;&gt;å¸¦å®½ä¼°è®¡&lt;/h3&gt;
&lt;p&gt;monitoréœ€è¦è·å¾—ä¸åŒç§ç±»I/Oå‡†ç¡®çš„å¸¦å®½ï¼Œä¾‹å¦‚DRAMçš„read/writeå¸¦å®½ï¼ŒNVMçš„read/writeå¸¦å®½ã€‚Regulatorä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥å†³å®šæ˜¯å¦è¦é™åˆ¶æ¯ä¸ªTGroupçš„å†…å­˜å¸¦å®½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºNVM/DRAMçš„readå¸¦å®½ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡PMUè¿›è¡Œè·å–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NVM Read Bandwidthï¼š&lt;code&gt;ocr.all_data_rd.pmm_hit_local_pmm.any_snoop&lt;/code&gt; éœ€è¦é€šè¿‡PMUäº‹ä»¶è®¡æ•°å™¨æ¥æ£€ç´¢æœ¬åœ°NVM readçš„æ•°é‡å¹¶ä¹˜ä¸Šcache line size å³64Bæ¥å¾—å‡ºæ€»å¸¦å®½&lt;/li&gt;
&lt;li&gt;DRAM Read Bandwidthï¼š&lt;code&gt;ocr.all_data_rd.l3_miss_local_dram.any_snoop&lt;/code&gt; DRAM PMU counterè¿›è¡Œç»Ÿè®¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºWriteçš„ç»Ÿè®¡æ— æ³•é€šè¿‡PMUï¼Œéœ€è¦åˆ©ç”¨MBMæ¥ç›‘æ§æ¯ä¸ªTGroupçš„æ€»å†…å­˜è®¿é—®å¸¦å®½ï¼Œä¸ºDRAM read/write Bandwidth å’Œ NVM read/write Bandwidthçš„æ€»å’Œã€‚äºŒè€…çš„Readå¸¦å®½å¯ä»¥å¾ˆå®¹æ˜“è®¡ç®—å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;åªéœ€é€šè¿‡å‘¨æœŸæ€§åœ°æ”¶é›†NVM writeçš„æ•°é‡ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªTGroupæ€»NVM write Bandwidth&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;User-Spaceå¯¹äºNVMçš„writeåªèƒ½é€šè¿‡æ–‡ä»¶ç³»ç»ŸAPIå’Œé€šè¿‡MMapåçš„CPU storeæŒ‡ä»¤æ“ä½œå†…å­˜æ¥å®ç°ï¼Œå¯¹äºæ–‡ä»¶ç³»ç»ŸAPIå¯ä»¥hookå†…æ ¸VFSå¹¶ç›‘æ§æ¯ä¸ªTGroup NVM write çš„æ•°é‡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºMMapçš„è®¿é—®ï¼Œä½œè€…åŸºäºappæ˜¯å¦å—ä¿¡æå‡ºäº†ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºå—ä¿¡ä»»çš„appï¼ˆæ¥è‡ªå—ä¿¡ç”¨æˆ·æˆ–è€…å…¬å¸ä¼ä¸šï¼‰ï¼Œä½¿ç”¨ä»–ä»¬æ¥è¾…åŠ©æ”¶é›†ä½¿ç”¨mmapæ–¹å¼å¯¹NVMè¿›è¡Œçš„writeæ•°é‡ã€‚ä½œè€…æå‡ºäº†ä¿®æ”¹åçš„PMDKï¼Œè°ƒç”¨PMDKçš„APIåˆ·æ–°Cache lines åˆ°NVMæˆ–æ‰§è¡Œæ°¸ä¹…åœ°å†…å­˜å†™å…¥ï¼ˆmovntï¼‰ï¼Œé€šè¿‡è®¡ç®—å¹¶ç»Ÿè®¡æ¯ä¸ªçº¿ç¨‹NVM writeçš„æ•°é‡åˆ°è®¡æ•°å™¨ä¸­ã€‚ä¸ºäº†è¦å°†è®¡æ•°å™¨æŠ¥å‘Šç»™MT2ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è®¾ç½®ä¸€ä¸ªä¸å†…æ ¸å…±äº«çš„é¡µé¢ï¼Œè¿›ç¨‹ä¸­çš„æ¯ä¸ªçº¿ç¨‹å°†å…¶æ¯ä¸ªçº¿ç¨‹è®¡æ•°å™¨çš„å€¼å†™å…¥é¡µé¢ä¸­çš„ä¸åŒä½ç½®ã€‚å†…æ ¸ä¸­çš„MT2å®šæœŸæ£€æŸ¥è®¡æ•°å™¨ï¼Œå¹¶è®¡ç®—æ¯ä¸ªTGroupçš„å¸¦å®½ã€‚åŸºäºPMDKçš„åº”ç”¨æ— åºè¿›è¡Œä¿®æ”¹ï¼Œå…¶ä»–åº”ç”¨éœ€è¦å¯¹æºç è¿›è¡Œå°‘é‡ä¿®æ”¹ã€‚æœ€ç»ˆæ ¹æ®æ”¶é›†çš„NVM writeä¿¡æ¯ï¼Œç»§ç»­è®¡ç®—å‡ºDRAMçš„write å¸¦å®½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
BW_{DW}=BW_{Total}-BW_{DR}-BW_{NR}-BW_{NW}
$$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºä¸å—ä¿¡çš„appï¼ˆå¯èƒ½ä¸ä¼šæŒ‰ç…§è§„å®šä¸Šä¼ NVM writeå¸¦å®½ä¿¡æ¯ï¼‰ï¼Œåªèƒ½è¿›è¡Œç²—ç•¥ä¼°è®¡ã€‚åˆ©ç”¨PEBSï¼ˆProcessor Event Based Sampling å¤„ç†å™¨äº‹ä»¶é‡‡æ ·ï¼‰ï¼Œç”¨äºå¯¹æ¯ä¸ªTGroupå¸¦æœ‰ç›®çš„åœ°å€çš„å†…å­˜writeæ“ä½œè¿›è¡Œé‡‡æ ·ï¼Œé€šè¿‡æ¯”è¾ƒNVMçš„åœ°å€èŒƒå›´ï¼Œå¯ä»¥è®¡ç®—å‡ºNVMå’ŒDRAMä¸­é‡‡æ ·çš„writeæ“ä½œæ¯”ä¾‹ï¼Œå¯¹NVMå’ŒDRAM writeè¿›è¡Œç²—ç•¥ä¼°è®¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¹²æ‰°æ£€æµ‹&#34;&gt;å¹²æ‰°æ£€æµ‹&lt;/h3&gt;
&lt;p&gt;MT2é€šè¿‡æµ‹é‡ä¸åŒç±»å‹å†…å­˜è®¿é—®çš„å»¶è¿Ÿæ¥æ£€æµ‹å¹²æ‰°çº§åˆ«ï¼Œå› ä¸ºå†…å­˜è®¿é—®å»¶è¿Ÿä¸å¸¦å®½è´Ÿç›¸å…³&lt;/p&gt;
&lt;p&gt;MT2é€šè¿‡å››ä¸ªæ€§èƒ½å‚æ•°å¾—åˆ°readå»¶è¿Ÿï¼Œ &lt;code&gt;unc_m_pmm_rpq_occupancy.all &lt;/code&gt;($RPQ_O$), &lt;code&gt;unc_m_pmm_rpq_inserts&lt;/code&gt; ($RPQ_1$), &lt;code&gt;unc_m_rpq_occupancy&lt;/code&gt;, and &lt;code&gt;unc_m_rpq_inserts&lt;/code&gt;ï¼Œé€šè¿‡$\frac{RPQ_O}{RPQ_1}$æ¥è®¡ç®—NVM readå»¶è¿Ÿï¼ŒåŒç†å¾—åˆ°DRAM readå»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;MT2å‘¨æœŸæ€§åœ°å‘èµ·NVMå’ŒDRAM writeè¯·æ±‚ï¼Œä»¥æ­¤æ¥æµ‹é‡å®Œæˆæ—¶é—´ï¼Œè¿›è€Œè·å¾—å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;é€šè¿‡è®¾ç½®é˜ˆå€¼æ¥åˆ¤æ–­å¸¦å®½æ˜¯å¦å‘ç”Ÿå¹²æ‰°&lt;/p&gt;
&lt;p&gt;å¹²æ‰°æ£€æµ‹ä¼ªä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;detect_interference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bt&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bandwidth_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;latency&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THRESHOLD&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä½œè€…ä½¿ç”¨ååé‡é™ä½10%çš„å»¶è¿Ÿä½œä¸ºé˜ˆå€¼&lt;/p&gt;
&lt;h2 id=&#34;regulator&#34;&gt;Regulator&lt;/h2&gt;
&lt;h3 id=&#34;å†…å­˜è°ƒèŠ‚æœºåˆ¶&#34;&gt;å†…å­˜è°ƒèŠ‚æœºåˆ¶&lt;/h3&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230223164328178.png&#34; alt=&#34;image-20230223164328178&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;&lt;strong&gt;MBA&lt;/strong&gt;ï¼Œé€šè¿‡è®¾ç½®é™æµå€¼æ¥å¯¹ç¨‹åºè¿›è¡Œé™åˆ¶ã€‚MBAåªæ”¯æŒthrottling valuesï¼Œä¸èƒ½è¿›è¡Œå¤ªç²¾ç»†çš„æ§åˆ¶ï¼ŒMBAå¯¹DRAMæ•æ„Ÿçš„è´Ÿè½½çš„é™åˆ¶æ•ˆæœæ›´å¥½ï¼Œå¯¹NVM-writeçš„é™åˆ¶å‡ ä¹æ²¡æœ‰æ•ˆæœï¼Œå¦‚ä¸Šå›¾bã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CPUè°ƒåº¦&lt;/strong&gt;ï¼Œå¯ä»¥è¿›è¡Œæ›´ç»†ç²’åº¦çš„å†…å­˜å¸¦å®½è°ƒæ•´ï¼Œåˆ©ç”¨Linux Cgroup CPUå­ç³»ç»Ÿæ¥å¯¹åº”ç”¨ä½¿ç”¨çš„CPUæ ¸å¿ƒè¿›è¡Œé™é¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ‰æ•ˆæ€§å’Œæ¯”è¾ƒ&lt;/strong&gt;ï¼Œä½œè€…é€šè¿‡å¯¹æ¯”æµ‹è¯•åå‘ç°ï¼ŒCPUé™æµä¼šå½±å“åº”ç”¨ç¨‹åºçš„å…¶ä»–ä»»åŠ¡ï¼Œé™åˆ¶å…¶æ•´ä½“çš„æ•ˆç‡ï¼Œè€ŒMBAè¿›å¯¹å†…å­˜çš„è®¿é—®è¿›è¡Œé™åˆ¶ï¼Œå¯¹ç¨‹åºæ•´ä½“çš„è¿è¡Œå½±å“è¾ƒå°ã€‚&lt;/p&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20230223170600388.png&#34; alt=&#34;image-20230223170600388&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;h3 id=&#34;åŠ¨æ€å¸¦å®½é™æµ&#34;&gt;åŠ¨æ€å¸¦å®½é™æµ&lt;/h3&gt;
&lt;h4 id=&#34;è¯†åˆ«åµé—¹é‚»å±…&#34;&gt;è¯†åˆ«åµé—¹é‚»å±…&lt;/h4&gt;
&lt;p&gt;Preventionç­–ç•¥ï¼Œæ‰€æœ‰è¶…è¿‡å¸¦å®½ä¸Šé™çš„TGroupéƒ½è¢«è§†ä¸ºåµé—¹é‚»å±…&lt;/p&gt;
&lt;p&gt;Remedyç­–ç•¥ï¼ŒRegulatoré¦–å…ˆæ ¹æ®Monitoræä¾›çš„ä¿¡æ¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸¥é‡çš„å†…å­˜å¹²æ‰°ï¼Œå½“å†…å­˜å¹²æ‰°æƒ…å†µä¸¥é‡æ—¶ï¼Œç®—æ³•ä¼šæ ¹æ®æ¯ä¸ªTGroupçš„å¸¦å®½ä½¿ç”¨æƒ…å†µè¯†åˆ«åµé—¹é‚»å±…ï¼Œæ ¹æ®ä¸Šæ–‡çš„åˆ†æï¼ŒåŒ…å«NVM writeæ“ä½œæœ€å¤šçš„TGroupæœ€æœ‰å¯èƒ½æ˜¯åµé—¹é‚»å±…ï¼Œå› æ­¤ç®—æ³•è¦é€‰å–è¿™ç±»TGroupå¹¶è¿›è¡Œé™æµã€‚&lt;/p&gt;
&lt;h4 id=&#34;è°ƒèŠ‚å†…å­˜å¸¦å®½&#34;&gt;è°ƒèŠ‚å†…å­˜å¸¦å®½&lt;/h4&gt;
&lt;p&gt;ç®—æ³•ä¼šæ ¹æ®å†…å­˜è®¿é—®çš„ç±»å‹æ¥é€‰å–è°ƒèŠ‚æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºNVMè®¿é—®å¸¦å®½çš„é™åˆ¶ï¼Œç®—æ³•é‡‡ç”¨CPUé™åˆ¶&lt;/p&gt;
&lt;p&gt;å¯¹äºDRAMè®¿é—®å¸¦å®½çš„é™åˆ¶ï¼Œç®—æ³•é¦–å…ˆå‰Šå‡å…¶TGroupçš„MBAï¼Œå¦‚æœMBAå·²ç»è®¾å®šä¸ºæœ€å°å€¼ï¼Œç®—æ³•å°†ä½¿ç”¨CPUé™æµæ¥è¿›ä¸€æ­¥è°ƒèŠ‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é‡Šæ”¾å†…å­˜é™åˆ¶&#34;&gt;é‡Šæ”¾å†…å­˜é™åˆ¶&lt;/h4&gt;
&lt;p&gt;ä¸€æ—¦å†…å­˜å¹²æ‰°æ¶ˆå¤±ï¼Œç®—æ³•å°±ä¼šå°è¯•æ”¾å®½å¸¦å®½é™åˆ¶ï¼Œæ“ä½œè¿‡ç¨‹å’Œæ–½åŠ å†…å­˜é™åˆ¶çš„æ–¹å¼ç›¸åã€‚&lt;/p&gt;
&lt;p&gt;å½“Regulatorç»“æŸäº†ä¸€æ¬¡è°ƒèŠ‚/é‡Šæ”¾æ“ä½œæ—¶ï¼Œå°±ä¼šç»§ç»­ç­‰å¾…ä¸‹ä¸€æ­¥æ“ä½œï¼Œå–å†³äºMonitoræä¾›çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“çš„å·¥ä½œæµç¨‹åœ¨ä½œè€…çš„Slidesä¸Šæœ‰ä¸€å¼ å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20230223191251147.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20230223191251147&#34;
	
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x03-implementation&#34;&gt;0x03 Implementation&lt;/h1&gt;
&lt;h2 id=&#34;cgroupæ¥å£&#34;&gt;Cgroupæ¥å£&lt;/h2&gt;
&lt;p&gt;Cgroupæ˜¯Linuxå†…æ ¸ä¸­ç”¨äºèµ„æºé™åˆ¶çš„å·¥å…·ï¼Œå¸¸ç”¨äºå®¹å™¨åŒ–æŠ€æœ¯ï¼Œç›®å‰æ­£åœ¨æ•´ç†æœ‰å…³å†…å®¹è®¡åˆ’åˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Cgroupé€šè¿‡æš´éœ²ä¼ªæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶å®ç°å…¶æ¥å£ï¼ŒCgroupfsï¼Œç”¨æˆ·é€šè¿‡ä¿®æ”¹æ–‡ä»¶çš„å†…å®¹å®Œæˆé…ç½®å·¥ä½œï¼ŒMT2éµå¾ªCgroupè§„èŒƒæ·»åŠ äº†TGroupï¼Œç”¨äºé™æµå’Œç®¡ç†çš„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;priority&lt;/code&gt;ï¼šç”¨äºè®¾ç½®TGroupçš„ä¼˜å…ˆçº§ï¼ŒåŒ…æ‹¬&lt;code&gt;high&lt;/code&gt;å’Œ&lt;code&gt;low&lt;/code&gt;ï¼Œ&lt;code&gt;high&lt;/code&gt;ä¼˜å…ˆçº§çš„TGroupä¸ä¼šè¢«Regulatoré™åˆ¶ï¼Œ&lt;code&gt;low&lt;/code&gt;ä¼˜å…ˆçº§åˆ™ä¼šåœ¨å†…å­˜å¹²æ‰°æƒ…å†µå‘ç”Ÿæ—¶è¢«é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bandwidth&lt;/code&gt;ï¼šè¯¥æ–‡ä»¶åªè¯»ï¼Œè¿”å›TGroupå½“å‰çš„å¸¦å®½ä½¿ç”¨æƒ…å†µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;limit&lt;/code&gt;ç”¨äºè·å–å’Œè®¾ç½®TGroupçš„ç»å¯¹å¸¦å®½ï¼Œå››ä¸ªé€—å·åˆ†éš”çš„æ•°å­—æ¥ä»£è¡¨å››ç§å†…å­˜è®¿é—®å¸¦å®½ä¸Šé™ï¼Œä¸€æ—¦å¸¦å®½è¶…è¿‡è¯¥å€¼TGroupå°±ä¼šè¢«é™æµã€‚Zero Valueè¡¨ç¤ºæ— é™åˆ¶ï¼Œè¯¥é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;çº¿ç¨‹åˆ›å»ºé—®é¢˜&#34;&gt;çº¿ç¨‹åˆ›å»ºé—®é¢˜&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰å­è¿›ç¨‹éƒ½ä¸çˆ¶è¿›ç¨‹æ”¾åœ¨åŒä¸€ä¸ªTGroupä¸­ï¼Œé™¤éç®¡ç†å‘˜æ‰‹åŠ¨å°†å…¶æ”¾å…¥å¦ä¸€ä¸ªTGroupã€‚ä¸ºæ­¤ä½œè€…åœ¨è¿›ç¨‹/çº¿ç¨‹åˆ›å»ºç¨‹åºä¸­æ·»åŠ äº†ä¸€ä¸ªhookï¼Œå³Linuxå†…æ ¸ä¸­çš„&lt;code&gt;fork&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mba&#34;&gt;MBA&lt;/h2&gt;
&lt;p&gt;MBAæ”¯æŒ10ä¸ªé™æµå€¼ï¼Œç”±äº70ã€80ã€90çš„æ•ˆæœè¾ƒå·®ï¼Œä½œè€…åªä½¿ç”¨å…¶ä¸­çš„8ä¸ªå€¼ï¼Œå¹¶å°†æ¯ä¸ªå€¼åˆ†é…åˆ°ä¸€ä¸ªCLOSä¸­ï¼Œå°†TGroupåˆ†é…åˆ°ç›¸åº”çš„CLOSæ¥å®ç°ä¸åŒç­‰çº§çš„é™æµã€‚åœ¨æ²¡æœ‰å¹²æ‰°çš„æƒ…å†µä¸‹ï¼Œå…·æœ‰ç›¸åŒCLOSçš„TGroupsæœ‰ç›¸åŒçš„è¯·æ±‚é€Ÿç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸Šä¸‹æ–‡åˆ‡æ¢&#34;&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ç»™æ¯ä¸ªçº¿ç¨‹è®¾ç½®MT2ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬è®¾ç½®PMUç›¸å…³çš„ä¸Šä¸‹æ–‡ã€å†™å…¥ä¸MBAç›¸å…³çš„MSRå¯„å­˜å™¨ä»¥åŠè®¾ç½®CPUé…é¢ï¼Œä½œè€…ç»™è°ƒåº¦å™¨æ·»åŠ äº†ä¸€ä¸ªhookã€‚æ¯æ¬¡å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œæˆ‘ä»¬å°±ä¸ºå°†è¦åœ¨è¿™ä¸ªCPUæ ¸ä¸Šè¿è¡Œçš„æ–°çº¿ç¨‹è®¾ç½®ç›¸åº”çš„MT2ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;pmu&#34;&gt;PMU&lt;/h2&gt;
&lt;p&gt;ç”¨äºè®¡ç®—æ²¡æœ‰å‘½ä¸­Cacheè€Œè¿›è¡ŒNVMå’ŒDRAMè®¿é—®çš„æ‰€æœ‰readæŒ‡ä»¤ã€‚å¯¹äºDRAMå’ŒNVMçš„readæ“ä½œå»¶è¿Ÿä¹Ÿé€šè¿‡PMUè·å–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;pebs&#34;&gt;PEBS&lt;/h2&gt;
&lt;p&gt;é‡‡æ ·é¢‘ç‡ä¸º10007ï¼ŒPEBSå°†æ¯10007ä¸ªäº‹ä»¶è®°å½•ä¸€ä¸ªçº¿æ€§åœ°å€ï¼Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿå¤ªå¤§çš„æ€§èƒ½å½±å“ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸“æœ‰å†…æ ¸çº¿ç¨‹&#34;&gt;ä¸“æœ‰å†…æ ¸çº¿ç¨‹&lt;/h2&gt;
&lt;p&gt;åœ¨MT2å†…æ ¸æ¨¡å—çš„åˆå§‹åŒ–é˜¶æ®µåˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå®šæœŸæ£€æµ‹å†…å­˜å¹²æ‰°ï¼Œç›‘æ§å¸¦å®½å¹¶æ‰§è¡ŒåŠ¨æ€å¸¦å®½é™æµã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸çº¿ç¨‹çš„ä¼ªä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;kthread_main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;interference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;detect_interference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aggregate_bandwidths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;adjust_bandwidths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;interference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;INTERVAL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;0x04-thinking&#34;&gt;0x04 Thinking&lt;/h1&gt;
&lt;p&gt;ä½œè€…åœ¨å†…æ ¸ä¸­å®ç°äº†çº¿ç¨‹ç²’åº¦çš„å†…å­˜å¸¦å®½ç›‘æ§ï¼ŒåŒæ—¶åˆ©ç”¨äº†å¤šç§æ–¹æ³•æ¥å®ç°å†…å­˜å¸¦å®½çš„é™æµã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶åˆ©ç”¨äº†åˆ†æDRAM/NVMè¯»å†™å¸¦å®½ä¹‹é—´çš„ç›¸äº’å½±å“ï¼Œä»è€Œç¡®å®šäº†ä¼˜åŒ–çš„æ–¹å‘å’Œæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ç« æ¥è‡ªSJTUçš„IPADSå®éªŒå®¤ï¼Œæ–‡ç« ä¸­çš„è®ºè¿°éå¸¸æœ‰æ¡ç†ï¼Œé‡‡å–çš„æ¯ä¸€é¡¹æªæ–½éƒ½æœ‰å®éªŒéªŒè¯ï¼Œæœ‰ä¾‹å¯å¾ªï¼Œä¾‹å¦‚é€‰å–NVM writeæ“ä½œè¾ƒå¤šçš„TGroupä½œä¸ºå¹²æ‰°é¡¹ï¼Œä»¥åŠMBAå’ŒCPUé™é¢ç»¼åˆè°ƒæ•´å¸¦å®½ï¼Œéƒ½æœ‰ç›¸åº”çš„å®éªŒåˆ†æã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>[ACM Trans. On Storage] HintStor: A Framework to Study I/O Hints in Heterogeneous Storage</title>
        <link>https://blog.ipandai.club/p/acm-trans.-on-storage-hintstor-a-framework-to-study-i/o-hints-in-heterogeneous-storage/</link>
        <pubDate>Wed, 30 Nov 2022 10:58:22 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/acm-trans.-on-storage-hintstor-a-framework-to-study-i/o-hints-in-heterogeneous-storage/</guid>
        <description>&lt;h1 id=&#34;0x00-everyday-english&#34;&gt;0x00 Everyday English&lt;/h1&gt;
&lt;p&gt;Heterogeneous å„ç§å„æ ·çš„&lt;/p&gt;
&lt;p&gt;semantic è¯­ä¹‰ä¸Šçš„&lt;/p&gt;
&lt;p&gt;conservative ä¿å®ˆçš„ã€ä¼ ç»Ÿçš„ &amp;mdash;aggressive æ¿€è¿›çš„&lt;/p&gt;
&lt;p&gt;aggregate åˆè®¡&lt;/p&gt;
&lt;p&gt;orchestrate ç²¾å¿ƒç­–åˆ’&lt;/p&gt;
&lt;p&gt;proactive ç§¯æä¸»åŠ¨çš„&lt;/p&gt;
&lt;p&gt;by means of é€šè¿‡ï¼Œå€ŸåŠ©äº&lt;/p&gt;
&lt;p&gt;off-the-shelf ç°æˆçš„&lt;/p&gt;
&lt;p&gt;elaborate è¯¦ç»†é˜è¿°&lt;/p&gt;
&lt;h1 id=&#34;0x01-intro&#34;&gt;0x01 Intro&lt;/h1&gt;
&lt;p&gt;éšç€å­˜å‚¨æŠ€æœ¯çš„å‘å±•ï¼Œç”±SCMã€SSDã€HDDä»¥åŠä¸€ç³»åˆ—äº‘å­˜å‚¨æ„æˆäº†ç›®å‰å¼‚æ„å­˜å‚¨ç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;å¼‚æ„å­˜å‚¨ç³»ç»Ÿå°†å†·æ•°æ®æ”¾åœ¨æ›´æ…¢çš„å±‚æ¬¡ï¼Œçƒ­æ•°æ®æ”¾åœ¨æ›´å¿«çš„å±‚æ¬¡ï¼Œå­˜å‚¨æœºåˆ¶çš„æ¿€è¿›å’Œä¿å®ˆéƒ½ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½æŸå¤±ï¼Œè€Œä¸”å¼‚æ„å­˜å‚¨ç³»ç»Ÿç”±ä¸åŒé€Ÿåº¦å’Œç‰¹ç‚¹çš„å­˜å‚¨è®¾å¤‡ç»„æˆ&lt;/p&gt;
&lt;p&gt;åœ¨å¼‚æ„å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œè¿˜å­˜åœ¨å‰å°å’Œåå°I/Oçš„å¹²æ‰°é—®é¢˜ï¼Œå¸¦æ¥æ˜æ˜¾çš„å»¶è¿Ÿï¼Œç¡¬ç›˜çš„ç®¡ç†å±‚å¾€å¾€ä¸èƒ½åˆ†è¾¨å‡ºI/Oè¯·æ±‚çš„ä¼˜å…ˆçº§é«˜ä½ï¼Œå¹¶å†³å®šå°†å…¶æ•°æ®å­˜å‚¨åˆ°å“ªä¸€å±‚æ¬¡&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µè¢«ç§°ä¸ºI/Oæ ˆé«˜å±‚æ¬¡ä¸åº•å±‚å­˜å‚¨ç³»ç»Ÿä¹‹é—´çš„è¯­ä¹‰é¸¿æ²Ÿï¼Œå…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸ºä½¿ç”¨I/O access hintsï¼Œå½“appè¯»å–ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å—å¯èƒ½æ•£è½åœ¨ä¸åŒè®¾å¤‡ä¸­ï¼Œä¸Šå±‚å¯ä»¥å‘ŠçŸ¥å­˜å‚¨ç³»ç»Ÿï¼Œä½¿å¾—å­˜å‚¨ç³»ç»Ÿæå‰å°†è¯¥æ–‡ä»¶çš„æ•°æ®æ±‡æ€»åˆ°è¯»å–é€Ÿåº¦æ›´é«˜çš„å±‚æ¬¡ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå…è®¸å­˜å‚¨åç«¯æ§åˆ¶å™¨é’ˆå¯¹ä¸åŒçš„I/OæŒ‡ä»¤å®æ–½ä¸åŒçš„I/Oç­–ç•¥ï¼Œä¾‹å¦‚SSDå¯ä»¥ä¼˜å…ˆå¤„ç†å…ƒæ•°æ®å’Œå°æ–‡ä»¶ï¼Œä½¿å…¶å…ˆç¼“å­˜è‡³æ–‡ä»¶ç³»ç»Ÿä¸­&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ä¸ªé€šç”¨çµæ´»çš„æ¡†æ¶ï¼ŒHintStorï¼Œä¸ºå¼‚æ„å­˜å‚¨ç³»ç»Ÿæä¾›access hints&lt;/p&gt;
&lt;p&gt;è®¾è®¡å’Œå®ç°äº†ä¸€å¥—æ–°çš„ç”¨æˆ·å±‚é¢çš„æ¥å£ï¼Œæ–‡ä»¶ç³»ç»Ÿæ’ä»¶ï¼Œå—å­˜å‚¨æ•°æ®ç®¡ç†å™¨ï¼Œåœ¨å­˜å‚¨ç®¡ç†æ–¹é¢ï¼ŒHintStroré€šè¿‡åœ¨blockçº§åˆ«è¿›è¡Œç»Ÿè®¡ï¼ˆçƒ­åŠ›å›¾ç­‰ï¼‰æ¥è§¦å‘æ•°æ®è¿ç§»ï¼Œå¹¶é€šè¿‡FIFOé˜Ÿåˆ—å¤„ç†I/Oï¼›HintStorè¿˜æä¾›äº†access hintçš„è¯„ä¼°ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°çš„app/userå±‚é¢çš„æ¥å£å…è®¸ç”¨æˆ·å®šä¹‰å’Œé…ç½®æ–°çš„hint&lt;/li&gt;
&lt;li&gt;VFSä¸­çš„æ–‡ä»¶ç³»ç»Ÿæ’ä»¶æå–æ–‡ä»¶å¸ƒå±€ä¿¡æ¯å¹¶å»ºç«‹æ–‡ä»¶å±‚é¢çš„æ•°æ®åˆ†ç±»å™¨ï¼Œç”¨äºä¸‹å±‚å„ç§æ–‡ä»¶ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;åœ¨åŸºäºDMçš„Linuxä¸­ï¼Œå—å­˜å‚¨æ•°æ®ç®¡ç†å™¨å®ç°äº†å››ä¸ªåŸå­access hintæ“ä½œï¼Œè§¦å‘æ•°æ®è¿ç§»å’ŒI/Oè°ƒåº¦ï¼Œå› æ­¤å¯ä»¥æ‰§è¡Œå’Œåˆ†æä¸ä¸Šå±‚hintæœ‰å…³çš„ä¸åŒç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œè€…åŸºäºSSDã€HDDã€SCMä»¥åŠäº‘å­˜å‚¨è¿›è¡Œäº†è¯„ä¼°ï¼Œä»¥ä½“ç°ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œå®ç°å¹¶åˆ†æäº†ä»¥ä¸‹å››ä¸ªhintsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨çš„æ•°æ®è¿›è¡Œåˆ†ç±»ï¼ˆå…ƒæ•°æ®ï¼Œæ–‡ä»¶æ•°æ®ï¼Œæ–‡ä»¶å¤§å°ï¼‰&lt;/li&gt;
&lt;li&gt;Stream IDï¼Œè¯¥IDç”¨äºå¯¹ä¸åŒæ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå¹¶å°†ç›¸å…³æ•°æ®å­˜å‚¨åœ¨ä¸€èµ·æˆ–ç´§å¯†åœ°å­˜å‚¨åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Š&lt;/li&gt;
&lt;li&gt;äº‘é¢„å–ï¼Œcloud prefetchï¼Œè°ƒç ”äº†åœ¨access hintsæƒ…å†µä¸‹ï¼Œå¦‚ä½•å¸®åŠ©æœ‰æ•ˆåœ°é›†æˆæœ¬åœ°å­˜å‚¨å’Œäº‘å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;I/Oä»»åŠ¡è°ƒåº¦ï¼Œç”¨æˆ·å¯ä»¥åœ¨åº”ç”¨å±‚é¢å‘å—å­˜å‚¨è®¾å¤‡å‘èµ·hintsï¼Œæ¥å¯¹å‰å°å’Œåå°ä»»åŠ¡è¿›è¡ŒåŒºåˆ†&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x02-bg&#34;&gt;0x02 Bg&lt;/h1&gt;
&lt;p&gt;åœ¨ç›®å‰çš„hintsæœºåˆ¶ä¸­ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å®¿ä¸»æœºçš„page cacheå’Œé¢„å–æœºåˆ¶ï¼Œç›®å‰systemä¸­çš„ç³»ç»Ÿè°ƒç”¨å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªéšæœºè®¿é—®flagæ¥å‘ŠçŸ¥å†…æ ¸é€‰å–æ­£ç¡®çš„é¢„å–å’Œpage cacheç­–ç•¥ä»¥ä¼˜åŒ–å¯¹æŸä¸ªæ–‡ä»¶çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰å¾ˆå°‘æœ‰å¯¹å¼‚æ„å­˜å‚¨ç³»ç»Ÿçš„ä¼˜åŒ–ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯åœ¨ä¸åŒçš„å­˜å‚¨è®¾å¤‡ä¸Šçš„æ™ºèƒ½æ•°æ®ç§»åŠ¨ï¼Œ&lt;code&gt;fadvise()&lt;/code&gt;å’Œ&lt;code&gt;inoice()&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨å¯ä»¥æ”¹å–„prefetchingï¼Œä½†æ˜¯ä¸èƒ½è§£å†³æ•°æ®ç§»åŠ¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;MPI-I/O hintsåœ¨é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿä¸­ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿï¼Œç›®å‰è¿™äº›ç ”ç©¶ç€çœ¼äºä¼˜åŒ–å­˜å‚¨ç³»ç»Ÿä¸­çš„buffer/cacheéƒ¨åˆ†ï¼Œred haté€šè¿‡åœ¨ç”¨æˆ·ç©ºé—´é™åˆ¶I/Oæ¥å¯¹ä¸åŒä¾›åº”å•†çš„å­˜å‚¨è®¾å¤‡è¿›è¡Œblockå¯¹é½ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æœ‰äº›æ–‡ä»¶ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰ç±»åˆ«ï¼Œbtrfså¯ä»¥åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸­æ”¯æŒä¸åŒçš„å·ï¼ŒåŒæ—¶éœ€è¦ç”¨æˆ·ä¸ºå­˜å‚¨è®¾å¤‡é™æ€é…ç½®å·ï¼Œç”¨æˆ·å¯èƒ½è®©å¤šä¸ªåº”ç”¨è¿è¡Œåœ¨ä¸€ä¸ªé€»è¾‘å·ä¸­ï¼Œä¸ºäº†å®ç°é«˜æ•ˆçš„æ•°æ®ç®¡ç†ï¼Œä½œè€…è€ƒè™‘åœ¨å·ä¸Šæ”¯æŒåŠ¨æ€çš„access hintsã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x03-hintstor-design&#34;&gt;0x03 HintStor Design&lt;/h1&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221202204914922.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221202204914922&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;HintStorçš„æ¶æ„å›¾å¦‚ä¸Šå›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;Device Mapperæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä¸ºç”±å¤šç§å—è®¾å¤‡ç»„æˆçš„å·æä¾›æ˜ å°„&lt;/p&gt;
&lt;p&gt;æ•´ä½“åŒ…å«ä¸‰å±‚ï¼Œåœ¨åº”ç”¨å±‚ã€æ–‡ä»¶ç³»ç»Ÿå±‚ã€å—å±‚æä¾›äº†æ–°çš„æ¥å£å’Œæ’ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç”¨æˆ·å±‚é€šè¿‡æ¥å£è¿æ¥Block Storage Data Managerå’Œæ–‡ä»¶ç³»ç»Ÿï¼Œä½¿å¾—åº”ç”¨å¯ä»¥æ¥å—æ•°æ®å’Œå‘é€access hints&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æå–chunkçš„æ–‡ä»¶ç³»ç»Ÿè¯­ä¹‰ï¼ŒHintStorå°†ä¸€ä¸ªæ’ä»¶ç»‘å®šåˆ°æ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œæ¥åˆ©ç”¨å†…éƒ¨æ–‡ä»¶çš„æ–‡ä»¶æ•°æ®ç»“æ„å’Œæ–‡ä»¶æ•°æ®å¸ƒå±€&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ§åˆ¶å¯¹å¤§chunkçš„æ•°æ®ç®¡ç†ï¼ŒHintStorå®ç°äº†æ–°çš„block storage managerï¼Œå¯ä»¥å®ç°å¯¹å­˜å‚¨è®¾å¤‡çš„access hintsç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨Device Mapperä¸­å®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redirector å°†I/Oè¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„è®¾å¤‡&lt;/li&gt;
&lt;li&gt;Migrator æä¾›å—è®¾å¤‡é—´çš„å¼‚æ­¥æ•°æ®æ‹·è´ï¼Œä¸ºäº†é˜²æ­¢æ‹·è´è¿‡ç¨‹ä¸­å¯¹å¸¦å®½çš„å ç”¨ï¼Œä¼šå¯¹æµé‡è¿›è¡Œé™åˆ¶ï¼Œè¿ç§»åä¼šé€šè¿‡ä¸€ä¸ªflagæ¥å†³å®šæ˜¯å¦åˆ é™¤æ‹·è´çš„åŸå§‹æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;interface&#34;&gt;Interface&lt;/h2&gt;
&lt;p&gt;HintStorä½¿ç”¨sysfsæ¥å£ä¸ºI/Oè¯·æ±‚è®¾ç½®ä¸€äº›å±æ€§ï¼Œä¸å—è®¾å¤‡å’Œæ–‡ä»¶ç³»ç»Ÿé€šä¿¡ï¼Œç±»ä¼¼äºä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥ä»å…¶ä»–å†…æ ¸çš„å­ç³»ç»Ÿä¸­æå–ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸å®ç°äº†éƒ¨åˆ†ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨JSONæ ¼å¼çš„è¯·æ±‚è¿›è¡Œé€šä¿¡ï¼ŒJSONçš„ç¼–è§£ç å¯èƒ½æœ‰æ€§èƒ½æŸå¤±ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½è¦å¯¹ä»£ç è¿›è¡Œå°‘é‡ä¿®æ”¹&lt;/p&gt;
&lt;h2 id=&#34;file-system-plugin&#34;&gt;File System Plugin&lt;/h2&gt;
&lt;p&gt;HintStorå¯ä»¥è·å–ä¸è¯·æ±‚ç›¸å…³çš„data blockä¿¡æ¯ï¼Œæå‰è§¦å‘æ•°æ®è¿ç§»ï¼Œä¼˜åŒ–åç»­çš„è®¿é—®&lt;/p&gt;
&lt;p&gt;HintStorå¯ä»¥åŒºåˆ†å‰å°å’Œåå°I/O ï¼Œä¼˜å…ˆå¯¹å‰å°I/Oè¿›è¡Œæ»¡è¶³&lt;/p&gt;
&lt;p&gt;HintStoråœ¨VFSæä¾›äº†ä¸€ä¸ªFS_HINTè°ƒç”¨ï¼Œç”¨äºè·å–æ–‡ä»¶çš„æ•°æ®å¸ƒå±€ä¿¡æ¯ï¼Œè·å–æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ï¼Œè¯¥æ¥å£ä¾›ç”¨æˆ·ç©ºé—´å’Œåº”ç”¨è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ—¶æ”¯æŒæŸ¥è¯¢å¤šä¸ªæ–‡ä»¶çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥åŠŸèƒ½æä¾›åœ¨ext2ã€ext4å’Œbtrfsç­‰Linuxä¸­ä¸»æµçš„æ–‡ä»¶ç³»ç»Ÿä¸­&lt;/p&gt;
&lt;p&gt;FS_HINTä¼šç»´æŠ¤ext4é¢„åˆ†é…çš„block groupï¼Œbtrfså¯ä»¥å°†ä¸€ä¸ªå—è®¾å¤‡æŒ‚è½½ä¸ºsub-Volumeï¼Œç”¨äºè·¨è®¾å¤‡ç®¡ç†æ•°æ®&lt;/p&gt;
&lt;p&gt;é€šè¿‡ioctlæ¥å£æ¥è·å–æ–‡ä»¶çš„è¾¹ç•Œï¼Œæ¥è§¦å‘æ•°æ®è¿ç§»æˆ–è€…I/Oè°ƒåº¦&lt;/p&gt;
&lt;h2 id=&#34;block-storage-data-manager&#34;&gt;Block Storage Data Manager&lt;/h2&gt;
&lt;p&gt;ä¸»è¦åŒ…å«ï¼š&lt;/p&gt;
&lt;p&gt;chunkçš„æ˜ å°„è¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»´æŠ¤LBAåˆ°Physical Block Addressçš„æ˜ å°„&lt;/li&gt;
&lt;li&gt;chunk size å¯è‡ªå®šä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;chunk-level I/O åˆ†æå™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äºç›‘æ§æ¯ä¸ªchunkä¸Šçš„I/Oè®¿é—®ç»Ÿè®¡ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;ä¼°ç®—æ¯ä¸ªchunkçš„è®¿é—®é¢‘ç‡ï¼Œç”Ÿæˆçƒ­åŠ›å›¾ï¼Œè¯¥ä¿¡æ¯ç”¨äºå‘¨æœŸæ€§çš„è¿›è¡Œæ•°æ®è¿ç§»&lt;/li&gt;
&lt;li&gt;è™½ç„¶è¿™äº›ä¿¡æ¯å¯èƒ½ä¸å‡†ç¡®ï¼Œä»ç„¶å¯ä»¥ç”¨æ¥ä½œä¸ºæ•°æ®ç§»åŠ¨çš„æ­£ç¡®æ€§è¯„ä¼°æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;å½“chunkè¢«è¿ç§»åˆ°æ›´ä½é€Ÿçš„å±‚æ¬¡ï¼Œè®¿é—®é¢‘ç‡å¯èƒ½ä¼šå‡é«˜ï¼Œè¿›è€Œå°†æ•°æ®è½¬ç§»åˆ°æ›´å¿«çš„å±‚æ¬¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;chunk è°ƒåº¦å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äºè¯„ä¼°ä¸åŒä»»åŠ¡çš„ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦&lt;/li&gt;
&lt;li&gt;ç›®å‰æ”¯æŒä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—å’Œä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œé»˜è®¤ä½¿ç”¨FIFOæœºåˆ¶æ¥ç»´æŠ¤åŸæœ‰çš„è¯·æ±‚é¡ºåº&lt;/li&gt;
&lt;li&gt;å½“ä»»åŠ¡ä¼˜å…ˆçº§ç›¸å…³çš„Hintå‘èµ·æ—¶ï¼Œä¼šå°†ä½ä¼˜å…ˆçº§çš„è¯·æ±‚æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—å°¾éƒ¨&lt;/li&gt;
&lt;li&gt;åº”ç”¨å¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨æ¥è°ƒç”¨ä¸€ä¸ªè¯·æ±‚ï¼Œç”¨äºå°†æ¥è¿‘deadlineçš„è¯·æ±‚ä»ç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°å·¥ä½œé˜Ÿåˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;access hinitåŸå­æ“ä½œçš„åˆ†ç±»æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HintStorå°†æ•°æ®çš„å¸ƒå±€å’Œç§»åŠ¨è§†ä½œæ”¹å–„å¼‚æ„å­˜å‚¨ç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªaccess hintæŒ‡ä»¤æ˜¯ä¸€ä¸ªå››å…ƒç»„&lt;code&gt;(op,chunk_id,src_addr,dest_addr)&lt;/code&gt;ï¼ŒåŒ…æ‹¬æ“ä½œç±»å‹ã€chunk IDã€åœ¨é€»è¾‘å·ä¸­çš„æºåœ°å€å’Œç›®çš„åœ°å€&lt;/li&gt;
&lt;li&gt;å…±æœ‰å››ä¸ªåŸå­æ“ä½œï¼š
&lt;ul&gt;
&lt;li&gt;Redirectï¼šå½“æœ€åˆè¯·æ±‚çš„åŸåœ°å€è¢«é‡å®šå‘åˆ°å…¶ä»–åœ°å€æ—¶è§¦å‘ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªç”±å¤šä¸ªSSDå’ŒHDDç»„æˆçš„é€»è¾‘å·ä¸­ï¼Œå¯ä»¥å°†å­˜å‚¨åˆ°HDDä¸Šçš„è¾ƒå°çš„æ–‡ä»¶é‡å®šå‘åˆ°SSDä¸­ã€‚è¯¥å¤„ç†å‡½æ•°ä¼šè°ƒç”¨DMä¸­çš„é©±åŠ¨å¹¶ç®¡ç†è¢«é‡å®šå‘çš„è¯·æ±‚ï¼Œå½“bioåˆ°è¾¾DMæ—¶ï¼Œå°†å¯¹data chunké‡æ–°èµ‹å€¼ä¸ºç›®çš„åœ°å€&lt;/li&gt;
&lt;li&gt;Migrateï¼šä½œä¸ºHintStorä¸­å…³é”®çš„éƒ¨åˆ†ï¼Œåœ¨åå°ä¼šä¿ç•™ä¸€ä¸ªmigration daemonåå°é©»ç•™ç¨‹åºï¼Œèµ·åˆå½“æ•°æ®å—å­˜æ”¾äºä¸åŒçš„å­˜å‚¨è®¾å¤‡æ—¶ï¼Œæ•°æ®çš„è®¿é—®é¢‘ç‡ä¼šæ—¶ä¸æ—¶å‘ç”Ÿå˜åŒ–ï¼ŒMigrationæ“ä½œé€šè¿‡è°ƒç”¨DMä¸­çš„migrator target driverï¼Œå°†data chunkä»åŸæœ‰çš„ä½ç½®è½¬ç§»åˆ°ç›®çš„ä½ç½®ã€‚ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œè¿ç§»è¿‡ç¨‹ä¸­è¯¥chunkå°†åŠ é”è¿›è¡Œä¿æŠ¤ï¼Œå¿½ç•¥å¯¹chunkçš„è®¿é—®ã€‚HintStoræä¾›ä¸»åŠ¨å’Œç­–ç•¥ä¸¤ç§è¿ç§»æ–¹å¼ï¼Œä¸»åŠ¨å³ç”¨æˆ·ä¸»åŠ¨è§¦å‘ï¼ŒåŒæ—¶å®ç°äº†åŸºäºæ—¶é—´çš„å¯å‘å¼è¿ç§»ç­–ç•¥ï¼Œå¯ä»¥é…ç½®ä¸ºæ¯ä¸¤ä¸ªå°æ—¶è¿ç§»top-kè®¿é—®æœ€é¢‘ç¹çš„chunkåˆ°æ›´å¿«çš„å­˜å‚¨è®¾å¤‡ä¸­&lt;/li&gt;
&lt;li&gt;Replicateï¼šç”¨äºå°†æ•°æ®çš„å‰¯æœ¬è¿›è¡Œä¿ç•™ï¼Œä½¿ç”¨DMä¸­çš„migrator target driverï¼Œä¿ç•™åŸæ¥æ•°æ®çš„æŒ‡é’ˆï¼Œä½¿å¾—çƒ­ç‚¹æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªå­˜å‚¨è®¾å¤‡ä¸Šï¼Œæé«˜æ•°æ®è®¿é—®çš„å¹³å‡æ—¶é—´ï¼ŒåŒæ—¶å¯ä»¥åˆ©ç”¨Replicateåˆ›å»ºæ•°æ®çš„å¤šä¸ªå‰¯æœ¬ï¼Œéœ€è¦åŠ é”&lt;/li&gt;
&lt;li&gt;Prefetchï¼šç±»ä¼¼äºBufferingï¼Œ HintStoré¢„ç•™ä¸€ä¸ªbuffer spaceç©ºé—´ç”¨äºé¢„å–ï¼Œå°†data chunkåŠ è½½åˆ°buffer spaceä¸­ï¼Œå®ç°ç±»ä¼¼äºMigrateå’ŒReplicateï¼Œä¸»è¦åŒºåˆ«æ˜¯Prefetchåœ¨æ‹·è´æ—¶ä¸éœ€è¦åŠ é”è¿›è¡Œä¿æŠ¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;classification&#34;&gt;Classification&lt;/h2&gt;
&lt;p&gt;I/O access hintså¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«ä¸ºä»æ“ä½œç³»ç»ŸåŠ¨æ€åœ°è¿›è¡Œæ•è·å’Œä»æ–‡ä»¶ç³»ç»Ÿé™æ€åœ°è·å–&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221209005726034.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221209005726034&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åŠ¨æ€çš„access hintsä¸»è¦å¸®åŠ©å—å­˜å‚¨è®¾å¤‡åœ¨è¿è¡Œæ—¶ç®¡ç†æ•°æ®çš„å¸ƒå±€ï¼Œå¯¹äºå†·æ•°æ®ï¼Œä¾¿äºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œé¢„å–ã€‚&lt;/p&gt;
&lt;p&gt;HintStoråœ¨chunkçº§åˆ«å¤„ç†I/Oè¯·æ±‚ï¼Œå¹¶ä¸”ç»‘å®šä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡ä»¶ç»“æ„å’Œç”¨æˆ·çš„æç¤ºï¼Œä»»åŠ¡è°ƒåº¦åˆ™åœ¨è¿›ç¨‹levelå®ç°&lt;/p&gt;
&lt;h1 id=&#34;conclusion--thinking&#34;&gt;Conclusion &amp;amp;&amp;amp; Thinking&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æ¯”Flash Shareï¼ŒHintStorä¸»è¦é’ˆå¯¹Linux I/Oæ ˆå’Œæ–‡ä»¶ç³»ç»Ÿå±‚é¢ï¼ŒFlash Share è¿˜è€ƒè™‘åˆ°äº†NVMeåè®®æ–¹é¢å’ŒSSDå±‚é¢&lt;/li&gt;
&lt;li&gt;åœ¨å¤„ç†å‰å°/åå°I/Oéƒ¨åˆ†äºŒè€…æ¯”è¾ƒç±»ä¼¼&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>[ATC&#39;20] PinK: High-speed In-storage Key-value Store with Bounded Tails</title>
        <link>https://blog.ipandai.club/p/atc20-pink-high-speed-in-storage-key-value-store-with-bounded-tails/</link>
        <pubDate>Sat, 26 Nov 2022 13:40:59 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/atc20-pink-high-speed-in-storage-key-value-store-with-bounded-tails/</guid>
        <description>&lt;h1 id=&#34;0x00-everyday-english&#34;&gt;0x00 Everyday English&lt;/h1&gt;
&lt;p&gt;preferable æ›´å¯å–çš„&lt;/p&gt;
&lt;p&gt;consequently å› æ­¤&lt;/p&gt;
&lt;p&gt;inevitably å¿…ç„¶çš„&lt;/p&gt;
&lt;p&gt;conventional å¸¸è§„çš„ã€ä¼ ç»Ÿçš„&lt;/p&gt;
&lt;p&gt;exacerbates åŠ å‰§&lt;/p&gt;
&lt;p&gt;deteriorates æ¶åŒ–&lt;/p&gt;
&lt;p&gt;deterministic ç¡®å®šæ€§&lt;/p&gt;
&lt;h1 id=&#34;0x01-intro&#34;&gt;0x01 Intro&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦æå‡ºäº†Pinkï¼ŒåŸºäºLSM treeçš„KV-SSDï¼Œä¸»è¦é€šè¿‡é¿å…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨å°‘é‡DRAMæ¥è¿›è¡Œä¼˜åŒ–&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿçš„KV-SSDä¸»è¦é€šè¿‡åœ¨æ§åˆ¶å™¨çš„DRAMä¸­ç»´æŠ¤ä¸€ä¸ªhash tableæ¥å¯»å€ï¼Œå—åˆ°DRAMçš„å®¹é‡é™åˆ¶ï¼Œè¶…å‡ºå®¹é‡çš„éƒ¨åˆ†ä¼šæš‚æ—¶å­˜æ”¾åœ¨é—ªå­˜ä¸­ï¼Œå› æ­¤åœ¨å¯»å€æ—¶å¸¦æ¥äº†è®¿é—®é—ªå­˜çš„é¢å¤–å¼€é”€ï¼ŒåŒæ—¶å½“å‘ç”Ÿå“ˆå¸Œç¢°æ’æ—¶ï¼Œå¯èƒ½ä¼šæ“ä½œå¤šä¸ªé—ªå­˜ï¼Œé€ æˆäº†å¤§é‡ä¸å¯é¢„æµ‹çš„å¼€é”€&lt;/p&gt;
&lt;p&gt;å•çº¯ä½¿ç”¨LSMåšä¸ºæ›¿æ¢çš„è¯ï¼Œå¯ä»¥å‡å°‘DRAMçš„å­˜å‚¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›æ€§èƒ½é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°¾å»¶è¿Ÿï¼šå¾ˆå¤šLSM-treeä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥å¿«é€Ÿæ£€ç´¢ï¼Œå¯é æ€§å·®ï¼Œå­˜åœ¨å°¾å»¶è¿Ÿé—®é¢˜&lt;/li&gt;
&lt;li&gt;å†™æ”¾å¤§ï¼šç”±äºLSMå¯¹KVç´¢å¼•çš„æ’åºå’Œåˆå¹¶æ“ä½œï¼Œå¸¦æ¥äº†å¾ˆå¤šå¯¹é—ªå­˜é¢å¤–çš„è®¿é—®ï¼Œè¿˜å¢å¤§äº†FTLè¿›è¡ŒGCçš„è´Ÿæ‹…&lt;/li&gt;
&lt;li&gt;å¸ƒéš†è¿‡æ»¤å™¨çš„é‡å»ºå’ŒKVæ’åºï¼šæ¶ˆè€—äº†å¤§é‡çš„CPUèµ„æºï¼Œå¸¦æ¥I/Oæ€§èƒ½çš„å¤§å¹…ä¸‹é™&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºLSM-treeçš„KVå­˜å‚¨å¼•æ“-PinKï¼Œè§£å†³äº†ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ã€‚PinKä½¿ç”¨äº†å››ç§æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKçš„æ ¸å¿ƒæ˜¯level pinningï¼Œå°†å›ºå®šåœ¨LSM-treeæœ€é¡¶å±‚çš„KVç´¢å¼•å›ºå®šåˆ°DRAMä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºéƒ¨åˆ†levelå›ºå®šåœ¨DRAMä¸­ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è¿›è¡Œcompactionï¼Œæ— éœ€å ç”¨é—ªå­˜çš„I/Oï¼Œè¢«å›ºå®šçš„ç´¢å¼•é€šè¿‡ç”µå®¹è¿›è¡Œä¿æŠ¤ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦å®šæœŸè¿›è¡Œåˆ·æ–°ï¼Œè¿™é‡Œè¦æ³¨æ„ä½œè€…ä½¿ç”¨DRAMå®¹é‡å¾ˆå°ï¼Œä½¿ç”¨ç”µå®¹è¶³ä»¥ä¿è¯æŒä¹…åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GCçš„ä¸»è¦I/Oå¼€é”€æ¥è‡ªå¯¹LSM-treeç´¢å¼•çš„æ›´æ–°ï¼ŒPinké€šè¿‡å»¶è¿ŸLSM-treeä¸­ç´¢å¼•æ›´æ–°åˆ°compactioné˜¶æ®µæ¥å‡å°‘GCçš„I/Oå¼€é”€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨SSDæ§åˆ¶å™¨å’ŒNANDèŠ¯ç‰‡ä¹‹é—´æ·»åŠ æ¯”è¾ƒå™¨ï¼ŒPinKåœ¨è¯»å–KVå¯¹è±¡æ—¶æ‰§è¡ŒKVæ’åºï¼Œå®Œå…¨æ¶ˆé™¤äº†compactionçš„CPUæˆæœ¬&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x02-bg&#34;&gt;0x02 Bg&lt;/h1&gt;
&lt;p&gt;äº†è§£ä¸€äº›æœ‰å…³NANDé—ªå­˜SSDã€KV-SSDã€Hash-based KV-SSDã€LSM-Tree-based KV-SSDçš„ç°çŠ¶ï¼Œå¹¶å¯¹Hashå’ŒLSM-treeè¿›è¡Œæ¯”è¾ƒ&lt;/p&gt;
&lt;p&gt;ä½œè€…å¯¹LSM-treeçš„è®¾è®¡ï¼ŒL0ä½äºDRAMä¸­ï¼Œå¹¶ä½œä¸ºwrite bufferï¼Œå…¶ä½™å„å±‚å­˜å‚¨åœ¨é—ªå­˜ä¸­&lt;/p&gt;
&lt;h1 id=&#34;0x03-design&#34;&gt;0x03 Design&lt;/h1&gt;
&lt;p&gt;Pinkæœ‰å››ä¸ªä¸»è¦çš„æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;ä½äºDRAMä¸­çš„level listså’ŒSkiplist&lt;/p&gt;
&lt;p&gt;ä½äºé—ªå­˜ä¸­çš„meta segmentså’Œdata segments&lt;/p&gt;
&lt;p&gt;åœ¨LSM-tree KV æ–‡ä»¶ç³»ç»Ÿæ–¹é¢ï¼Œä½œè€…ä¸»è¦å‚è€ƒäº†&lt;a class=&#34;link&#34; href=&#34;https://www.usenix.org/conference/fast16/technical-sessions/presentation/lu&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;WiscKey FAST&#39;16&lt;/a&gt;ï¼Œå–ä»£FTLè¿›è¡ŒGCã€ç´¢å¼•å’Œç£¨æŸå‡è¡¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221128145842322.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221128145842322&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;skiplist&#34;&gt;Skiplist&lt;/h2&gt;
&lt;p&gt;Skiplistä½œä¸ºLSM-treeä¸­çš„L0ï¼Œèµ·åˆ°ç±»ä¼¼write bufferçš„ä½œç”¨ï¼Œæš‚æ—¶ä¿å­˜KVå¯¹è±¡ï¼ŒSkiplistä¸­çš„å¯¹è±¡ä¸ºï¼š&lt;code&gt;&amp;lt;key size, key, value size, value&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å½“Skiplistæ»¡æ—¶ï¼Œä¼šå°†ç¼“å­˜çš„å¯¹è±¡ä»¥meta segmentå’Œdata segmentçš„å½¢å¼åˆ·æ–°åˆ°L1ä¸­ï¼Œåœ¨L1å’Œæ›´ä½çš„levelä¸­ï¼ŒKeyå’ŒValueå°†è¢«åˆ†ç¦»å­˜å‚¨åˆ°meta/data segmentä¸­ï¼Œdata segmentä¸­å­˜å‚¨valueã€keyå’Œkey sizeç”¨äºGC&lt;/p&gt;
&lt;h2 id=&#34;level-list&#34;&gt;Level list&lt;/h2&gt;
&lt;p&gt;ç”¨äºè·Ÿè¸ªé—ªå­˜ä¸­æ¯ä¸ªlevelçš„meta segment&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªlevel listæ˜¯ä¸€ä¸ªä¿å­˜å›ºå®šå¤§å°çš„æŒ‡é’ˆå¯¹çš„æ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆ4Bï¼Œç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘meta segmentåœ¨é—ªå­˜ä¸­çš„ç‰©ç†åœ°å€ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘meta segmentçš„start key&lt;/p&gt;
&lt;p&gt;meta segmentçš„start keyå•ç‹¬å­˜å‚¨åœ¨DRAMä¸­ï¼Œå¯ä»¥æ”¯æŒåŠ¨æ€å¤§å°çš„keyï¼ŒåŒæ—¶å¯ä»¥å®ç°åœ¨level listæŸ¥æ‰¾meta segmentæ—¶è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;å¦‚æœLSM-treeæœ‰5ä¸ªLevelï¼Œå³h=5ï¼Œé™¤äº†L0ä¹‹å¤–ï¼Œæ¯ä¸ªleveléƒ½ä¼šæœ‰ä¸€ä¸ªlevel list&lt;/p&gt;
&lt;p&gt;L0å’ŒLevel listé€šè¿‡ç”µå®¹æ¥ä¿æŠ¤ï¼ŒPinkä¸éœ€è¦ä½¿ç”¨æ—¥å¿—æ¥ç»´æŠ¤åŸå­æ€§å’Œæ•°æ®çš„æŒä¹…æ€§&lt;/p&gt;
&lt;h2 id=&#34;level-pinning&#34;&gt;Level Pinning&lt;/h2&gt;
&lt;p&gt;æ¶ˆé™¤å°¾å»¶è¿Ÿï¼Œå°†$top-k\ \  level(k&amp;lt;=h-1)$ çš„meta segmentä¿å­˜åœ¨DRAMä¸­ï¼Œå‡å°‘äº†readè¿‡ç¨‹çš„å°¾éƒ¨å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;å½“å¤„ç†GETæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆåœ¨DRAMä¸­å¯¹Keyè¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“DRAMä¸­æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå°†å¯¹å‰©ä½™çš„å‡ ä¸ªlevelåœ¨é—ªå­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œåœ¨ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæœ€åçš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º$O(h-1)$ï¼Œè¯¥ç­–ç•¥ä¸‹å¯ä»¥ä¼˜åŒ–ä¸º$O(h-k-1)$&lt;/p&gt;
&lt;p&gt;å› æ­¤LSM-treeå„levelæŒ‰ç…§å‚æ•°Tè¿›è¡Œå¢é•¿ï¼Œå› æ­¤topkç­–ç•¥ä¸‹ç©ºé—´å ç”¨ä¸ä¼šè¿‡å¤§&lt;/p&gt;
&lt;p&gt;åŒæ—¶å¯ä»¥ç›´æ¥åœ¨DRAMä¸­è¿›è¡Œcompactionæ“ä½œï¼Œæ— éœ€å ç”¨é—ªå­˜I/Oï¼Œå› ä¸ºæœ‰ç”µå®¹çš„å­˜åœ¨ï¼Œæ— éœ€å®šæœŸåˆ·æ–°è„segmentåˆ°é—ªå­˜ä¸­&lt;/p&gt;
&lt;h2 id=&#34;optimizing-search-path&#34;&gt;Optimizing Search Path&lt;/h2&gt;
&lt;p&gt;åœ¨å¯¹Keyè¿›è¡ŒæŸ¥è¯¢æ—¶ï¼ŒLSM-treeå°†å¯¹å„ä¸ªLevelè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221129190239823.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221129190239823&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æœ´ç´ çš„LSM-treeæœ€åçš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º$O(h^2\cdot log(T))$ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„æƒ…å†µä¸‹å¯ä»¥æ›´ä½&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKé€šè¿‡prefixæ¥å‡å°‘å­—ç¬¦ä¸²æ¯”è¾ƒçš„å¼€é”€ï¼Œå¹¶ä¸”å…ˆæ¯”è¾ƒkeyçš„å‰4ä¸ªå­—èŠ‚ï¼Œå¦‚æœåŒ¹é…æˆåŠŸæ‰ä¼šæ¯”è¾ƒåé¢çš„éƒ¨åˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨level listä¸Šæ¯ä¸ªè®°å½•å¼•å…¥ä¸€ä¸ª4å­—èŠ‚çš„èŒƒå›´æŒ‡é’ˆï¼Œå®ç°å¤šçº§cascadingèŒƒå›´æŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€çº§æœ‰æœ€å¤§çš„start keyåŒæ—¶key å°äºç­‰äºä¸Šä¸€çº§ä¸­çš„è®°å½•ï¼Œåœ¨ä¸€çº§ä¸€çº§çš„ä¼ é€’ä¸­ä¸æ–­å‡å°‘æœç´¢çš„èŒƒå›´ï¼Œå¦‚ä¸Šå›¾bæ‰€ç¤ºï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º$O(h\cdot log(T))$&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;speeding-up-compaction&#34;&gt;Speeding up Compaction&lt;/h2&gt;
&lt;p&gt;åœ¨compactioné˜¶æ®µï¼Œå¼•å…¥ä¸€ä¸ªç¡¬ä»¶åŠ é€Ÿå™¨ï¼Œä½äºé—ªå­˜å’Œæ•°æ®ä¸»æ€»çº¿ä¹‹é—´ï¼Œå¯ä»¥æ–¹ä¾¿çš„åˆå¹¶ä¸¤ä¸ªé—ªå­˜ä¸­çš„level&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221129225719057.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221129225719057&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å·¥ä½œæµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;PinKå‘åŠ é€Ÿå™¨å‘èµ·compactionè¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤ä¸ªlevelçš„meta segmentçš„é—ªå­˜åœ°å€$(L_i,L_{i+1})$&lt;/li&gt;
&lt;li&gt;å›å†™çš„é—ªå­˜åœ°å€$L_{i+1}$&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘å¤šä¸ªé—ªå­˜å‘èµ·è¯»å–è¯·æ±‚ï¼ŒåŒæ—¶è¿˜è¦å¯¹ä¸åŒchannelè¿”å›çš„æ•°æ®è¿›è¡Œé‡æ–°æ’åºï¼Œåºåˆ—åŒ–meta segment&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ç°è‰²çš„æ¯”è¾ƒå™¨ï¼Œä¼šä¸æ–­çš„è·å–ä¸¤ä¸ªlevelä¸­çš„æ•°æ®ï¼Œè¾“å‡ºkeyè¾ƒå°çš„é‚£ä¸€ä¸ª&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºæ— æ•ˆçš„keyï¼Œå°†é€šçŸ¥PinKè¿›è¡ŒGC&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å‡ºçš„æ’åºåç»“æœå°†ä¿å­˜åœ¨write bufferä¸­è¿›è¡Œå›å†™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ“ä½œç»“æŸåï¼ŒåŠ é€Ÿå™¨é€šçŸ¥PinKå½“å‰$L_{i+1}$ä½¿ç”¨çš„é—ªå­˜é¡µçš„æ•°é‡ï¼Œä¾¿äºå’Œæ­¤å‰æä¾›çš„è¿›è¡Œæ¯”è¾ƒï¼Œç”¨äºGC&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;PinKåœ¨DRAMçš„pinned levelä¸­ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼çš„åŠ é€Ÿå™¨ï¼ŒåŸºäºDMA&lt;/p&gt;
&lt;h2 id=&#34;optimizing-gc&#34;&gt;Optimizing GC&lt;/h2&gt;
&lt;p&gt;éœ€è¦é’ˆå¯¹meta/data segmentåˆ†åˆ«åˆ¶å®šGCç­–ç•¥&lt;/p&gt;
&lt;h2 id=&#34;durability--scalability&#34;&gt;Durability &amp;amp;&amp;amp; Scalability&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ç”µå®¹æ¥ä¿æŠ¤æ•´ä¸ªDRAMï¼Œå¯¹äºæ¯”è¾ƒä½ç«¯çš„SSDï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ç”µå®¹æ¥ç»´æŒï¼Œåªèƒ½ç»§ç»­ä½¿ç”¨å®šæœŸå†™å›åˆ°é—ªå­˜çš„æœºåˆ¶ï¼ˆè¦ä¿æŠ¤level listsï¼Œpinned levelï¼ŒL0ï¼‰ï¼ŒåŒæ—¶è¿˜è¦è®°å½•æ—¥å¿—ï¼Œç”±äºLSM-treeçš„ç‰¹æ€§ï¼Œè¯¥æ“ä½œæ¯”åŸºäºhashçš„KV-SSDå¼€é”€ç•¥å°&lt;/p&gt;
&lt;h1 id=&#34;conclusion--thinking&#34;&gt;Conclusion &amp;amp;&amp;amp; Thinking&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä¹‹å‰é˜…è¯»çš„KV-SSDç›¸æ¯”ï¼ŒPinKå°†éƒ¨åˆ†Levelå›ºå®šåˆ°DRAMä¸­ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;PinKå¼ƒç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½¿ç”¨ä¸€ç§å±‚çº§ç¼©å°æŸ¥æ‰¾èŒƒå›´çš„æ–¹å¼ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡&lt;/li&gt;
&lt;li&gt;å¼•å…¥äº†ä¸€ä¸ªåŠ é€Ÿå™¨æ¥å‡å°‘LSM-tree compactionæ“ä½œçš„å¼€é”€&lt;/li&gt;
&lt;li&gt;è®ºæ–‡éƒ½æé«˜äº†å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨æ—¶é‡å»ºçš„å¼€é”€ç•¥é«˜ï¼Œæ˜¯å¦å¯ä»¥è€ƒè™‘ä½¿ç”¨å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼Œè¿™éƒ¨åˆ†ä¸»è¦ç€çœ¼äºLSM-treeçš„ä¼˜åŒ–ï¼Œå¯èƒ½å¹¶ä¸æ˜¯çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>[FAST&#39;18] FEMUé—ªå­˜æ¨¡æ‹Ÿç³»ç»Ÿä»‹ç»</title>
        <link>https://blog.ipandai.club/p/fast18-femu%E9%97%AA%E5%AD%98%E6%A8%A1%E6%8B%9F%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/</link>
        <pubDate>Wed, 23 Nov 2022 19:44:51 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/fast18-femu%E9%97%AA%E5%AD%98%E6%A8%A1%E6%8B%9F%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/</guid>
        <description>&lt;h1 id=&#34;0x00-everyday-english&#34;&gt;0x00 Everyday English&lt;/h1&gt;
&lt;p&gt;LOC == line of code&lt;/p&gt;
&lt;p&gt;Guest OS == VM&lt;/p&gt;
&lt;p&gt;intricacies é”™ç»¼å¤æ‚&lt;/p&gt;
&lt;p&gt;drop-in replacement é€šå¸¸è¡¨ç¤ºç›´æ¥æ›¿æ¢ï¼Œå¹¶ä¸”æ›¿æ¢åä¸ä¼šäº§ç”Ÿå½±å“ï¼Œç”šè‡³ä¼šæœ‰ä¸€äº›æ–°çš„åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;leverage å¯¹&amp;hellip;äº§ç”Ÿå½±å“ï¼›ä¸€èˆ¬ä¹Ÿå¯ä»¥ç†è§£ä¸º å……åˆ†åˆ©ç”¨ï¼Œæ¯”utilizeè¯­æ°”å¼ºä¸€äº›&lt;/p&gt;
&lt;h1 id=&#34;0x01-intro&#34;&gt;0x01 Intro&lt;/h1&gt;
&lt;p&gt;FEMUæ˜¯ç”¨äºè½¯ç¡¬ä»¶å…¨æ ˆçš„SSDç ”ç©¶æ¨¡æ‹Ÿå¹³å°ï¼ŒåŸºäºQEMUå¼€å‘ï¼Œç›¸æ¯”äºOpenChannel SSDå®ç°äº†è¾ƒé«˜çš„å‡†ç¡®ç‡&lt;/p&gt;
&lt;p&gt;æ­¤å‰çš„SSDç ”ç©¶æ¨¡æ‹Ÿå·¥å…·å¤§å¤šä¸å¼€æºï¼Œå¯æ‰©å±•æ€§å·®ï¼Œç ”ç©¶æˆæœ¬é«˜ï¼Œå¹¶ä¸”å·²ç»è¿‡æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;FEMUé¦–å…ˆå¼€æºå…è´¹ï¼Œå¹¶ä¸”æœ‰è¾ƒé«˜çš„å‡†ç¡®åº¦ï¼ŒåŒæ—¶å¯ä¼¸ç¼©æ€§å¼ºï¼Œæœ€å¤§æ”¯æŒ32 I/O çº¿ç¨‹å¹¶æ¨¡æ‹Ÿ32ä¸ªå¹¶è¡Œçš„SSD channels/chipsï¼Œå¯æ‰©å±•æ€§é«˜ï¼Œå¾—ç›ŠäºåŸºäºQEMUçš„ä¼˜ç‚¹ï¼ŒFEMUå¯ä»¥æ”¯æŒé’ˆå¯¹äºSSDçš„ç ”ç©¶ï¼Œé’ˆå¯¹os å†…æ ¸çš„ç ”ç©¶ï¼Œæˆ–è€…åŸºäºoså†…æ ¸å’ŒSSDçš„ç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/vtess/FEMU&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;FEMU GitHub ä»“åº“åœ°å€ï¼š https://github.com/vtess/FEMU&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x02-femu&#34;&gt;0x02 FEMU&lt;/h1&gt;
&lt;p&gt;FEMUæœ¬èº«ä»…æœ‰3929è¡Œä»£ç ï¼ŒåŸºäºQEMU v2.9ï¼ŒFEMUè¿‘äº›å¹´çš„æ›´æ–°ä¹Ÿä¸»è¦ä¸ºä¿®å¤ä¸€äº›bugã€åˆå¹¶QEMUçš„ç‰ˆæœ¬ï¼Œå°†ä¼ ç»Ÿçš„App+å®¿ä¸»æœº+SSDçš„ç ”ç©¶æ¶æ„è½¬å˜ä¸ºäº†App+è™šæ‹Ÿæœº+FEMUã€‚&lt;/p&gt;
&lt;p&gt;FEMUä¸­çš„FTLæ¨¡å—ã€GCã€I/Oè°ƒåº¦ä¸»è¦åŸºäºVSSIM&lt;a class=&#34;link&#34; href=&#34;https://ieeexplore.ieee.org/document/6558443&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;VSSIM: Virtual machine based SSD simulator | IEEE Conference Publication | IEEE Xplore&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¯ä¼¸ç¼©æ€§&#34;&gt;å¯ä¼¸ç¼©æ€§&lt;/h2&gt;
&lt;p&gt;å¯¹äºå½“å‰çš„é«˜å¹¶è¡ŒåŒ–çš„SSDï¼Œå¯ä¼¸ç¼©æ€§å¯¹æ¨¡æ‹Ÿé—ªå­˜è‡³å…³é‡è¦ã€‚é€šè¿‡virtioå’Œdataplaneæ¥å£è¿›è¡Œæ¨¡æ‹Ÿï¼Œä¸èƒ½è¾¾åˆ°è¶³å¤Ÿçš„å¯ä¼¸ç¼©æ€§ï¼ŒåŒæ—¶å­˜åœ¨è¾ƒé«˜çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨QEMUä¸­å­˜åœ¨çš„ä¸¤ä¸ªä¸»è¦é—®é¢˜æ˜¯&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;QEMUä½¿ç”¨ä¼ ç»Ÿçš„trap-and-emulateæ–¹æ³•è¿›è¡ŒI/Oæ¨¡æ‹Ÿï¼Œè™šæ‹Ÿæœºçš„NVMeé©±åŠ¨é€šè¿‡doorbellå¯„å­˜å™¨å‘ŠçŸ¥QEMUæ¨¡æ‹Ÿçš„I/Oè®¾å¤‡ã€‚è¯¥doorbellå°†å¼•èµ·å¼€é”€è¾ƒå¤§çš„VM-exitï¼ŒåŒæ—¶åœ¨I/Oå®Œæˆé˜¶æ®µï¼Œä¹Ÿä¼šäº§ç”Ÿè¯¥è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;QEMUä½¿ç”¨å¼‚æ­¥I/Oæ¥å®ç°read/writeï¼ŒAIOçš„æ‰§è¡Œéœ€è¦é¿å…QEMUçš„I/Oè¢«é˜»å¡ï¼Œå½“åœ¨å­˜å‚¨åç«¯æ˜¯åŸºäºRAMçš„é•œåƒæ—¶ï¼ŒAIOäº§ç”Ÿçš„è´Ÿè½½å°¤ä¸ºæ˜æ˜¾&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨åŸºäºè½®è¯¢çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”ç¦ç”¨äº†è™šæ‹Ÿæœºçš„doorbellå†™æ“ä½œï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ¥è½®è¯¢å­˜å‚¨è®¾å¤‡é˜Ÿåˆ—çš„çŠ¶æ€ï¼Œé¿å…äº†VM-exit&lt;/li&gt;
&lt;li&gt;ä¸ä½¿ç”¨è™šæ‹Ÿçš„é•œåƒæ–‡ä»¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ä»¥RAMä¸ºåç«¯çš„å­˜å‚¨æ¨¡æ‹Ÿï¼Œå®šä¹‰åœ¨QEMUçš„å †ç©ºé—´ä¸­ï¼Œå°†QEMUä¸­DMAä¿®æ”¹ä¸ºä»QEMU heapä¸­è¯»å†™æ•°æ®ï¼Œè¿™ä¸ªæ”¹å˜å¯¹VMæ¥è¯´æ˜¯é€æ˜çš„&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å‡†ç¡®åº¦&#34;&gt;å‡†ç¡®åº¦&lt;/h2&gt;
&lt;h3 id=&#34;å»¶è¿Ÿæ¨¡æ‹Ÿ&#34;&gt;å»¶è¿Ÿæ¨¡æ‹Ÿ&lt;/h3&gt;
&lt;p&gt;å½“I/Oè¯·æ±‚åˆ°è¾¾åï¼ŒFEMUå‘èµ·DMA R/Wï¼Œå¹¶ç”¨æ¨¡æ‹Ÿçš„å®Œæˆæ—¶é—´$(T_{endio})$å¯¹I/Oè¯·æ±‚è¿›è¡Œæ ‡è®°ï¼Œæ·»åŠ åˆ°endio queueä¸­ï¼Œé˜Ÿåˆ—æŒ‰ç…§I/Oçš„å®Œæˆæ—¶é—´è¿›è¡Œæ’åºã€‚ä¸€æ—¦I/Oè¯·æ±‚çš„é¢„ä¼°å®Œæˆæ—¶é—´å¤§äºå½“å‰æ—¶é—´ï¼Œä¼šç”±ä¸“é—¨çš„end I/O å¤„ç†çº¿ç¨‹è´Ÿè´£å°†å…¶é€šè¿‡ä¸­æ–­å‘é€ç»™è™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;FEMUå¯¹æ¯ä¸ªI/Oè¯·æ±‚éƒ½è®¾ç½®äº†&lt;code&gt;+50us&lt;/code&gt;çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»¶è¿Ÿæ¨¡å‹&#34;&gt;å»¶è¿Ÿæ¨¡å‹&lt;/h3&gt;
&lt;p&gt;å¯¹äº$T_{endio}$çš„è®¡ç®—ï¼š&lt;/p&gt;
&lt;p&gt;æ ‡è®°æ¯ä¸ªplaneå’Œchannelçš„ä¸‹ä¸€æ¬¡ç©ºé—²æ—¶é—´$T_{free}$ï¼Œ&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªpageå†™å…¥éœ€è¦channel #1 å’Œplane #2æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆchannelçš„ä¸‹ä¸€æ¬¡ç©ºé—²æ—¶é—´å°†ä¸º$T_{freeOfChannel1}=T_{now}+T_{transfer}$ï¼Œå…¶ä¸­çš„$T_{transfer}$ä¸ºä¸€ä¸ªå¯é…ç½®çš„pageåœ¨channelä¸­çš„ä¼ è¾“æ—¶é—´ï¼Œplaneçš„ä¸‹ä¸€æ¬¡ç©ºé—²æ—¶é—´åˆ™ä¸º$T_{freeOfPlane2}+=T_{write}$ï¼Œå…¶ä¸­$T_{write}$æ˜¯å¯é…ç½®çš„NAND pageå†™å…¥æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤è¯¥å†™å…¥æ“ä½œçš„$T_{endio}=T_{freeOfPlane2}$ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªå†™å…¥è¿‡ç¨‹æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œå¯¹äºæ–°åˆ°è¾¾çš„page readï¼Œå°†ä»¤$T_{freeOfPlane2} += T_{read}$ï¼Œå…¶ä¸­$T_{read}$ä¸ºå¯é…ç½®çš„å‚æ•°NAND pageè¯»å–æ—¶é—´ï¼Œå¹¶ä¸”$T_{freeOf Channel1} += T_{transfer}$ï¼Œ&lt;/p&gt;
&lt;p&gt;å› æ­¤è¯¥page writeçš„$T_{endio}=T_{freeOf Channel1}$ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ™®é€šçš„SSD planeåªæœ‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå•ä¸ªplaneä¸èƒ½å®ç°I/Oå¹¶è¡Œï¼Œæ‰€ä»¥è¯¥æ¨¡å‹å¯ä»¥æ»¡è¶³å®é™…è¦æ±‚&lt;/p&gt;
&lt;p&gt;è¯¥æ¨¡å‹å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ª$T_{erase}$æ¥æ¨¡æ‹ŸGCçš„å»¶è¿Ÿ&lt;/p&gt;
&lt;h3 id=&#34;openchannelå»¶è¿Ÿæ¨¡å‹&#34;&gt;OpenChannelå»¶è¿Ÿæ¨¡å‹&lt;/h3&gt;
&lt;p&gt;OpenChannel SSDï¼ŒOCä½¿ç”¨åŒå¯„å­˜å™¨çš„planeï¼Œdata registerå’Œcache registerï¼Œå› æ­¤åœ¨ä¸€ä¸ªplaneä¸­å¯¹ä¸€ä¸ªNAND pageçš„read/writeå¯ä»¥å¹¶è¡Œï¼Œå› æ­¤æ•ˆç‡é«˜ï¼Œä¸‹å›¾ç›´è§‚çš„å±•ç¤ºäº†äºŒè€…çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221125195232028.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221125195232028&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;OCæœ‰ç€ä¸ç»Ÿä¸€çš„å»¶è¿Ÿæ¨¡å‹ï¼Œæ˜ å°„åˆ°MLCé¢—ç²’cellé«˜ä½bitsçš„pageæœ‰ç€æ›´é«˜çš„å»¶è¿Ÿï¼Œå®é™…ä¸Šä¸€ä¸ªNANDä¸­çš„512ä¸ªpageä»¥ä¸€ç§ç‰¹åˆ«çš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œ&lt;code&gt;LLLLLLuLLuLLuuLLuu...(repeate of LLuu)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;FEMUå¯¹OCçš„å®ç°æ–¹å¼è¿›è¡Œäº†æ•´åˆï¼Œå®ç°äº†è¾ƒå¥½çš„æ•ˆæœ&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–åŠŸèƒ½&#34;&gt;å…¶ä»–åŠŸèƒ½&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;FTLå’ŒGCï¼šé»˜è®¤ä½¿ç”¨åŠ¨æ€æ˜ å°„FTLï¼Œchannelé˜»å¡çš„GCã€‚åŒæ—¶è¿˜æ”¯æŒchannelã€controllerã€planeå±‚é¢è¿›è¡Œé˜»å¡çš„GCç­–ç•¥&lt;/li&gt;
&lt;li&gt;ç™½ç›’æ¨¡å¼/é»‘ç›’æ¨¡å¼&lt;/li&gt;
&lt;li&gt;å¤šè®¾å¤‡æ”¯æŒï¼šæ”¯æŒè™šæ‹Ÿæœºè¿æ¥å¤šä¸ªSSDï¼Œæ¯ä¸ªSSDåŒ…å«ç‹¬ç«‹çš„NVMeå®ä¾‹å’ŒFTL&lt;/li&gt;
&lt;li&gt;æ‰©å±•NVMeæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;Page-Levelå»¶è¿Ÿå¯è‡ªå®šä¹‰ï¼šæ¨¡æ‹Ÿé—ªå­˜èŠ¯ç‰‡çš„è‰¯å“ç‡å¸¦æ¥çš„å»¶è¿Ÿä¸ç»Ÿä¸€æ€§&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼SSDï¼šè¯„ä¼°ç±»ä¼¼Hadoopçš„åº”ç”¨&lt;/li&gt;
&lt;li&gt;Page-Levelæ•…éšœæ³¨å…¥ï¼šè¿›è¡Œé—ªå­˜å¯é æ€§ç ”ç©¶&lt;/li&gt;
&lt;li&gt;ä¸€äº›é™åˆ¶ï¼šFEMUåŸºäºDRAMï¼Œä¸èƒ½æ¨¡æ‹Ÿå®¹é‡å¤ªå¤§çš„SSDï¼Œå¿…é¡»æ‰‹åŠ¨æ¨¡æ‹ŸSSDå´©æºƒçš„æƒ…æ™¯ï¼Œå› ä¸ºDRAMé‡å¯å°†ä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>[OSDI&#39;21] Modernizing File System through In-Storage Indexing</title>
        <link>https://blog.ipandai.club/p/osdi21-modernizing-file-system-through-in-storage-indexing/</link>
        <pubDate>Sat, 29 Oct 2022 16:48:32 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/osdi21-modernizing-file-system-through-in-storage-indexing/</guid>
        <description>&lt;h1 id=&#34;questions&#34;&gt;Questions&lt;/h1&gt;
&lt;p&gt;æ ¸å¿ƒæ€æƒ³éƒ¨åˆ†éœ€è¦å†æ€è€ƒå’Œæ¢³ç†ä¸‹ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆé‡‡ç”¨ KV SSD æ›¿ä»£ä¼ ç»Ÿ block SSD èƒ½å¤Ÿè§£å†³ä¸Šè¿°é—®é¢˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å…¶ä¸­ï¼Œåˆ©ç”¨äº† KV SSD çš„ä»€ä¹ˆç‰¹æ€§ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¯¹æ–‡ä»¶ç³»ç»Ÿå“ªäº›åœ°æ–¹åšäº†ä»€ä¹ˆä»¥ä¼˜åŒ–ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®ºæ–‡è¯•å›¾è§£å†³çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;éšç€å­˜å‚¨è®¾å¤‡çš„ä¸æ–­å‘å±•ï¼Œå­˜å‚¨è®¾å¤‡çš„æ€§èƒ½è¶Šæ¥è¶Šé«˜ï¼Œä½†å½“å‰æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ–‡ä»¶ç³»ç»Ÿåœ¨ä¸€äº›æ“ä½œä¸Šå¹¶ä¸èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¦‚ä»Šå­˜å‚¨è®¾å¤‡çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®å†™å…¥æ—¶ï¼Œéœ€è¦æ‰§è¡Œå¤§é‡æ“ä½œç»´æŠ¤å…ƒæ•°æ®ã€è¿›è¡Œç¡¬ç›˜çš„ç©ºé—´ç®¡ç†ã€ç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œå·¥ä½œé‡å¤§ã€‚&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒæ€æƒ³ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Key-Valueå­˜å‚¨æ¥å£å–ä»£ä¼ ç»Ÿçš„å¿«è®¾å¤‡æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;p&gt;æå‡ºKevinï¼Œåˆ†ä¸ºKevin=KevinFS + KevinSSD&lt;/p&gt;
&lt;p&gt;KevinFS&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»´æŠ¤æ–‡ä»¶å’Œç›®å½•åˆ°KVå¯¹è±¡çš„æ˜ å°„å…³ç³»&lt;/li&gt;
&lt;li&gt;å°†POSIXç³»ç»Ÿè°ƒç”¨è½¬è¯‘æˆKVæ“ä½œæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;ä¿è¯KV-SSDçš„ä¸€è‡´æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;KevinSSD&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å­˜å‚¨è®¾å¤‡ä¸­ç´¢å¼•KVå¯¹è±¡&lt;/li&gt;
&lt;li&gt;å¯¹å¤šä¸ªKVå¯¹è±¡æä¾›äº‹åŠ¡æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x00-intro&#34;&gt;0x00 Intro&lt;/h1&gt;
&lt;p&gt;Keviné¿å…äº†å¤§é‡å…ƒæ•°æ®çš„ç»´æŠ¤å¸¦æ¥çš„I/Oæ”¾å¤§&lt;/p&gt;
&lt;p&gt;ä¸éœ€è¦æ—¥å¿—å³å¯å®Œæˆå´©æºƒä¸€è‡´æ€§çš„ç»´æŠ¤&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŠµå¾¡æ–‡ä»¶åˆ†æ®µåé€ æˆçš„æ€§èƒ½ä¸‹é™&lt;/p&gt;
&lt;p&gt;å­˜å‚¨çš„æ–‡ä»¶å—é€šè¿‡LSMè¿›è¡Œåˆ†éƒ¨æ’åºå’Œç´¢å¼•&lt;/p&gt;
&lt;h1 id=&#34;0x01-bg--related-work&#34;&gt;0x01 BG &amp;amp;&amp;amp; Related Work&lt;/h1&gt;
&lt;h2 id=&#34;ä¼ ç»Ÿå—è®¾å¤‡&#34;&gt;ä¼ ç»Ÿå—è®¾å¤‡&lt;/h2&gt;
&lt;p&gt;æä¾›å—ç²’åº¦ï¼ˆ512B or 4KBï¼‰çš„è®¿é—®&lt;/p&gt;
&lt;p&gt;HDDé€šè¿‡ç»´æŠ¤ä¸€ä¸ªé—´æ¥è¡¨æ¥å¤„ç†åå—&lt;/p&gt;
&lt;p&gt;åŸºäºé—ªå­˜çš„SSDé€šè¿‡FTLæ¥ç»´æŠ¤é€»è¾‘å—åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ç´¢å¼•è¡¨ï¼Œä»¥ä¾¿åœ¨å¼‚åœ°æ›´æ–°çš„NANDä¸Šæ¨¡æ‹Ÿå¯é‡å†™ä»‹è´¨å¹¶ä¸”æ’é™¤åå—ã€‚&lt;/p&gt;
&lt;p&gt;ç°æœ‰ç ”ç©¶ç¼“è§£äº†I/Oè°ƒåº¦ã€æ–‡ä»¶ç¢ç‰‡åŒ–ã€æ—¥å¿—ç›¸å…³é—®é¢˜ï¼Œæ²¡èƒ½æ¶ˆé™¤å…ƒæ•°æ®çš„ä¿®æ”¹å¸¦æ¥çš„I/Oæµé‡&lt;/p&gt;
&lt;p&gt;DevFSå®ç°äº†åœ¨å­˜å‚¨è®¾å¤‡å†…éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥å°†æ¥å£æš´éœ²ç»™åº”ç”¨ï¼Œè°ƒç”¨æ—¶ä¸ç”¨å‘ç”ŸTrapï¼Œå¯¹äºå…ƒæ•°æ®çš„ç»´æŠ¤éƒ½åœ¨å­˜å‚¨è®¾å¤‡ç«¯æ‰§è¡Œï¼Œç§»é™¤äº†I/O æ ˆå‡å°‘äº†é€šä¿¡æ¥å£çš„å¼€é”€ã€‚ç¼ºç‚¹æ˜¯éœ€è¦å¤§é‡çš„DRAMå’Œå¤šæ ¸å¿ƒçš„CPUã€èƒ½æä¾›çš„åŠŸèƒ½æœ‰é™ï¼Œè¿˜é™åˆ¶äº†å¿«ç…§ã€é‡å¤æ•°æ®åˆ é™¤ç­‰æ–‡ä»¶ç³»ç»Ÿé«˜çº§åŠŸèƒ½çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;KVå­˜å‚¨å¯ä»¥é«˜æ•ˆå¤„ç†å…ƒæ•°æ®å’Œå°æ–‡ä»¶çš„å†™å…¥&lt;/p&gt;
&lt;h2 id=&#34;lsm-tree&#34;&gt;LSM-Tree&lt;/h2&gt;
&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102145019013.png&#34; alt=&#34;image-20221102145019013&#34; style=&#34;zoom:70%;&#34; /&gt;
&lt;p&gt;LSM Treeæœ‰å¤šçº§ï¼ŒåŒ…æ‹¬$L_1,L_2,&amp;hellip;,L_{h-1},L_{h}$ï¼Œhæ˜¯æ ‘çš„é«˜åº¦ï¼Œå¯¹äºå„çº§çš„å¤§å°æœ‰å¦‚ä¸‹å…³ç³»ï¼Œ$Size(L_{i+1})&amp;gt;=T*Size(L_i)$&lt;/p&gt;
&lt;p&gt;æ¯å±‚éƒ½æœ‰æŒ‰Keyæ’åºçš„å”¯ä¸€KVå¯¹è±¡ã€‚å„å±‚ä¹‹é—´çš„KeyèŒƒå›´å¯èƒ½ä¼šå‡ºç°é‡å ã€‚&lt;/p&gt;
&lt;p&gt;KVå¯¹è±¡é¦–å…ˆå†™å…¥DRAMä¸­çš„Memtableï¼Œå½“Memtableä¸ä¸ºç©ºæ—¶ï¼Œç¼“å­˜çš„KVå¯¹è±¡å°†åˆ·æ–°åˆ°L1ä¸­è¿›è¡ŒæŒä¹…åŒ–ï¼Œå½“L1ä¸ä¸ºç©ºæ—¶ï¼ŒKVå¯¹è±¡åˆ·æ–°åˆ°L2ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œå‹ç¼©æ“ä½œæ¥å¯¹ä¸¤å±‚ä¹‹é—´çš„KVå¯¹è±¡è¿›è¡Œåˆå¹¶å’Œæ’åºï¼Œåœ¨æ’åºåå†™å›ç£ç›˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ”¹å–„å‹ç¼©æ“ä½œçš„I/Oå¼€é”€ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„valueå­˜å‚¨åœ¨value logä¸­ï¼Œåœ¨LSM treeä¸­åªä¿å­˜valueæŒ‡é’ˆï¼Œå­˜å‚¨&lt;code&gt;&amp;lt;key, value pointer&amp;gt;&lt;/code&gt;å½¢å¼ã€‚å¯¹äºå¤±æ•ˆçš„valueè¦è€ƒè™‘åƒåœ¾å›æ”¶é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯¹KVå¯¹è±¡è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å¤šçº§è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“åœ¨Liä¸åŒ¹é…æ—¶ï¼ŒæŸ¥æ‰¾Li+1ã€‚ä¸ºäº†å‡å°‘å¤šçº§æŸ¥æ‰¾çš„è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œä¼˜åŒ–ï¼Œå½“æ£€ç´¢åˆ°ç›®æ ‡KVå¯¹è±¡æ—¶ï¼ŒLSM treeå°†ä¼šè¿”å›ç›¸åº”çš„valueï¼ŒKVåˆ†ç¦»å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œå°†ä¼šé¢å¤–å»è¯»ä¸€æ¬¡value logã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-architecture&#34;&gt;0x02 Architecture&lt;/h1&gt;
&lt;p&gt;KEVINåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†&lt;/p&gt;
&lt;p&gt;KEVINFSï¼šç»´æŠ¤æ–‡ä»¶ã€ç›®å½•åˆ°KVå¯¹è±¡æ˜ å°„çš„æ–‡ä»¶ç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;KEVINSSDï¼šç´¢å¼•KVå¯¹è±¡åˆ°é—ªå­˜çš„LSM-tree&lt;/p&gt;
&lt;h2 id=&#34;kv-command&#34;&gt;KV Command&lt;/h2&gt;
&lt;p&gt;æ”¯æŒå¤šç§KVæŒ‡ä»¤ï¼ŒåŒæ—¶æ”¯æŒäº‹åŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102154423353.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102154423353&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…å°†Keyé™åˆ¶ä¸º256Bï¼Œvalueå¤§å°æ²¡æœ‰é™åˆ¶&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶å’Œç›®å½•çš„æ˜ å°„&#34;&gt;æ–‡ä»¶å’Œç›®å½•çš„æ˜ å°„&lt;/h2&gt;
&lt;p&gt;KevinFSåªä½¿ç”¨ä¸‰ä¸ªç±»å‹çš„KVå¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$superblock$ï¼šä¿å­˜æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¤§å°128B&lt;/li&gt;
&lt;li&gt;$meta$ï¼šä¿å­˜æ–‡ä»¶ã€ç›®å½•çš„å…ƒæ•°æ®ï¼Œå¤§å°256B&lt;/li&gt;
&lt;li&gt;$data$ï¼šä¿å­˜æ–‡ä»¶æ•°æ®ï¼Œunlimitedï¼Œä¸è¶…è¿‡æ–‡ä»¶å¤§å°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºç›®å½•çš„éå†é€šè¿‡ITERATE&lt;/p&gt;
&lt;p&gt;Keyçš„å‘½åéµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;metaå¯¹è±¡çš„keyç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;å‰ç¼€&lt;code&gt;m:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;çˆ¶ç›®å½•çš„inode number&lt;/li&gt;
&lt;li&gt;åˆ†éš”ç¬¦&lt;code&gt;:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶/ç›®å½•å&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;dataå¯¹è±¡çš„keyç»„æˆï¼š
&lt;ul&gt;
&lt;li&gt;å‰ç¼€&lt;code&gt;d:&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶çš„inode number&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Keyå‘½åè§„èŒƒå‚è€ƒäº†å…¶ä»–è®ºæ–‡ï¼ˆKai Ren and Garth Gibson. TABLEFS: Enhancing Metadata Efficiency in the Local File System. In Proceedings of the USENIX Annual Technical Conference, pages 145â€“156, 2013.ï¼‰ï¼Œæœ¬ç¯‡æ–‡ç« å°†å…¶æ‰©å±•åˆ°äº†å­˜å‚¨è®¾å¤‡å±‚é¢&lt;/p&gt;
&lt;p&gt;KevinFSæ²¡æœ‰å®ç°dentryï¼Œå¦‚æœéœ€è¦è®¿é—®ä¸€ä¸ªç›®å½•å†…çš„æ‰€æœ‰é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;ITERATE(m:50:, 2)&lt;/code&gt;ï¼Œæ¥è·å–ä¸¤ä¸ªçˆ¶ç›®å½•inodeä¸º50ï¼ˆå‰ç¼€åŒ¹é…ç»™å®šçš„patternï¼‰çš„å­ç›®å½•/æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¼˜åŒ–ï¼šä¸ºäº†é˜²æ­¢ITERATEæ¶ˆè€—å¤ªé•¿æ—¶é—´ï¼Œå»ºè®®æŒ‡å®šcnt&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¼˜åŒ–ï¼šä¸ºäº†é«˜æ•ˆå¤„ç†å°æ–‡ä»¶ï¼ŒKevinFSå°†æ€»ä½“å°äº4KBçš„å°æ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ•°æ®å†…å®¹æ‰“åŒ…ï¼ŒI/Oç›´æ¥æ“ä½œmetaå¯¹è±¡GET/SETæ¥è¿›è¡Œè¯»å†™&lt;/p&gt;
&lt;p&gt;@TODO ä¸€ä¸ªä¼˜åŒ–ï¼šä½¿ç”¨å…¨è·¯å¾„ç´¢å¼•æ¥å–ä»£åŸºäºinodeçš„ç´¢å¼•ï¼Œè¿™æé«˜äº†åŸºäºæ’åºç®—æ³•çš„KVå­˜å‚¨çš„æ‰«ææ€§èƒ½ï¼Œä¸»è¦å¯¹seek timeå¼€é”€å¤§çš„HDDä¼˜åŒ–æ¯”è¾ƒæ˜æ˜¾&lt;/p&gt;
&lt;h2 id=&#34;kvå¯¹è±¡ç´¢å¼•&#34;&gt;KVå¯¹è±¡ç´¢å¼•&lt;/h2&gt;
&lt;p&gt;KevinSSDåŸºæœ¬å®ç°äº†ä¼ ç»ŸSSD ä¸­FTLçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå°†KVå¯¹è±¡æ˜ å°„åˆ°é—ªå­˜ã€åˆ†é…å’Œé‡Šæ”¾é—ªå­˜çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;FTLåªåšåå—ç®¡ç†å’Œç£¨æŸå‡è¡¡ç­‰ç®€å•å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªLevelç»´æŠ¤ä¸€ä¸ªå†…å­˜è¡¨ï¼Œæ¥è®°å½•Flashä¸­çš„KVå¯¹è±¡ã€‚è¡¨çš„æ¯ä¸ªè®°å½•éƒ½æœ‰&lt;code&gt;&amp;lt;start key, end key, pointer&amp;gt;&lt;/code&gt;ï¼Œå…¶ä¸­æŒ‡é’ˆæŒ‡å‘ä¿å­˜KVå¯¹è±¡çš„é—ªå­˜é¡µé¢çš„ä½ç½®ï¼Œstart keyå’Œend keyæ˜¯é¡µé¢ä¸­keyçš„èŒƒå›´ã€‚keyçš„èŒƒå›´å¯ä»¥åœ¨å¤šä¸ªLevelä¸Šé‡å ã€‚ä¸ºäº†å¿«é€ŸæŸ¥æ‰¾ï¼Œæ‰€æœ‰è®°å½•éƒ½æŒ‰å¼€å§‹é”®æ’åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102165350981.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102165350981&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;metaå’Œdataå¯¹è±¡çš„Keyå’ŒValueä¼šè¢«åˆ†ç¦»å­˜å‚¨ã€‚é€šè¿‡&lt;code&gt;&amp;lt;key, value pointer&amp;gt;&lt;/code&gt;çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œä¼šæœ‰ä¸“é—¨çš„flash pageæ¥åˆ†åˆ«å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ˆmetaå’Œdataå¯¹è±¡ä½¿ç”¨ä¸åŒçš„flash pageï¼‰ï¼Œkey-index pages&lt;/p&gt;
&lt;h3 id=&#34;meta-object&#34;&gt;Meta object&lt;/h3&gt;
&lt;p&gt;åœ¨å¯¹KVå¯¹è±¡è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯èƒ½éœ€è¦åœ¨å¤šçº§è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“åœ¨Liä¸åŒ¹é…æ—¶ï¼ŒæŸ¥æ‰¾Li+1ã€‚ä¸ºäº†å‡å°‘å¤šçº§æŸ¥æ‰¾çš„è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œä¼˜åŒ–ï¼Œå½“æ£€ç´¢åˆ°ç›®æ ‡KVå¯¹è±¡æ—¶ï¼ŒLSM treeå°†ä¼šè¿”å›ç›¸åº”çš„valueï¼ŒKVåˆ†ç¦»å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œå°†ä¼šé¢å¤–å»è¯»ä¸€æ¬¡value logã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ç›®å½•é¡¹çš„æ›´æ–°åªéœ€è¦ä¿®æ”¹å…¶å…ƒæ•°æ®å³å¯å®Œæˆï¼Œè€Œä¸éœ€è¦ä¿®æ”¹4KBçš„å—&lt;/p&gt;
&lt;h3 id=&#34;data-object&#34;&gt;Data object&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†é¿å…å¯¹å¤§æ•°æ®çš„å°èŒƒå›´æ›´æ–°å¸¦æ¥çš„I/Oé«˜è´Ÿè½½ï¼ŒKevinSSDå°†data objectåˆ†å‰²ä¸º4KBå¤§å°çš„å­å¯¹è±¡ï¼Œä½¿ç”¨å•ç‹¬çš„åç¼€æ¥å¯¹ä»–ä»¬è¿›è¡Œè¡¨ç¤ºï¼Œåç¼€ä»0å¼€å§‹ï¼Œæ‹¼æ¥åœ¨åŸå§‹çš„data object Keyåï¼Œå› æ­¤data objectçš„keyæœ€ç»ˆæ„æˆä¸º
$$
d:{inode\ \ \ number}:{subobject \ \ number,start\ with \ 0}
$$
ä¸éœ€è¦ä¸­é—´è¡¨è¿›è¡Œç´¢å¼•ï¼Œåªéœ€è¦é€šè¿‡åç§»é‡å³å¯å®šä½è¦ä¿®æ”¹çš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;Data objectåŒæ ·ä½¿ç”¨ä¿å­˜æŒ‡é’ˆçš„æ–¹å¼å°†æ˜ å°„å­˜å‚¨åœ¨key-index pagesä¸­ï¼Œkey-index pagesä¼šå¯¹é”®è¿›è¡Œæ’åºï¼Œå› æ­¤å±äºåŒä¸€ä¸ªæ–‡ä»¶çš„subobjectä¸€èˆ¬ä¼šåœ¨åŒä¸€ä¸ªflash pageä¸­ã€‚&lt;/p&gt;
&lt;p&gt;==ä¼˜åŒ–==ï¼šåœ¨æŸ¥æ‰¾æŒ‡é’ˆæ—¶ï¼Œä¼šå°†ä¸€æ•´ä¸ªé—ªå­˜é¡µå†…çš„æ•°æ®å…¨éƒ¨å–å‡ºï¼Œå­˜å‚¨åœ¨æ§åˆ¶å™¨çš„DRAMä¸­ï¼Œå‡è½»åç»­æŸ¥æ‰¾å¯èƒ½å¸¦æ¥çš„è´Ÿè½½&lt;/p&gt;
&lt;h2 id=&#34;ç¼“è§£ç´¢å¼•è´Ÿè½½&#34;&gt;ç¼“è§£ç´¢å¼•è´Ÿè½½&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨LSM-treeç”±äºå¤šçº§æŸ¥æ‰¾å¸¦æ¥é¢å¤–çš„I/Oï¼Œä¼ ç»ŸFTLçš„æ˜ å°„éƒ½ä¿å­˜åœ¨DRAMï¼Œå› æ­¤æ²¡æœ‰é¢å¤–å¼€é”€ã€‚ä½œè€…ä»‹ç»äº†ä¸‰ç§ä¸»è¦åŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‹ç¼©æ“ä½œçš„å¼€é”€&#34;&gt;å‹ç¼©æ“ä½œçš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;åŒä¸Šæ–‡ä»‹ç»çš„æ–¹æ¡ˆï¼Œé€šè¿‡åˆ†ç¦»Valueå¯ä»¥æ˜¾è‘—ç¼“è§£I/Oçš„æ•°æ®ä¼ è¾“è´Ÿè½½ï¼Œå¯¹dataè¿›è¡Œåˆ†ç‰‡æˆ‘ä¸ªäººæ„Ÿè§‰åè€Œä¼šåŠ å¤§å‹ç¼©æ“ä½œçš„åˆå¹¶è¿‡ç¨‹ï¼Œå³ä½¿åˆ†ç‰‡åé”®å€¼éƒ½æ˜¯æœ‰åºçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å±‚çº§æŸ¥æ‰¾çš„å¼€é”€&#34;&gt;å±‚çº§æŸ¥æ‰¾çš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;ç”±äºLSM-treeçš„ç‰¹æ€§ï¼Œéœ€è¦é€å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸ºäº†é˜²æ­¢å¤§é‡çš„é¡ºåºæŸ¥æ‰¾ï¼Œä½œè€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œäº†ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶è¿˜ç¼“å­˜äº†çƒ­ç‚¹K2Vç´¢å¼•æ•°æ®ï¼ˆä¸ç›®æ ‡ç´¢å¼•å¤„åœ¨åŒä¸€ä¸ªflash pageä¸­çš„ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åˆ©ç”¨å¤§å®¹é‡SSDä¸­æä¾›çš„è¶…å¤§DRAMï¼Œä½œè€…é‡‡ç”¨å‹ç¼©å­˜å‚¨K2Vç´¢å¼•ï¼Œå¹¶åœ¨å…¶ä¸­æ’å…¥æ²¡æœ‰å‹ç¼©çš„K2Vç´¢å¼•æ¥ä½œä¸ºäºŒåˆ†æŸ¥æ‰¾çš„å‚ç…§ç‰©ã€‚ï¼ˆå¿«é€Ÿåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Ÿä¸å¦‚ç»§ç»­ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;åˆ†æ•£çš„å¯¹è±¡å¸¦æ¥çš„å¼€é”€&#34;&gt;åˆ†æ•£çš„å¯¹è±¡å¸¦æ¥çš„å¼€é”€&lt;/h3&gt;
&lt;p&gt;LSM-treeå…è®¸å„å±‚ä¹‹é—´çš„keyèŒƒå›´é‡å ï¼Œå› æ­¤æœ‰åŒä¸€ä¸ªå‰ç¼€çš„ç›®å½•æˆ–è€…æ–‡ä»¶å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„Levelä¸­ï¼Œå¯¹äºè·å–ä¸€ä¸ªç›®å½•ä¸­æ‰€æœ‰ç›®å½•ã€æ–‡ä»¶çš„æ“ä½œï¼Œéœ€è¦å¯¹å¤šä¸ªé—ªå­˜é¡µè¿›è¡Œè®¿é—®ã€‚è¿™ä¸ªé—®é¢˜ä½œè€…æ²¡æœ‰ç»™å‡ºä¸€ä¸ªæ˜ç¡®çš„æ–¹æ¡ˆï¼ˆåœ¨å‹ç¼©åˆå¹¶æ—¶éšå¼è§£å†³ï¼‰ï¼Œä½†æ˜¯æä¾›äº†ä¸€ä¸ªç”¨æˆ·å·¥å…·æ¥ä¸»åŠ¨è§¦å‘åˆå¹¶ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…å¯¹æ¯”äº†å„ç§æ–¹æ³•åœ¨éšæœºè¯»ã€å±€éƒ¨è¯»ï¼ˆï¼Ÿï¼‰ã€é¡ºåºè¯»æƒ…å†µä¸‹å¯¹é—ªå­˜é¡µçš„è¯»å–æ¬¡æ•°ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ç¨³å®šä¼šæœ‰ä¸€æ¬¡è¯»å–&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨äº†KevinSSDåå¯¹äºSSDè€Œè¨€ï¼ŒI/Oå»¶è¿Ÿæœ‰è½»å¾®çš„å¢åŠ ï¼Œæ•´ä½“è€Œè¨€æ•ˆç‡æé«˜äº†&lt;/p&gt;
&lt;h1 id=&#34;0x03-implement-vfs&#34;&gt;0x03 Implement VFS&lt;/h1&gt;
&lt;h2 id=&#34;write&#34;&gt;write&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰çš„å†™ç›¸å…³ç³»ç»Ÿè°ƒç”¨å¯ä»¥é€šè¿‡SETå’ŒDELETEæ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚unlinkï¼Œåªéœ€è¦ä¸¤æ¬¡DELETEæŒ‡ä»¤ï¼Œç§»é™¤metaå’Œdata objectã€‚&lt;/p&gt;
&lt;p&gt;SETæ—¶ç°åœ¨Memtableä¸­ä¿å­˜ä¸€ä¸ªKVå¯¹è±¡ï¼Œç„¶åæŒä¹…åŒ–åˆ°flashä¸­ï¼Œè‹¥Keyå·²å­˜åœ¨åˆ™ä¸¢å¼ƒæ—§çš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;DELETEæ—¶åœ¨æ ‘ä¸Šå†™å…¥ä¸€ä¸ª4Bå¤§å°çš„å¢“ç¢‘&lt;/p&gt;
&lt;p&gt;å¤±æ•ˆçš„å¯¹è±¡ï¼ˆè¢«SETè¦†ç›–ï¼‰å’Œåˆ é™¤çš„å¯¹è±¡åœ¨å‹ç¼©æœŸé—´è¢«æ°¸ä¹…åˆ é™¤&lt;/p&gt;
&lt;h2 id=&#34;read&#34;&gt;read&lt;/h2&gt;
&lt;p&gt;é€šè¿‡GETå’ŒITERATEå®ç°&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œopenç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒæŸ¥è¯¢meta objectè·å–æ–‡ä»¶çš„inodeï¼Œé€šè¿‡GETå‘½ä»¤å®ç°&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œlookupç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç»™å®šä¸€ä¸ªå®Œæ•´çš„è·¯å¾„&lt;code&gt;/home/alice/&lt;/code&gt;ï¼Œä»æ ¹ç›®å½•å¼€å§‹è·å–å¤šä¸ªmeta objectï¼Œæœ€ç»ˆè·å–ç›®æ ‡æ–‡ä»¶çš„inode&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œreadç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå°†GETä¸€ä¸ªdata object&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œreaddirç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä½¿ç”¨ITERATEï¼Œæ‰¹é‡è·å–ä¸€ç»„meta objectsæ¥è·å–inode&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221102210344432.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221102210344432&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ç›¸è¾ƒäºExt4ï¼ŒKevinFSå¯ä»¥æ›´å¥½çš„é˜²æ­¢æ–‡ä»¶ç¢ç‰‡åŒ–å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x04-crash-consistency&#34;&gt;0x04 Crash Consistency&lt;/h1&gt;
&lt;h2 id=&#34;ä¸€è‡´æ€§ç»´æŠ¤&#34;&gt;ä¸€è‡´æ€§ç»´æŠ¤&lt;/h2&gt;
&lt;p&gt;é€šè¿‡äº‹åŠ¡å³å¯å®ç°åŸå­åŒ–çš„æ“ä½œ&lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿçš„æ—¥å¿—ç»“æ„ä¸­ï¼Œç”±äºäº‹åŠ¡çš„å¤§å°å—æ—¥å¿—å¤§å°çš„é™åˆ¶ï¼Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å¯èƒ½ä¼šè¢«åˆ’åˆ†åˆ°å¤šä¸ªäº‹åŠ¡ä¸­ã€‚KVFSé€šè¿‡å¼ºåˆ¶é™åˆ¶å¯¹ä¸€ä¸ªæ–‡ä»¶çš„æ“ä½œé©»ç•™åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ¥ç¡®ä¿åŸå­æ€§ã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡çš„éš”ç¦»ï¼Ÿå¯¹==fsync==æŒ‡ä»¤å•ç‹¬åˆ›å»ºä¸€ä¸ªå°å‹äº‹åŠ¡æ¥æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;KevinFSåŸºäºKVäº‹åŠ¡çš„ç‰¹æ€§æ¥ç»´æŠ¤ä¸€è‡´æ€§ï¼Œä¸ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;kväº‹åŠ¡çš„å®ç°&#34;&gt;KVäº‹åŠ¡çš„å®ç°&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨äº†ä¸‰ä¸ªæ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡è¡¨$TxTable$ï¼šè®°å½•äº‹åŠ¡åŸºæœ¬ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ—¥å¿—$TxLogs$ï¼šç»´æŠ¤äº‹åŠ¡å¯¹è±¡çš„K2Vç´¢å¼•ï¼Œå­˜å‚¨åœ¨DRAMæˆ–è€…é—ªå­˜ä¸­&lt;/li&gt;
&lt;li&gt;æ¢å¤æ—¥å¿—$TxRecovery$ï¼šç”¨äºæ¢å¤å’Œç»ˆæ­¢äº‹åŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯æ”¶åˆ°BeginTxæŒ‡ä»¤æ—¶ï¼ŒKevinSSDåœ¨TxTableä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«TIDï¼Œå½“å‰äº‹åŠ¡çš„çŠ¶æ€ï¼Œä¸äº‹åŠ¡ç›¸å…³K2Vç´¢å¼•çš„ä½ç½®ï¼Œåˆå§‹çŠ¶æ€ä¸ºRUNNINGï¼ˆå¦‚â‘ ï¼‰ã€‚å½“åç»­æŒ‡ä»¤åˆ°è¾¾åï¼ŒKevinSSDå°†KVç´¢å¼•è®°å½•åœ¨TxLogsï¼Œå¹¶ç¼“å­˜åœ¨Memtableä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ”¶åˆ°EndTxæŒ‡ä»¤åï¼Œå®Œæˆäº‹åŠ¡çš„æäº¤ï¼Œæ ‡è®°äº‹åŠ¡çŠ¶æ€ä¸ºCOMMITTEDï¼ˆå¦‚â‘¡ï¼‰ã€‚å°†æäº¤çš„KVç´¢å¼•åŒæ­¥åˆ°LSM-treeä¸­&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20221103102304181.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20221103102304181&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘åœ¨COMMITTEDé˜¶æ®µï¼Œå°†TxLogsä¸­çš„KVç´¢å¼•åŒæ­¥åˆ°LSM tree L1ä¸­æ—¶çš„è´Ÿè½½ï¼Œå¯¹æ¯ä¸ªäº‹åŠ¡åœ¨DRAMä¸­ç»´æŠ¤äº†ä¸€ä¸ªSkiplistï¼Œä¾¿äºå¿«é€ŸæŸ¥æ‰¾KVå¯¹è±¡åœ¨TxLogsä¸­çš„ç´¢å¼•ï¼Œåœ¨L1å’ŒL2éœ€è¦è¿›è¡Œå‹ç¼©æ—¶å†å°†skiplistä¸­çš„æ•°æ®åŒæ­¥åˆ°checkpointï¼Œå½“åŒæ­¥å®Œæˆåï¼Œäº‹åŠ¡çš„çŠ¶æ€å°†å˜ä¸ºCHECKPOINTEDï¼ˆå¦‚â‘¢ï¼‰ï¼Œæœ€ç»ˆå³å°†å¯¹DRAMä¸­çš„TxTableå’ŒTxLogsè¿›è¡Œå›æ”¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;recovery&#34;&gt;Recovery&lt;/h2&gt;
&lt;p&gt;è‹¥å‘ç”Ÿæ‰ç”µï¼ŒKVSSDä¼šåˆ©ç”¨ç”µå®¹å°†KVç´¢å¼•æŒä¹…åŒ–åˆ°é—ªå­˜ä¸­çš„TxLogsï¼ŒTxTableæ›´æ–°å†…éƒ¨çš„æŒ‡é’ˆï¼Œåœ¨TxRecoveryä¸­è¿›è¡Œè®°å½•ã€‚åœ¨ç³»ç»Ÿé‡å¯æ—¶ï¼ŒKVSSDä¼šæ‰«æTx Recoveryï¼ŒåŠ è½½æœ€æ–°çš„TxTableï¼Œå¯¹äºå¤„äºCOMMITTEDçŠ¶æ€çš„äº‹åŠ¡ï¼Œå°†å…¶TxLogsç´¢å¼•åŠ è½½åˆ°Skiplistä¸­ï¼Œå¯¹äºå¤„äºRUNNINGçŠ¶æ€çš„äº‹åŠ¡ï¼Œç›´æ¥è¿›è¡ŒAbortå¹¶å›æ”¶å…¶èµ„æºã€‚&lt;/p&gt;
&lt;h1 id=&#34;conclusion--thinking&#34;&gt;Conclusion &amp;amp;&amp;amp; Thinking&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºK/Vå­˜å‚¨æ¶æ„çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡å¯¹Keyçš„è®¾è®¡ä¿è¯äº†åœ¨I/Oæ“ä½œä¸­çš„é«˜æ•ˆæ€§ã€‚é€šè¿‡æœ¬æ–‡äº†è§£äº†ä¸€äº›KVå­˜å‚¨çš„trickï¼Œå¯¹äºKVå­˜å‚¨çš„å„ç§åœºæ™¯ï¼Œæ— è®ºæ˜¯åœ¨Redisä¸­è¿˜æ˜¯åœ¨KVæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¯¹äºKeyçš„è®¾è®¡éƒ½è‡³å…³é‡è¦ï¼Œå¥½çš„è®¾è®¡å¾€å¾€èƒ½å¤Ÿå¸¦æ¥æå¤§çš„æ•ˆç‡æå‡ï¼Œä¾‹å¦‚å¸ƒéš†è¿‡æ»¤å™¨çš„åº”ç”¨ï¼Œæœ‰å¾ˆå¤šç»éªŒå€¼å¾—å­¦ä¹ ã€‚åŒæ—¶äº†è§£äº†å¯¹äº‹åŠ¡çš„ä¸€äº›æ§åˆ¶æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤ç¯‡è®ºæ–‡è®©æˆ‘æƒŠè®¶äºæ–‡ä»¶ç³»ç»Ÿè¿˜èƒ½é€šè¿‡KVå­˜å‚¨æ¥å®ç°çš„é€šçŸ¥ï¼Œè¿˜è®©æˆ‘å›æƒ³èµ·äº†TiDBï¼Œé€šè¿‡KVå­˜å‚¨ç³»ç»Ÿæ¥å®ç°äº†åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œå¹¶å®Œå…¨å…¼å®¹MySQLï¼Œè¯´æ˜åœ¨åˆ©ç”¨å¥½KVå­˜å‚¨çš„ç‰¹æ€§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³é—®é¢˜ï¼Œè¦å¤šå»å­¦ä¹ ä»–ä»¬çš„è®¾è®¡æ€æƒ³ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>[ATC&#39;19] Asynchronous I/O Stack: A Low-latency Kernel I/O Stack for Ultra-Low Latency SSDs</title>
        <link>https://blog.ipandai.club/p/atc19-asynchronous-i/o-stack-a-low-latency-kernel-i/o-stack-for-ultra-low-latency-ssds/</link>
        <pubDate>Wed, 17 Aug 2022 10:30:41 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/atc19-asynchronous-i/o-stack-a-low-latency-kernel-i/o-stack-for-ultra-low-latency-ssds/</guid>
        <description>&lt;h1 id=&#34;intro&#34;&gt;Intro&lt;/h1&gt;
&lt;p&gt;ä¼˜åŒ–I/Oçš„æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å±‚é¢ç›´æ¥è°ƒç”¨å¤–éƒ¨å­˜å‚¨è®¾å¤‡ï¼Œéœ€è¦åº”ç”¨åŒ…å«æ–‡ä»¶ç³»ç»Ÿçš„è°ƒç”¨ï¼Œè‡ƒè‚¿ï¼ŒåŒæ—¶ä¸åŒåº”ç”¨å’Œç”¨æˆ·é—´çš„å†²çªé—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ“ä½œç³»ç»Ÿå†…æ ¸çš„I/O æ ˆ
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è½®è¯¢æ¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€&lt;/li&gt;
&lt;li&gt;åœ¨åº•å±‚å‡å°‘ä¸€åŠçš„ä¸­æ–­å¤„ç†&lt;/li&gt;
&lt;li&gt;åˆ†æ•£I/OæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;I/O blockè°ƒåº¦æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;related-work&#34;&gt;Related Work&lt;/h1&gt;
&lt;p&gt;å‡å°‘å†…æ ¸çš„å¼€é”€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ä¸­æ–­å¤„ç†çš„ååŠéƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;æ˜¯ç”¨è½®è¯¢æŠ€æœ¯è€Œéä¸­æ–­ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;æ··åˆè½®è¯¢&lt;/li&gt;
&lt;li&gt;åŸºäºSSDçš„é—ªå­˜éšæœºè¯»å†™ç®€åŒ–è°ƒåº¦ç­–ç•¥&lt;/li&gt;
&lt;li&gt;åœ¨NVMeå›ºä»¶ä¸­è¿›è¡Œè°ƒåº¦&lt;/li&gt;
&lt;li&gt;å¯¹é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæä¾›ä¸åŒçš„IO pathæ”¯æŒï¼Œæœ€å°åŒ–IO pathçš„å¼€é”€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¿®æ”¹å­˜å‚¨æ¥å£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†æ•£/åˆ†æ•£ IOåˆå¹¶å¤šä¸ªIOåˆ°ä¸€ä¸ªæŒ‡ä»¤ï¼Œå‡å°‘å¾€è¿”æ¬¡æ•°&lt;/li&gt;
&lt;li&gt;ç§»é™¤doorbellæœºåˆ¶å’Œå®Œæˆä¿¡å·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ”¹å–„fsync&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†²fsyncè¯·æ±‚å‘å‡ºåˆ°æ”¶åˆ°responseï¼Œå»¶é•¿æ•°æ®æŒä¹…åŒ–çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;åœ¨æ—¥å¿—æäº¤è®°å½•ä¸­ä½¿ç”¨æ ¡éªŒå’Œï¼Œæœ‰æ•ˆçš„é‡å æ—¥å¿—å†™å…¥å’Œå—å†™å…¥&lt;/li&gt;
&lt;li&gt;æå‡º&lt;code&gt;å†™å®ˆåºç³»ç»Ÿè°ƒç”¨&lt;/code&gt;ï¼Œé‡å çš„fsyncæ•ˆæœç›¸åŒï¼Œå½“åº”ç”¨éœ€è¦ä½¿ç”¨fsyncæ—¶ï¼Œå…³äºIOçš„æ“ä½œå°†åŒæ­¥è¿›è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æˆ·å±‚ç›´æ¥è®¿é—®å¤–è®¾ï¼Œå­˜åœ¨éš”ç¦»ã€ä¿æŠ¤ç­‰å®‰å…¨é—®é¢˜&lt;/p&gt;
&lt;h1 id=&#34;motivation&#34;&gt;Motivation&lt;/h1&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ç°çŠ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I/O è¯·æ±‚è¿‡ç¨‹ä¸­å¤ªå¤šçš„æ­¥éª¤&lt;/li&gt;
&lt;li&gt;é¡µé¢ç¼“å­˜åˆ†é…å’Œç´¢å¼•&lt;/li&gt;
&lt;li&gt;DMAï¼Œä¸€ç³»åˆ—æ•°æ®ç»“æ„çš„åˆ›å»º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰çš„ ULL SDDå®ç°äº†ä½äº10å¾®å¦™çš„IOå»¶è¿Ÿï¼Œç„¶è€Œæ“ä½œç³»ç»Ÿå†…æ ¸äº§ç”Ÿçš„å»¶è¿Ÿæ²¡æœ‰æ˜æ˜¾å˜åŒ–&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸“æ³¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linuxå†…æ ¸ä¸­çš„&lt;code&gt;read()&lt;/code&gt;å’Œ&lt;code&gt;write()+fsync()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åŸºäºNVMe SSDçš„Ext4æ–‡ä»¶ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;for-read-path&#34;&gt;For Read Path&lt;/h2&gt;
&lt;p&gt;ç ”ç©¶å‘ç°è®¸å¤šå‰©ä½™çš„æ“ä½œä¸å¿…åœ¨è®¾å¤‡I/Oä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;æ­¤ç±»æ“ä½œå¯ä»¥åœ¨è®¾å¤‡I/Oæ“ä½œè¿›è¡Œæ—¶æ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ­¤ç±»æ“ä½œå¤§å¤šç‹¬ç«‹äºè®¾å¤‡I/Oæ“ä½œï¼Œå› æ­¤è€ƒè™‘è®©è¿™äº›æ“ä½œä¸IOé‡å &lt;/p&gt;
&lt;h2 id=&#34;for-write-path&#34;&gt;For Write Path&lt;/h2&gt;
&lt;p&gt;ç¼“å†²å†™&lt;code&gt;write()&lt;/code&gt;ï¼Œå¹¶ä¸å‘èµ·IOè¯·æ±‚ï¼Œä¸èƒ½å¼‚æ­¥å¤„ç†&lt;/p&gt;
&lt;p&gt;ç”±äºfsyncçš„å›å†™æœºåˆ¶å’Œæ–‡ä»¶ç³»ç»Ÿå´©æºƒä¸€è‡´æ€§ï¼ˆæ—¥å¿—ç³»ç»Ÿï¼‰ï¼ŒåŒ…å«éƒ¨åˆ†IOè¯·æ±‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ–‡ä»¶ç³»ç»Ÿå¸¦æ¥çš„ä¸‰æ¬¡IOæ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®å—å†™&lt;/li&gt;
&lt;li&gt;jbd2å‘èµ·å†™å…¥æ—¥å¿—Block I/O&lt;/li&gt;
&lt;li&gt;æäº¤Block I/O&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™äº›IOçš„åˆ›å»ºï¼Œæ¶‰åŠä¼—å¤šè¿‡ç¨‹ï¼ˆblockåˆ†é…ï¼Œè¯·æ±‚ç¼“å†²é¡µï¼Œåˆ›å»ºå’Œæäº¤bioï¼Œè®¾ç½®DMAåœ°å€ï¼‰ï¼Œå› æ­¤å¯ä»¥è®©CPUå°†è¿™äº›å‰ç½®æ“ä½œåœ¨IOè¯·æ±‚å‘èµ·å‰é¢„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;for-lightweight-block-layer&#34;&gt;For Lightweight Block Layer&lt;/h2&gt;
&lt;p&gt;ä¼ ç»ŸBlock Layeræ¶‰åŠè¿‡å¤šè¿‡ç¨‹ï¼Œæ¨è¿Ÿäº†IOæŒ‡ä»¤æäº¤ç»™è®¾å¤‡çš„æ—¶é—´&lt;/p&gt;
&lt;p&gt;å› ä¸ºULL SSDçš„é«˜é€ŸéšæœºIOæ€§èƒ½å’Œä½é€Ÿçš„é¡ºåºIOï¼Œè¯·æ±‚é‡æ’çš„æ•ˆæœå¾ˆä½&lt;/p&gt;
&lt;p&gt;ç®€åŒ–block layerï¼Œé’ˆå¯¹å¼‚æ­¥IO stackè¿›è¡Œä¼˜åŒ–&lt;/p&gt;
&lt;h1 id=&#34;design&#34;&gt;Design&lt;/h1&gt;
&lt;h2 id=&#34;è½»é‡åŒ–çš„block-io-layer&#34;&gt;è½»é‡åŒ–çš„Block I/O Layer&lt;/h2&gt;
&lt;p&gt;LBIOï¼Œä¸ºLL NVMe SSDè€Œè®¾è®¡ï¼Œåªæ”¯æŒIO submission/completionå’ŒIOæŒ‡ä»¤tagging&lt;/p&gt;
&lt;p&gt;åªä½¿ç”¨&lt;code&gt;lbio&lt;/code&gt;æ¥è¡¨ç¤ºä¸€ä¸ªblock I/Oè¯·æ±‚ï¼Œå‡å°‘äº†&lt;code&gt;bio-to-request&lt;/code&gt;çš„æ—¶é—´&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªlbioåŒ…æ‹¬&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LBA&lt;/li&gt;
&lt;li&gt;I/O é•¿åº¦&lt;/li&gt;
&lt;li&gt;å¤åˆ¶çš„é¡µé¢&lt;/li&gt;
&lt;li&gt;é¡µé¢çš„DMAåœ°å€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨å…¨å±€çš„lbioäºŒä½æ•°ç»„æ¥è®°å½•&lt;/p&gt;
&lt;p&gt;è¡Œçš„ä¸ªæ•°ä¸ºCPUæ ¸å¿ƒæ•°ï¼Œè¡Œæˆç»„è¢«åˆ†é…åˆ°ä¸€ä¸ªNVMeé˜Ÿåˆ—&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚8æ ¸å¿ƒï¼Œ4NVMeé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—åˆ†é…2ä¸ªæ ¸å¿ƒçš„lbio
å½“æ ¸å¿ƒæ•°ç­‰äºé˜Ÿåˆ—æ•°æ—¶ï¼Œå¯ä»¥å®ç°æ— é”çš„å‘½ä»¤æäº¤&lt;/p&gt;
&lt;p&gt;lbioåœ¨å…¨å±€æ•°ç»„ä¸­çš„ç´¢å¼•ç”¨ä½œNVMeæŒ‡ä»¤çš„tagï¼Œå‡å°‘äº†ä¹‹å‰èµ‹tagçš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;lbioæäº¤åï¼Œè°ƒç”¨&lt;code&gt;nvme_queue_lbio&lt;/code&gt;æ¥æäº¤I/OæŒ‡ä»¤&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;LBIOä¸ä¼šåˆå¹¶å’Œè°ƒåº¦IOè¯·æ±‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;read-path&#34;&gt;Read Path&lt;/h2&gt;
&lt;p&gt;Ext4æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”±extent status treeä¿å­˜ç¼“å­˜åˆ°ç‰©ç†æ–‡ä»¶blockçš„æ˜ å°„&lt;/p&gt;
&lt;p&gt;é¢„åŠ è½½æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå½“æ ‘å¤ªå¤§æ—¶ï¼Œå¯ä»¥åªå¯¹æŸä¸ªæ–‡ä»¶é¢„åŠ è½½&lt;/p&gt;
&lt;h3 id=&#34;å¼‚æ­¥é¡µé¢ç”³è¯·å’Œdmaåˆ†é…&#34;&gt;å¼‚æ­¥é¡µé¢ç”³è¯·å’ŒDMAåˆ†é…&lt;/h3&gt;
&lt;p&gt;æå‰åˆ†é…ç©ºé—²é¡µæ± &lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘é¡µé¢DMAçš„åˆ†é…ï¼Œä¸ºæ¯ä¸ªæ ¸ç»´æŠ¤ä¸€ä¸ªDMAæ˜ å°„ç©ºé—²é¡µï¼ˆ4KB DMAæ˜ å°„é¡µçš„é“¾è¡¨ï¼‰&lt;/p&gt;
&lt;p&gt;å½“ç©ºé—²é¡µæ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†é€€åŒ–ä¸ºåŒæ­¥è¿›è¡Œï¼ˆoriginï¼‰&lt;/p&gt;
&lt;h3 id=&#34;ç¼“å­˜é¡µç´¢å¼•&#34;&gt;ç¼“å­˜é¡µç´¢å¼•&lt;/h3&gt;
&lt;p&gt;è‡ªæ—‹é”é˜²æ­¢å¹¶å‘é—®é¢˜ï¼Œå½±å“æ•ˆç‡&lt;/p&gt;
&lt;p&gt;åœ¨è¯·æ±‚å‘å‡ºï¼Œä½†æ˜¯é¡µé¢è¿˜æ²¡æœ‰æ›´æ–°æ—¶ï¼Œå¯èƒ½é‡å¤è¯·æ±‚æ›´æ–°é¡µé¢&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆæ˜¯ä¸é™åˆ¶requestï¼Œåœ¨request completioné˜¶æ®µè§£å†³é—®é¢˜&lt;/p&gt;
&lt;p&gt;å°½ç®¡å¤šä¸ªblockè¯·æ±‚ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªé¡µé¢è¢«ç´¢å¼•&lt;/p&gt;
&lt;p&gt;å¯¹äºå…¶ä»–é¡µé¢ï¼Œæ ‡è®°ä¸ºabandonedï¼Œä¸­æ–­å‘ç”Ÿä¹‹åï¼Œå¦‚æœæ ‡è®°ä¸ºabandonedï¼Œåˆ™æ¸…é™¤å·²ç»å®Œæˆçš„é¡µé¢&lt;/p&gt;
&lt;h3 id=&#34;dmaè§£é™¤æ˜ å°„&#34;&gt;DMAè§£é™¤æ˜ å°„&lt;/h3&gt;
&lt;p&gt;åŸæœ¬ä½¿ç”¨ä¸­æ–­æ¥å¤„ç†ï¼Œæ”¹ä¸ºå½“ç³»ç»Ÿç©ºé—²æˆ–ç­‰å¾…ä¸€ä¸ªIOè¯·æ±‚æ—¶å¤„ç†&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹å¼å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´çª—å£ï¼Œè‹¥ä¸å—åˆ°æ¶æ„è®¿é—®ï¼Œä¸ä¼šäº§ç”Ÿå½±å“ï¼Œå¦åˆ™ç”¨æˆ·å¯ä»¥è‡ªè¡Œé€‰æ‹©å…³é—­æƒ°æ€§DMAæ˜ å°„æ¥è§¦&lt;/p&gt;
&lt;h2 id=&#34;write--fsync-path&#34;&gt;Write &amp;amp;&amp;amp; fsync Path&lt;/h2&gt;
&lt;p&gt;å½“fsyncæ¶‰åŠæ–‡ä»¶ç³»ç»Ÿä¸­äº‹åŠ¡æ—¶ï¼Œå¯ä»¥å°†jbd2æ—¥å¿—å¤„ç†é‡å å¤„ç†&lt;/p&gt;
&lt;h1 id=&#34;experiment&#34;&gt;Experiment&lt;/h1&gt;
&lt;p&gt;åŸºäºLinuxå†…æ ¸5.0.5ç‰ˆæœ¬&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦&lt;code&gt;O_AIOS&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;evaluation&#34;&gt;Evaluation&lt;/h1&gt;
&lt;h1 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;æå‡ºäº†AIOS&lt;/p&gt;
&lt;p&gt;LBIOå±‚&lt;/p&gt;
&lt;p&gt;AIOSå°†I/Oè·¯å¾„ä¸­çš„åŒæ­¥æ“ä½œæ›¿æ¢ä¸ºå¼‚æ­¥æ“ä½œï¼Œä»¥å°†ä¸è¯»å–å’Œfsyncç›¸å…³çš„è®¡ç®—ä¸è®¾å¤‡I/Oè®¿é—®é‡å ã€‚&lt;/p&gt;
&lt;p&gt;AIOSåœ¨Optane SSDä¸Šå®ç°äº†ä¸€ä½æ•°å¾®ç§’çš„I/Oå»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒAIOSé€šè¿‡Z-SSDå’ŒOptane SSDä¸Šçš„æ¨¡æ‹Ÿå®éªŒå’Œå®é™…æµ‹è¯•æ˜¾è‘—é™ä½å»¶è¿Ÿå’Œæ€§èƒ½æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸€äº›å¯å‘&#34;&gt;ä¸€äº›å¯å‘&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ä¼˜åŒ–I/Oå¯ä»¥ä»CPUçš„ç©ºé—²æ—¶é—´åˆ†æï¼Œéœ€è¦è€ƒè™‘å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ï¼Œæœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨CPUèµ„æºï¼Œå‡å°‘ç©ºé—²ã€‚&lt;/li&gt;
&lt;li&gt;ç¡¬ä»¶è®¾å¤‡åœ¨å‘å±•çš„åŒæ—¶ï¼Œè½¯ä»¶åº”è¯¥æä¾›å¿…è¦é€‚é…&lt;/li&gt;
&lt;li&gt;å‡å°‘å†…æ ¸ä¸­ä¸I/Oç›¸å…³çš„ç»“æ„ç±»å‹è½¬åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœæ—¶é—´å¼€é”€&lt;/li&gt;
&lt;li&gt;æƒ°æ€§ä¿®æ”¹ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œåœ¨ä¿è¯å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æé«˜æ•ˆç‡&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>[OSDI&#39;19] Flashshare: Punching Through Server Storage Stack from Kernel to Firmware for Ultra-Low Latency SSDs</title>
        <link>https://blog.ipandai.club/p/osdi19-flashshare-punching-through-server-storage-stack-from-kernel-to-firmware-for-ultra-low-latency-ssds/</link>
        <pubDate>Wed, 17 Aug 2022 10:30:30 +0800</pubDate>
        
        <guid>https://blog.ipandai.club/p/osdi19-flashshare-punching-through-server-storage-stack-from-kernel-to-firmware-for-ultra-low-latency-ssds/</guid>
        <description>&lt;p&gt;è¶…ä½å»¶è¿Ÿå›ºæ€ç¡¬ç›˜ä»å†…æ ¸åˆ°å›ºä»¶çš„æœåŠ¡å™¨å­˜å‚¨å †æ ˆ&lt;/p&gt;
&lt;h1 id=&#34;ä¸ªåˆ«åè¯è§£é‡Š&#34;&gt;ä¸ªåˆ«åè¯è§£é‡Š&lt;/h1&gt;
&lt;p&gt;the 99^th percentile è¶…è¿‡ç»Ÿè®¡æ•°æ®99%çš„æ•°æ˜¯å¤šå°‘&lt;/p&gt;
&lt;p&gt;blk-mq Linux Multiqueue block layer å†…æ ¸å¯¹ssdéšæœºI/Oçš„ä¼˜åŒ–&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;message signaled interrupt (MSI)&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;1æ‘˜è¦&#34;&gt;1.æ‘˜è¦&lt;/h1&gt;
&lt;p&gt;flash share&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸ä¸­ï¼Œæ‰©å±•äº†ç³»ç»Ÿå †æ ˆçš„æ•°æ®ç»“æ„ï¼Œä¼ é€’åº”ç”¨ç¨‹åºçš„å±æ€§ï¼ˆï¼Ÿï¼‰ï¼ŒåŒ…æ‹¬å†…æ ¸å±‚åˆ°SSDå›ºä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç»™å®šçš„å±æ€§ï¼ŒFlashShareçš„å—å±‚ç®¡ç†IOè°ƒåº¦å¹¶å¤„ç†NVMeä¸­æ–­ã€‚&lt;/p&gt;
&lt;p&gt;è¯„ä¼°ç»“æœè¡¨æ˜ï¼ŒFLASHSHAREå¯ä»¥å°†å…±åŒè¿è¡Œåº”ç”¨ç¨‹åºçš„å¹³å‡å‘¨è½¬å“åº”æ—¶é—´åˆ†åˆ«ç¼©çŸ­22%å’Œ31%ã€‚&lt;/p&gt;
&lt;h1 id=&#34;10-intro&#34;&gt;1.0 Intro&lt;/h1&gt;
&lt;h2 id=&#34;11-ç°çŠ¶&#34;&gt;1.1 ç°çŠ¶&lt;/h2&gt;
&lt;p&gt;ç½‘ç»œæœåŠ¡æä¾›å•†ï¼Œæ»¡è¶³æœåŠ¡çº§åˆ«åè®®SLAï¼Œå»¶è¿Ÿæ•æ„Ÿ&lt;/p&gt;
&lt;p&gt;æŸä¸ªæ®µæ—¶é—´çŸ­å¯èƒ½æœ‰å¤§é‡è¯·æ±‚æ¶Œå…¥ï¼Œä¾›åº”å•†ä¼šè¶…é¢é…ç½®æœºå™¨ä»¥æ»¡è¶³SLA&lt;/p&gt;
&lt;p&gt;ç°çŠ¶ï¼šè¯¥åœºæ™¯å¹¶ä¸å¸¸è§ï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹æœåŠ¡å™¨çš„èµ„æºå ç”¨ç‡éå¸¸ä½ï¼Œèƒ½è€—æ¯”ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³åˆ©ç”¨ç‡ä½ï¼ŒæœåŠ¡å™¨ä¼šè¿è¡Œç¦»çº¿çš„æ•°æ®åˆ†æåº”ç”¨ï¼Œå»¶è¿Ÿä¸æ•æ„Ÿï¼Œä»¥ååé‡ä¸ºå¯¼å‘ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œåœ¨è¿è¡Œäº†å¤šä¸ªè¿›ç¨‹çš„æœåŠ¡å™¨ä¸Šï¼ŒI/Oå»¶è¿Ÿå¢é«˜ï¼Œæ»¡è¶³SLAéå¸¸å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;ç°æœ‰çš„ULL SSDç›¸è¾ƒäºNVMe SSDå¯ä»¥å‡å°‘10å€çš„å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™äº›ULL SSDåœ¨åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ä¸‹é«˜å¼ºåº¦å‹æ¦¨æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¸èƒ½å……åˆ†åˆ©ç”¨ULL SSDçš„ä¼˜åŠ¿/è¡¨ç°ä¸€èˆ¬ã€‚&lt;/p&gt;
&lt;p&gt;the 99th percentile æ˜¯0.8msï¼ˆapacheï¼‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å½“æœåŠ¡å™¨åŒæ—¶è¿è¡Œpagerankçš„æ—¶å€™ï¼Œå»¶è¿Ÿä¼šå¢åŠ 228.5%ã€‚&lt;/p&gt;
&lt;p&gt;åŸå› ï¼šç•¥&lt;/p&gt;
&lt;p&gt;ä»å›ºä»¶åˆ°å†…æ ¸ä¼˜åŒ–å †æ ˆçš„å­˜å‚¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…æ ¸çº§åˆ«çš„å¢å¼ºï¼š&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªæŒ‘æˆ˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Linuxçš„blk-mqå¯¼è‡´I/Oè¯·æ±‚é˜Ÿåˆ—åŒ–ï¼Œå¼•å…¥å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;NVMeçš„é˜Ÿåˆ—æœºåˆ¶æ²¡æœ‰å¯¹I/Oä¼˜å…ˆçº§çš„ç­–ç•¥ï¼Œå› æ­¤ï¼Œæ¥è‡ªç¦»çº¿åº”ç”¨çš„IOè¯·æ±‚å®¹æ˜“é˜»å¡åœ¨çº¿åº”ç”¨çš„ç´§æ€¥è¯·æ±‚ï¼Œé€ æˆå»¶è¿Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºlatency criticalçš„è¯·æ±‚ï¼Œç»•è¿‡NVMeçš„è¯·æ±‚é˜Ÿåˆ—ã€‚åŒæ—¶ä»¤NVMeçš„é©±åŠ¨é€šè¿‡çŸ¥æ™“æ¯ä¸ªåº”ç”¨çš„å»¶è¿Ÿä¸´ç•ŒåŒ¹é…NVMeçš„æäº¤å’Œè¯·æ±‚é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›ºä»¶å±‚è®¾è®¡ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹		å³ä½¿å†…æ ¸çº§çš„ä¼˜åŒ–ä¿è¯äº†å»¶è¿Ÿæ•æ„Ÿçš„è¯·æ±‚å¯ä»¥è·å¾—é«˜ä¼˜å…ˆçº§ï¼Œä½†å¦‚æœåŸºç¡€å›ºä»¶ä¸äº†è§£å»¶è¿Ÿä¸´ç•Œå€¼ï¼ŒULLç‰¹æ€§ï¼ˆç±»ä¼¼å†…å­˜çš„æ€§èƒ½ï¼‰æ— æ³•å®Œå…¨æš´éœ²ç»™ç”¨æˆ·ã€‚æœ¬æ–‡ä¸­é‡æ–°è®¾è®¡äº†I/Oè°ƒåº¦å’Œç¼“å­˜çš„å›ºä»¶ï¼Œä»¥ç›´æ¥å‘ç”¨æˆ·æš´éœ²ULLç‰¹æ€§ã€‚å°†ULL SSDçš„é›†æˆç¼“å­˜è¿›è¡Œåˆ†åŒºï¼Œå¹¶æ ¹æ®å·¥ä½œè´Ÿè½½çš„å±æ€§å¯¹æ¯ä¸ªI/OæœåŠ¡ç‹¬ç«‹çš„åˆ†é…ç¼“å­˜ã€‚å›ºä»¶åŠ¨æ€çš„æ›´æ–°åˆ†åŒºå¤§å°å¹¶ä»¥ç²¾ç»†ç²’åº¦è°ƒæ•´é¢„å–I/Oç²’åº¦ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ULL SSDçš„æ–°ä¸­æ–­å¤„ç†æœåŠ¡ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹	å½“å‰çš„NVMeä¸­æ–­æœºåˆ¶æ²¡æœ‰å¯¹ULL I/OæœåŠ¡ä¼˜åŒ–ã€‚è½®è¯¢æ–¹æ³•ï¼ˆLinux 4.9.30ï¼‰æ¶ˆè€—äº†å¤§é‡çš„CPUèµ„æºå»æ£€æŸ¥I/OæœåŠ¡çš„å®Œæˆæƒ…å†µã€‚å½“è½®è¯¢åœ¨çº¿äº¤äº’æœåŠ¡çš„IOè¯·æ±‚å®ŒæˆçŠ¶æ€æ—¶ï¼ŒflashShareä½¿ç”¨ä¸€ä¸ªä»…å¯¹ç¦»çº¿åº”ç”¨ç¨‹åºä½¿ç”¨æ¶ˆæ¯ä¿¡å·ä¸­æ–­çš„é€‰æ‹©æ€§ä¸­æ–­æœåŠ¡ç¨‹åºSelect-ISRã€‚&lt;/p&gt;
&lt;p&gt;â€‹	é€šè¿‡å°†NVMeé˜Ÿåˆ—å’ŒISRå¸è½½åˆ°ç¡¬ä»¶åŠ é€Ÿå™¨ä¸­æ¥è¿›ä¸€æ­¥ä¼˜åŒ–NVMe completion routineã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å„ç§ä»¿çœŸå®éªŒåæ•ˆæœä¸é”™ï¼Œæ•ˆç‡æé«˜äº†22%å’Œ31%ã€‚&lt;/p&gt;
&lt;h1 id=&#34;20-background&#34;&gt;2.0 Background&lt;/h1&gt;
&lt;h2 id=&#34;21-å­˜å‚¨å†…æ ¸æ ˆ&#34;&gt;2.1 å­˜å‚¨å†…æ ¸æ ˆ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220810145032258.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220810145032258&#34;
	
	
&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Linuxæ–‡ä»¶ç³»ç»ŸIO&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bio&lt;/li&gt;
&lt;li&gt;request&lt;/li&gt;
&lt;li&gt;nvme_rw_command&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å­˜å‚¨å †æ ˆä¸­ï¼ŒNVMeé©±åŠ¨å‘èµ·çš„è¯·æ±‚é€šè¿‡nvme_rw_commandçš„å½¢å¼ä¼ é€’åˆ°PCI/PCIeè®¾å¤‡é©±åŠ¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å½“I/Oè¯·æ±‚å®Œæˆåï¼Œå‘é€ä¿¡å·ä¸­æ–­ï¼Œä¸­æ–­ç›´æ¥è¢«å†™å…¥åˆ°ä¸­æ–­å¤„ç†å™¨çš„ä¸­æ–­å‘é‡ä¸­ã€‚è¢«ä¸­æ–­çš„æ ¸å¿ƒé€‰æ‹©ISRå¤„ç†è¯¥ä¸­æ–­è¯·æ±‚ï¼ŒéšåNVMeé©±åŠ¨å†SQ/CQä¸­æ¸…ç©ºç›¸åº”çš„è®°å½•å¹¶å°†ç»“æœè¿”å›è‡³ä¸Šä¸€å±‚ï¼ˆæ¯”å¦‚blk-mqå’Œæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;22-è®¾å¤‡å›ºä»¶æ ˆ&#34;&gt;2.2 è®¾å¤‡å›ºä»¶æ ˆ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220810232230437.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220810232230437&#34;
	
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ”¶åˆ°request&lt;/li&gt;
&lt;li&gt;SQ tail++å…¥é˜Ÿ&lt;/li&gt;
&lt;li&gt;å†™å…¥SQé—¨é“ƒå¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;é€šè¿‡DMAè¯»å–æ•°æ®çš„ç‰©ç†ä½ç½®&lt;/li&gt;
&lt;li&gt;SQ head++å‡ºé˜Ÿ&lt;/li&gt;
&lt;li&gt;å°†è¯·æ±‚è½¬å‘è‡³åµŒå…¥å¼ç¼“å­˜å±‚æˆ–è€…FTL&lt;/li&gt;
&lt;li&gt;å½“å‡ºç°ç¼ºé¡µæˆ–è€…é¡µé¢æ›¿æ¢æ—¶ï¼ŒFTLå°†ç›®æ ‡LBAè½¬æ¢æˆZ-NANDä¸­ç›¸åº”çš„ç‰©ç†åœ°å€ï¼Œå¿…è¦æ—¶è‡ªè¡ŒGC&lt;/li&gt;
&lt;li&gt;åœ¨å®ŒæˆI/Oè¯·æ±‚ä¹‹åï¼ŒNVMeæ§åˆ¶å™¨å¢åŠ è¿™ä¸ªCQçš„tailï¼Œå…¥é˜Ÿ&lt;/li&gt;
&lt;li&gt;é€šè¿‡DMAä¼ è¾“æ•°æ®ï¼Œå¹¶ä¿®æ”¹phase tag&lt;/li&gt;
&lt;li&gt;ä¸»æœºISRé€šè¿‡æœç´¢é˜Ÿåˆ—ä¸­æ£€æŸ¥phase tagï¼Œå¯¹äºæœ‰æ•ˆçš„phase tagï¼ŒISRæ¸…é™¤tagä½ï¼Œå¹¶ä¸”å¤„ç†å‰©ä½™çš„I/Oå®Œæˆè¯·æ±‚ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;CQ head++å‡ºé˜Ÿï¼Œåœ¨SQä¸­ç§»é™¤ç›¸åº”çš„è®°å½•ï¼Œå¹¶ä¸”å†™å…¥CQçš„head doorbell&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;30-è·¨å±‚è®¾è®¡&#34;&gt;3.0 è·¨å±‚è®¾è®¡&lt;/h1&gt;
&lt;h2 id=&#34;31-å¿«é€Ÿå­˜å‚¨çš„æŒ‘æˆ˜&#34;&gt;3.1 å¿«é€Ÿå­˜å‚¨çš„æŒ‘æˆ˜&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811110758918.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811110758918&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯å­˜å‚¨æ ˆæ— æ³•åŒºåˆ†æ¥è‡ªApacheçš„I/Oè¯·æ±‚ï¼ŒåŠæ—¶ä¸¤ä¸ªåº”ç”¨éœ€è¦ä¸åŒçº§åˆ«I/Oçš„å“åº”ã€‚&lt;/p&gt;
&lt;h1 id=&#34;32-é¢„çŸ¥çµæ•å“åº”&#34;&gt;3.2 é¢„çŸ¥çµæ•å“åº”&lt;/h1&gt;
&lt;p&gt;ä¸ºäº†è®©å†…æ ¸å¯ä»¥åŒºåˆ†I/O è¯·æ±‚çš„ä¼˜å…ˆçº§å’Œç´§è¿«ç¨‹åº¦ï¼Œä¿®æ”¹Linuxçš„è¿›ç¨‹æ§åˆ¶å¿«&lt;code&gt;task_struct&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯æœ‰æ•ˆæ€§ï¼Œåœ¨&lt;code&gt;address_space&lt;/code&gt;,&lt;code&gt;bio&lt;/code&gt;,&lt;code&gt;request&lt;/code&gt;,&lt;code&gt;nvme_rw_command&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸­éƒ½ä¿å­˜å·¥ä½œè´Ÿè½½å±æ€§ï¼Œåœ¨å­˜å‚¨å †æ ˆä¸Šæ‰“å­”ã€‚&lt;/p&gt;
&lt;p&gt;FlashShareåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šé…ç½®è¿™äº›å±æ€§çš„å·¥å…·ã€‚å«åš&lt;code&gt;chworkload_attr&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥æ–¹ä¾¿çš„ä¿®æ”¹æ¯ä¸ªåº”ç”¨çš„å±æ€§å¹¶ç»‘å®šåˆ°&lt;code&gt;task_struct&lt;/code&gt;ä¸­&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹äº†syscallè¡¨&lt;code&gt;arch/x86/entry/syscalls/syscall 64.tbl&lt;/code&gt;æ·»åŠ äº†ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ä»&lt;code&gt;task_struct&lt;/code&gt;ä¸­set/getå·¥ä½œå±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;/linux/syscall.h&lt;/code&gt;ä¸­è¿›è¡Œæ³¨å†Œï¼Œå¹¶å¸¦æœ‰&lt;code&gt;asmlinkage&lt;/code&gt;æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·é€šè¿‡shellç»™å®šç‰¹å®šè¿›ç¨‹ï¼Œå®ç°äº&lt;code&gt;/sched/cores.c&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;33-å†…æ ¸ä¼˜åŒ–&#34;&gt;3.3 å†…æ ¸ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿä¸­çš„blk-mqå’ŒNVMeé©±åŠ¨&lt;/p&gt;
&lt;p&gt;blk-mqåˆå¹¶é‡æ’è¯·æ±‚æé«˜äº†å¸¦å®½ä½¿ç”¨ï¼Œä½†æ˜¯å¼•å…¥äº†å»¶è¿Ÿ&lt;/p&gt;
&lt;p&gt;è·³è¿‡æ‰€æœ‰åœ¨çº¿åº”ç”¨çš„I/O è¯·æ±‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç¦»çº¿åº”ç”¨ç¨‹åºçš„ I/O è¯·æ±‚è¢« blk-mq è°ƒåº¦åˆ°åç»­åœ¨çº¿åº”ç”¨ç¨‹åºå‘å‡ºçš„åŒä¸€ LBAï¼Œåˆ™å¯èƒ½å‘ç”Ÿå±é™©ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸¤ä¸ªè¯·æ±‚çš„æ“ä½œç±»å‹ä¸åŒï¼Œblk-mqä¼šå°†ä¸¤ä¸ªè¯·æ±‚ä¸²è”ã€‚å¦åˆ™blk-mqä¼šå°†ä¸¤ä¸ªè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ª&lt;code&gt;request&lt;/code&gt;å¹¶äº¤ç»™NVMeé©±åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢å»¶è¿Ÿæ•æ„Ÿçš„I/O è¢«NVMeæ§åˆ¶å™¨æ€æ­»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºæ¯ä¸ªæ ¸å¿ƒåˆ›å»ºä¸¤ä¸ªSQé˜Ÿåˆ—å’Œä¸€ä¸ªCQé˜Ÿåˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811173922087.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811173922087&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ä¸€ä¸ªSQä¿å­˜æ¥è‡ªåœ¨çº¿åº”ç”¨çš„I/Oè¯·æ±‚ã€‚&lt;strong&gt;NVMeé©±åŠ¨ç¨‹åºé€šè¿‡ç®¡ç†å‘˜é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥NVMeæ§åˆ¶å™¨é€‰æ‹©ä¸€ç§æ–°çš„é˜Ÿåˆ—è°ƒåº¦æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å§‹ç»ˆä¼˜å…ˆå®‰æ’è¯¥SQä¸­çš„è¯·æ±‚ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœªæ¥é¿å…å› ä¼˜å…ˆçº§å¸¦æ¥çš„é¥¥é¥¿ï¼Œå½“è¯¥é˜Ÿåˆ—ä¸­çš„è¯·æ±‚æ•°é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œæˆ–è€…æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…è¢«æ»¡è¶³ï¼ŒNVMeé©±åŠ¨ä¼šæ»¡è¶³æ‰€æœ‰ç¦»çº¿åº”ç”¨I/O ã€‚&lt;/p&gt;
&lt;p&gt;å®éªŒè¡¨æ˜ï¼Œé˜Ÿåˆ—å¤§å°ä¸º8æˆ–è€…200usçš„é˜ˆå€¼æœ€å¥½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;40-io-completionå’Œç¼“å­˜&#34;&gt;4.0 I/O Completionå’Œç¼“å­˜&lt;/h1&gt;
&lt;p&gt;é‡‡ç”¨è½®è¯¢æœºåˆ¶æ—¶æŸ¥è¯¢I/O Completionæ—¶ï¼Œå†…æ ¸æ€å ç”¨97%ã€‚&lt;/p&gt;
&lt;p&gt;å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ²¡æœ‰ä¸ºå¤„ç†I/O å“åº”å•ç‹¬åˆ†é…æ ¸å¿ƒï¼Œå¯¹äºå¤šè¿›ç¨‹ä¸‹ä½æ•ˆ&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬è¦å‡è½»å¤„ç†I/Oè½®è¯¢çš„æ ¸å¿ƒå¼€é”€ï¼Œè¿›ä¸€æ­¥é™ä½å»¶è¿Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;41-ä¸­æ–­å¤„ç†ç¨‹åº&#34;&gt;4.1 ä¸­æ–­å¤„ç†ç¨‹åº&lt;/h2&gt;
&lt;p&gt;flash shareä»…å¯¹æ¥è‡ªåœ¨çº¿åº”ç”¨çš„I/O è¯·æ±‚ä½¿ç”¨è½®è¯¢&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¿¡å·å¤„ç†ç¦»çº¿åº”ç”¨&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220811231355037.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220811231355037&#34;
	
	
&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®æ”¹blk-mqä¸­çš„&lt;code&gt;submit_bio()&lt;/code&gt;ï¼Œå°†ç”±æ–‡ä»¶ç³»ç»Ÿæˆ–ç¼“å­˜çš„bioæ’å…¥åˆ°mq&lt;/li&gt;
&lt;li&gt;å¦‚æœbioæ˜¯æ¥è‡ªç¦»çº¿åº”ç”¨çš„ï¼Œåˆ™æ’å…¥é˜Ÿåˆ—ï¼Œas normal&lt;/li&gt;
&lt;li&gt;å¦‚æœbioæ˜¯æ¥è‡ªåœ¨çº¿åº”ç”¨çš„ï¼Œblk-mqåˆ™è°ƒç”¨&lt;code&gt;queue_rq()&lt;/code&gt;å°†è¯·æ±‚å‘é€è‡³NVMeé©±åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;NVMeé©±åŠ¨è½¬æ¢I/O è¯·æ±‚ä¸ºNVMeæŒ‡ä»¤å¹¶éæ’å…¥åˆ°å“åº”SQé˜Ÿåˆ—ä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½¿ç”¨Select-ISRï¼Œå½“è¯·æ±‚ä¸ºç¦»çº¿åº”ç”¨æ—¶ï¼ŒCPUæ ¸å¿ƒå¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢ä»NVMeé©±åŠ¨ä¸­é‡Šæ”¾ã€‚å¦åˆ™ï¼Œblk-mqè°ƒç”¨è½®è¯¢æœºåˆ¶&lt;code&gt;blk-poll()&lt;/code&gt;ã€‚&lt;code&gt;blk-poll()&lt;/code&gt;æŒç»­è°ƒç”¨&lt;code&gt;nvme_poll()&lt;/code&gt;ï¼Œæ£€æŸ¥æœ‰æ•ˆçš„å®Œæˆè®°å½•æ˜¯å¦å­˜åœ¨äºç›®æ ‡NVMe CQä¸­ã€‚å¦‚æœå­˜åœ¨ï¼Œblk-mqç¦ç”¨æ­¤CQçš„IRQï¼Œä»¥è‡³äºMSIä¿¡å·æ— æ³•å†æ¬¡æ•è·blk-mqç¨‹åºã€‚&lt;code&gt;nvme_poll()&lt;/code&gt;é€šè¿‡æ£€æŸ¥CQä¸­çš„phase tagsæŸ¥æ‰¾CQä¸­çš„æ–°è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œ&lt;code&gt;nvme poll()&lt;/code&gt;æœç´¢ä¸€ä¸ªCQè®°å½•ï¼Œå…¶è¯·æ±‚ä¿¡æ¯ä¸&lt;code&gt;blk poll()&lt;/code&gt;ç­‰å¾…å®Œæˆçš„æ ‡ç­¾åŒ¹é…ã€‚ä¸€æ—¦æ£€æµ‹åˆ°è¿™æ ·çš„æ–°è®°å½•ï¼Œblk-mqå°±ä¼šé€€å‡ºåœ¨&lt;code&gt;blk poll()&lt;/code&gt;ä¸­å®ç°çš„æ— é™è¿­ä»£ï¼Œå¹¶å°†ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å…¶ç”¨æˆ·è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æå‡º&lt;code&gt;I/O-stack accelerator&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦ç›®çš„æ˜¯å°†blk-mqçš„ä»»åŠ¡è¿ç§»åˆ°é™„å±äºPCIeçš„åŠ é€Ÿå™¨ä¸­&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿å¾—é€šè¿‡ä¸Šå±‚æ–‡ä»¶ç³»ç»Ÿç”Ÿæˆçš„bioç›´æ¥è½¬æ¢æˆ&lt;code&gt;nvm_rw_command&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç‰¹æ®Šçš„tagç´¢å¼•æœç´¢é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œå¹¶ä¸”ä»£è¡¨CPUåˆå¹¶bio&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹æ³•å¯ä»¥å‡å°‘36%çš„I/O completionæ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;42-å›ºä»¶å±‚&#34;&gt;4.2 å›ºä»¶å±‚&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºä¸¤ä¸ªå†…å­˜åˆ†åŒºï¼Œä¸€ä¸ªæœåŠ¡äºåœ¨çº¿åº”ç”¨ï¼Œä¸€ä¸ªæœåŠ¡äºç¦»çº¿åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‰ç§æ¨¡å¼&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å›ºå®šæ‹†åˆ†ç¼“å­˜&lt;/li&gt;
&lt;li&gt;æ ¹æ®I/OåŠ¨æ€åˆ’åˆ†&lt;/li&gt;
&lt;li&gt;æ•°æ®å¯ä¿ç•™&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220812003132031.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220812003132031&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;43-io-stack-acceleration&#34;&gt;4.3 I/O-Stack Acceleration&lt;/h2&gt;
&lt;p&gt;æ·»åŠ äº†ä¸€ä¸ªbarrier logicï¼Œç®€å•çš„MUXï¼Œä½œä¸ºç¡¬ä»¶ä»²è£&lt;/p&gt;
&lt;p&gt;å¼•å…¥status bitmapæ¥è¿‡æ»¤SQé˜Ÿåˆ—ä¸­çš„è®°å½•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå¹¶é€»è¾‘æ’å…¥ä¸€ä¸ªè¡Œçš„nvme æŒ‡ä»¤ï¼Œstatus bitmapè®¾ç½®ä¸º1&lt;/li&gt;
&lt;li&gt;å¦‚æœç›‘æµ‹åˆ°ULL SSDä»I/O SQä¸­è¯»å–NVMeæŒ‡ä»¤ï¼Œstatus bitmapè®¾ç½®ä¸º0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœçŠ¶æ€ä½å›¾è¡¨æ˜CAMä¸­çš„è¯·æ±‚æ¡ç›®ï¼ˆä¸ç›®æ ‡SQç›¸å…³è”ï¼‰æ— æ•ˆï¼ŒCAMå°†è·³è¿‡å¯¹è¿™äº›æ¡ç›®çš„æœç´¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;50-å®éªŒ&#34;&gt;5.0 å®éªŒ&lt;/h1&gt;
&lt;h2 id=&#34;51-å®éªŒæ­¥éª¤&#34;&gt;5.1 å®éªŒæ­¥éª¤&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨gem5ç³»ç»Ÿç»“æ„æ¨¡æ‹Ÿ&lt;/p&gt;
&lt;p&gt;64ä½armæŒ‡ä»¤é›†&lt;/p&gt;
&lt;p&gt;Linux 4.9.30&lt;/p&gt;
&lt;p&gt;8æ ¸å¿ƒ2GHz&lt;/p&gt;
&lt;p&gt;L1 Cache 64KB&lt;/p&gt;
&lt;p&gt;2GB Memory&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.ipandai.club/img/image-20220812191343849.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image-20220812191343849&#34;
	
	
&gt;&lt;/p&gt;
&lt;h1 id=&#34;related-work&#34;&gt;Related Work&lt;/h1&gt;
&lt;p&gt;å°†SSDå›ºä»¶è½¬ç§»åˆ°ä¸»æœºä¸Šï¼Œæ¶ˆé™¤å†—ä½™çš„åœ°å€è½¬æ¢&lt;/p&gt;
&lt;p&gt;æ ¹æ®åº”ç”¨ç¨‹åºç‰¹å¾å¯¹ç¼“å­˜è¿›è¡Œåˆ†åŒºå¤„ç†ï¼Œç„¶è€Œä¸èƒ½å‘æŒ¥ULL SSDçš„ä½œç”¨&lt;/p&gt;
&lt;p&gt;ä»æ–‡ä»¶ç³»ç»Ÿå’Œblock IOè®¾å¤‡æ–¹é¢ä¼˜åŒ–ç§»åŠ¨ç«¯æ“ä½œç³»ç»Ÿï¼Œä½¿å…¶æé«˜SQLiteçš„æ€§èƒ½ï¼Œæœ‰å±€é™æ€§ï¼Œåº”ç”¨ç¨‹åºã€ULL SSD&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸çš„å¤šä¸ªå±‚å¯¹å†™è¯·æ±‚è¿›è¡Œè°ƒåº¦ï¼Œå®¹æ˜“é˜»å¡è¯»è¯·æ±‚å’ŒULLæ“ä½œ&lt;/p&gt;
&lt;p&gt;æ ¹æ®å‰å°ä»»åŠ¡å’Œåå°ä»»åŠ¡ä¸­çš„ä¾èµ–å…³ç³»ï¼Œåˆ†é…ä¼˜å…ˆçº§ï¼Œå…è®¸åå°ä»»åŠ¡é«˜ä¼˜å…ˆçº§ï¼ŒIOé€šå¸¸æƒ…å†µä¸‹æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œæ•ˆæœå·®ï¼ŒæœåŠ¡å™¨å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šè¿›ç¨‹&lt;/p&gt;
&lt;p&gt;è€ƒè™‘å¯¹åœ¨çº¿åº”ç”¨è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼Œä½†æ˜¯æ²¡æœ‰è€ƒè™‘å¯¹IO stackä¸­å…¶ä»–éƒ¨åˆ†çš„å½±å“&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
